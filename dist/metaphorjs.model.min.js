(function(){var H=Array.prototype.slice,Y=function(h){return!(!h||h.constructor!==Object)},h=function(h){return"undefined"==typeof h},p=function b(){var d=!1,a=!1,c=H.call(arguments),e=c.shift(),g,f,z;"boolean"==typeof c[c.length-1]&&(d=c.pop());"boolean"==typeof c[c.length-1]&&(a=d,d=c.pop());for(;c.length;)if(g=c.shift())for(f in g)if(g.hasOwnProperty(f)&&!h(z=g[f]))if(a)if(e[f]&&Y(e[f])&&Y(z))b(e[f],z,d,a);else{if(!0===d||h(e[f])||null===e[f])Y(z)?(e[f]={},b(e[f],z,d,!0)):e[f]=z}else if(!0===d||
h(e[f])||null===e[f])e[f]=z;return e},A=function(b){return"function"===typeof b},r=function(b){return"string"==typeof b},M=function(b){return null!=b&&"object"===typeof b},Z=function(b,d){var a={};b||(b=h(global)?window:global);this.register=function(c,e){var g;g=c;var f=g.split("."),z,n=f.pop();z=f.join(".");var u=f.length,v,x=b;if(a[z])g=[a[z],n,g];else{if(0<u)for(z=0;z<u;z++){v=f[z];if(d&&0==z)if(v==d){x=b;continue}else g=d+"."+g;h(x[v])&&(x[v]={});x=x[v]}else d&&(g=d+"."+g);g=[x,n,g]}f=g[0];n=
g[1];M(f)&&h(f[n])&&(f[n]=e,a[g[2]]=e);return e};this.exists=function(c){return!h(a[c])};this.get=function(c,e){if(!h(a[c]))return a[c];if(d&&!h(a[d+"."+c]))return a[d+"."+c];if(!e){var g=c.split("."),f,z=g.length,n,u=b;for(f=0;f<z;f++)if(n=g[f],d&&0==f&&n==d)u=b;else{if(h(u[n]))return;u=u[n]}u&&(a[c]=u);return u}};this.add=function(c,b){d&&0!==c.indexOf(d)&&(c=d+"."+c);h(a[c])&&(a[c]=b);return b};this.remove=function(c){delete a[c]}};Z.prototype={register:null,exists:null,get:null,add:null,remove:null};
var K=function(b){b||(b=new Z);var d=function(a,c){return e(function(){},a,c)},a=function(a,c,b){return function(){var e=void 0,d=this.supr;this.supr=a.prototype[c]||function(){};try{e=b.apply(this,arguments)}catch(g){}this.supr=d;return e}},c=function(c,b,e){for(var d in b)b.hasOwnProperty(d)&&(c[d]=A(b[d])&&e.prototype&&A(e.prototype[d])?a(e,d,b[d]):b[d])},e=function(a,b,e){var d=function(){};d.prototype=a.prototype;var d=new d,g=function(){e&&e.apply(this,arguments);this.initialize&&this.initialize.apply(this,
arguments)};c(d,b,a);g.prototype=d;g.prototype.constructor=g;g.prototype.getClass=function(){return this.__proto__.constructor.__class};g.prototype.getParentClass=function(){return this.__proto__.constructor.__parentClass};g.__instantiate=function(a){return function(){var c=function(){},b;c.prototype=a.prototype;c=new c;b=a.prototype.constructor.apply(c,arguments);return M(b)?b:c}}(g);return g},g=function(a,c,g,u,v,x){null===a&&(a="");A(a)?(v=g,r(c)?(v=u,u=g):(u=c,g=a,c=null),a=null):r(a)||(v=c,u=
a,a=g=c=null);r(c)||A(c)||(v=u,u=g,g=c,c=null);A(g)||(v=u,u=g,g=null);u=u||{};var h=c&&r(c)?b.get(c):c;if(c&&!h)throw Error(c+" not found");c=h?e(h,u,g):d(u,g);c.__isMetaphorClass=!0;c.__parent=h;c.__parentClass=h?h.__class:null;c.__class=a;if(v)for(var G in v)v.hasOwnProperty(G)&&(c[G]=v[G]);a&&(x?b.add(a,c):b.register(a,c));v&&v.alias&&b.add(v.alias,c);return c};this.factory=function(a){var c=b.get(a),e=H.call(arguments,1);if(!c)throw Error(a+" not found");return c.__instantiate.apply(this,e)};
this.isSubclassOf=function(a,c){var e=a,d=b.get;r(c)||(c=c.getClass?c.getClass():c.prototype.constructor.__class);for(r(a)&&(e=d(a));e;){if(e.prototype.constructor.__class==c)return!0;e&&(e=e.getParentClass?d(e.getParentClass()):e.__parent)}return!1};this.isInstanceOf=function(a,c){var e=r(c)?b.get(c):c;return e?a instanceof e:!1};this.define=g;this.defineCache=function(a,c,b,e,d){return g(a,c,b,e,d,!0)}};K.prototype={factory:null,isSubclassOf:null,isInstanceOf:null,define:null,defineCache:null};
var $={lib:{},cmp:{},view:{}},la=new Z($,"MetaphorJs"),K=new K(la),O=K.define,w=Function.prototype.bind?function(b,d){return b.bind(d)}:function(b,d){return function(){return b.apply(d,arguments)}},ea=function(){return String.prototype.trim?function(b){return r(b)?b.trim():b}:function(b){return r(b)?b.replace(/^\s\s*/,"").replace(/\s\s*$/,""):b}}(),fa=function(b,d,a){setTimeout(function(){b.apply(d,a||[])},0)},k=function(){},ma=function(){return h(JSON)?function(b){return JSON.parse(b)}:function(b){return(new Function("return "+
b))()}}(),ga=function(b,d){var a,c;if(!b||!r(b))return null;try{c=new DOMParser,a=c.parseFromString(b,d||"text/xml")}catch(e){a=void 0}if(!a||a.getElementsByTagName("parsererror").length)throw"Invalid XML: "+b;return a},aa=function(b){if(!b||h(b.length)||r(b))return b?[b]:[];for(var d=[],a=-1,c=b.length>>>0;++a!==c;d[a]=b[a]);return d},ha=function(){var b=/^[\w[:#.][\w\]*^|=!]*$/,d=/=([^\]]+)/,a=/ *, */,c=/(\([^)]*)\+/,e=/(\[[^\]]+)~/,g=/(~|>|\+)/,f=/ +/,z=/([^[:.#]+)?(?:#([^[:.#]+))?(?:\.([^[:.]+))?(?:\[([^!&^*|$[:=]+)([!$^*|&]?=)?([^:\]]+)?\])?(?::([^(]+)(?:\(([^)]+)\))?)?/,
n=/(?:(-?\d*)n)?(?:(%|-)(\d*))?/,u=/\D/,v=/[^(]*\(([^)]*)\)/,h=/\(.*/,r=/\[([^!~^*|$ [:=]+)([$^*|]?=)?([^ :\]]+)?\]/,G=document,w=!!G.getElementsByClassName,A=!!G.querySelectorAll,I={"first-child":function(a){return a.parentNode.getElementsByTagName("*")[0]!==a},"last-child":function(a){for(;(a=a.nextSibling)&&1!=a.nodeType;);return!!a},root:function(a){return"html"!==a.nodeName.toLowerCase()},"nth-child":function(a,c){var b=a.nodeIndex||0,e=c[3]=c[3]?("%"===c[2]?-1:1)*c[3]:0,d=c[1];if(b)return!((b+
e)%d);var g=a.parentNode.firstChild;b++;do if(1==g.nodeType&&(g.nodeIndex=++b)&&a===g&&(b+e)%d)return 0;while(g=g.nextSibling);return 1},"nth-last-child":function(a,c){var b=a.nodeIndexLast||0,e=c[3]?("%"===c[2]?-1:1)*c[3]:0,d=c[1];if(b)return!((b+e)%d);var g=a.parentNode.lastChild;b++;do if(1==g.nodeType&&(g.nodeLastIndex=b++)&&a===g&&(b+e)%d)return 0;while(g=g.previousSibling);return 1},empty:function(a){return!!a.firstChild},parent:function(a){return!a.firstChild},"only-child":function(a){return 1!=
a.parentNode.getElementsByTagName("*").length},checked:function(a){return!a.checked},lang:function(a,c){return a.lang!==c&&G.documentElement.lang!==c},enabled:function(a){return a.disabled||"hidden"===a.type},disabled:function(a){return!a.disabled},selected:function(a){return!a.selected}},t={},p=function(a){return t[a]||(t[a]=new RegExp("(^| +)"+a+"($| +)"))},C={"":function(a,c){return!!a.getAttribute(c)},"=":function(a,c,b){return(c=a.getAttribute(c))&&c===b},"&=":function(a,c,b){return(c=a.getAttribute(c))&&
p(b).test(c)},"^=":function(a,c,b){return(c=a.getAttribute(c)+"")&&!c.indexOf(b)},"$=":function(a,c,b){return(c=a.getAttribute(c)+"")&&c.indexOf(b)==c.length-b.length},"*=":function(a,c,b){return(c=a.getAttribute(c)+"")&&-1!=c.indexOf(b)},"|=":function(a,c,b){return(c=a.getAttribute(c)+"")&&(c===b||!!c.indexOf(b+"-"))},"!=":function(a,c,b){return!(c=a.getAttribute(c))||!p(b).test(c)}},k=function(N,P){P=P||G;var l=[],y=null,B,k,p,m,t,D,E;if(A)try{l=aa(P.querySelectorAll(N.replace(d,'="$1"')))}catch(J){y=
!0}if(!A||y)if(b.test(N))switch(y=0,N.charAt(0)){case "#":y=N.slice(1);l=G.getElementById(y);l.id!==y&&(l=G.all[y]);l=l?[l]:[];break;case ".":B=N.slice(1);if(w)l=aa((l=P.getElementsByClassName(B)).length?l:[]);else{B=" "+B+" ";k=P.getElementsByTagName("*");for(p=0;m=k[p++];)-1!=(" "+m.className+" ").indexOf(B)&&(l[y++]=m);l=y?l:[]}break;case ":":k=P.getElementsByTagName("*");p=0;t=N.replace(v,"$1");for(D=N.replace(h,"");m=k[p++];)I[D]&&!I[D](m,t)&&(l[y++]=m);l=y?l:[];break;case "[":k=P.getElementsByTagName("*");
p=0;m=r.exec(N);B=m[1];E=m[2]||"";for(t=m[3];m=k[p++];)C[E]&&(C[E](m,B,t)||"class"===B&&C[E](m,"className",t))&&(l[y++]=m);l=y?l:[];break;default:l=aa((l=P.getElementsByTagName(N)).length?l:[])}else{for(var F=N.split(a),M=F.length-1,U=!!M,K,V,s,L,Q,R,S,T,W,q,H,O;y=F[M--];){V=(K=y.replace(c,"$1%").replace(e,"$1&").replace(g," $1 ").split(f)).length;p=0;L=" ";for(k=[P];s=K[p++];)if(" "!==s&&">"!==s&&"~"!==s&&"+"!==s&&k){s=s.match(z);Q=s[1]||"*";R=s[2];S=s[3]?" "+s[3]+" ":"";B=s[4];E=s[5]||"";D=s[7];
t="nth-child"===D||"nth-last-child"===D?n.exec("even"===s[8]&&"2n"||"odd"===s[8]&&"2n%1"||!u.test(s[8])&&"0n%"+s[8]||s[8]):s[8];T=[];y=W=0;for(H=p==V;q=k[W++];)switch(L){case " ":O=q.getElementsByTagName(Q);for(q=0;m=O[q++];)R&&m.id!==R||S&&-1==(" "+m.className+" ").indexOf(S)||!(!B||C[E]&&(C[E](m,B,s[6])||"class"===B&&C[E](m,"className",s[6])))||m.yeasss||(I[D]?I[D](m,t):D)||(H&&(m.yeasss=1),T[y++]=m);break;case "~":for(Q=Q.toLowerCase();(q=q.nextSibling)&&!q.yeasss;)1!=q.nodeType||"*"!==Q&&q.nodeName.toLowerCase()!==
Q||R&&q.id!==R||S&&-1==(" "+q.className+" ").indexOf(S)||!(!B||C[E]&&(C[E](m,B,s[6])||"class"===B&&C[E](m,"className",s[6])))||q.yeasss||(I[D]?I[D](q,t):D)||(H&&(q.yeasss=1),T[y++]=q);break;case "+":for(;(q=q.nextSibling)&&1!=q.nodeType;);!q||q.nodeName.toLowerCase()!==Q.toLowerCase()&&"*"!==Q||R&&q.id!==R||S&&-1==(" "+m.className+" ").indexOf(S)||!(!B||C[E]&&(C[E](m,B,s[6])||"class"===B&&C[E](m,"className",s[6])))||q.yeasss||(I[D]?I[D](q,t):D)||(H&&(q.yeasss=1),T[y++]=q);break;case ">":for(O=q.getElementsByTagName(Q),
p=0;m=O[p++];)m.parentNode!==q||R&&m.id!==R||S&&-1==(" "+m.className+" ").indexOf(S)||!(!B||C[E]&&(C[E](m,B,s[6])||"class"===B&&C[E](m,"className",s[6])))||m.yeasss||(I[D]?I[D](m,t):D)||(H&&(m.yeasss=1),T[y++]=m)}k=T}else L=s;if(U){if(!k.concat){T=[];for(q=0;m=k[q];)T[q++]=m;k=T}l=k.concat(1==l.length?l[0]:l)}else l=k}for(y=l.length;y--;)l[y].yeasss=l[y].nodeIndex=l[y].nodeIndexLast=null}return l};k.is=function(a,c){var b=k(c,a.parentNode),e,d;e=-1;for(d=b.length;++e<d;)if(b[e]===a)return!0;return!1};
return k}(),na=Object.prototype.toString,ia=function(b){return"number"==typeof b&&!isNaN(b)},U=function(b){return!!(b&&M(b)&&ia(b.length)&&"[object Array]"==na.call(b))},V=function(b,d,a){b.attachEvent?b.attachEvent("on"+d,a):b.addEventListener(d,a,!1)},oa=function(){var b=["0","0","0"];return function(){for(var d=b.length,a;d;){d--;a=b[d].charCodeAt(0);if(57==a)return b[d]="A",b.join("");if(90==a)b[d]="0";else return b[d]=String.fromCharCode(a+1),b.join("")}b.unshift("0");return b.join("")}}(),ba=
function(){this.events={}};ba.prototype={createEvent:function(b,d){b=b.toLowerCase();var a=this.events;a[b]||(a[b]=new ca(b,d));return a[b]},getEvent:function(b){b=b.toLowerCase();return this.events[b]},on:function(b,d,a,c){b=b.toLowerCase();var e=this.events;e[b]||(e[b]=new ca(b));return e[b].on(d,a,c)},once:function(b,d,a,c){c=c||{};c.limit=1;return this.on(b,d,a,c)},un:function(b,d,a){b=b.toLowerCase();var c=this.events;c[b]&&c[b].un(d,a)},hasListener:function(b,d,a){b=b.toLowerCase();var c=this.events;
return c[b]?c[b].hasListener(d,a):!1},removeAllListeners:function(b){var d=this.events;d[b]&&d[b].removeAllListeners()},trigger:function(){var b=arguments[0],d=this.events,b=b.toLowerCase();if(!d[b])return null;b=d[b];return b.trigger.apply(b,H.call(arguments,1))},suspendEvent:function(b){b=b.toLowerCase();var d=this.events;d[b]&&d[b].suspend()},suspendAllEvents:function(){var b=this.events,d;for(d in b)b[d].suspend()},resumeEvent:function(b){b=b.toLowerCase();var d=this.events;d[b]&&d[b].resume()},
resumeAllEvents:function(){var b=this.events,d;for(d in b)b[d].resume()},destroyEvent:function(b){var d=this.events;d[b]&&(d[b].removeAllListeners(),d[b].destroy(),delete d[b])},destroy:function(b){var d=this.events;if(b)b=b.toLowerCase(),d[b]&&(d[b].destroy(),delete d[b]);else{for(var a in d)d[a].destroy();this.events={}}},getApi:function(){if(!this.api){for(var b="createEvent getEvent on un once hasListener removeAllListeners trigger suspendEvent suspendAllEvents resumeEvent resumeAllEvents destroyEvent".split(" "),
d={},a,c=-1,e=b.length;++c<e;a=b[c],d[a]=w(this[a],this));this.api=d}return this.api}};var ca=function(b,d){this.name=b;this.listeners=[];this.map={};this.hash=oa();this.uni="$$"+b+"_"+this.hash;this.suspended=!1;this.lid=0;this.returnResult=h(d)?null:d};ca.prototype={getName:function(){return this.name},destroy:function(){this.map=this.listeners=null},on:function(b,d,a){if(!b)return null;d=d||null;a=a||{};var c=this.uni,e=d||b;if(e[c]&&!a.allowDupes)return null;var g=++this.lid,f=a.first||!1;e[c]=
g;b={fn:b,scope:d,uniScope:e,id:g,called:0,limit:a.limit||0,start:a.start||1,count:0,append:a.append,prepend:a.prepend};f?this.listeners.unshift(b):this.listeners.push(b);this.map[g]=b;return g},once:function(b,d,a){a=a||{};a.once=!0;return this.on(b,d,a)},un:function(b,d){var a=-1,c=this.uni,e=this.listeners,g;g=b==parseInt(b)?b:(d||b)[c];if(!g)return!1;for(var f=0,z=e.length;f<z;f++)if(e[f].id==g){a=f;delete e[f].uniScope[c];break}if(-1==a)return!1;e.splice(a,1);delete this.map[g];return!0},hasListener:function(b,
d){var a=this.listeners,c;if(b){d=d||b;c=A(b)?d[this.uni]:b;if(!c)return!1;for(var e=0,g=a.length;e<g;e++)if(a[e].id==c)return!0;return!1}return 0<a.length},removeAllListeners:function(){var b=this.listeners,d=this.uni,a,c;a=0;for(c=b.length;a<c;a++)delete b[a].uniScope[d];this.listeners=[];this.map={}},suspend:function(){this.suspended=!0},resume:function(){this.suspended=!1},_prepareArgs:function(b,d){var a;b.append||b.prepend?(a=H.call(d),b.prepend&&(a=b.prepend.concat(a)),b.append&&(a=a.concat(b.append))):
a=d;return a},trigger:function(){var b=this.listeners,d=this.returnResult;if(this.suspended||0==b.length)return null;for(var a="all"==d?[]:null,c,e,b="first"==d?[b[0]]:H.call(b);c=b.shift();)if(c&&this.map[c.id]&&(c.count++,!(c.count<c.start))){e=c.fn.apply(c.scope,this._prepareArgs(c,arguments));c.called++;c.called==c.limit&&this.un(c.id);"all"==d&&a.push(e);if("first"==d)return e;"last"==d&&(a=e);if(!1==d&&!1===e)break}if(d)return a}};var L=function(b){var d;return b&&(M(b)||A(b))?A(d=b.then)?d:
!1:!1},ja=function(b){var d=b.stack||Error().stack;fa(function(){!h(console)&&console.log&&(console.log(b),d&&console.log(d))})},da=function(){var b=[],d=!1,a="undefined"!=typeof process?process.nextTick:function(a){setTimeout(a,0)},c=function(){d=!0;var e=b.shift();a(function(){e[0].apply(e[1],e[2]);b.length?c():d=!1},0)},e=function(a,e,g){g=g||[];b.push([a,e,g]);d||c()},g=function(a,c){return function(b){try{c.resolve(a(b))}catch(e){c.reject(e)}}},f=function(a,c){if(a instanceof f)return a;if(!(this instanceof
f))return new f(a,c);this._fulfills=[];this._rejects=[];this._dones=[];this._fails=[];if(!h(a))if(L(a)||!A(a))this.resolve(a);else try{a.call(c,w(this.resolve,this),w(this.reject,this))}catch(b){this.reject(b)}};f.prototype={_state:0,_fulfills:null,_rejects:null,_dones:null,_fails:null,_wait:0,_value:null,_reason:null,_triggered:!1,isPending:function(){return 0==this._state},isFulfilled:function(){return 1==this._state},isRejected:function(){return 2==this._state},_cleanup:function(){delete this._fulfills;
delete this._rejects;delete this._dones;delete this._fails},_processValue:function(a,c){var b;if(0==this._state)if(a===this)this._doReject(new TypeError("cannot resolve promise with itself"));else{try{if(b=L(a)){a instanceof f?a.then(w(this._processResolveValue,this),w(this._processRejectReason,this)):(new f(b,a)).then(w(this._processResolveValue,this),w(this._processRejectReason,this));return}}catch(e){0==this._state&&this._doReject(e);return}c.call(this,a)}},_callResolveHandlers:function(){this._done();
for(var a=this._fulfills,c;c=a.shift();)e(c[0],c[1],[this._value]);this._cleanup()},_doResolve:function(a){this._value=a;this._state=1;0==this._wait&&this._callResolveHandlers()},_processResolveValue:function(a){this._processValue(a,this._doResolve)},resolve:function(a){if(this._triggered)return this;this._triggered=!0;this._processResolveValue(a);return this},_callRejectHandlers:function(){this._fail();for(var a=this._rejects,c;c=a.shift();)e(c[0],c[1],[this._reason]);this._cleanup()},_doReject:function(a){this._state=
2;this._reason=a;0==this._wait&&this._callRejectHandlers()},_processRejectReason:function(a){this._processValue(a,this._doReject)},reject:function(a){if(this._triggered)return this;this._triggered=!0;this._processRejectReason(a);return this},then:function(a,c){var b=new f,d=this._state;0==d||0!=this._wait?(a&&A(a)?this._fulfills.push([g(a,b),null]):this._fulfills.push([b.resolve,b]),c&&A(c)?this._rejects.push([g(c,b),null]):this._rejects.push([b.reject,b])):1==d?a&&A(a)?e(g(a,b),null,[this._value]):
b.resolve(this._value):2==d&&(c&&A(c)?e(g(c,b),null,[this._reason]):b.reject(this._reason));return b},"catch":function(a){return this.then(null,a)},_done:function(){for(var a=this._dones,c;c=a.shift();)try{c[0].call(c[1]||null,this._value)}catch(b){ja(b)}},done:function(a,c){var b=this._state;1==b&&0==this._wait?a.call(c||null,this._value):0==b&&this._dones.push([a,c]);return this},_fail:function(){for(var a=this._fails,c;c=a.shift();)try{c[0].call(c[1]||null,this._reason)}catch(b){ja(b)}},fail:function(a,
c){var b=this._state;2==b&&0==this._wait?a.call(c||null,this._reason):0==b&&this._fails.push([a,c]);return this},always:function(a,c){this.done(a,c);this.fail(a,c);return this},promise:function(){return{then:w(this.then,this),done:w(this.done,this),fail:w(this.fail,this),always:w(this.always,this)}},after:function(a){var c=this;if(L(a)){c._wait++;var b=function(){c._wait--;0==c._wait&&0!=c._state&&(1==c._state?c._callResolveHandlers():c._callRejectHandlers())};A(a.done)?a.done(b):a.then(b)}return c}};
f.resolve=function(a){return new f(a)};f.reject=function(a){var c=new f;c.reject(a);return c};f.all=function(a){if(!a.length)return f.resolve(null);var c=new f,b=a.length,e=Array(b),d=b,g,h,k=function(a,b){e[b]=a;d--;0==d&&c.resolve(e)};for(g=0;g<b;g++)(function(b){h=a[g];h instanceof f?h.done(function(a){k(a,b)}).fail(c.reject,c):L(h)||A(h)?(new f(h)).done(function(a){k(a,b)}).fail(c.reject,c):k(h,b)})(g);return c};f.when=function(){return f.all(arguments)};f.allResolved=function(a){if(!a.length)return f.resolve(null);
var c=new f,b=a.length,e=[],d=b,g,h,k=function(a){e.push(a);p()},p=function(){d--;0==d&&c.resolve(e)};for(g=0;g<b;g++)h=a[g],h instanceof f?h.done(k).fail(p):L(h)||A(h)?(new f(h)).done(k).fail(p):k(h);return c};f.race=function(a){if(!a.length)return f.resolve(null);var c=new f,b=a.length,e,d;for(e=0;e<b&&(d=a[e],d instanceof f?d.done(c.resolve,c).fail(c.reject,c):L(d)||A(d)?(new f(d)).done(c.resolve,c).fail(c.reject,c):c.resolve(d),c.isPending());e++);return c};return f}(),W=function(){var b=/#.*$/,
d=/([?&])_=[^&]*/,a=/\?/,c=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,e=/^(?:GET|HEAD)$/i,g=0,f=function(a,c,b){var e,d;if(r(a)&&b)c.push(encodeURIComponent(b)+"="+encodeURIComponent(a));else if(U(a)&&b)for(e=0,d=a.length;e<d;e++)f(a[e],c,b+"["+e+"]");else if(M(a))for(e in a)a.hasOwnProperty(e)&&f(a[e],c,b?b+"["+e+"]":e)},z=function(c,g){c.replace(b,"");if(!1===g.cache){var l=(new Date).getTime();return d.test(c)?c.replace(d,"$1_="+l):c+(a.test(c)?"&":"?")+"_="+l}!g.data||window.FormData&&
g.data instanceof window.FormData||(r(g.data)?l=g.data:(l=[],f(g.data,l,null),l=l.join("&").replace(/%20/g,"+")),g.data=l,e.test(g.method)&&(c+=(a.test(c)?"&":"?")+g.data,g.data=null));return c},n={xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"},u={url:null,data:null,method:"GET",headers:null,username:null,password:null,cache:null,dataType:null,timeout:0,contentType:"application/x-www-form-urlencoded",
xhrFields:null,jsonp:!1,jsonpParam:null,jsonpCallback:null,transport:null,replace:!1,selector:null,form:null,beforeSend:null,progress:null,uploadProgress:null,processResponse:null,callbackScope:null},v={},x=new ba,F=function(a){var c;c=eval;a&&(/^[^\S]*use strict/.test(a)?(c=document.createElement("script"),c.text=a,document.head.appendChild(c).parentNode.removeChild(c)):c(a))},G=function(a,c,b){var e,d;if(!M(a)&&!A(a)&&b)e=document.createElement("input"),e.setAttribute("type","hidden"),e.setAttribute("name",
b),e.setAttribute("value",a),c.appendChild(e);else if(U(a)&&b)for(e=0,d=a.length;e<d;e++)G(a[e],c,b+"["+e+"]");else if(M(a))for(e in a)a.hasOwnProperty(e)&&G(a[e],c,b?b+"["+e+"]":e)},H=function(a){for(var c,b,e="",d=0;d<a.elements.length;d++)if(c=a.elements[d],c.hasAttribute("name"))if(b="INPUT"===c.nodeName.toUpperCase()?c.getAttribute("type").toUpperCase():"TEXT","FILE"===b)for(b=0;b<c.files.length;e+="&"+encodeURIComponent(c.name)+"="+encodeURIComponent(c.files[b++].name));else if("RADIO"!==b&&
"CHECKBOX"!==b||c.checked)e+="&"+encodeURIComponent(c.name)+"="+encodeURIComponent(c.value);return e},L=function(a,c,b){var e=c?c.dataType:null;c=c?c.selector:null;if(!r(a))return a;b=b||"";if("xml"===e||!e&&0<=b.indexOf("xml"))return a=ga(ea(a)),c?ha(c,a):a;if("html"===e)return a=ga(a,"text/html"),c?ha(c,a):a;if("fragment"==e){b=document.createDocumentFragment();e=document.createElement("div");for(e.innerHTML=a;e.firstChild;)b.appendChild(e.firstChild);return b}if("json"===e||!e&&0<=b.indexOf("json"))return ma(ea(a));
("script"===e||!e&&0<=b.indexOf("javascript"))&&F(a);return a+""},I=function(a){var b=h(window)?"":window.location.href,b=c.exec(b.toLowerCase())||[],e=c.exec(a.url.toLowerCase());this._opt=a;a.crossDomain=!(!e||e[1]===b[1]&&e[2]===b[2]&&(e[3]||("http:"===e[1]?"80":"443"))===(b[3]||("http:"===b[1]?"80":"443")));b=new da;"iframe"!=a.transport||a.form?a.form&&(this._form=a.form,"POST"!=a.method||!h(window)&&window.FormData||"iframe"==a.transport||(a.transport="iframe")):(this.createForm(),a.form=this._form);
a.form&&"iframe"!=a.transport&&(a.data="POST"==a.method?new FormData(a.form):H(a.form));a.url=z(a.url,a);e=!a.crossDomain&&"script"!=a.transport||a.form?"iframe"==a.transport?new K(a,b,this):new J(a,b,this):new C(a,b,this);this._deferred=b;this._transport=e;b.done(function(a){x.trigger("success",a)});b.fail(function(a){x.trigger("error",a)});b.always(function(){x.trigger("end")});x.trigger("start");a.timeout&&(this._timeout=setTimeout(w(this.onTimeout,this),a.timeout));a.jsonp&&this.createJsonp();
!1===x.trigger("beforeSend",a,e)&&(this._promise=da.reject());a.beforeSend&&!1===a.beforeSend.call(a.callbackScope,a,e)&&(this._promise=da.reject());this._promise||(fa(e.send,e),b.abort=w(this.abort,this),b.always(this.destroy,this),this._promise=b)};I.prototype={_jsonpName:null,_transport:null,_opt:null,_deferred:null,_promise:null,_timeout:null,_form:null,_removeForm:!1,promise:function(){return this._promise},abort:function(a){this._transport.abort();this._deferred.reject(a||"abort")},onTimeout:function(){this.abort("timeout")},
createForm:function(){var a=document.createElement("form");a.style.display="none";a.setAttribute("method",this._opt.method);G(this._opt.data,a,null);document.body.appendChild(a);this._form=a;this._removeForm=!0},createJsonp:function(){var c=this._opt,b=c.jsonpParam||"callback",e=c.jsonpCallback||"jsonp_"+ ++g;c.url+=(a.test(c.url)?"&":"?")+b+"="+e;this._jsonpName=e;h(window)||(window[e]=w(this.jsonpCallback,this));h(global)||(global[e]=w(this.jsonpCallback,this));return e},jsonpCallback:function(a){try{this._deferred.resolve(this.processResponseData(a))}catch(c){this._deferred.reject(c)}},
processResponseData:function(a,c){var b=this._opt;a=L(a,b,c);x.hasListener("processResponse")&&(a=x.trigger("processResponse",a,this._deferred));b.processResponse&&(a=b.processResponse.call(b.callbackScope,a,this._deferred));return a},processResponse:function(a,c){var b=this._deferred,e;if(this._opt.jsonp)if(a){try{F(a)}catch(d){b.reject(d)}b.isPending()&&b.reject("jsonp script didn't invoke callback")}else b.reject("jsonp script is empty");else{try{e=this.processResponseData(a,c)}catch(g){b.reject(g)}b.resolve(e)}},
destroy:function(){this._timeout&&clearTimeout(this._timeout);this._form&&this._form.parentNode&&this._removeForm&&this._form.parentNode.removeChild(this._form);this._transport.destroy();delete this._transport;delete this._opt;delete this._deferred;delete this._promise;delete this._timeout;delete this._form;this._jsonpName&&(h(window)||delete window[this._jsonpName],h(global)||delete global[this._jsonpName])}};var t=function(a,c){c=c||{};a&&!r(a)?c=a:c.url=a;if(!c.url&&(c.form&&(c.url=c.form.getAttribute("action")),
!c.url))throw"Must provide url";p(c,v,!1,!0);p(c,u,!1,!0);c.method=c.method?c.method.toUpperCase():c.form?c.form.getAttribute("method").toUpperCase()||"GET":"GET";return(new I(c)).promise()};t.setup=function(a){p(v,a,!0,!0)};t.on=function(){x.on.apply(x,arguments)};t.un=function(){x.un.apply(x,arguments)};t.get=function(a,c){c=c||{};c.method="GET";return t(a,c)};t.post=function(a,c){c=c||{};c.method="POST";return t(a,c)};t.load=function(a,c,b){b=b||{};r(c)||(b=c);b.dataType="fragment";return t(c,
b).done(function(c){if(b.replace)for(;a.firstChild;)a.removeChild(a.firstChild);a.appendChild(c)})};t.loadScript=function(a){return t(a,{transport:"script"})};t.submit=function(a,c){c=c||{};c.form=a;return t(null,c)};var J=function(a,c,b){var e;if(!(window.XMLHttpRequest&&(e=new XMLHttpRequest)||(e=new ActiveXObject("Msxml2.XMLHTTP"))||(e=new ActiveXObject("Microsoft.XMLHTTP"))))throw"Unable to create XHR object";this._xhr=e;this._deferred=c;this._opt=a;this._ajax=b;a.progress&&V(e,"progress",w(a.progress,
a.callbackScope));a.uploadProgress&&e.upload&&V(e.upload,"progress",w(a.uploadProgress,a.callbackScope));try{var d;if(a.xhrFields)for(d in a.xhrFields)e[d]=a.xhrFields[d];a.data&&a.contentType&&e.setRequestHeader("Content-Type",a.contentType);e.setRequestHeader("X-Requested-With","XMLHttpRequest");e.setRequestHeader("Accept",a.dataType&&n[a.dataType]?n[a.dataType]+", */*; q=0.01":n._default);for(d in a.headers)e.setRequestHeader(d,a.headers[d])}catch(g){}e.onreadystatechange=w(this.onReadyStateChange,
this)};J.prototype={_xhr:null,_deferred:null,_ajax:null,onReadyStateChange:function(){var a=this._xhr,c=this._deferred;if(0===a.readyState)a.onreadystatechange=k,c.resolve(a);else if(4===a.readyState){a.onreadystatechange=k;var b;a:{try{b=!a.status&&!h(location)&&"file:"==location.protocol||200<=a.status&&300>a.status||304===a.status||1223===a.status;break a}catch(e){}b=!1}b?this._ajax.processResponse(r(a.responseText)?a.responseText:void 0,a.getResponseHeader("content-type")||""):c.reject(a)}},abort:function(){this._xhr.onreadystatechange=
k;this._xhr.abort()},send:function(){var a=this._opt;try{this._xhr.open(a.method,a.url,!0,a.username,a.password),this._xhr.send(a.data)}catch(c){this._deferred.reject(c)}},destroy:function(){delete this._xhr;delete this._deferred;delete this._opt;delete this._ajax}};var C=function(a,c,b){this._opt=a;this._ajax=b;this._deferred=c};C.prototype={_opt:null,_deferred:null,_ajax:null,_el:null,send:function(){var a=document.createElement("script");a.setAttribute("async","async");a.setAttribute("charset",
"utf-8");a.setAttribute("src",this._opt.url);V(a,"load",w(this.onLoad,this));V(a,"error",w(this.onError,this));document.head.appendChild(a);this._el=a},onLoad:function(a){this._deferred&&this._deferred.resolve(a)},onError:function(a){this._deferred.reject(a)},abort:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el)},destroy:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el);delete this._el;delete this._opt;delete this._ajax;delete this._deferred}};var K=
function(a,c,b){this._opt=a;this._ajax=b;this._deferred=c};K.prototype={_opt:null,_deferred:null,_ajax:null,_el:null,send:function(){var a=document.createElement("iframe"),c="frame-"+ ++g,b=this._opt.form;a.setAttribute("id",c);a.setAttribute("name",c);a.style.display="none";document.body.appendChild(a);b.setAttribute("action",this._opt.url);b.setAttribute("target",c);V(a,"load",w(this.onLoad,this));V(a,"error",w(this.onError,this));this._el=a;try{b.submit()}catch(e){this._deferred.reject(e)}},onLoad:function(){var a=
this._el;this._opt&&!this._opt.jsonp&&(a=a.contentDocument||a.contentWindow.document,a=a.body.innerHTML,this._ajax.processResponse(a))},onError:function(a){this._deferred.reject(a)},abort:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el)},destroy:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el);delete this._el;delete this._opt;delete this._ajax;delete this._deferred}};return t}(),J=K.factory,X=function(){var b={},d={};return O("MetaphorJs.data.Model",
{type:null,fields:null,record:null,store:null,plain:!1,initialize:function(a){this.fields={};p(this,{record:{load:null,save:null,"delete":null,id:null,data:null,success:null,extra:{}},store:{load:null,save:null,"delete":null,id:null,data:null,total:null,start:null,limit:null,success:null,extra:{}}},!1,!0);p(this,a,!0,!0);this.plain=!this.type},isPlain:function(){return this.plain},getRecordProp:function(a,c){return this.getProp("record",a,c)},setRecordProp:function(a,c){this.record[a]=c},getStoreProp:function(a,
c){return this.getProp("store",a,c)},setStoreProp:function(a,c){this.store[a]=c},getProp:function(a,c,b){a=this[a];return a[c]&&a[c][b]||a[b]||this[b]||null},setProp:function(a,c){return this[a]=c},_createAjaxCfg:function(a,c,b,d){var f=this,h=f[a],n=p({},r(h[c])?{url:h[c]}:h[c]),k=f.getProp(a,c,"id"),v=f.getProp(a,c,"data"),x=f.getProp(a,c,"url"),w=f.getProp(a,c,"json");if(!n)if(x)n={url:x};else throw a+"."+c+" not defined";r(n)&&(n={url:n});if(!n.url){if(!x)throw a+"."+c+" url not defined";n.url=
x}n.data=p({},n.data,f.extra,h.extra,h[c]?h[c].extra:{},!1,!0);n.method||(n.method="load"==c?"GET":"POST");b&&(n.data[k]=b);d&&(v?n.data[v]=d:n.data=d);w&&n.data&&"GET"!=n.method&&(n.data=JSON.stringify(n.data));n.callbackScope=f;"record"==a?n.processResponse=function(a,b){f._processRecordResponse(c,a,b)}:"store"==a&&(n.processResponse=function(a,b){f._processStoreResponse(c,a,b)});return n},_processRecordResponse:function(a,c,b){var d=this.getRecordProp(a,"id"),f=this.getRecordProp(a,"data"),d=(f=
f?c[f]:c)&&f[d]||c[d];this._getSuccess("record",a,c)?b.resolve({id:d,data:f}):b.reject(c)},_processStoreResponse:function(a,c,b){var d=this.getStoreProp(a,"data"),f=this.getStoreProp(a,"total"),d=d?c[d]:c,f=f?c[f]:null;this._getSuccess("store",a,c)?b.resolve({data:d,total:f}):b.reject(c)},_getSuccess:function(a,c,b){return(a=this.getProp(a,c,"success"))&&void 0!=b[a]?b[a]:!0},loadRecord:function(a){return W(this._createAjaxCfg("record","load",a))},saveRecord:function(a,c,b){return W(this._createAjaxCfg("record",
a.getId()?"save":"create",a.getId(),p({},a.storeData(a.getData(c)),b)))},deleteRecord:function(a){return W(this._createAjaxCfg("record","delete",a.getId()))},loadStore:function(a,c){return W(p(this._createAjaxCfg("store","load"),c,!0,!0))},saveStore:function(a,c){return W(this._createAjaxCfg("store","save",null,c))},deleteRecords:function(a,c){return W(this._createAjaxCfg("store","delete",c))},getFields:function(){return this.fields},restoreField:function(a,c,b){var d=this.fields[c];if(d){switch(r(d)?
d:d.type){case "int":b=parseInt(b);break;case "bool":case "boolean":r(b)?(b=b.toLowerCase(),b=!("off"===b||"no"===b||"0"===b||"false"==b||"null"==b)):b=b?!0:!1;break;case "double":case "float":b=parseFloat(b);break;case "date":d.parseFn?b=d.parseFn(b,d.format):Date.parse?b=Date.parse(b,d.format):("timestamp"==d.format&&(b=1E3*parseInt(b)),b=new Date(b))}d.restore&&(b=d.restore.call(a,b,c))}return this.onRestoreField(a,c,b)},onRestoreField:function(a,c,b){return b},storeField:function(a,c,b){var d=
this.fields[c];if(d){switch(r(d)?d:d.type){case "bool":case "boolean":b=b?"1":"0";break;case "date":b=d.formatFn?d.formatFn(b,d.format):Date.format?Date.format(b,d.format):"timestamp"==d.format?b.getTime()/1E3:b.format?b.format(d.format):b.toString();break;default:b=b.toString()}d.store&&(b=d.store.call(a,b,c))}return this.onStoreField(a,c,b)},onStoreField:function(a,c,b){return b}},{create:function(a,c){return"MetaphorJs.data.Model"==a?J(a,c):c?J(a,c):b[a]?b[a]:b[a]=J(a)},addToCache:function(a){var c=
a.getClass(),b=a.getId();"MetaphorJs.data.Record"!=c&&(d[c]||(d[c]={}),d[c][b]=a)},getFromCache:function(a,c){return d[a]&&d[a][c]?d[a][c]:null},removeFromCache:function(a,c){d[a]&&d[a][c]&&delete d[a][c]}})}(),ka=K.isInstanceOf;O("MetaphorJs.cmp.Base",{destroyed:!1,_observable:null,initialize:function(b){b=b||{};this._observable=new ba;p(this,this._observable.getApi(),!0,!1);if(b.callback){var d=b.callback,a=d.scope||this;delete d.scope;for(var c in d)if(d.hasOwnProperty(c))this.on(c,d[c],a);delete b.callback}p(this,
b,!0,!1)},destroy:function(){if(!this.destroyed){if(!1===this.trigger("beforedestroy",this))return!1;this.onDestroy();this.destroyed=!0;this.trigger("destroy",this);this._observable.destroy();delete this._observable}},onDestroy:k});var F=O("MetaphorJs.data.Record","MetaphorJs.cmp.Base",{id:null,data:null,orig:null,modified:null,loaded:!1,dirty:!1,destroyed:!1,model:null,standalone:!0,stores:null,initialize:function(b,d,a){var c=arguments.length;1==c?(a=b,d=b=null):2==c&&(a=d,d=null);this.data={};
this.orig={};this.stores=[];this.modified={};a=a||{};this.supr(a);r(this.model)?this.model=J(this.model):ka(this.model,"MetaphorJs.data.Model")||(this.model=J("MetaphorJs.data.Model",this.model));this.id=b;d?this.importData(d):!1!==a.autoLoad&&b&&this.load();"MetaphorJs.data.Record"!=this.getClass()&&X.addToCache(this)},isLoaded:function(){return this.loaded},isStandalone:function(){return this.standalone},isDirty:function(){return this.dirty},getModel:function(){return this.model},attachStore:function(b){b=
b.getId();-1==this.stores.indexOf(b)&&this.stores.push(b)},detachStore:function(b){b=b.getId();var d;this.destroyed||-1==(d=this.stores.indexOf(b))||(this.stores.splice(d,1),0!=this.stores.length||this.standalone||this.destroy())},setDirty:function(b){this.dirty!=b&&(this.dirty=!!b,this.trigger("dirtychange",this,b))},importData:function(b){var d={},a;if(b){for(a in b)d[a]=this.model.restoreField(this,a,b[a]);this.data=d}this.orig=p({},this.data);this.modified={};this.loaded=!0;this.setDirty(!1)},
storeData:function(b){var d={},a;for(a in b)d[a]=this.model.storeField(this,a,b[a]);return d},getId:function(){return this.id},getData:function(b){if(b){var d={},a,c;b=r(b)?[b]:b;a=0;for(c=b.length;a<c;a++)d[b[a]]=this.data[b[a]];return d}return p({},this.data)},getChanged:function(){return p({},this.modified)},isChanged:function(b){return this.modified[b]||!1},get:function(b){return this.data[b]},setId:function(b){!this.id&&b&&(this.id=b)},set:function(b,d){var a=this.data[b];d=this.model.restoreField(this,
b,d);this.data[b]=d;a!=d&&(this.modified[b]=!0,this.setDirty(!0),this.trigger("change",this,b,d,a),this.trigger("change-"+b,this,b,d,a))},revert:function(){this.dirty&&(this.data=p({},this.orig),this.modified={},this.setDirty(!1))},load:function(){var b=this;b.trigger("beforeload",b);return b.model.loadRecord(b.id).done(function(d){b.setId(d.id);b.importData(d.data);b.trigger("load",b)}).fail(function(){b.trigger("failedload",b)})},save:function(b,d){var a=this;a.trigger("beforesave",a);return a.model.saveRecord(a,
b,d).done(function(c){a.setId(c.id);a.importData(c.data);a.trigger("save",a)}).fail(function(c){a.trigger("failedsave",a)})},"delete":function(){var b=this;b.trigger("beforedelete",b);return b.model.deleteRecord(b).done(function(){b.trigger("delete",b);b.destroy()}).fail(function(){b.trigger("faileddelete",b)})},reset:function(){this.id=null;this.data={};this.orig={};this.modified={};this.dirty=this.loaded=!1;this.trigger("reset",this)},destroy:function(){this.destroyed||(this.destroyed=!0,this.trigger("destroy",
this),this.stores=this.model=this.modified=this.orig=this.data=null,X.removeFromCache(this.getClass(),this.id),this.supr())}});(function(){var b=0,d={};return O("MetaphorJs.data.Store","MetaphorJs.cmp.Base",{id:null,autoLoad:!1,clearOnLoad:!0,model:null,extraParams:null,loaded:!1,loading:!1,local:!1,items:null,map:null,keys:null,length:0,totalLength:0,start:0,pageSize:null,pages:null,filtered:!1,filterBackup:null,filterFn:null,filterScope:null,filterParams:null,initialize:function(a,c,e){this.items=
[];this.map={};this.keys=[];this.loaded=!1;this.extraParams=this.extraParams||{};a&&!r(a)&&(e=c,c=a,a=null);c=c||{};this.supr(c);this.id=this.id||++b;d[this.id]=this;r(this.model)?this.model=J(this.model):ka(this.model,X)||(this.model=J("MetaphorJs.data.Model",this.model));if(a||c.url)this.model.store.load=a||c.url;!this.local&&this.autoLoad?this.load():e&&(U(e)?this.loadArray(e):this.loadAjaxData(e));this.local&&(this.loaded=!0)},getId:function(){return this.id},isLoaded:function(){return this.loaded},
isLocal:function(){return this.local},setLocal:function(a){this.local=!!a},isLoading:function(){return this.loading},isFiltered:function(){return this.filtered},getLength:function(){return this.length},getTotalLength:function(){return this.filtered?this.length:this.totalLength||this.length},getPagesCount:function(){return null!==this.pageSize?parseInt(this.totalLength/this.pageSize):1},setParam:function(a,c){this.extraParams[a]=c},getParam:function(a){return this.extraParams[a]},setStart:function(a){this.start=
a},setPageSize:function(a){this.pageSize=a},getAjaxData:function(){return this.ajaxData},hasDirty:function(){if(this.model.isPlain())return!1;var a=!1;this.each(function(c){return c.isDirty()?(a=!0,!1):!0});return a},getDirty:function(){var a=[];if(this.model.isPlain())return a;this.each(function(c){c.isDirty()&&a.push(c)});return a},getModel:function(){return this.model},importData:function(a){this.suspendAllEvents();for(var c=0;c<a.length;c++)this.add(a[c]);this.resumeAllEvents();this.loaded=!0;
this.loading=!1;this.onLoad();this.trigger("load",this)},load:function(a){var c=this,b=c.model.store,d=b.start,b=b.limit;if(c.local)return null;a=p({},c.extraParams,a||{});null===c.pageSize||a[d]||a[b]||(a[d]=c.start,a[b]=c.pageSize);return!1===c.trigger("beforeload",c)?null:c.model.loadStore(c,a).done(function(a){c.totalLength=parseInt(a.total);c.importData(a.data);c.totalLength=parseInt(a.total)}).fail(function(a){c.onFailedLoad();c.trigger("failedload",c,a)})},onLoad:k,onFailedLoad:k,save:function(){var a=
this,c={},b=0;if(a.local)return null;if(a.model.isPlain())throw Error("Cannot save plain store");a.each(function(a){a.isDirty()&&(c[a.getId()]=a.storeData(a.getData()),b++)});if(!b)throw Error("Nothing to save");return!1===a.trigger("beforesave",a,c)?null:a.model.saveStore(a,c).done(function(c){var b,e,d=c.data;if(d&&d.length)for(c=0,b=d.length;c<b;c++)e=a.getRecordId(d[c]),(e=a.getById(e))&&e.importData(d[c]);a.onSave();a.trigger("save",a)}).fail(function(){a.onFailedSave();a.trigger("failedsave",
a)})},onSave:k,onFailedSave:k,deleteById:function(a){var c=this,b,d,f;if(c.local)return null;if(!a||U(a)&&!a.length)throw Error("Record id required");U(a)||(a=[a]);b=0;for(d=a.length;b<d;b++)f=c.getById(a[b]),f instanceof F?f.destroy():c.removeId(a[b]);return!1===c.trigger("beforedelete",c,a)?null:c.model.deleteRecords(c,a).done(function(){c.onDelete();c.trigger("delete",c,a)}).fail(function(){c.onFailedDelete();c.trigger("faileddelete",c,a)})},onDelete:k,onFailedDelete:k,deleteAt:function(a){var c=
this.getAt(a);if(!c)throw Error("Record not found at "+a);return this.deleteRecord(c)},"delete":function(a){return this.deleteById(this.getRecordId(a))},deleteRecords:function(a){var c=[],b,d;b=0;for(d=a.length;b<d;b++)c.push(this.getRecordId(a[b]));return this.deleteById(c)},loadAjaxData:function(a){var c=this;!1!==c.trigger("beforeload",c)&&c.model._processStoreResponse("load",a,{resolve:function(a,b){c.importData(a);c.totalLength=parseInt(b)},reject:function(){}})},loadArray:function(a,c){!1!==
this.trigger("beforeload",this)&&(!c&&this.clearOnLoad&&0<this.length&&this.clear(),U(a)&&(this.importData(a),this.totalLength=this.length))},loadOr:function(a,c){this.local||this.isLoading()||(this.isLoaded()?a&&a.call(c||this):this.load())},addNextPage:function(){!this.local&&this.length<this.totalLength&&this.load({start:this.length,limit:this.pageSize},!0)},loadNextPage:function(){this.local||(this.start+=this.pageSize,this.load())},loadPrevPage:function(){this.local||(this.start-=this.pageSize,
this.load())},getRecordId:function(a){return a instanceof F?a.getId():a[this.model.getStoreProp("load","id")]||null},processRawDataItem:function(a){if(a instanceof F||this.model.isPlain())return a;var c=this.model.type,b=this.getRecordId(a),d;b&&(d=X.getFromCache(c,b));d||(d=J(c,b,a,{model:this.model,standalone:!1}));return d},bindRecord:function(a,c){c[a]("change",this.onRecordChange,this);c[a]("destroy",this.onRecordDestroy,this);c[a]("dirtychange",this.onRecordDirtyChange,this);return c},onRecordDirtyChange:function(a){this.trigger("update",
this,a)},onRecordChange:function(a,c,b,d){this.trigger("update",this,a)},onRecordDestroy:function(a){this.remove(a)},add:function(a,c,b){if(this.filtered)throw"Cannot add to filtered store";if(!r(a)&&!ia(a)){c=a;if(U(c)){if(!c.length)return;a=this.length;for(var d=0,f=c.length;d<f;d++)c[d]=this.processRawDataItem(c[d]),this.add(this.getRecordId(c[d]),c[d],!0);this.onAdd(a,c);b||this.trigger("add",a,c);return}c=this.processRawDataItem(c);a=this.getRecordId(c)}if(!h(a)&&null!==a){if(!h(this.map[a])){this.replace(a,
c);return}this.map[a]=c}this.length++;this.items.push(c);this.keys.push(a);c instanceof F&&(c.attachStore(this),this.bindRecord("on",c));this.onAdd(this.length-1,[c]);b||this.trigger("add",this.length-1,[c])},onAdd:k,removeAt:function(a){if(a<this.length&&0<=a){this.length--;this.totalLength--;var c=this.items[a];this.items.splice(a,1);var b=this.keys[a];h(b)||delete this.map[b];this.keys.splice(a,1);this.onRemove(c,b);this.trigger("remove",c,b);return c instanceof F?(this.bindRecord("un",c),c.detachStore(this),
null):c}return!1},onRemove:k,insert:function(a,c,b,d){if(this.filtered)throw Error("Cannot insert into filtered store");2==arguments.length&&(b=arguments[1],c=this.getRecordId(b));b=this.processRawDataItem(b);this.containsId(c)&&(this.suspendAllEvents(),this.removeId(c),this.resumeAllEvents());if(a>=this.length)return this.add(c,b,d);this.length++;this.items.splice(a,0,b);h(c)||null===c||(this.map[c]=b);this.keys.splice(a,0,c);b instanceof F&&(b.attachStore(this),this.bindRecord("on",b));this.onAdd(a,
[b]);d||this.trigger("add",a,[b]);return b},replace:function(a,c){var b,d;1==arguments.length&&(c=arguments[0],a=this.getRecordId(c));c=this.processRawDataItem(c);b=this.map[a];if(h(a)||null===a||h(b))return this.add(a,c);b instanceof F&&(this.bindRecord("un",b),b.detachStore(this));d=this.indexOfId(a);this.items[d]=c;this.map[a]=c;c instanceof F&&(this.bindRecord("on",c),c.attachStore(this));this.onReplace(a,b,c);this.trigger("replace",a,b,c);return c},onReplace:k,remove:function(a){return this.removeAt(this.indexOf(a))},
removeId:function(a){return this.removeAt(this.indexOfId(a))},contains:function(a){return-1!=this.indexOf(a)},containsId:function(a){return!h(this.map[a])},clear:function(){var a=this.getRange();this.clearFilter(!0);this._reset();this.onClear();this.trigger("clear",a)},onClear:k,reset:function(){this._reset()},_reset:function(a){var c,b;if(!a)for(a=0,c=this.items.length;a<c;a++)b=this.items[a],b instanceof F&&(this.bindRecord("un",b),b.detachStore(this));this.totalLength=this.length=this.start=0;
this.items=[];this.keys=[];this.map={};this.loaded=this.local},filter:function(a,c,b){this.filtered&&this.clearFilter(!0);this.filtered=!0;this.filterFn=a;this.filterScope=c;this.filterParams=b;this.trigger("beforefilter",this);this.suspendAllEvents();this.filterBackup={length:this.length,items:this.items,keys:this.keys,map:this.map};this._reset(!0);a=this.filterBackup.keys;c=this.filterBackup.items;b=0;for(var d=c.length;b<d;b++)this._filterRecord(c[b],a[b])&&(this.items.push(c[b]),this.keys.push(a[b]),
this.length++,this.map[a[b]]=c[b]);this.resumeAllEvents();this.onFilter();this.trigger("filter",this)},onFilter:k,_filterRecord:function(a,c){return this.filtered&&this.filterFn.call(this.filterScope,a,c,this.filterParams)},clearFilter:function(a){this.filtered&&(a||this.trigger("beforeclearfilter",this),this.suspendAllEvents(),this.filtered=!1,this._reset(!0),this.length=this.filterBackup.length,this.items=this.filterBackup.items,this.keys=this.filterBackup.keys,this.map=this.filterBackup.map,this.filterBackup=
null,this.resumeAllEvents(),this.onClearFilter(),a||this.trigger("clearfilter",this))},onClearFilter:k,getAt:function(a){return this.items[a]||null},getById:function(a){return this.map[a]||null},indexOf:function(a){return this.items.indexOf(a)},indexOfId:function(a){return this.keys.indexOf(a)},each:function(a,c){var b=[].concat(this.items);c=c||window;for(var d=0,f=b.length;d<f&&!1!==a.call(c,b[d],d,f);d++);},eachId:function(a,c){c=c||window;for(var b=0,d=this.keys.length;b<d;b++)a.call(c,this.keys[b],
this.items[b],b,d)},collect:function(a){var c=[],b=!this.model.isPlain();this.each(function(d){(d=b?d.get(a):d[a])&&c.push(d)});return c},first:function(){return this.items[0]},last:function(){return this.items[this.length-1]},getRange:function(a,c){var b=this.items;if(1>b.length)return[];a=a||0;c=Math.min(h(c)||null===c?this.length-1:c,this.length-1);var d,f=[];if(a<=c)for(d=a;d<=c;d++)f[f.length]=b[d];else for(d=a;d>=c;d--)f[f.length]=b[d];return f},findBy:function(a,c,b){a=this.findIndexBy(a,c,
b);return-1==a?null:this.getAt(a)},findIndexBy:function(a,c,b){c=c||this;var d=this.keys,f=this.items;b=b||0;for(var h=f.length;b<h;b++)if(a.call(c,f[b],d[b]))return b;return-1},find:function(a,c,b){var d=!this.model.isPlain(),f;return this.findIndexBy(function(h){f=d?h.get(a):h[a];return b?f===c:f==c},this)},findExact:function(a,c){return this.find(a,c,!0)},findBySet:function(a){var c=null,b,d;this.each(function(f){b=!0;for(d in a)if(a[d]!=f[d]){b=!1;break}return b?(c=f,!1):!0});return c},onDestroy:function(){delete d[this.id];
this.clear();this.supr()}},{createFromSelect:function(a){var c=[];a=a.options;for(var b=0,d=a.length;b<d;b++){var f=a[b],h=(f.hasAttribute?f.hasAttribute("value"):f.getAttributeNode("value").specified)?f.value:f.text;c.push([h,f.text])}a=J("MetaphorJs.data.Store",{server:{load:{id:0}}});a.loadArray(c);return a},lookupStore:function(a){return d[a]||null},eachStore:function(a,b){for(var e in d)if(!1===a.call(b||window,d[e]))break}})})();"undefined"!=typeof global?global.MetaphorJs=$:window.MetaphorJs=
$})();
