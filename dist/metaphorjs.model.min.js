(function(){var u=function(c){return"function"==typeof c},na=Object.prototype.toString,H=function(){var c={"[object String]":0,"[object Number]":1,"[object Boolean]":2,"[object Object]":3,"[object Function]":4,"[object Array]":5,"[object RegExp]":9,"[object Date]":10};return function(a){if(!a){if(null===a)return 6;if(void 0===a)return 7}var b=c[na.call(a)];return void 0===b?-1:1==b&&isNaN(a)?8:b}}(),v=function(c){return"string"==typeof c||0===H(c)},V=function(c){if(null===c||"object"!=typeof c)return!1;
c=H(c);return 2<c||-1==c},aa=function(c,a){var b={};c||(c="undefined"!=typeof global?global:window);this.register=function(d,e){var f;f=d;var g=f.split("."),h,z=g.pop();h=g.join(".");var l=g.length,q,W=c;if(b[h])f=[b[h],z,f];else{if(0<l)for(h=0;h<l;h++){q=g[h];if(a&&0==h)if(q==a){W=c;continue}else f=a+"."+f;void 0===W[q]&&(W[q]={});W=W[q]}else a&&(f=a+"."+f);f=[W,z,f]}g=f[0];z=f[1];V(g)&&void 0===g[z]&&(g[z]=e,b[f[2]]=e);return e};this.exists=function(a){return void 0!==b[a]};this.get=function(d,
e){if(void 0!==b[d])return b[d];if(a&&void 0!==b[a+"."+d])return b[a+"."+d];if(!e){var f=d.split("."),g,h=f.length,z,l=c;for(g=0;g<h;g++)if(z=f[g],a&&0==g&&z==a)l=c;else{if(void 0===l[z])return;l=l[z]}l&&(b[d]=l);return l}};this.add=function(c,e){a&&0!==c.indexOf(a)&&(c=a+"."+c);void 0===b[c]&&(b[c]=e);return e};this.remove=function(a){delete b[a]}};aa.prototype={register:null,exists:null,get:null,add:null,remove:null};var I=Array.prototype.slice,ia=function(c,a,b){setTimeout(function(){c.apply(a,
b||[])},0)},ba=function(c){var a=c.stack||Error().stack;if("undefined"!=typeof console&&console.log)ia(function(){console.log(c);a&&console.log(a)});else throw c;},J=function(c){c||(c=new aa);var a=function(a,b){return e(function(){},a,b)},b=function(a,b,c){return function(){var d,e=this.supr;this.supr="__construct"==b?a.prototype[b]||a.prototype.constructor:a.prototype[b]||function(){};d=c.apply(this,arguments);this.supr=e;return d}},d=function(a,c,d){for(var e in c)c.hasOwnProperty(e)&&(a[e]=!u(c[e])||
!u(d.prototype[e])&&d.prototype[e]?c[e]:b(d,e,c[e]))},e=function(a,b,c){var e=function(){};e.prototype=a.prototype;e=new e;c&&(b.__construct=c);var f=function(){this.__construct&&this.__construct.apply(this,arguments);this.initialize&&this.initialize.apply(this,arguments)};d(e,b,a);e.constructor=f;f.prototype=e;f.prototype.getClass=function(){return f.__class};f.prototype.getParentClass=function(){return f.__parentClass};f.__instantiate=function(a){return function(){var b=function(){},c;b.prototype=
a.prototype;b=new b;c=a.prototype.constructor.apply(b,arguments);return V(c)?c:b}}(f);return f},f=function(b,d,f,l,q,k){null===b&&(b="");u(b)?(q=f,v(d)?(q=l,l=f):(l=d,f=b,d=null),b=null):v(b)||(q=d,l=b,b=f=d=null);v(d)||u(d)||(q=l,l=f,f=d,d=null);u(f)||(q=l,l=f,f=null);l=l||{};var E=d&&v(d)?c.get(d):d;if(d&&!E)throw Error(d+" not found");d=E?e(E,l,f):a(l,f);d.__isMetaphorClass=!0;d.__parent=E;d.__parentClass=E?E.__class:null;d.__class=b;if(q)for(var L in q)q.hasOwnProperty(L)&&(d[L]=q[L]);b&&(k?c.add(b,
d):c.register(b,d));q&&q.alias&&c.add(q.alias,d);return d};this.factory=function(a){var b=c.get(a),d=I.call(arguments,1);if(!b)throw Error(a+" not found");return b.__instantiate.apply(this,d)};this.isSubclassOf=function(a,b){var d=a,e=c.get;v(b)||(b=b.getClass?b.getClass():b.prototype.constructor.__class);for(v(a)&&(d=e(a));d;){if(d.prototype.constructor.__class==b)return!0;d&&(d=d.getParentClass?e(d.getParentClass()):d.__parent)}return!1};this.isInstanceOf=function(a,b){var d=v(b)?c.get(b):b;return d?
a instanceof d:!1};this.define=f;this.defineCache=function(a,b,d,c,e){return f(a,b,d,c,e,!0)};this.extend=function(a,b,d,c){return f(null,a,b,d,c)}};J.prototype={factory:null,isSubclassOf:null,isInstanceOf:null,define:null,defineCache:null,extend:null};var ca={lib:{},cmp:{},view:{}},oa=new aa(ca,"MetaphorJs"),J=new J(oa),X=J.define,k=Function.prototype.bind?function(c,a){return c.bind(a)}:function(c,a){return function(){return c.apply(a,arguments)}},m=function(){},Y=function(c){return"object"==typeof c&&
3===H(c)&&!c.nodeType},da=function(c){return!0===c||!1===c},p=function(){return function a(){var b=!1,d=!1,e=I.call(arguments),f=e.shift(),g,h,z;da(e[e.length-1])&&(b=e.pop());da(e[e.length-1])&&(d=b,b=e.pop());for(;e.length;)if(g=e.shift())for(h in g)if(g.hasOwnProperty(h)&&void 0!==(z=g[h]))if(d)if(f[h]&&Y(f[h])&&Y(z))a(f[h],z,b,d);else{if(!0===b||void 0==f[h])Y(z)?(f[h]={},a(f[h],z,b,!0)):f[h]=z}else if(!0===b||void 0==f[h])f[h]=z;return f}}(),ja=function(){return String.prototype.trim?function(c){return v(c)?
c.trim():c}:function(c){return v(c)?c.replace(/^\s\s*/,"").replace(/\s\s*$/,""):c}}(),pa=function(){return"undefined"!=typeof JSON?function(c){return JSON.parse(c)}:function(c){return(new Function("return "+c))()}}(),ka=function(c,a){var b,d;if(!c||!v(c))return null;try{d=new DOMParser,b=d.parseFromString(c,a||"text/xml")}catch(e){b=void 0}if(!b||b.getElementsByTagName("parsererror").length)throw"Invalid XML: "+c;return b},ea=function(c){if(c&&void 0!=!c.length&&!v(c)){for(var a=[],b=-1,d=c.length>>>
0;++b!==d;a[b]=c[b]);return a}return c?[c]:[]},la=function(){var c=/^[\w[:#.][\w\]*^|=!]*$/,a=/=([^\]]+)/,b=/ *, */,d=/(\([^)]*)\+/,e=/(\[[^\]]+)~/,f=/(~|>|\+)/,g=/ +/,h=/([^[:.#]+)?(?:#([^[:.#]+))?(?:\.([^[:.]+))?(?:\[([^!&^*|$[:=]+)([!$^*|&]?=)?([^:\]]+)?\])?(?::([^(]+)(?:\(([^)]+)\))?)?/,z=/(?:(-?\d*)n)?(?:(%|-)(\d*))?/,l=/\D/,q=/[^(]*\(([^)]*)\)/,k=/\(.*/,E=/\[([^!~^*|$ [:=]+)([$^*|]?=)?([^ :\]]+)?\]/,L=document,v=!!L.getElementsByClassName,u=!!L.querySelectorAll,y={"first-child":function(a){return a.parentNode.getElementsByTagName("*")[0]!==
a},"last-child":function(a){for(;(a=a.nextSibling)&&1!=a.nodeType;);return!!a},root:function(a){return"html"!==a.nodeName.toLowerCase()},"nth-child":function(a,b){var d=a.nodeIndex||0,c=b[3]=b[3]?("%"===b[2]?-1:1)*b[3]:0,e=b[1];if(d)return!((d+c)%e);var w=a.parentNode.firstChild;d++;do if(1==w.nodeType&&(w.nodeIndex=++d)&&a===w&&(d+c)%e)return 0;while(w=w.nextSibling);return 1},"nth-last-child":function(a,b){var d=a.nodeIndexLast||0,c=b[3]?("%"===b[2]?-1:1)*b[3]:0,e=b[1];if(d)return!((d+c)%e);var w=
a.parentNode.lastChild;d++;do if(1==w.nodeType&&(w.nodeLastIndex=d++)&&a===w&&(d+c)%e)return 0;while(w=w.previousSibling);return 1},empty:function(a){return!!a.firstChild},parent:function(a){return!a.firstChild},"only-child":function(a){return 1!=a.parentNode.getElementsByTagName("*").length},checked:function(a){return!a.checked},lang:function(a,b){return a.lang!==b&&L.documentElement.lang!==b},enabled:function(a){return a.disabled||"hidden"===a.type},disabled:function(a){return!a.disabled},selected:function(a){return!a.selected}},
m={},p=function(a){return m[a]||(m[a]=new RegExp("(^| +)"+a+"($| +)"))},C={"":function(a,b){return null!==a.getAttribute(b)},"=":function(a,b,d){return(b=a.getAttribute(b))&&b===d},"&=":function(a,b,d){return(b=a.getAttribute(b))&&p(d).test(b)},"^=":function(a,b,d){return(b=a.getAttribute(b)+"")&&!b.indexOf(d)},"$=":function(a,b,d){return(b=a.getAttribute(b)+"")&&b.indexOf(d)==b.length-d.length},"*=":function(a,b,d){return(b=a.getAttribute(b)+"")&&-1!=b.indexOf(d)},"|=":function(a,b,d){return(b=a.getAttribute(b)+
"")&&(b===d||!!b.indexOf(d+"-"))},"!=":function(a,b,d){return!(b=a.getAttribute(b))||!p(d).test(b)}},w=function(w,B){B=B||L;var r=[],x=null,A,m,p,n,M,D,F;if(u)try{r=ea(B.querySelectorAll(w.replace(a,'="$1"')))}catch(J){x=!0}if(!u||x)if(c.test(w))switch(x=0,w.charAt(0)){case "#":x=w.slice(1);r=L.getElementById(x);r.id!==x&&(r=L.all[x]);r=r?[r]:[];break;case ".":A=w.slice(1);if(v)r=ea((r=B.getElementsByClassName(A)).length?r:[]);else{A=" "+A+" ";m=B.getElementsByTagName("*");for(p=0;n=m[p++];)-1!=(" "+
n.className+" ").indexOf(A)&&(r[x++]=n);r=x?r:[]}break;case ":":m=B.getElementsByTagName("*");p=0;M=w.replace(q,"$1");for(D=w.replace(k,"");n=m[p++];)y[D]&&!y[D](n,M)&&(r[x++]=n);r=x?r:[];break;case "[":m=B.getElementsByTagName("*");p=0;n=E.exec(w);A=n[1];F=n[2]||"";for(M=n[3];n=m[p++];)C[F]&&(C[F](n,A,M)||"class"===A&&C[F](n,"className",M))&&(r[x++]=n);r=x?r:[];break;default:r=ea((r=B.getElementsByTagName(w)).length?r:[])}else{for(var G=w.split(b),K=G.length-1,V=!!K,S,T,t,N,O,P,Q,R,U,s,H,I;x=G[K--];){T=
(S=x.replace(d,"$1%").replace(e,"$1&").replace(f," $1 ").split(g)).length;p=0;N=" ";for(m=[B];t=S[p++];)if(" "!==t&&">"!==t&&"~"!==t&&"+"!==t&&m){t=t.match(h);O=t[1]||"*";P=t[2];Q=t[3]?" "+t[3]+" ":"";A=t[4];F=t[5]||"";D=t[7];M="nth-child"===D||"nth-last-child"===D?z.exec("even"===t[8]&&"2n"||"odd"===t[8]&&"2n%1"||!l.test(t[8])&&"0n%"+t[8]||t[8]):t[8];R=[];x=U=0;for(H=p==T;s=m[U++];)switch(N){case " ":I=s.getElementsByTagName(O);for(s=0;n=I[s++];)P&&n.id!==P||Q&&-1==(" "+n.className+" ").indexOf(Q)||
!(!A||C[F]&&(C[F](n,A,t[6])||"class"===A&&C[F](n,"className",t[6])))||n.yeasss||(y[D]?y[D](n,M):D)||(H&&(n.yeasss=1),R[x++]=n);break;case "~":for(O=O.toLowerCase();(s=s.nextSibling)&&!s.yeasss;)1!=s.nodeType||"*"!==O&&s.nodeName.toLowerCase()!==O||P&&s.id!==P||Q&&-1==(" "+s.className+" ").indexOf(Q)||!(!A||C[F]&&(C[F](n,A,t[6])||"class"===A&&C[F](n,"className",t[6])))||s.yeasss||(y[D]?y[D](s,M):D)||(H&&(s.yeasss=1),R[x++]=s);break;case "+":for(;(s=s.nextSibling)&&1!=s.nodeType;);!s||s.nodeName.toLowerCase()!==
O.toLowerCase()&&"*"!==O||P&&s.id!==P||Q&&-1==(" "+n.className+" ").indexOf(Q)||!(!A||C[F]&&(C[F](n,A,t[6])||"class"===A&&C[F](n,"className",t[6])))||s.yeasss||(y[D]?y[D](s,M):D)||(H&&(s.yeasss=1),R[x++]=s);break;case ">":for(I=s.getElementsByTagName(O),p=0;n=I[p++];)n.parentNode!==s||P&&n.id!==P||Q&&-1==(" "+n.className+" ").indexOf(Q)||!(!A||C[F]&&(C[F](n,A,t[6])||"class"===A&&C[F](n,"className",t[6])))||n.yeasss||(y[D]?y[D](n,M):D)||(H&&(n.yeasss=1),R[x++]=n)}m=R}else N=t;if(V){if(!m.concat){R=
[];for(s=0;n=m[s];)R[s++]=n;m=R}r=m.concat(1==r.length?r[0]:r)}else r=m}for(x=r.length;x--;)r[x].yeasss=r[x].nodeIndex=r[x].nodeIndexLast=null}return r};w.is=function(a,b){var d=w(b,a.parentNode),c,e;c=-1;for(e=d.length;++c<e;)if(d[c]===a)return!0;return!1};return w}(),S=function(c){return"object"==typeof c&&5===H(c)},T=function(c,a,b){c.attachEvent?c.attachEvent("on"+a,b):c.addEventListener(a,b,!1)},Z=function(){var c=["0","0","0"];return function(){for(var a=c.length,b;a;){a--;b=c[a].charCodeAt(0);
if(57==b)return c[a]="A",c.join("");if(90==b)c[a]="0";else return c[a]=String.fromCharCode(b+1),c.join("")}c.unshift("0");return c.join("")}}(),fa=function(){this.events={}};fa.prototype={createEvent:function(c,a){c=c.toLowerCase();var b=this.events;b[c]||(b[c]=new ga(c,a));return b[c]},getEvent:function(c){c=c.toLowerCase();return this.events[c]},on:function(c,a,b,d){c=c.toLowerCase();var e=this.events;e[c]||(e[c]=new ga(c));return e[c].on(a,b,d)},once:function(c,a,b,d){d=d||{};d.limit=1;return this.on(c,
a,b,d)},un:function(c,a,b){c=c.toLowerCase();var d=this.events;d[c]&&d[c].un(a,b)},hasListener:function(c,a,b){c=c.toLowerCase();var d=this.events;return d[c]?d[c].hasListener(a,b):!1},removeAllListeners:function(c){var a=this.events;a[c]&&a[c].removeAllListeners()},trigger:function(){var c=arguments[0],a=this.events,c=c.toLowerCase();if(!a[c])return null;c=a[c];return c.trigger.apply(c,I.call(arguments,1))},suspendEvent:function(c){c=c.toLowerCase();var a=this.events;a[c]&&a[c].suspend()},suspendAllEvents:function(){var c=
this.events,a;for(a in c)c[a].suspend()},resumeEvent:function(c){c=c.toLowerCase();var a=this.events;a[c]&&a[c].resume()},resumeAllEvents:function(){var c=this.events,a;for(a in c)c[a].resume()},destroyEvent:function(c){var a=this.events;a[c]&&(a[c].removeAllListeners(),a[c].destroy(),delete a[c])},destroy:function(c){var a=this.events;if(c)c=c.toLowerCase(),a[c]&&(a[c].destroy(),delete a[c]);else{for(var b in a)a[b].destroy();this.events={}}},getApi:function(){if(!this.api){for(var c="createEvent getEvent on un once hasListener removeAllListeners trigger suspendEvent suspendAllEvents resumeEvent resumeAllEvents destroyEvent".split(" "),
a={},b,d=-1,e=c.length;++d<e;b=c[d],a[b]=k(this[b],this));this.api=a}return this.api}};var ga=function(c,a){this.name=c;this.listeners=[];this.map={};this.hash=Z();this.uni="$$"+c+"_"+this.hash;this.suspended=!1;this.lid=0;this.returnResult=void 0===a?null:a};ga.prototype={getName:function(){return this.name},destroy:function(){this.map=this.listeners=null},on:function(c,a,b){if(!c)return null;a=a||null;b=b||{};var d=this.uni,e=a||c;if(e[d]&&!b.allowDupes)return null;var f=++this.lid,g=b.first||!1;
e[d]=f;c={fn:c,scope:a,uniScope:e,id:f,called:0,limit:b.limit||0,start:b.start||1,count:0,append:b.append,prepend:b.prepend};g?this.listeners.unshift(c):this.listeners.push(c);this.map[f]=c;return f},once:function(c,a,b){b=b||{};b.once=!0;return this.on(c,a,b)},un:function(c,a){var b=-1,d=this.uni,e=this.listeners,f;f=c==parseInt(c)?c:(a||c)[d];if(!f)return!1;for(var g=0,h=e.length;g<h;g++)if(e[g].id==f){b=g;delete e[g].uniScope[d];break}if(-1==b)return!1;e.splice(b,1);delete this.map[f];return!0},
hasListener:function(c,a){var b=this.listeners,d;if(c){a=a||c;d=u(c)?a[this.uni]:c;if(!d)return!1;for(var e=0,f=b.length;e<f;e++)if(b[e].id==d)return!0;return!1}return 0<b.length},removeAllListeners:function(){var c=this.listeners,a=this.uni,b,d;b=0;for(d=c.length;b<d;b++)delete c[b].uniScope[a];this.listeners=[];this.map={}},suspend:function(){this.suspended=!0},resume:function(){this.suspended=!1},_prepareArgs:function(c,a){var b;c.append||c.prepend?(b=I.call(a),c.prepend&&(b=c.prepend.concat(b)),
c.append&&(b=b.concat(c.append))):b=a;return b},trigger:function(){var c=this.listeners,a=this.returnResult;if(this.suspended||0==c.length)return null;for(var b="all"==a?[]:null,d,e,c="first"==a?[c[0]]:I.call(c);d=c.shift();)if(d&&this.map[d.id]&&(d.count++,!(d.count<d.start))){e=d.fn.apply(d.scope,this._prepareArgs(d,arguments));d.called++;d.called==d.limit&&this.un(d.id);"all"==a&&b.push(e);if("first"==a)return e;"last"==a&&(b=e);if(!1==a&&!1===e)break}if(a)return b}};var K=function(c){var a;return c&&
(V(c)||u(c))?u(a=c.then)?a:!1:!1},ha=function(){var c=[],a=!1,b="undefined"!=typeof process?process.nextTick:function(a){setTimeout(a,0)},d=function(){a=!0;var e=c.shift();b(function(){e[0].apply(e[1],e[2]);c.length?d():a=!1},0)},e=function(b,e,f){f=f||[];c.push([b,e,f]);a||d()},f=function(a,b){return function(d){try{b.resolve(a(d))}catch(c){b.reject(c)}}},g=function(a,b){if(a instanceof g)return a;if(!(this instanceof g))return new g(a,b);var d;this._fulfills=[];this._rejects=[];this._dones=[];this._fails=
[];if(0<arguments.length)if(d=K(a))a instanceof g?a.then(k(this.resolve,this),k(this.reject,this)):(new g(d,a)).then(k(this.resolve,this),k(this.reject,this));else if(u(a))try{a.call(b,k(this.resolve,this),k(this.reject,this))}catch(c){this.reject(c)}else this.resolve(a)};g.prototype={_state:0,_fulfills:null,_rejects:null,_dones:null,_fails:null,_wait:0,_value:null,_reason:null,_triggered:!1,isPending:function(){return 0==this._state},isFulfilled:function(){return 1==this._state},isRejected:function(){return 2==
this._state},_cleanup:function(){delete this._fulfills;delete this._rejects;delete this._dones;delete this._fails},_processValue:function(a,b){var d;if(0==this._state)if(a===this)this._doReject(new TypeError("cannot resolve promise with itself"));else{try{if(d=K(a)){a instanceof g?a.then(k(this._processResolveValue,this),k(this._processRejectReason,this)):(new g(d,a)).then(k(this._processResolveValue,this),k(this._processRejectReason,this));return}}catch(c){0==this._state&&this._doReject(c);return}b.call(this,
a)}},_callResolveHandlers:function(){this._done();for(var a=this._fulfills,b;b=a.shift();)e(b[0],b[1],[this._value]);this._cleanup()},_doResolve:function(a){this._value=a;this._state=1;0==this._wait&&this._callResolveHandlers()},_processResolveValue:function(a){this._processValue(a,this._doResolve)},resolve:function(a){if(this._triggered)return this;this._triggered=!0;this._processResolveValue(a);return this},_callRejectHandlers:function(){this._fail();for(var a=this._rejects,b;b=a.shift();)e(b[0],
b[1],[this._reason]);this._cleanup()},_doReject:function(a){this._state=2;this._reason=a;0==this._wait&&this._callRejectHandlers()},_processRejectReason:function(a){this._processValue(a,this._doReject)},reject:function(a){if(this._triggered)return this;this._triggered=!0;this._processRejectReason(a);return this},then:function(a,b){var d=new g,c=this._state;0==c||0!=this._wait?(a&&u(a)?this._fulfills.push([f(a,d),null]):this._fulfills.push([d.resolve,d]),b&&u(b)?this._rejects.push([f(b,d),null]):this._rejects.push([d.reject,
d])):1==c?a&&u(a)?e(f(a,d),null,[this._value]):d.resolve(this._value):2==c&&(b&&u(b)?e(f(b,d),null,[this._reason]):d.reject(this._reason));return d},"catch":function(a){return this.then(null,a)},_done:function(){for(var a=this._dones,b;b=a.shift();)try{b[0].call(b[1]||null,this._value)}catch(d){ba(d)}},done:function(a,b){var d=this._state;1==d&&0==this._wait?a.call(b||null,this._value):0==d&&this._dones.push([a,b]);return this},_fail:function(){for(var a=this._fails,b;b=a.shift();)try{b[0].call(b[1]||
null,this._reason)}catch(d){ba(d)}},fail:function(a,b){var d=this._state;2==d&&0==this._wait?a.call(b||null,this._reason):0==d&&this._fails.push([a,b]);return this},always:function(a,b){this.done(a,b);this.fail(a,b);return this},promise:function(){return{then:k(this.then,this),done:k(this.done,this),fail:k(this.fail,this),always:k(this.always,this)}},after:function(a){var b=this;if(K(a)){b._wait++;var d=function(){b._wait--;0==b._wait&&0!=b._state&&(1==b._state?b._callResolveHandlers():b._callRejectHandlers())};
u(a.done)?a.done(d):a.then(d)}return b}};g.fcall=function(a,b,d){return g.resolve(a.apply(b,d||[]))};g.resolve=function(a){var b=new g;b.resolve(a);return b};g.reject=function(a){var b=new g;b.reject(a);return b};g.all=function(a){if(!a.length)return g.resolve(null);var b=new g,d=a.length,c=Array(d),e=d,f,k,m=function(a,d){c[d]=a;e--;0==e&&b.resolve(c)};for(f=0;f<d;f++)(function(d){k=a[f];k instanceof g?k.done(function(a){m(a,d)}).fail(b.reject,b):K(k)||u(k)?(new g(k)).done(function(a){m(a,d)}).fail(b.reject,
b):m(k,d)})(f);return b};g.when=function(){return g.all(arguments)};g.allResolved=function(a){if(!a.length)return g.resolve(null);var b=new g,d=a.length,c=[],e=d,f,k,m=function(a){c.push(a);p()},p=function(){e--;0==e&&b.resolve(c)};for(f=0;f<d;f++)k=a[f],k instanceof g?k.done(m).fail(p):K(k)||u(k)?(new g(k)).done(m).fail(p):m(k);return b};g.race=function(a){if(!a.length)return g.resolve(null);var b=new g,d=a.length,c,e;for(c=0;c<d&&(e=a[c],e instanceof g?e.done(b.resolve,b).fail(b.reject,b):K(e)||
u(e)?(new g(e)).done(b.resolve,b).fail(b.reject,b):b.resolve(e),b.isPending());c++);return b};g.waterfall=function(a){if(!a.length)return g.resolve(null);for(var b=a.shift(),b=u(b)?g.fcall(b):g.resolve(d),d;d=a.shift();)K(d)?b=b.then(function(a){return function(){return a}}(d)):u(d)?b=b.then(d):b.resolve(d);return b};g.counter=function(a){var b=new g;b.countdown=function(){a--;0==a&&b.resolve()};return b};return g}(),ma=function(c){c=H(c);return 3>c&&-1<c},N=function(){var c=/#.*$/,a=/([?&])_=[^&]*/,
b=/\?/,d=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,e=/^(?:GET|HEAD)$/i,f=function(a,b,d){var c,e;if(ma(a)&&d)b.push(encodeURIComponent(d)+"="+encodeURIComponent(""+a));else if(S(a)&&d)for(c=0,e=a.length;c<e;c++)f(a[c],b,d+"["+c+"]");else if(V(a))for(c in a)a.hasOwnProperty(c)&&f(a[c],b,d?d+"["+c+"]":c)},g=function(d,g){d.replace(c,"");if(!1===g.cache){var B=(new Date).getTime();return a.test(d)?d.replace(a,"$1_="+B):d+(b.test(d)?"&":"?")+"_="+B}!g.data||window.FormData&&g.data instanceof
window.FormData||(v(g.data)?B=g.data:(B=[],f(g.data,B,null),B=B.join("&").replace(/%20/g,"+")),g.data=B,e.test(g.method)&&(d+=(b.test(d)?"&":"?")+g.data,g.data=null));return d},h={xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"},z={url:null,data:null,method:"GET",headers:null,username:null,password:null,cache:null,dataType:null,timeout:0,contentType:"application/x-www-form-urlencoded",
xhrFields:null,jsonp:!1,jsonpParam:null,jsonpCallback:null,transport:null,replace:!1,selector:null,form:null,beforeSend:null,progress:null,uploadProgress:null,processResponse:null,callbackScope:null},l={},q=new fa,G=function(a){var b;b=eval;a&&(/^[^\S]*use strict/.test(a)?(b=document.createElement("script"),b.text=a,document.head.appendChild(b).parentNode.removeChild(b)):b(a))},E=function(a,b,d){var c,e;if(!V(a)&&!u(a)&&d)c=document.createElement("input"),c.setAttribute("type","hidden"),c.setAttribute("name",
d),c.setAttribute("value",a),b.appendChild(c);else if(S(a)&&d)for(c=0,e=a.length;c<e;c++)E(a[c],b,d+"["+c+"]");else if(V(a))for(c in a)a.hasOwnProperty(c)&&E(a[c],b,d?d+"["+c+"]":c)},L=function(a){for(var b,d,c="",e=0;e<a.elements.length;e++)if(b=a.elements[e],b.hasAttribute("name"))if(d="INPUT"===b.nodeName.toUpperCase()?b.getAttribute("type").toUpperCase():"TEXT","FILE"===d)for(d=0;d<b.files.length;c+="&"+encodeURIComponent(b.name)+"="+encodeURIComponent(b.files[d++].name));else if("RADIO"!==d&&
"CHECKBOX"!==d||b.checked)c+="&"+encodeURIComponent(b.name)+"="+encodeURIComponent(b.value);return c},H=function(a,b,d){var c=b?b.dataType:null;b=b?b.selector:null;if(!v(a))return a;d=d||"";if("xml"===c||!c&&0<=d.indexOf("xml"))return a=ka(ja(a)),b?la(b,a):a;if("html"===c)return a=ka(a,"text/html"),b?la(b,a):a;if("fragment"==c){d=document.createDocumentFragment();c=document.createElement("div");for(c.innerHTML=a;c.firstChild;)d.appendChild(c.firstChild);return d}if("json"===c||!c&&0<=d.indexOf("json"))return pa(ja(a));
("script"===c||!c&&0<=d.indexOf("javascript"))&&G(a);return a+""},I=function(a){var b=d.exec((window?window.location.href:"").toLowerCase())||[],c=d.exec(a.url.toLowerCase());this._opt=a;!0!==a.crossDomain&&(a.crossDomain=!(!c||c[1]===b[1]&&c[2]===b[2]&&(c[3]||("http:"===c[1]?"80":"443"))===(b[3]||("http:"===b[1]?"80":"443"))));b=new ha;"iframe"!=a.transport||a.form?a.form&&(this._form=a.form,"POST"!=a.method||window&&window.FormData||(a.transport="iframe")):(this.createForm(),a.form=this._form);
a.form&&"iframe"!=a.transport&&(a.data="POST"==a.method?new FormData(a.form):L(a.form));a.url=g(a.url,a);c=!a.crossDomain&&"script"!=a.transport||a.form?"iframe"==a.transport?new C(a,b,this):new J(a,b,this):new K(a,b,this);this._deferred=b;this._transport=c;b.done(function(a){q.trigger("success",a)});b.fail(function(a){q.trigger("error",a)});b.always(function(){q.trigger("end")});q.trigger("start");a.timeout&&(this._timeout=setTimeout(k(this.onTimeout,this),a.timeout));a.jsonp&&this.createJsonp();
!1===q.trigger("beforeSend",a,c)&&(this._promise=ha.reject());a.beforeSend&&!1===a.beforeSend.call(a.callbackScope,a,c)&&(this._promise=ha.reject());this._promise||(ia(c.send,c),b.abort=k(this.abort,this),b.always(this.destroy,this),this._promise=b)};I.prototype={_jsonpName:null,_transport:null,_opt:null,_deferred:null,_promise:null,_timeout:null,_form:null,_removeForm:!1,promise:function(){return this._promise},abort:function(a){this._transport.abort();this._deferred.reject(a||"abort")},onTimeout:function(){this.abort("timeout")},
createForm:function(){var a=document.createElement("form");a.style.display="none";a.setAttribute("method",this._opt.method);E(this._opt.data,a,null);document.body.appendChild(a);this._form=a;this._removeForm=!0},createJsonp:function(){var a=this._opt,d=a.jsonpParam||"callback",c=a.jsonpCallback||"jsonp_"+Z();a.url+=(b.test(a.url)?"&":"?")+d+"="+c;this._jsonpName=c;"undefined"!=typeof window&&(window[c]=k(this.jsonpCallback,this));"undefined"!=typeof global&&(global[c]=k(this.jsonpCallback,this));
return c},jsonpCallback:function(a){var b;try{b=this.processResponseData(a)}catch(d){this._deferred?this._deferred.reject(d):ba(d)}this._deferred&&this._deferred.resolve(b)},processResponseData:function(a,b){var d=this._opt;a=H(a,d,b);q.hasListener("processResponse")&&(a=q.trigger("processResponse",a,this._deferred));d.processResponse&&(a=d.processResponse.call(d.callbackScope,a,this._deferred));return a},processResponse:function(a,b){var d=this._deferred,c;if(this._opt.jsonp)if(a){try{G(a)}catch(e){d.reject(e)}d.isPending()&&
d.reject("jsonp script didn't invoke callback")}else d.reject("jsonp script is empty");else{try{c=this.processResponseData(a,b)}catch(f){d.reject(f)}d.resolve(c)}},destroy:function(){this._timeout&&clearTimeout(this._timeout);this._form&&this._form.parentNode&&this._removeForm&&this._form.parentNode.removeChild(this._form);this._transport.destroy();delete this._transport;delete this._opt;delete this._deferred;delete this._promise;delete this._timeout;delete this._form;this._jsonpName&&("undefined"!=
typeof window&&delete window[this._jsonpName],"undefined"!=typeof global&&delete global[this._jsonpName])}};var y=function(a,b){b=b||{};a&&!v(a)?b=a:b.url=a;if(!b.url&&(b.form&&(b.url=b.form.getAttribute("action")),!b.url))throw"Must provide url";p(b,l,!1,!0);p(b,z,!1,!0);b.method=b.method?b.method.toUpperCase():b.form?b.form.getAttribute("method").toUpperCase()||"GET":"GET";return(new I(b)).promise()};y.setup=function(a){p(l,a,!0,!0)};y.on=function(){q.on.apply(q,arguments)};y.un=function(){q.un.apply(q,
arguments)};y.get=function(a,b){b=b||{};b.method="GET";return y(a,b)};y.post=function(a,b){b=b||{};b.method="POST";return y(a,b)};y.load=function(a,b,d){d=d||{};v(b)||(d=b);d.dataType="fragment";return y(b,d).done(function(b){if(d.replace)for(;a.firstChild;)a.removeChild(a.firstChild);a.appendChild(b)})};y.loadScript=function(a){return y(a,{transport:"script"})};y.submit=function(a,b){b=b||{};b.form=a;return y(null,b)};var J=function(a,b,d){var c;if(!(window.XMLHttpRequest&&(c=new XMLHttpRequest)||
(c=new ActiveXObject("Msxml2.XMLHTTP"))||(c=new ActiveXObject("Microsoft.XMLHTTP"))))throw"Unable to create XHR object";this._xhr=c;this._deferred=b;this._opt=a;this._ajax=d;a.progress&&T(c,"progress",k(a.progress,a.callbackScope));a.uploadProgress&&c.upload&&T(c.upload,"progress",k(a.uploadProgress,a.callbackScope));c.onreadystatechange=k(this.onReadyStateChange,this)};J.prototype={_xhr:null,_deferred:null,_ajax:null,setHeaders:function(){var a=this._opt,b=this._xhr,d;if(a.xhrFields)for(d in a.xhrFields)b[d]=
a.xhrFields[d];a.data&&a.contentType&&b.setRequestHeader("Content-Type",a.contentType);b.setRequestHeader("X-Requested-With","XMLHttpRequest");b.setRequestHeader("Accept",a.dataType&&h[a.dataType]?h[a.dataType]+", */*; q=0.01":h._default);for(d in a.headers)b.setRequestHeader(d,a.headers[d])},onReadyStateChange:function(){var a=this._xhr,b=this._deferred;if(0===a.readyState)a.onreadystatechange=m,b.resolve(a);else if(4===a.readyState){a.onreadystatechange=m;var d;a:{try{d=!a.status&&location&&"file:"==
location.protocol||200<=a.status&&300>a.status||304===a.status||1223===a.status;break a}catch(c){}d=!1}d?this._ajax.processResponse(v(a.responseText)?a.responseText:void 0,a.getResponseHeader("content-type")||""):b.reject(a)}},abort:function(){this._xhr.onreadystatechange=m;this._xhr.abort()},send:function(){var a=this._opt;try{this._xhr.open(a.method,a.url,!0,a.username,a.password),this.setHeaders(),this._xhr.send(a.data)}catch(b){this._deferred.reject(b)}},destroy:function(){delete this._xhr;delete this._deferred;
delete this._opt;delete this._ajax}};var K=function(a,b,d){this._opt=a;this._ajax=d;this._deferred=b};K.prototype={_opt:null,_deferred:null,_ajax:null,_el:null,send:function(){var a=document.createElement("script");a.setAttribute("async","async");a.setAttribute("charset","utf-8");a.setAttribute("src",this._opt.url);T(a,"load",k(this.onLoad,this));T(a,"error",k(this.onError,this));document.head.appendChild(a);this._el=a},onLoad:function(a){this._deferred&&this._deferred.resolve(a)},onError:function(a){this._deferred.reject(a)},
abort:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el)},destroy:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el);delete this._el;delete this._opt;delete this._ajax;delete this._deferred}};var C=function(a,b,d){this._opt=a;this._ajax=d;this._deferred=b};C.prototype={_opt:null,_deferred:null,_ajax:null,_el:null,send:function(){var a=document.createElement("iframe"),b="frame-"+Z(),d=this._opt.form;a.setAttribute("id",b);a.setAttribute("name",b);a.style.display=
"none";document.body.appendChild(a);d.setAttribute("action",this._opt.url);d.setAttribute("target",b);T(a,"load",k(this.onLoad,this));T(a,"error",k(this.onError,this));this._el=a;try{d.submit()}catch(c){this._deferred.reject(c)}},onLoad:function(){var a=this._el;this._opt&&!this._opt.jsonp&&(a=a.contentDocument||a.contentWindow.document,a=a.body.innerHTML,this._ajax.processResponse(a))},onError:function(a){this._deferred.reject(a)},abort:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el)},
destroy:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el);delete this._el;delete this._opt;delete this._ajax;delete this._deferred}};return y}(),G=J.factory,$=function(){var c={},a={};return X("MetaphorJs.data.Model",{type:null,fields:null,record:null,store:null,plain:!1,lastAjaxResponse:null,initialize:function(a){this.fields={};p(this,{record:{load:null,save:null,"delete":null,id:null,data:null,success:null,extra:{}},store:{load:null,save:null,"delete":null,id:null,data:null,
total:null,start:null,limit:null,success:null,extra:{}}},!1,!0);p(this,a,!0,!0);this.plain=!this.type},isPlain:function(){return this.plain},getRecordProp:function(a,d){return this.getProp("record",a,d)},setRecordProp:function(a,d){this.record[a]=d},getStoreProp:function(a,d){return this.getProp("store",a,d)},setStoreProp:function(a,d){this.store[a]=d},getProp:function(a,d,c){a=this[a];return a[d]&&a[d][c]||a[c]||this[c]||null},setProp:function(a,d){return this[a]=d},_createAjaxCfg:function(a,d,c,
f,g){var h=this,k=h[a],l=p({},v(k[d])?{url:k[d]}:k[d]),m=h.getProp(a,d,"id"),u=h.getProp(a,d,"data"),E=h.getProp(a,d,"url"),G=h.getProp(a,d,"json");if(!l)if(E)l={url:E};else throw a+"."+d+" not defined";v(l)&&(l={url:l});if(!l.url){if(!E)throw a+"."+d+" url not defined";l.url=E}l.data=p({},l.data,h.extra,k.extra,k[d]?k[d].extra:{},g,!0,!0);l.method||(l.method="load"==d?"GET":"POST");c&&(l.data[m]=c);f&&(u?l.data[u]=f:l.data=f);G&&l.data&&"GET"!=l.method&&(l.data=JSON.stringify(l.data));l.callbackScope=
h;"record"==a?l.processResponse=function(a,b){h.lastAjaxResponse=a;h._processRecordResponse(d,a,b)}:"store"==a&&(l.processResponse=function(a,b){h.lastAjaxResponse=a;h._processStoreResponse(d,a,b)});return l},_processRecordResponse:function(a,d,c){var f=this.getRecordProp(a,"id"),g=this.getRecordProp(a,"data"),f=(g=g?d[g]:d)&&g[f]||d[f];this._getSuccess("record",a,d)?c.resolve({id:f,data:g}):c.reject(d)},_processStoreResponse:function(a,d,c){var f=this.getStoreProp(a,"data"),g=this.getStoreProp(a,
"total"),f=f?d[f]:d,g=g?d[g]:null;this._getSuccess("store",a,d)?c.resolve({data:f,total:g}):c.reject(d)},_getSuccess:function(a,d,c){return(a=this.getProp(a,d,"success"))&&void 0!=c[a]?c[a]:!0},loadRecord:function(a){return N(this._createAjaxCfg("record","load",a))},saveRecord:function(a,d,c){return N(this._createAjaxCfg("record",a.getId()?"save":"create",a.getId(),p({},a.storeData(a.getData(d)),c)))},deleteRecord:function(a){return N(this._createAjaxCfg("record","delete",a.getId()))},loadStore:function(a,
d){return N(this._createAjaxCfg("store","load",null,null,d))},saveStore:function(a,d){return N(this._createAjaxCfg("store","save",null,d))},deleteRecords:function(a,d){return N(this._createAjaxCfg("store","delete",d))},getFields:function(){return this.fields},restoreField:function(a,d,c){var f=this.fields[d];if(f){switch(v(f)?f:f.type){case "int":c=parseInt(c);break;case "bool":case "boolean":v(c)?(c=c.toLowerCase(),c=!("off"===c||"no"===c||"0"===c||"false"==c||"null"==c)):c=c?!0:!1;break;case "double":case "float":c=
parseFloat(c);break;case "date":f.parseFn?c=f.parseFn(c,f.format):Date.parse?c=Date.parse(c,f.format):("timestamp"==f.format&&(c=1E3*parseInt(c)),c=new Date(c))}f.restore&&(c=f.restore.call(a,c,d))}return this.onRestoreField(a,d,c)},onRestoreField:function(a,d,c){return c},storeField:function(a,d,c){var f=this.fields[d];if(f){switch(v(f)?f:f.type){case "bool":case "boolean":c=c?"1":"0";break;case "date":c=f.formatFn?f.formatFn(c,f.format):Date.format?Date.format(c,f.format):"timestamp"==f.format?
c.getTime()/1E3:c.format?c.format(f.format):c.toString();break;default:c=c.toString()}f.store&&(c=f.store.call(a,c,d))}return this.onStoreField(a,d,c)},onStoreField:function(a,d,c){return c}},{create:function(a,d){return"MetaphorJs.data.Model"==a?G(a,d):d?G(a,d):c[a]?c[a]:c[a]=G(a)},addToCache:function(b){var d=b.getClass(),c=b.getId();"MetaphorJs.data.Record"!=d&&(a[d]||(a[d]={}),a[d][c]=b)},getFromCache:function(b,d){return a[b]&&a[b][d]?a[b][d]:null},removeFromCache:function(b,d){a[b]&&a[b][d]&&
delete a[b][d]}})}(),qa=J.isInstanceOf;X("MetaphorJs.cmp.Base",{destroyed:!1,_observable:null,initialize:function(c){c=c||{};this._observable=new fa;p(this,this._observable.getApi(),!0,!1);if(c.callback){var a=c.callback,b=a.scope||this;delete a.scope;for(var d in a)if(a.hasOwnProperty(d))this.on(d,a[d],b);delete c.callback}p(this,c,!0,!1)},destroy:function(){if(!this.destroyed){if(!1===this.trigger("beforedestroy",this))return!1;this.onDestroy();this.destroyed=!0;this.trigger("destroy",this);this._observable.destroy();
delete this._observable}},onDestroy:m});var U=X("MetaphorJs.data.Record","MetaphorJs.cmp.Base",{id:null,data:null,orig:null,modified:null,loaded:!1,dirty:!1,destroyed:!1,model:null,standalone:!0,stores:null,initialize:function(c,a,b){var d=arguments.length;1==d?(b=c,a=c=null):2==d&&(b=a,a=null);this.data={};this.orig={};this.stores=[];this.modified={};b=b||{};this.supr(b);v(this.model)?this.model=G(this.model):qa(this.model,"MetaphorJs.data.Model")||(this.model=G("MetaphorJs.data.Model",this.model));
this.id=c;a?this.importData(a):!1!==b.autoLoad&&c&&this.load();"MetaphorJs.data.Record"!=this.getClass()&&$.addToCache(this)},isLoaded:function(){return this.loaded},isStandalone:function(){return this.standalone},isDirty:function(){return this.dirty},getModel:function(){return this.model},attachStore:function(c){c=c.getId();-1==this.stores.indexOf(c)&&this.stores.push(c)},detachStore:function(c){c=c.getId();var a;this.destroyed||-1==(a=this.stores.indexOf(c))||(this.stores.splice(a,1),0!=this.stores.length||
this.standalone||this.destroy())},setDirty:function(c){this.dirty!=c&&(this.dirty=!!c,this.trigger("dirtychange",this,c))},importData:function(c){var a={},b;if(c){for(b in c)a[b]=this.model.restoreField(this,b,c[b]);this.data=a}this.orig=p({},this.data);this.modified={};this.loaded=!0;this.setDirty(!1)},storeData:function(c){var a={},b;for(b in c)a[b]=this.model.storeField(this,b,c[b]);return a},getId:function(){return this.id},getData:function(c){if(c){var a={},b,d;c=v(c)?[c]:c;b=0;for(d=c.length;b<
d;b++)a[c[b]]=this.data[c[b]];return a}return p({},this.data)},getChanged:function(){return p({},this.modified)},isChanged:function(c){return this.modified[c]||!1},get:function(c){return this.data[c]},setId:function(c){!this.id&&c&&(this.id=c)},set:function(c,a){var b=this.data[c];a=this.model.restoreField(this,c,a);this.data[c]=a;b!=a&&(this.modified[c]=!0,this.setDirty(!0),this.trigger("change",this,c,a,b),this.trigger("change-"+c,this,c,a,b))},revert:function(){this.dirty&&(this.data=p({},this.orig),
this.modified={},this.setDirty(!1))},load:function(){var c=this;c.trigger("beforeload",c);return c.model.loadRecord(c.id).done(function(a){c.setId(a.id);c.importData(a.data);c.trigger("load",c)}).fail(function(){c.trigger("failedload",c)})},save:function(c,a){var b=this;b.trigger("beforesave",b);return b.model.saveRecord(b,c,a).done(function(a){b.setId(a.id);b.importData(a.data);b.trigger("save",b)}).fail(function(a){b.trigger("failedsave",b)})},"delete":function(){var c=this;c.trigger("beforedelete",
c);return c.model.deleteRecord(c).done(function(){c.trigger("delete",c);c.destroy()}).fail(function(){c.trigger("faileddelete",c)})},reset:function(){this.id=null;this.data={};this.orig={};this.modified={};this.dirty=this.loaded=!1;this.trigger("reset",this)},destroy:function(){this.destroyed||(this.destroyed=!0,this.trigger("destroy",this),this.stores=this.model=this.modified=this.orig=this.data=null,$.removeFromCache(this.getClass(),this.id),this.supr())}}),ra=function(){var c=function(a,b,c){if(u(b))return b(a,
c);if(""===b||void 0===b)return!0;if(void 0!==a){if(da(a))return a===b;if(b instanceof RegExp)return b.test(""+a);if("strict"==c)return""+a===""+b;if(!0===c||null===c||void 0===c)return-1!=""+a.indexOf(b);if(!1===c)return-1==""+a.indexOf(b)}return!1},a=function(a,b,f){if(ma(a))return void 0===b.$?!0:c(a,b.$,f);var g,h;for(g in b)if("$"==g)for(h in a){if(c(a[h],b.$,f))return!0}else if(c(a[g],b[g],f))return!0;return!1},b=function(b,c,f){Y(c)||(c={$:c});var g=[],h,k;h=-1;for(k=b.length;++h<k;)a(b[h],
c,f)&&g.push(b[h]);return g};b.compare=a;return b}(),sa=function(c,a,b){b||(b="asc");c=c.slice();c.sort(function(b,c){var f=typeof b,g=b,h=c;if(f!=typeof c)return 0;"object"==f&&(u(a)?(g=a(b),h=a(c)):(g=b[a],h=c[a]));if("number"==typeof g)return g-h;g=(""+g).toLowerCase();h=(""+h).toLowerCase();return g===h?0:g>h?1:-1});return"desc"==b?c.reverse():c},J=Array.prototype.indexOf;J||(J=Array.prototype.indexOf=function(c,a){var b;if(null==this)throw new TypeError('"this" is null or not defined');var d=
Object(this),e=d.length>>>0;if(0===e)return-1;b=+a||0;Infinity===Math.abs(b)&&(b=0);if(b>=e)return-1;for(b=Math.max(0<=b?b:e-Math.abs(b),0);b<e;){if(b in d&&d[b]===c)return b;b++}return-1});(function(){var c={};return X("MetaphorJs.data.Store","MetaphorJs.cmp.Base",{id:null,autoLoad:!1,clearOnLoad:!0,model:null,extraParams:null,loaded:!1,loading:!1,local:!1,items:null,current:null,map:null,currentMap:null,length:0,currentLength:0,maxLength:0,totalLength:0,start:0,pageSize:null,pages:null,filtered:!1,
sorted:!1,filterBy:null,filterOpt:null,sortBy:null,sortDir:null,publicStore:!1,idProp:null,initialize:function(a,b,d){this.items=[];this.current=[];this.map={};this.currentMap={};this.loaded=!1;this.extraParams=this.extraParams||{};a&&!v(a)&&(d=b,b=a,a=null);b=b||{};a&&(b.url=a);this.supr(b);this.id=this.id||Z();this.publicStore&&(c[this.id]=this);this.initModel(b);this.createEvent("beforeload",!1);!this.local&&this.autoLoad?this.load():d&&(S(d)?this._loadArray(d):this._loadAjaxData(d));this.local&&
(this.loaded=!0)},initModel:function(a){v(this.model)?this.model=G(this.model):this.model instanceof $||(this.model=G("MetaphorJs.data.Model",this.model));a.url&&(this.model.store.load=a.url);this.idProp=this.model.getStoreProp("load","id")},getId:function(){return this.id},isLoaded:function(){return this.loaded},isLocal:function(){return this.local},setLocal:function(a){this.local=!!a},isLoading:function(){return this.loading},isFiltered:function(){return this.filtered},isSorted:function(){return this.sorted},
getLength:function(a){return a?this.length:this.currentLength},getTotalLength:function(){return this.totalLength||this.currentLength},getPagesCount:function(){return null!==this.pageSize?parseInt(this.totalLength/this.pageSize):1},setParam:function(a,b){this.extraParams[a]=b},getParam:function(a){return this.extraParams[a]},setStart:function(a){this.start=a},setPageSize:function(a){this.pageSize=a},getAjaxData:function(){return this.ajaxData},hasDirty:function(a){if(this.model.isPlain())return!1;
var b=!1;this.each(function(a){return a.isDirty()?(b=!0,!1):!0},null,a);return b},getDirty:function(a){var b=[];if(this.model.isPlain())return b;this.each(function(a){a.isDirty()&&b.push(a)},null,a);return b},getModel:function(){return this.model},_loadAjaxData:function(a,b){var c=this;b=b||{};if(b.silent||!1!==c.trigger("beforeload",c))c.ajaxData=a,c.model._processStoreResponse("load",a,{resolve:function(a){c._onModelLoadSuccess(a,b)},reject:function(a){c._onModelLoadFail(a,b)}})},_loadArray:function(a,
b){b=b||{};(b.silent||!1!==this.trigger("beforeload",this))&&S(a)&&(this._load(a,b),this.totalLength=this.length)},_load:function(a,b){var c=b.prepend;b=b||{};for(var e=0;e<a.length;e++)c?this.insert(e,a[e],!0,!0):this.add(a[e],!0,!0);this.loaded=!0;this.loading=!1;this.onLoad();b.skipUpdate||this.update();b.silent||this.trigger("load",this)},load:function(a,b){var c=this,e=c.model.store,f=e.start,e=e.limit,g=c.pageSize;b=b||{};if(c.local)return null;a=p({},c.extraParams,a||{});null===g||a[f]||a[e]||
(f&&(a[f]=c.start),e&&(a[e]=g));if(!b.silent&&!1===c.trigger("beforeload",c))return null;c.loading=!0;return c.model.loadStore(c,a).done(function(a){c.ajaxData=c.model.lastAjaxResponse;c._onModelLoadSuccess(a,b)}).fail(function(a){c.ajaxData=c.model.lastAjaxResponse;c._onModelLoadFail(a,b)})},_onModelLoadSuccess:function(a,b){this.clearOnLoad&&0<this.length&&this.clear();this.totalLength=parseInt(a.total);this._load(a.data,b)},_onModelLoadFail:function(a,b){this.onFailedLoad();b.silent||this.trigger("failedload",
this,a)},onLoad:m,onFailedLoad:m,save:function(a){var b=this,c={},e=0;if(b.local)return null;if(b.model.isPlain())throw Error("Cannot save plain store");b.each(function(a){a.isDirty()&&(c[a.getId()]=a.storeData(a.getData()),e++)});if(!e)throw Error("Nothing to save");return a||!1!==b.trigger("beforesave",b,c)?b.model.saveStore(b,c).done(function(c){b._onModelSaveSuccess(c,a)}).fail(function(c){b._onModelSaveFail(c,a)}):null},_onModelSaveSuccess:function(a,b){var c,e,f,g=a.data;if(g&&g.length)for(c=
0,e=g.length;c<e;c++)f=this.getRecordId(g[c]),(f=this.getById(f))&&f.importData(g[c]);this.onSave();b||this.trigger("save",this)},_onModelSaveFail:function(a,b){this.onFailedSave(a);b||this.trigger("failedsave",this)},onSave:m,onFailedSave:m,deleteById:function(a,b,c){var e=this,f,g,h;if(e.local)return null;if(!a||S(a)&&!a.length)throw Error("Record id required");S(a)||(a=[a]);f=0;for(g=a.length;f<g;f++)h=e.getById(a[f]),e.remove(h,b,c),h instanceof U&&h.destroy();return b||!1!==e.trigger("beforedelete",
e,a)?e.model.deleteRecords(e,a).done(function(){e.totalLength-=a.length;e.onDelete();b||e.trigger("delete",e,a)}).fail(function(){e.onFailedDelete();b||e.trigger("faileddelete",e,a)}):null},onDelete:m,onFailedDelete:m,deleteAt:function(a,b,c){var e=this.getAt(a);if(!e)throw Error("Record not found at "+a);return this["delete"](e,b,c)},"delete":function(a,b,c){return this.deleteById(this.getRecordId(a),b,c)},deleteRecords:function(a,b,c){var e=[],f,g;f=0;for(g=a.length;f<g;f++)e.push(this.getRecordId(a[f]));
return this.deleteById(e,b,c)},loadOr:function(a,b,c){this.local||this.isLoading()||(this.isLoaded()?a&&a.call(b||this):this.load(null,c))},addNextPage:function(a){!this.local&&this.length<this.totalLength&&this.load({start:this.length,limit:this.pageSize},a)},loadNextPage:function(a){this.local||(this.start+=this.pageSize,this.load(null,a))},loadPrevPage:function(a){this.local||(this.start-=this.pageSize,0>this.start&&(this.start=0),this.load(null,a))},loadPage:function(a,b){this.local||(this.start=
parseInt(a,10),0>this.start&&(this.start=0),this.load(null,b))},getRecordId:function(a){return a instanceof U?a.getId():a[this.idProp]||null},getRecordData:function(a){return this.model.isPlain()?a:a.data},processRawDataItem:function(a){if(a instanceof U||this.model.isPlain())return a;var b=this.model.type,c=this.getRecordId(a),e;c&&(e=$.getFromCache(b,c));e||(e=G(b,c,a,{model:this.model,standalone:!1}));return e},bindRecord:function(a,b){b[a]("change",this.onRecordChange,this);b[a]("destroy",this.onRecordDestroy,
this);b[a]("dirtychange",this.onRecordDirtyChange,this);return b},onRecordDirtyChange:function(a){this.trigger("update",this,a)},onRecordChange:function(a,b,c,e){this.trigger("update",this,a)},onRecordDestroy:function(a){this.remove(a)},shift:function(a,b,c){return this.removeAt(0,a,b,c)},unshift:function(a,b,c){return this.insert(0,a,b,c)},pop:function(a,b,c){return this.removeAt(this.length-1,a,b,c)},addMany:function(a,b,c){var e,f,g=this.length;e=0;for(f=a.length;e<f;e++)this.insert(g+e,a[e],!0,
!0);c||this.update();0<f&&!b&&this.trigger("add",a)},add:function(a,b,c){return this.insert(this.length,a,b,c)},onAdd:m,removeAt:function(a,b,c,e){e||(a=this.items.indexOf(this.current[a]));if(a<this.length&&0<=a)return this.length--,e=this.items[a],this.items.splice(a,1),a=this.getRecordId(e),void 0!=a&&(delete this.map[a],delete this.currentMap[a]),this.onRemove(e,a),c||this.update(),b||this.trigger("remove",e,a),e instanceof U?(this.bindRecord("un",e),e.detachStore(this),e.destroyed?void 0:e):
e},onRemove:m,insertMany:function(a,b,c,e){var f,g;f=0;for(g=b.length;f<g;f++)this.insert(a+f,b[f],!0,!0);0<g&&!e&&this.update();0<g&&!c&&this.trigger("add",b)},insert:function(a,b,c,e){var f,g=!1;b=this.processRawDataItem(b);f=this.getRecordId(b);this.map[f]&&(this.suspendAllEvents(),this.removeId(f),this.resumeAllEvents());a>=this.length?(this.items.push(b),g=!0):this.items.splice(a,0,b);this.length++;this.maxLength&&this.length>this.maxLength&&(g?this.pop(c,!0):this.shift(c,!0));void 0!=f&&(this.map[f]=
b);b instanceof U&&(b.attachStore(this),this.bindRecord("on",b));this.onAdd(a,b);e||this.update();c||this.trigger("add",[b]);return b},replace:function(a,b,c,e){var f;f=this.items.indexOf(a);this.removeAt(f,!0,!0,!0);this.insert(f,b,!0,!0);e||this.update();c||this.trigger("replace",a,b);return b},onReplace:m,remove:function(a,b,c){return this.removeAt(this.indexOf(a,!0),b,c,!0)},removeId:function(a,b,c){return this.removeAt(this.indexOfId(a,!0),b,c,!0)},contains:function(a,b){return-1!=this.indexOf(a,
b)},containsId:function(a,b){return b?void 0!==this.map[a]:void 0!==this.currentMap[a]},clear:function(){var a=this.getRange();this._reset();this.onClear();this.trigger("clear",a)},onClear:m,reset:function(){this._reset();this.start=0},_reset:function(a){var b,c;if(!a)for(a=0,b=this.items.length;a<b;a++)c=this.items[a],c instanceof U&&(this.bindRecord("un",c),c.detachStore(this));this.totalLength=this.currentLength=this.length=0;this.items=[];this.current=[];this.map={};this.currentMap={};this.loaded=
this.local},getAt:function(a,b){return b?this.items[a]||void 0:this.current[a]||void 0},getById:function(a,b){return b?this.map[a]||void 0:this.currentMap[a]||void 0},indexOf:function(a,b){return b?this.items.indexOf(a):this.current.indexOf(a)},indexOfId:function(a,b){return this.indexOf(this.getById(a,b),b)},each:function(a,b,c){c=c?this.items.slice():this.current.slice();for(var e=0,f=c.length;e<f&&!1!==a.call(b,c[e],e,f);e++);},eachId:function(a,b,c){var e=this;e.each(function(c,d,h){return a.call(b,
e.getRecordId(c),d,h)},null,c)},collect:function(a,b){var c=[],e=!this.model.isPlain();this.each(function(b){(b=e?b.get(a):b[a])&&c.push(b)},null,b);return c},first:function(a){return a?this.items[0]:this.current[0]},last:function(a){return a?this.items[this.length-1]:this.current[this.current-1]},getRange:function(a,b,c){c=c?this.items:this.current;var e=[];if(1>c.length)return e;a=a||0;b=Math.min(void 0==b?this.length-1:b,this.length-1);if(a<=b)for(;a<=b;a++)e.push(c[a]);else for(;a>=b;a--)e.push(c[a]);
return e},findBy:function(a,b,c,e){a=this.findIndexBy(a,b,c,e);return-1==a?void 0:this.getAt(a,e)},findIndexBy:function(a,b,c,e){e=e?this.items:this.current;c=c||0;for(var f=e.length;c<f;c++)if(a.call(b,e[c],this.getRecordId(e[c])))return c;return-1},find:function(a,b,c,e){var f=!this.model.isPlain(),g;return this.findIndexBy(function(e){g=f?e.get(a):e[a];return c?g===b:g==b},this,0,e)},findExact:function(a,b,c){return this.find(a,b,!0,c)},findBySet:function(a,b){var c=null,e,f;this.each(function(b){e=
!0;for(f in a)if(a[f]!=b[f]){e=!1;break}return e?(c=b,!1):!0},null,b);return c},update:function(){var a=this,b=a.filtered,c=a.sorted;a.currentLength=a.length;a.currentMap=a.map;a.current=a.items;if(b){var e=a.filterBy,f=a.filterOpt,g,h;a.current=g=[];a.currentMap=h={};a.each(function(b){ra.compare(b.data,e,f)&&(g.push(b),h[a.getRecordId(b)]=b)},null,!0);a.currentLength=a.current.length}if(c){var k=a.sortBy,l=!a.model.isPlain();a.current=sa(a.current,function(a){return l?a.get(k):a[k]},a.sortDir)}a.trigger("update",
a)},filter:function(a,b){this.filtered=!0;this.filterBy=a;this.filterOpt=b;this.update()},clearFilter:function(){this.filtered&&(this.filterOpt=this.filterBy=null,this.update())},sort:function(a,b){this.sorted=!0;this.sortBy=a;this.sortDir=b;this.update()},clearSorting:function(){this.sorted=!1;this.sortDir=this.sortBy=null;this.update()},onDestroy:function(){delete c[this.id];this.clear();this.supr()}},{createFromSelect:function(a){var b=[];a=a.options;for(var c=0,e=a.length;c<e;c++){var f=a[c],
g=(f.hasAttribute?f.hasAttribute("value"):f.getAttributeNode("value").specified)?f.value:f.text;b.push([g,f.text])}a=G("MetaphorJs.data.Store",{server:{load:{id:0}}});a._loadArray(b);return a},lookupStore:function(a){return c[a]||null},eachStore:function(a,b){for(var d in c)if(!1===a.call(b||window,c[d]))break}})})();X("MetaphorJs.data.FirebaseStore","MetaphorJs.data.Store",{firebase:null,initialize:function(c){this.firebase=v(c)?new Firebase(c):c;this.firebase.on("child_added",k(this.onChildAdded,
this));this.firebase.on("child_removed",k(this.onChildRemoved,this));this.firebase.on("child_changed",k(this.onChildChanged,this));this.firebase.on("child_moved",k(this.onChildMoved,this));this.supr()},initModel:m,ref:function(){return this.firebase.ref?this.firebase.ref():this.firebase},load:function(){if(!this.loaded)this.firebase.once("value",k(this.onSnapshotLoaded,this))},onSnapshotLoaded:function(c){var a=this;c.forEach(function(b){a.add(b,!0,!0)});a.update();a.loaded=!0;a.trigger("load",a)},
onChildAdded:function(c,a){if(this.loaded){var b=this.indexOfId(a,!0);this.insert(b+1,c)}},onChildRemoved:function(c){this.loaded&&this.removeId(c.name())},onChildChanged:function(c,a){if(this.loaded){var b=this.getById(c.name(),!0);this.replace(b,c)}},onChildMoved:function(c,a){},getRecordId:function(c){return c.name()},getRecordData:function(c){return c.val()},processRawDataItem:function(c){return c},bindRecord:m});"undefined"!=typeof global?global.MetaphorJs=ca:window.MetaphorJs=ca})();
