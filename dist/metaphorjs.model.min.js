'use strict';(function(){function q(c){return"function"==typeof c}function k(c){return"string"==typeof c||c===""+c}function Y(c){if(null===c||"object"!=typeof c)return!1;c=Z(c);return 2<c||-1==c}function ia(c,b,a,d){setTimeout(function(){c.apply(b,a||[])},d||0)}function K(c){var b=c.stack||Error().stack;if("undefined"!=typeof console&&console.log)ia(function(){console.log(c);b&&console.log(b)});else throw c;}function $(c){return"object"==typeof c&&3===Z(c)&&!c.nodeType&&c.constructor===Object}function da(c){return!0===
c||!1===c}function t(){}function ja(c,b){var a,d;if(!c||!k(c))return null;try{d=new DOMParser,a=d.parseFromString(c,b||"text/xml")}catch(e){a=void 0}if(!a||a.getElementsByTagName("parsererror").length)throw"Invalid XML: "+c;return a}function ea(c){if(c&&void 0!=!c.length&&c!==""+c){for(var b=[],a=-1,d=c.length>>>0;++a!==d;b[a]=c[a]);return b}return c?[c]:[]}function O(c){return"object"==typeof c&&5===Z(c)}function P(c,b,a){c.attachEvent?c.attachEvent("on"+b,a):c.addEventListener(b,a,!1)}function Q(c){if(!c||
!c.then)return!1;var b,a;return"object"!=(a=typeof c)&&"function"!=a?!1:q(b=c.then)?b:!1}function ka(c){c=Z(c);return 3>c&&-1<c}function na(c,b,a){a||(a="asc");c=c.slice();c.sort(function(a,c){var f=typeof a,g=a,h=c;if(f!=typeof c)return 0;"object"==f&&(q(b)?(g=b(a),h=b(c)):(g=a[b],h=c[b]));if("number"==typeof g)return g-h;g=(""+g).toLowerCase();h=(""+h).toLowerCase();return g===h?0:g>h?1:-1});return"desc"==a?c.reverse():c}var oa=Object.prototype.toString,Z=function(){var c={"[object String]":0,"[object Number]":1,
"[object Boolean]":2,"[object Object]":3,"[object Function]":4,"[object Array]":5,"[object RegExp]":9,"[object Date]":10};return function(b){if(!b){if(null===b)return 6;if(void 0===b)return 7}var a=c[oa.call(b)];return void 0===a?-1:1==a&&isNaN(b)?8:a}}(),R=function(c,b){var a={};c||(c="undefined"!=typeof global?global:window);this.register=function(d,e){var f;f=d;var g=f.split("."),h,p=g.pop();h=g.join(".");var l=g.length,A,I=c;if(a[h])f=[a[h],p,f];else{if(0<l)for(h=0;h<l;h++){A=g[h];if(b&&0==h)if(A==
b){I=c;continue}else f=b+"."+f;void 0===I[A]&&(I[A]={});I=I[A]}else b&&(f=b+"."+f);f=[I,p,f]}g=f[0];p=f[1];Y(g)&&void 0===g[p]&&(g[p]=e,a[f[2]]=e);return e};this.exists=function(b){return void 0!==a[b]};this.get=function(d,e){if(void 0!==a[d])return a[d];if(b&&void 0!==a[b+"."+d])return a[b+"."+d];if(!e){var f=d.split("."),g,h=f.length,p,l=c;for(g=0;g<h;g++)if(p=f[g],b&&0==g&&p==b)l=c;else{if(void 0===l[p])return;l=l[p]}l&&(a[d]=l);return l}};this.add=function(c,e){b&&0!==c.indexOf(b)&&(c=b+"."+c);
void 0===a[c]&&(a[c]=e);return e};this.remove=function(b){delete a[b]};this.normalize=function(a){return a&&b&&0!==a.indexOf(b)?b+"."+a:a}};R.prototype.register=null;R.prototype.exists=null;R.prototype.get=null;R.prototype.add=null;R.prototype.remove=null;R.prototype.normalize=null;var G=Array.prototype.slice,m=function(){return function b(){var a=!1,d=!1,e=G.call(arguments),f=e.shift(),g,h,p;da(e[e.length-1])&&(a=e.pop());da(e[e.length-1])&&(d=a,a=e.pop());for(;e.length;)if(g=e.shift())for(h in g)if(g.hasOwnProperty(h)&&
void 0!==(p=g[h]))if(d)if(f[h]&&$(f[h])&&$(p))b(f[h],p,a,d);else{if(!0===a||void 0==f[h])$(p)?(f[h]={},b(f[h],p,a,!0)):f[h]=p}else if(!0===a||void 0==f[h])f[h]=p;return f}}(),J=function(){var c=function(){this.supr&&this.supr!==t&&this.supr.apply(this,arguments)},b=function(b,a,c){var d=b.prototype[a]||("$construct"==a?b:t)||t;return function(){var b,a=this.supr;this.supr=d;b=c.apply(this,arguments);this.supr=a;return b}},a=function(a,c,d){var e,l,A,I=d.prototype;for(e in c)c.hasOwnProperty(e)&&(A=
I[e],l=c[e],a[e]=!q(l)||A&&!q(A)?l:b(d,e,l));a.$plugins=null;I.$beforeInit?(a.$beforeInit=I.$beforeInit.slice(),a.$afterInit=I.$afterInit.slice()):(a.$beforeInit=[],a.$afterInit=[])},d=function(b,a){for(var c in a)a.hasOwnProperty(c)&&("$beforeInit"==c?b.$beforeInit.push(a[c]):"$afterInit"==c?b.$afterInit.push(a[c]):b[c]||(b[c]=a[c]))},e=function(b){b||(b=new R);var e=function(){return function(){var a,c,d=[],e=[],h,g,p=[],l=G.call(arguments);if(!this)throw"Must instantiate via new";this.$construct.apply(this,
arguments);h=this.$plugins;this.$plugins=null;a=-1;for(c=this.$beforeInit.length;++a<c;d.push([this.$beforeInit[a],this]));a=-1;for(c=this.$afterInit.length;++a<c;e.push([this.$afterInit[a],this]));if(h)for(a=0,c=h.length;a<c;a++)g=h[a],k(g)&&(g=b.get(g,!0)),p[a]=g=new g(this,l),g.$beforeHostInit&&d.push([g.$beforeHostInit,g]),g.$afterHostInit&&e.push([g.$afterHostInit,g]);a=-1;for(c=d.length;++a<c;d[a][0].apply(d[a][1],arguments));this.$init&&this.$init.apply(this,arguments);a=-1;for(c=e.length;++a<
c;e[a][0].apply(e[a][1],arguments));this.$plugins=p}},h=function(){};m(h.prototype,{$class:null,$extends:null,$plugins:null,$mixins:null,$construct:t,$init:t,$beforeInit:[],$afterInit:[],$getClass:function(){return this.$class},$getParentClass:function(){return this.$extends},destroy:function(){for(var a in this)this.hasOwnProperty(a)&&(this[a]=null)}});h.$self=h;h.$instantiate=function(){var a=arguments;switch(a.length){case 0:return new this;case 1:return new this(a[0]);case 2:return new this(a[0],
a[1]);case 3:return new this(a[0],a[1],a[2]);case 4:return new this(a[0],a[1],a[2],a[3]);default:return l(this,a)}};h.$extend=function(a,b,c){return p(a,b,c,this)};var p=function(p,l,S,z){q(p)||(S=l,l=p,p=null);l=l||{};var n=l.$class,B=z||l.$extends,r=l.$mixins,m,t;z=B&&k(B)?b.get(B):h;B?k(B)?z=b.get(B):(z=B,B=z.$class||""):(z=h,B="");if(B&&!z)throw Error(B+" not found");n&&(n=b.normalize(n));l.$class=n;l.$extends=B;l.$mixins=null;t=function(){};t.prototype=z.prototype;B=new t;t=null;l.$construct=
p||c;a(B,l,z);if(r)for(p=0,l=r.length;p<l;p++)t=r[p],k(t)&&(t=b.get(t,!0)),d(B,t);r=e();B.constructor=r;r.prototype=B;for(m in h)"prototype"!=m&&h.hasOwnProperty(m)&&(r[m]=h[m]);for(m in z)"prototype"!=m&&z.hasOwnProperty(m)&&(r[m]=z[m]);if(S)for(m in S)"prototype"!=m&&S.hasOwnProperty(m)&&(r[m]=S[m]);r.$parent=z;r.$self=r;n&&b.register(n,r);return r},l=function(a){var c=b.get(a),d=G.call(arguments,1);if(!c)throw Error(a+" not found");return c.$instantiate.apply(c,d)};this.factory=l;this.isSubclassOf=
function(a,c){var d=a,e=b.get;c=k(c)?b.normalize(c):c.prototype.$class;for(k(a)&&(d=e(b.normalize(a)));d&&d.prototype;){if(d.prototype.$class==c)return!0;d=d.$parent}return!1};this.isInstanceOf=function(a,c){var d=k(c)?b.get(c):c;return d?a instanceof d:!1};this.define=p;this.BaseClass=h};e.prototype={factory:null,isSubclassOf:null,isInstanceOf:null,define:null};return e}(),fa={lib:{},cmp:{},view:{}},pa=new R(fa,"MetaphorJs"),J=new J(pa),M=J.define,n=Function.prototype.bind?function(c,b){return c.bind(b)}:
function(c,b){return function(){return c.apply(b,arguments)}},la=function(){return String.prototype.trim?function(c){return k(c)?c.trim():c}:function(c){return k(c)?c.replace(/^\s\s*/,"").replace(/\s\s*$/,""):c}}(),qa=function(){return"undefined"!=typeof JSON?function(c){return JSON.parse(c)}:function(c){return(new Function("return "+c))()}}(),ma=function(){var c=/^[\w[:#.][\w\]*^|=!]*$/,b=/=([^\]]+)/,a=/ *, */,d=/(\([^)]*)\+/,e=/(\[[^\]]+)~/,f=/(~|>|\+)/,g=/ +/,h=/([^[:.#]+)?(?:#([^[:.#]+))?(?:\.([^[:.]+))?(?:\[([^!&^*|$[:=]+)([!$^*|&]?=)?([^:\]]+)?\])?(?::([^(]+)(?:\(([^)]+)\))?)?/,
p=/(?:(-?\d*)n)?(?:(%|-)(\d*))?/,l=/\D/,A=/[^(]*\(([^)]*)\)/,m=/\(.*/,n=/\[([^!~^*|$ [:=]+)([$^*|]?=)?([^ :\]]+)?\]/,z=document,t=!!z.getElementsByClassName,B=!!z.querySelectorAll,r={"first-child":function(a){return a.parentNode.getElementsByTagName("*")[0]!==a},"last-child":function(a){for(;(a=a.nextSibling)&&1!=a.nodeType;);return!!a},root:function(a){return"html"!==a.nodeName.toLowerCase()},"nth-child":function(a,b){var c=a.nodeIndex||0,d=b[3]=b[3]?("%"===b[2]?-1:1)*b[3]:0,e=b[1];if(c)return!((c+
d)%e);var x=a.parentNode.firstChild;c++;do if(1==x.nodeType&&(x.nodeIndex=++c)&&a===x&&(c+d)%e)return 0;while(x=x.nextSibling);return 1},"nth-last-child":function(a,b){var c=a.nodeIndexLast||0,d=b[3]?("%"===b[2]?-1:1)*b[3]:0,e=b[1];if(c)return!((c+d)%e);var x=a.parentNode.lastChild;c++;do if(1==x.nodeType&&(x.nodeLastIndex=c++)&&a===x&&(c+d)%e)return 0;while(x=x.previousSibling);return 1},empty:function(a){return!!a.firstChild},parent:function(a){return!a.firstChild},"only-child":function(a){return 1!=
a.parentNode.getElementsByTagName("*").length},checked:function(a){return!a.checked},lang:function(a,b){return a.lang!==b&&z.documentElement.lang!==b},enabled:function(a){return a.disabled||"hidden"===a.type},disabled:function(a){return!a.disabled},selected:function(a){return!a.selected}},k={},q=function(a){return k[a]||(k[a]=new RegExp("(^| +)"+a+"($| +)"))},E={"":function(a,b){return null!==a.getAttribute(b)},"=":function(a,b,c){var d;return(d=a.getAttribute(b))&&d===c},"&=":function(a,b,c){var d;
return(d=a.getAttribute(b))&&q(c).test(d)},"^=":function(a,b,c){var d;return(d=a.getAttribute(b)+"")&&!d.indexOf(c)},"$=":function(a,b,c){var d;return(d=a.getAttribute(b)+"")&&d.indexOf(c)==d.length-c.length},"*=":function(a,b,c){var d;return(d=a.getAttribute(b)+"")&&-1!=d.indexOf(c)},"|=":function(a,b,c){var d;return(d=a.getAttribute(b)+"")&&(d===c||!!d.indexOf(c+"-"))},"!=":function(a,b,c){var d;return!(d=a.getAttribute(b))||!q(c).test(d)}},x=function(x,D){D=D||z;var u=[],y=null,k,q,L,s,N,F,H;if(B)try{u=
ea(D.querySelectorAll(x.replace(b,'="$1"')))}catch(R){y=!0}if(!B||y)if(c.test(x))switch(y=0,x.charAt(0)){case "#":y=x.slice(1);u=z.getElementById(y);u.id!==y&&(u=z.all[y]);u=u?[u]:[];break;case ".":k=x.slice(1);if(t)u=ea((u=D.getElementsByClassName(k)).length?u:[]);else{k=" "+k+" ";q=D.getElementsByTagName("*");for(L=0;s=q[L++];)-1!=(" "+s.className+" ").indexOf(k)&&(u[y++]=s);u=y?u:[]}break;case ":":q=D.getElementsByTagName("*");L=0;N=x.replace(A,"$1");for(F=x.replace(m,"");s=q[L++];)r[F]&&!r[F](s,
N)&&(u[y++]=s);u=y?u:[];break;case "[":q=D.getElementsByTagName("*");L=0;s=n.exec(x);k=s[1];H=s[2]||"";for(N=s[3];s=q[L++];)E[H]&&(E[H](s,k,N)||"class"===k&&E[H](s,"className",N))&&(u[y++]=s);u=y?u:[];break;default:u=ea((u=D.getElementsByTagName(x)).length?u:[])}else{for(var J=x.split(a),C=J.length-1,Q=!!C,O,P,w,G,T,U,V,W,X,v,K,M;y=J[C--];){P=(O=y.replace(d,"$1%").replace(e,"$1&").replace(f," $1 ").split(g)).length;L=0;G=" ";for(q=[D];w=O[L++];)if(" "!==w&&">"!==w&&"~"!==w&&"+"!==w&&q){w=w.match(h);
T=w[1]||"*";U=w[2];V=w[3]?" "+w[3]+" ":"";k=w[4];H=w[5]||"";F=w[7];N="nth-child"===F||"nth-last-child"===F?p.exec("even"===w[8]&&"2n"||"odd"===w[8]&&"2n%1"||!l.test(w[8])&&"0n%"+w[8]||w[8]):w[8];W=[];y=X=0;for(K=L==P;v=q[X++];)switch(G){case " ":M=v.getElementsByTagName(T);for(v=0;s=M[v++];)U&&s.id!==U||V&&-1==(" "+s.className+" ").indexOf(V)||!(!k||E[H]&&(E[H](s,k,w[6])||"class"===k&&E[H](s,"className",w[6])))||s.yeasss||(r[F]?r[F](s,N):F)||(K&&(s.yeasss=1),W[y++]=s);break;case "~":for(T=T.toLowerCase();(v=
v.nextSibling)&&!v.yeasss;)1!=v.nodeType||"*"!==T&&v.nodeName.toLowerCase()!==T||U&&v.id!==U||V&&-1==(" "+v.className+" ").indexOf(V)||!(!k||E[H]&&(E[H](s,k,w[6])||"class"===k&&E[H](s,"className",w[6])))||v.yeasss||(r[F]?r[F](v,N):F)||(K&&(v.yeasss=1),W[y++]=v);break;case "+":for(;(v=v.nextSibling)&&1!=v.nodeType;);!v||v.nodeName.toLowerCase()!==T.toLowerCase()&&"*"!==T||U&&v.id!==U||V&&-1==(" "+s.className+" ").indexOf(V)||!(!k||E[H]&&(E[H](s,k,w[6])||"class"===k&&E[H](s,"className",w[6])))||v.yeasss||
(r[F]?r[F](v,N):F)||(K&&(v.yeasss=1),W[y++]=v);break;case ">":for(M=v.getElementsByTagName(T),L=0;s=M[L++];)s.parentNode!==v||U&&s.id!==U||V&&-1==(" "+s.className+" ").indexOf(V)||!(!k||E[H]&&(E[H](s,k,w[6])||"class"===k&&E[H](s,"className",w[6])))||s.yeasss||(r[F]?r[F](s,N):F)||(K&&(s.yeasss=1),W[y++]=s)}q=W}else G=w;if(Q){if(!q.concat){W=[];for(v=0;s=q[v];)W[v++]=s;q=W}u=q.concat(1==u.length?u[0]:u)}else u=q}for(y=u.length;y--;)u[y].yeasss=u[y].nodeIndex=u[y].nodeIndexLast=null}return u};x.is=function(a,
b){var c=x(b,a.parentNode),d,e;d=-1;for(e=c.length;++d<e;)if(c[d]===a)return!0;return!1};return x}(),aa=function(){var c=["0","0","0"];return function(){for(var b=c.length,a;b;){b--;a=c[b].charCodeAt(0);if(57==a)return c[b]="A",c.join("");if(90==a)c[b]="0";else return c[b]=String.fromCharCode(a+1),c.join("")}c.unshift("0");return c.join("")}}(),ga=function(){this.events={}};m(ga.prototype,{createEvent:function(c,b){c=c.toLowerCase();var a=this.events;a[c]||(a[c]=new ha(c,b));return a[c]},getEvent:function(c){c=
c.toLowerCase();return this.events[c]},on:function(c,b,a,d){c=c.toLowerCase();var e=this.events;e[c]||(e[c]=new ha(c));return e[c].on(b,a,d)},once:function(c,b,a,d){d=d||{};d.limit=1;return this.on(c,b,a,d)},un:function(c,b,a){c=c.toLowerCase();var d=this.events;d[c]&&d[c].un(b,a)},hasListener:function(c,b,a){c=c.toLowerCase();var d=this.events;return d[c]?d[c].hasListener(b,a):!1},removeAllListeners:function(c){var b=this.events;b[c]&&b[c].removeAllListeners()},trigger:function(){var c=arguments[0],
b=this.events,c=c.toLowerCase();if(!b[c])return null;c=b[c];return c.trigger.apply(c,G.call(arguments,1))},suspendEvent:function(c){c=c.toLowerCase();var b=this.events;b[c]&&b[c].suspend()},suspendAllEvents:function(){var c=this.events,b;for(b in c)c[b].suspend()},resumeEvent:function(c){c=c.toLowerCase();var b=this.events;b[c]&&b[c].resume()},resumeAllEvents:function(){var c=this.events,b;for(b in c)c[b].resume()},destroyEvent:function(c){var b=this.events;b[c]&&(b[c].removeAllListeners(),b[c].destroy(),
delete b[c])},destroy:function(c){var b=this.events;if(c)c=c.toLowerCase(),b[c]&&(b[c].destroy(),delete b[c]);else{for(var a in b)b[a].destroy();this.events={}}},getApi:function(){if(!this.api){for(var c="createEvent getEvent on un once hasListener removeAllListeners trigger suspendEvent suspendAllEvents resumeEvent resumeAllEvents destroyEvent".split(" "),b={},a,d=-1,e=c.length;++d<e;a=c[d],b[a]=n(this[a],this));this.api=b}return this.api}},!0,!1);var ha=function(c,b){this.name=c;this.listeners=
[];this.map={};this.hash=aa();this.uni="$$"+c+"_"+this.hash;this.suspended=!1;this.lid=0;this.returnResult=void 0===b?null:b};m(ha.prototype,{getName:function(){return this.name},destroy:function(){this.map=this.listeners=null},on:function(c,b,a){if(!c)return null;b=b||null;a=a||{};var d=this.uni,e=b||c;if(e[d]&&!a.allowDupes)return null;var f=++this.lid,g=a.first||!1;e[d]=f;c={fn:c,context:b,uniContext:e,id:f,called:0,limit:a.limit||0,start:a.start||1,count:0,append:a.append,prepend:a.prepend};g?
this.listeners.unshift(c):this.listeners.push(c);this.map[f]=c;return f},once:function(c,b,a){a=a||{};a.once=!0;return this.on(c,b,a)},un:function(c,b){var a=-1,d=this.uni,e=this.listeners,f;f=c==parseInt(c)?c:(b||c)[d];if(!f)return!1;for(var g=0,h=e.length;g<h;g++)if(e[g].id==f){a=g;delete e[g].uniContext[d];break}if(-1==a)return!1;e.splice(a,1);delete this.map[f];return!0},hasListener:function(c,b){var a=this.listeners,d;if(c){b=b||c;d=q(c)?b[this.uni]:c;if(!d)return!1;for(var e=0,f=a.length;e<
f;e++)if(a[e].id==d)return!0;return!1}return 0<a.length},removeAllListeners:function(){var c=this.listeners,b=this.uni,a,d;a=0;for(d=c.length;a<d;a++)delete c[a].uniContext[b];this.listeners=[];this.map={}},suspend:function(){this.suspended=!0},resume:function(){this.suspended=!1},_prepareArgs:function(c,b){var a;c.append||c.prepend?(a=G.call(b),c.prepend&&(a=c.prepend.concat(a)),c.append&&(a=a.concat(c.append))):a=b;return a},trigger:function(){var c=this.listeners,b=this.returnResult;if(this.suspended||
0==c.length)return null;for(var a="all"==b?[]:null,d,e,c="first"==b?[c[0]]:G.call(c);d=c.shift();)if(d&&this.map[d.id]&&(d.count++,!(d.count<d.start))){e=d.fn.apply(d.context,this._prepareArgs(d,arguments));d.called++;d.called==d.limit&&this.un(d.id);"all"==b&&a.push(e);if("first"==b)return e;"last"==b&&(a=e);if(!1==b&&!1===e)break}if(b)return a}},!0,!1);var ba=function(){var c=[],b=!1,a="undefined"!=typeof process?process.nextTick:function(a){setTimeout(a,0)},d=function(){b=!0;var e=c.shift();a(function(){e[0].apply(e[1],
e[2]);c.length?d():b=!1},0)},e=function(a,e,f){f=f||[];c.push([a,e,f]);b||d()},f=function(a,b){return function(c){try{b.resolve(a(c))}catch(d){b.reject(d)}}},g=function(a,b){if(a instanceof g)return a;if(!(this instanceof g))return new g(a,b);var c;this._fulfills=[];this._rejects=[];this._dones=[];this._fails=[];if(0<arguments.length)if(c=Q(a))a instanceof g?a.then(n(this.resolve,this),n(this.reject,this)):(new g(c,a)).then(n(this.resolve,this),n(this.reject,this));else if(q(a))try{a.call(b,n(this.resolve,
this),n(this.reject,this))}catch(d){this.reject(d)}else this.resolve(a)};m(g.prototype,{_state:0,_fulfills:null,_rejects:null,_dones:null,_fails:null,_wait:0,_value:null,_reason:null,_triggered:!1,isPending:function(){return 0==this._state},isFulfilled:function(){return 1==this._state},isRejected:function(){return 2==this._state},_cleanup:function(){this._fails=this._dones=this._rejects=this._fulfills=null},_processValue:function(a,b){var c;if(0==this._state)if(a===this)this._doReject(new TypeError("cannot resolve promise with itself"));
else{try{if(c=Q(a)){a instanceof g?a.then(n(this._processResolveValue,this),n(this._processRejectReason,this)):(new g(c,a)).then(n(this._processResolveValue,this),n(this._processRejectReason,this));return}}catch(d){0==this._state&&this._doReject(d);return}b.call(this,a)}},_callResolveHandlers:function(){this._done();for(var a=this._fulfills,b;b=a.shift();)e(b[0],b[1],[this._value]);this._cleanup()},_doResolve:function(a){this._value=a;this._state=1;0==this._wait&&this._callResolveHandlers()},_processResolveValue:function(a){this._processValue(a,
this._doResolve)},resolve:function(a){if(this._triggered)return this;this._triggered=!0;this._processResolveValue(a);return this},_callRejectHandlers:function(){this._fail();for(var a=this._rejects,b;b=a.shift();)e(b[0],b[1],[this._reason]);this._cleanup()},_doReject:function(a){this._state=2;this._reason=a;0==this._wait&&this._callRejectHandlers()},_processRejectReason:function(a){this._processValue(a,this._doReject)},reject:function(a){if(this._triggered)return this;this._triggered=!0;this._processRejectReason(a);
return this},then:function(a,b){var c=new g,d=this._state;0==d||0!=this._wait?(a&&q(a)?this._fulfills.push([f(a,c),null]):this._fulfills.push([c.resolve,c]),b&&q(b)?this._rejects.push([f(b,c),null]):this._rejects.push([c.reject,c])):1==d?a&&q(a)?e(f(a,c),null,[this._value]):c.resolve(this._value):2==d&&(b&&q(b)?e(f(b,c),null,[this._reason]):c.reject(this._reason));return c},"catch":function(a){return this.then(null,a)},_done:function(){for(var a=this._dones,b;b=a.shift();)try{b[0].call(b[1]||null,
this._value)}catch(c){K(c)}},done:function(a,b){var c=this._state;if(1==c&&0==this._wait)try{a.call(b||null,this._value)}catch(d){K(d)}else 0==c&&this._dones.push([a,b]);return this},_fail:function(){for(var a=this._fails,b;b=a.shift();)try{b[0].call(b[1]||null,this._reason)}catch(c){K(c)}},fail:function(a,b){var c=this._state;if(2==c&&0==this._wait)try{a.call(b||null,this._reason)}catch(d){K(d)}else 0==c&&this._fails.push([a,b]);return this},always:function(a,b){this.done(a,b);this.fail(a,b);return this},
promise:function(){return{then:n(this.then,this),done:n(this.done,this),fail:n(this.fail,this),always:n(this.always,this)}},after:function(a){var b=this;if(Q(a)){b._wait++;var c=function(){b._wait--;0==b._wait&&0!=b._state&&(1==b._state?b._callResolveHandlers():b._callRejectHandlers())};q(a.done)?a.done(c):a.then(c)}return b}},!0,!1);g.fcall=function(a,b,c){return g.resolve(a.apply(b,c||[]))};g.resolve=function(a){var b=new g;b.resolve(a);return b};g.reject=function(a){var b=new g;b.reject(a);return b};
g.all=function(a){if(!a.length)return g.resolve(null);var b=new g,c=a.length,d=Array(c),e=c,f,k,m=function(a,c){d[c]=a;e--;0==e&&b.resolve(d)};for(f=0;f<c;f++)(function(c){k=a[f];k instanceof g?k.done(function(a){m(a,c)}).fail(b.reject,b):Q(k)||q(k)?(new g(k)).done(function(a){m(a,c)}).fail(b.reject,b):m(k,c)})(f);return b};g.when=function(){return g.all(arguments)};g.allResolved=function(a){if(!a.length)return g.resolve(null);var b=new g,c=a.length,d=[],e=c,f,k,m=function(a){d.push(a);n()},n=function(){e--;
0==e&&b.resolve(d)};for(f=0;f<c;f++)k=a[f],k instanceof g?k.done(m).fail(n):Q(k)||q(k)?(new g(k)).done(m).fail(n):m(k);return b};g.race=function(a){if(!a.length)return g.resolve(null);var b=new g,c=a.length,d,e;for(d=0;d<c&&(e=a[d],e instanceof g?e.done(b.resolve,b).fail(b.reject,b):Q(e)||q(e)?(new g(e)).done(b.resolve,b).fail(b.reject,b):b.resolve(e),b.isPending());d++);return b};g.waterfall=function(a){if(!a.length)return g.resolve(null);for(var b=a.shift(),b=q(b)?g.fcall(b):g.resolve(c),c;c=a.shift();)Q(c)?
b=b.then(function(a){return function(){return a}}(c)):q(c)?b=b.then(c):b.resolve(c);return b};g.counter=function(a){var b=new g;b.countdown=function(){a--;0==a&&b.resolve()};return b};return g}(),ra=function(){var c=/#.*$/,b=/([?&])_=[^&]*/,a=/\?/,d=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,e=/^(?:GET|HEAD)$/i,f=function(a,b,c){var d,e;if(ka(a)&&c)b.push(encodeURIComponent(c)+"="+encodeURIComponent(""+a));else if(O(a)&&c)for(d=0,e=a.length;d<e;d++)f(a[d],b,c+"["+d+"]");else if(Y(a))for(d in a)a.hasOwnProperty(d)&&
f(a[d],b,c?c+"["+d+"]":d)},g=function(d,g){d.replace(c,"");if(!1===g.cache){var D=(new Date).getTime();return b.test(d)?d.replace(b,"$1_="+D):d+(a.test(d)?"&":"?")+"_="+D}!g.data||window.FormData&&g.data instanceof window.FormData||(k(g.data)?D=g.data:(D=[],f(g.data,D,null),D=D.join("&").replace(/%20/g,"+")),g.data=D,e.test(g.method)&&(d+=(a.test(d)?"&":"?")+g.data,g.data=null));return d},h={xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",
text:"text/plain",_default:"*/*"},p={url:null,data:null,method:"GET",headers:null,username:null,password:null,cache:null,dataType:null,timeout:0,contentType:"application/x-www-form-urlencoded",xhrFields:null,jsonp:!1,jsonpParam:null,jsonpCallback:null,transport:null,replace:!1,selector:null,form:null,beforeSend:null,progress:null,uploadProgress:null,processResponse:null,callbackScope:null},l={},A=new ga,I=function(a){var b;b=eval;a&&(/^[^\S]*use strict/.test(a)?(b=document.createElement("script"),
b.text=a,document.head.appendChild(b).parentNode.removeChild(b)):b(a))},S=function(a,b,c){var d,e;if(!Y(a)&&!q(a)&&c)d=document.createElement("input"),d.setAttribute("type","hidden"),d.setAttribute("name",c),d.setAttribute("value",a),b.appendChild(d);else if(O(a)&&c)for(d=0,e=a.length;d<e;d++)S(a[d],b,c+"["+d+"]");else if(Y(a))for(d in a)a.hasOwnProperty(d)&&S(a[d],b,c?c+"["+d+"]":d)},z=function(a){for(var b,c,d="",e=0;e<a.elements.length;e++)if(b=a.elements[e],null!==b.getAttribute("name"))if(c=
"INPUT"===b.nodeName.toUpperCase()?b.getAttribute("type").toUpperCase():"TEXT","FILE"===c)for(c=0;c<b.files.length;d+="&"+encodeURIComponent(b.name)+"="+encodeURIComponent(b.files[c++].name));else if("RADIO"!==c&&"CHECKBOX"!==c||b.checked)d+="&"+encodeURIComponent(b.name)+"="+encodeURIComponent(b.value);return d},J=function(a,b,c){var d=b?b.dataType:null;b=b?b.selector:null;if(!k(a))return a;c=c||"";if("xml"===d||!d&&0<=c.indexOf("xml"))return a=ja(la(a)),b?ma(b,a):a;if("html"===d)return a=ja(a,"text/html"),
b?ma(b,a):a;if("fragment"==d){c=document.createDocumentFragment();d=document.createElement("div");for(d.innerHTML=a;d.firstChild;)c.appendChild(d.firstChild);return c}if("json"===d||!d&&0<=c.indexOf("json"))return qa(la(a));("script"===d||!d&&0<=c.indexOf("javascript"))&&I(a);return a+""},B=function(a){var b=d.exec((window?window.location.href:"").toLowerCase())||[],c=d.exec(a.url.toLowerCase());this._opt=a;!0!==a.crossDomain&&(a.crossDomain=!(!c||c[1]===b[1]&&c[2]===b[2]&&(c[3]||("http:"===c[1]?
"80":"443"))===(b[3]||("http:"===b[1]?"80":"443"))));b=new ba;"iframe"!=a.transport||a.form?a.form&&(this._form=a.form,"POST"!=a.method||window&&window.FormData||(a.transport="iframe")):(this.createForm(),a.form=this._form);a.form&&"iframe"!=a.transport&&(a.data="POST"==a.method?new FormData(a.form):z(a.form));a.url=g(a.url,a);c=!a.crossDomain&&"script"!=a.transport||a.form?"iframe"==a.transport?new E(a,b,this):new C(a,b,this):new G(a,b,this);this._deferred=b;this._transport=c;b.done(function(a){A.trigger("success",
a)});b.fail(function(a){A.trigger("error",a)});b.always(function(){A.trigger("end")});A.trigger("start");a.timeout&&(this._timeout=setTimeout(n(this.onTimeout,this),a.timeout));a.jsonp&&this.createJsonp();!1===A.trigger("beforeSend",a,c)&&(this._promise=ba.reject());a.beforeSend&&!1===a.beforeSend.call(a.callbackScope,a,c)&&(this._promise=ba.reject());this._promise||(ia(c.send,c),b.abort=n(this.abort,this),b.always(this.destroy,this),this._promise=b)};m(B.prototype,{_jsonpName:null,_transport:null,
_opt:null,_deferred:null,_promise:null,_timeout:null,_form:null,_removeForm:!1,promise:function(){return this._promise},abort:function(a){this._transport.abort();this._deferred.reject(a||"abort")},onTimeout:function(){this.abort("timeout")},createForm:function(){var a=document.createElement("form");a.style.display="none";a.setAttribute("method",this._opt.method);S(this._opt.data,a,null);document.body.appendChild(a);this._form=a;this._removeForm=!0},createJsonp:function(){var b=this._opt,c=b.jsonpParam||
"callback",d=b.jsonpCallback||"jsonp_"+aa();b.url+=(a.test(b.url)?"&":"?")+c+"="+d;this._jsonpName=d;"undefined"!=typeof window&&(window[d]=n(this.jsonpCallback,this));"undefined"!=typeof global&&(global[d]=n(this.jsonpCallback,this));return d},jsonpCallback:function(a){var b;try{b=this.processResponseData(a)}catch(c){this._deferred?this._deferred.reject(c):K(c)}this._deferred&&this._deferred.resolve(b)},processResponseData:function(a,b){var c=this._opt;a=J(a,c,b);A.hasListener("processResponse")&&
(a=A.trigger("processResponse",a,this._deferred));c.processResponse&&(a=c.processResponse.call(c.callbackScope,a,this._deferred));return a},processResponse:function(a,b){var c=this._deferred,d;if(this._opt.jsonp)if(a){try{I(a)}catch(e){c.reject(e)}c.isPending()&&c.reject("jsonp script didn't invoke callback")}else c.reject("jsonp script is empty");else{try{d=this.processResponseData(a,b)}catch(f){c.reject(f)}c.resolve(d)}},destroy:function(){this._timeout&&clearTimeout(this._timeout);this._form&&
this._form.parentNode&&this._removeForm&&this._form.parentNode.removeChild(this._form);this._transport.destroy();this._form=this._timeout=this._promise=this._deferred=this._opt=this._transport=null;this._jsonpName&&("undefined"!=typeof window&&delete window[this._jsonpName],"undefined"!=typeof global&&delete global[this._jsonpName])}},!0,!1);var r=function(a,b){b=b||{};a&&!k(a)?b=a:b.url=a;if(!b.url&&(b.form&&(b.url=b.form.getAttribute("action")),!b.url))throw"Must provide url";m(b,l,!1,!0);m(b,p,
!1,!0);b.method=b.method?b.method.toUpperCase():b.form?b.form.getAttribute("method").toUpperCase()||"GET":"GET";return(new B(b)).promise()};r.setup=function(a){m(l,a,!0,!0)};r.on=function(){A.on.apply(A,arguments)};r.un=function(){A.un.apply(A,arguments)};r.get=function(a,b){b=b||{};b.method="GET";return r(a,b)};r.post=function(a,b){b=b||{};b.method="POST";return r(a,b)};r.load=function(a,b,c){c=c||{};k(b)||(c=b);c.dataType="fragment";return r(b,c).done(function(b){if(c.replace)for(;a.firstChild;)a.removeChild(a.firstChild);
a.appendChild(b)})};r.loadScript=function(a){return r(a,{transport:"script"})};r.submit=function(a,b){b=b||{};b.form=a;return r(null,b)};var C=function(a,b,c){var d;if(!(window.XMLHttpRequest&&(d=new XMLHttpRequest)||(d=new ActiveXObject("Msxml2.XMLHTTP"))||(d=new ActiveXObject("Microsoft.XMLHTTP"))))throw"Unable to create XHR object";this._xhr=d;this._deferred=b;this._opt=a;this._ajax=c;a.progress&&P(d,"progress",n(a.progress,a.callbackScope));a.uploadProgress&&d.upload&&P(d.upload,"progress",n(a.uploadProgress,
a.callbackScope));d.onreadystatechange=n(this.onReadyStateChange,this)};m(C.prototype,{_xhr:null,_deferred:null,_ajax:null,setHeaders:function(){var a=this._opt,b=this._xhr,c;if(a.xhrFields)for(c in a.xhrFields)b[c]=a.xhrFields[c];a.data&&a.contentType&&b.setRequestHeader("Content-Type",a.contentType);b.setRequestHeader("X-Requested-With","XMLHttpRequest");b.setRequestHeader("Accept",a.dataType&&h[a.dataType]?h[a.dataType]+", */*; q=0.01":h._default);for(c in a.headers)b.setRequestHeader(c,a.headers[c])},
onReadyStateChange:function(){var a=this._xhr,b=this._deferred;if(0===a.readyState)a.onreadystatechange=t,b.resolve(a);else if(4===a.readyState){a.onreadystatechange=t;var c;a:{try{c=!a.status&&location&&"file:"==location.protocol||200<=a.status&&300>a.status||304===a.status||1223===a.status;break a}catch(d){}c=!1}c?this._ajax.processResponse(k(a.responseText)?a.responseText:void 0,a.getResponseHeader("content-type")||""):b.reject(a)}},abort:function(){this._xhr.onreadystatechange=t;this._xhr.abort()},
send:function(){var a=this._opt;try{this._xhr.open(a.method,a.url,!0,a.username,a.password),this.setHeaders(),this._xhr.send(a.data)}catch(b){this._deferred.reject(b)}},destroy:function(){this._ajax=this._opt=this._deferred=this._xhr=null}},!0,!1);var G=function(a,b,c){this._opt=a;this._ajax=c;this._deferred=b};m(G.prototype,{_opt:null,_deferred:null,_ajax:null,_el:null,send:function(){var a=document.createElement("script");a.setAttribute("async","async");a.setAttribute("charset","utf-8");a.setAttribute("src",
this._opt.url);P(a,"load",n(this.onLoad,this));P(a,"error",n(this.onError,this));document.head.appendChild(a);this._el=a},onLoad:function(a){this._deferred&&this._deferred.resolve(a)},onError:function(a){this._deferred.reject(a)},abort:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el)},destroy:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el);this._deferred=this._ajax=this._opt=this._el=null}},!0,!1);var E=function(a,b,c){this._opt=a;this._ajax=c;this._deferred=
b};m(E.prototype,{_opt:null,_deferred:null,_ajax:null,_el:null,send:function(){var a=document.createElement("iframe"),b="frame-"+aa(),c=this._opt.form;a.setAttribute("id",b);a.setAttribute("name",b);a.style.display="none";document.body.appendChild(a);c.setAttribute("action",this._opt.url);c.setAttribute("target",b);P(a,"load",n(this.onLoad,this));P(a,"error",n(this.onError,this));this._el=a;try{c.submit()}catch(d){this._deferred.reject(d)}},onLoad:function(){var a=this._el;this._opt&&!this._opt.jsonp&&
(a=a.contentDocument||a.contentWindow.document,a=a.body.innerHTML,this._ajax.processResponse(a))},onError:function(a){this._deferred.reject(a)},abort:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el)},destroy:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el);this._deferred=this._ajax=this._opt=this._el=null}},!0,!1);return r}(),C=J.factory,ca=function(){var c={},b={};return M({$class:"MetaphorJs.model.Model",type:null,fields:null,record:null,store:null,
plain:!1,lastAjaxResponse:null,$init:function(a){this.fields={};m(this,{record:{load:null,save:null,"delete":null,id:null,data:null,success:null,extra:{}},store:{load:null,save:null,"delete":null,id:null,data:null,total:null,start:null,limit:null,success:null,extra:{}}},!1,!0);m(this,a,!0,!0);this.plain=!this.type},isPlain:function(){return this.plain},getRecordProp:function(a,b){return this.getProp("record",a,b)},setRecordProp:function(a,b){this.record[a]=b},getStoreProp:function(a,b){return this.getProp("store",
a,b)},setStoreProp:function(a,b){this.store[a]=b},getProp:function(a,b,c){a=this[a];return a[b]&&a[b][c]||a[c]||this[c]||null},setProp:function(a,b){return this[a]=b},_makeRequest:function(a,b,c,f,g){var h=this,p=h[a],l=m({},k(p[b])||q(p[b])?{url:p[b]}:p[b]),n=h.getProp(a,b,"id"),t=h.getProp(a,b,"data"),C=h.getProp(a,b,"url"),z=h.getProp(a,b,"json");if(!l)if(C)l={url:C};else throw a+"."+b+" not defined";if(k(l)||q(l))l={url:l};if(!l.url){if(!C)throw a+"."+b+" url not defined";l.url=C}l.data=m({},
l.data,h.extra,p.extra,p[b]?p[b].extra:{},g,!0,!0);if(q(l.url)){c=l.url(l.data);var G=new ba;c.then(function(c){"record"==a?h._processRecordResponse(b,c,G):"store"==a&&h._processStoreResponse(b,c,G)});return G}l.method||(l.method="load"==b?"GET":"POST");c&&(l.data[n]=c);f&&(t?l.data[t]=f:l.data=f);z&&l.data&&"GET"!=l.method&&(l.data=JSON.stringify(l.data));l.callbackScope=h;"record"==a?l.processResponse=function(a,c){h.lastAjaxResponse=a;h._processRecordResponse(b,a,c)}:"store"==a&&(l.processResponse=
function(a,c){h.lastAjaxResponse=a;h._processStoreResponse(b,a,c)});return ra(l)},_processRecordResponse:function(a,b,c){var f=this.getRecordProp(a,"id"),g=this.getRecordProp(a,"data"),f=(g=g?b[g]:b)&&g[f]||b[f];this._getSuccess("record",a,b)?c.resolve({id:f,data:g}):c.reject(b)},_processStoreResponse:function(a,b,c){var f=this.getStoreProp(a,"data"),g=this.getStoreProp(a,"total"),f=f?b[f]:b,g=g?b[g]:null;this._getSuccess("store",a,b)?c.resolve({data:f,total:g}):c.reject(b)},_getSuccess:function(a,
b,c){return(a=this.getProp(a,b,"success"))&&void 0!=c[a]?c[a]:!0},loadRecord:function(a){return this._makeRequest("record","load",a)},saveRecord:function(a,b,c){return this._makeRequest("record",a.getId()?"save":"create",a.getId(),m({},a.storeData(a.getData(b)),c))},deleteRecord:function(a){return this._makeRequest("record","delete",a.getId())},loadStore:function(a,b){return this._makeRequest("store","load",null,null,b)},saveStore:function(a,b){return this._makeRequest("store","save",null,b)},deleteRecords:function(a,
b){return this._makeRequest("store","delete",b)},getFields:function(){return this.fields},restoreField:function(a,b,c){var f=this.fields[b];if(f){switch(k(f)?f:f.type){case "int":c=parseInt(c);break;case "bool":case "boolean":k(c)?(c=c.toLowerCase(),c=!("off"===c||"no"===c||"0"===c||"false"==c||"null"==c)):c=c?!0:!1;break;case "double":case "float":c=parseFloat(c);break;case "date":f.parseFn?c=f.parseFn(c,f.format):Date.parse?c=Date.parse(c,f.format):("timestamp"==f.format&&(c=1E3*parseInt(c)),c=
new Date(c))}f.restore&&(c=f.restore.call(a,c,b))}return this.onRestoreField(a,b,c)},onRestoreField:function(a,b,c){return c},storeField:function(a,b,c){var f=this.fields[b];if(f){switch(k(f)?f:f.type){case "bool":case "boolean":c=c?"1":"0";break;case "date":c=f.formatFn?f.formatFn(c,f.format):Date.format?Date.format(c,f.format):"timestamp"==f.format?c.getTime()/1E3:c.format?c.format(f.format):c.toString();break;default:c=c.toString()}f.store&&(c=f.store.call(a,c,b))}return this.onStoreField(a,b,
c)},onStoreField:function(a,b,c){return c}},{create:function(a,b){return"MetaphorJs.model.Model"==a?C(a,b):b?C(a,b):c[a]?c[a]:c[a]=C(a)},addToCache:function(a){var c=a.$getClass(),e=a.getId();"MetaphorJs.model.Record"!=c&&(b[c]||(b[c]={}),b[c][e]=a)},getFromCache:function(a,c){return b[a]&&b[a][c]?b[a][c]:null},removeFromCache:function(a,c){b[a]&&b[a][c]&&delete b[a][c]}})}(),sa=J.isInstanceOf;M({$class:"MetaphorJs.cmp.Base",destroyed:!1,_observable:null,$init:function(c){c=c||{};this.$$observable=
new ga;m(this,this.$$observable.getApi(),!0,!1);if(c.callback){var b=c.callback,a=b.scope||this;delete b.scope;for(var d in b)if(b.hasOwnProperty(d))this.on(d,b[d],a);delete c.callback}m(this,c,!0,!1)},destroy:function(){if(!this.destroyed){if(!1===this.trigger("beforedestroy",this))return!1;this.onDestroy();this.destroyed=!0;this.trigger("destroy",this);this.$$observable.destroy();this.$$observable=null;this.supr()}},onDestroy:t});var X=M({$class:"MetaphorJs.model.Record",$extends:"MetaphorJs.cmp.Base",
id:null,data:null,orig:null,modified:null,loaded:!1,dirty:!1,destroyed:!1,model:null,standalone:!0,stores:null,$init:function(c,b,a){var d=arguments.length;1==d?(a=c,b=c=null):2==d&&(a=b,b=null);this.data={};this.orig={};this.stores=[];this.modified={};a=a||{};this.supr(a);k(this.model)?this.model=C(this.model):sa(this.model,"MetaphorJs.model.Model")||(this.model=C("MetaphorJs.model.Model",this.model));this.id=c;b?this.importData(b):!1!==a.autoLoad&&c&&this.load();"MetaphorJs.model.Record"!=this.$getClass()&&
ca.addToCache(this)},isLoaded:function(){return this.loaded},isStandalone:function(){return this.standalone},isDirty:function(){return this.dirty},getModel:function(){return this.model},attachStore:function(c){c=c.getId();-1==this.stores.indexOf(c)&&this.stores.push(c)},detachStore:function(c){c=c.getId();var b;this.destroyed||-1==(b=this.stores.indexOf(c))||(this.stores.splice(b,1),0!=this.stores.length||this.standalone||this.destroy())},setDirty:function(c){this.dirty!=c&&(this.dirty=!!c,this.trigger("dirtychange",
this,c))},importData:function(c){var b={},a;if(c){for(a in c)b[a]=this.model.restoreField(this,a,c[a]);this.data=b}this.orig=m({},this.data);this.modified={};this.loaded=!0;this.setDirty(!1)},storeData:function(c){var b={},a;for(a in c)b[a]=this.model.storeField(this,a,c[a]);return b},getId:function(){return this.id},getData:function(c){if(c){var b={},a,d;c=k(c)?[c]:c;a=0;for(d=c.length;a<d;a++)b[c[a]]=this.data[c[a]];return b}return m({},this.data)},getChanged:function(){return m({},this.modified)},
isChanged:function(c){return this.modified[c]||!1},get:function(c){return this.data[c]},setId:function(c){!this.id&&c&&(this.id=c)},set:function(c,b){var a=this.data[c];b=this.model.restoreField(this,c,b);this.data[c]=b;a!=b&&(this.modified[c]=!0,this.setDirty(!0),this.trigger("change",this,c,b,a),this.trigger("change-"+c,this,c,b,a))},revert:function(){this.dirty&&(this.data=m({},this.orig),this.modified={},this.setDirty(!1))},load:function(){var c=this;c.trigger("beforeload",c);return c.model.loadRecord(c.id).done(function(b){c.setId(b.id);
c.importData(b.data);c.trigger("load",c)}).fail(function(){c.trigger("failedload",c)})},save:function(c,b){var a=this;a.trigger("beforesave",a);return a.model.saveRecord(a,c,b).done(function(b){a.setId(b.id);a.importData(b.data);a.trigger("save",a)}).fail(function(b){a.trigger("failedsave",a)})},"delete":function(){var c=this;c.trigger("beforedelete",c);return c.model.deleteRecord(c).done(function(){c.trigger("delete",c);c.destroy()}).fail(function(){c.trigger("faileddelete",c)})},reset:function(){this.id=
null;this.data={};this.orig={};this.modified={};this.dirty=this.loaded=!1;this.trigger("reset",this)},destroy:function(){this.destroyed||(this.destroyed=!0,this.trigger("destroy",this),this.stores=this.model=this.modified=this.orig=this.data=null,ca.removeFromCache(this.$getClass(),this.id),this.supr())}}),ta=function(){var c=function(a,b,c){if(q(b))return b(a,c);if(""===b||void 0===b)return!0;if(void 0!==a){if(da(a))return a===b;if(b instanceof RegExp)return b.test(""+a);if("strict"==c)return""+
a===""+b;if(!0===c||null===c||void 0===c)return-1!=""+a.indexOf(b);if(!1===c)return-1==""+a.indexOf(b)}return!1},b=function(a,b,f){if(ka(a))return void 0===b.$?!0:c(a,b.$,f);var g,h;for(g in b)if("$"==g)for(h in a){if(c(a[h],b.$,f))return!0}else if(c(a[g],b[g],f))return!0;return!1},a=function(a,c,f){$(c)||(c={$:c});var g=[],h,k;h=-1;for(k=a.length;++h<k;)b(a[h],c,f)&&g.push(a[h]);return g};a.compare=b;return a}(),J=Array.prototype.indexOf;J||(J=Array.prototype.indexOf=function(c,b){var a;if(null==
this)throw new TypeError('"this" is null or not defined');var d=Object(this),e=d.length>>>0;if(0===e)return-1;a=+b||0;Infinity===Math.abs(a)&&(a=0);if(a>=e)return-1;for(a=Math.max(0<=a?a:e-Math.abs(a),0);a<e;){if(a in d&&d[a]===c)return a;a++}return-1});(function(){var c={};return M({$class:"MetaphorJs.model.Store",$extends:"MetaphorJs.cmp.Base",id:null,autoLoad:!1,clearOnLoad:!0,model:null,extraParams:null,loaded:!1,loading:!1,local:!1,items:null,current:null,map:null,currentMap:null,length:0,currentLength:0,
maxLength:0,totalLength:0,start:0,pageSize:null,pages:null,filtered:!1,sorted:!1,filterBy:null,filterOpt:null,sortBy:null,sortDir:null,publicStore:!1,idProp:null,$init:function(b,a,d){this.items=[];this.current=[];this.map={};this.currentMap={};this.loaded=!1;this.extraParams=this.extraParams||{};b&&!k(b)&&(d=a,a=b,b=null);a=a||{};b&&(a.url=b);this.supr(a);this.id=this.id||aa();this.publicStore&&(c[this.id]=this);this.initModel(a);this.createEvent("beforeload",!1);!this.local&&this.autoLoad?this.load():
d&&(O(d)?this._loadArray(d):this._loadAjaxData(d));this.local&&(this.loaded=!0)},initModel:function(b){k(this.model)?this.model=C(this.model):this.model instanceof ca||(this.model=C("MetaphorJs.model.Model",this.model));b.url&&(this.model.store.load=b.url);this.idProp=this.model.getStoreProp("load","id")},getId:function(){return this.id},isLoaded:function(){return this.loaded},isLocal:function(){return this.local},setLocal:function(b){this.local=!!b},isLoading:function(){return this.loading},isFiltered:function(){return this.filtered},
isSorted:function(){return this.sorted},getLength:function(b){return b?this.length:this.currentLength},getTotalLength:function(){return this.totalLength||this.currentLength},getPagesCount:function(){return null!==this.pageSize?parseInt(this.totalLength/this.pageSize):1},setParam:function(b,a){this.extraParams[b]=a},getParam:function(b){return this.extraParams[b]},setStart:function(b){this.start=b},setPageSize:function(b){this.pageSize=b},getAjaxData:function(){return this.ajaxData},hasDirty:function(b){if(this.model.isPlain())return!1;
var a=!1;this.each(function(b){return b.isDirty()?(a=!0,!1):!0},null,b);return a},getDirty:function(b){var a=[];if(this.model.isPlain())return a;this.each(function(b){b.isDirty()&&a.push(b)},null,b);return a},getModel:function(){return this.model},_loadAjaxData:function(b,a){var c=this;a=a||{};if(a.silent||!1!==c.trigger("beforeload",c))c.ajaxData=b,c.model._processStoreResponse("load",b,{resolve:function(b){c._onModelLoadSuccess(b,a)},reject:function(b){c._onModelLoadFail(b,a)}})},_loadArray:function(b,
a){a=a||{};(a.silent||!1!==this.trigger("beforeload",this))&&O(b)&&(this._load(b,a),this.totalLength=this.length)},_load:function(b,a){var c=a.prepend;a=a||{};for(var e=0;e<b.length;e++)c?this.insert(e,b[e],!0,!0):this.add(b[e],!0,!0);this.loaded=!0;this.loading=!1;this.trigger("loadingend",this);this.onLoad();a.skipUpdate||this.update();a.silent||this.trigger("load",this)},load:function(b,a){var c=this,e=c.model.store,f=e.start,e=e.limit,g=c.pageSize;a=a||{};if(c.local)return null;b=m({},c.extraParams,
b||{});null===g||b[f]||b[e]||(f&&(b[f]=c.start),e&&(b[e]=g));if(!a.silent&&!1===c.trigger("beforeload",c))return null;c.loading=!0;c.trigger("loadingstart",c);return c.model.loadStore(c,b).done(function(b){c.ajaxData=c.model.lastAjaxResponse;c._onModelLoadSuccess(b,a)}).fail(function(b){c.ajaxData=c.model.lastAjaxResponse;c._onModelLoadFail(b,a)})},_onModelLoadSuccess:function(b,a){a=a||{};if(!a.noopOnEmpty||b.data.length)!a.prepend&&!a.append&&this.clearOnLoad&&0<this.length&&this.clear(!0),this.totalLength=
parseInt(b.total),this._load(b.data,a)},_onModelLoadFail:function(b,a){this.onFailedLoad();a.silent||this.trigger("failedload",this,b)},onLoad:t,onFailedLoad:t,save:function(b){var a=this,c={},e=0;if(a.local)return null;if(a.model.isPlain())throw Error("Cannot save plain store");a.each(function(a){a.isDirty()&&(c[a.getId()]=a.storeData(a.getData()),e++)});if(!e)throw Error("Nothing to save");return b||!1!==a.trigger("beforesave",a,c)?a.model.saveStore(a,c).done(function(c){a._onModelSaveSuccess(c,
b)}).fail(function(c){a._onModelSaveFail(c,b)}):null},_onModelSaveSuccess:function(b,a){var c,e,f,g=b.data;if(g&&g.length)for(c=0,e=g.length;c<e;c++)f=this.getRecordId(g[c]),(f=this.getById(f))&&f.importData(g[c]);this.onSave();a||this.trigger("save",this)},_onModelSaveFail:function(b,a){this.onFailedSave(b);a||this.trigger("failedsave",this)},onSave:t,onFailedSave:t,deleteById:function(b,a,c){var e=this,f,g,h;if(e.local)return null;if(!b||O(b)&&!b.length)throw Error("Record id required");O(b)||(b=
[b]);f=0;for(g=b.length;f<g;f++)h=e.getById(b[f]),e.remove(h,a,c),h instanceof X&&h.destroy();return a||!1!==e.trigger("beforedelete",e,b)?e.model.deleteRecords(e,b).done(function(){e.totalLength-=b.length;e.onDelete();a||e.trigger("delete",e,b)}).fail(function(){e.onFailedDelete();a||e.trigger("faileddelete",e,b)}):null},onDelete:t,onFailedDelete:t,deleteAt:function(b,a,c){var e=this.getAt(b);if(!e)throw Error("Record not found at "+b);return this["delete"](e,a,c)},"delete":function(b,a,c){return this.deleteById(this.getRecordId(b),
a,c)},deleteRecords:function(b,a,c){var e=[],f,g;f=0;for(g=b.length;f<g;f++)e.push(this.getRecordId(b[f]));return this.deleteById(e,a,c)},loadOr:function(b,a,c){this.local||this.isLoading()||(this.isLoaded()?b&&b.call(a||this):this.load(null,c))},addPrevPage:function(b){b=b||{};b.append=!1;b.prepend=!0;b.noopOnEmpty=!0;return this.loadPrevPage(b)},addNextPage:function(b){b=b||{};b.append=!0;b.prepend=!1;b.noopOnEmpty=!0;if(!this.local&&(!this.totalLength||this.length<this.totalLength))return this.load({start:this.length,
limit:this.pageSize},b)},loadNextPage:function(b){if(!this.local&&(!this.totalLength||this.length<this.totalLength))return this.start+=this.pageSize,this.load(null,b)},loadPrevPage:function(b){if(!this.local&&0<this.start)return this.start-=this.pageSize,0>this.start&&(this.start=0),this.load(null,b)},loadPage:function(b,a){if(!this.local)return this.start=parseInt(b,10),0>this.start&&(this.start=0),this.load(null,a)},getRecordId:function(b){return b instanceof X?b.getId():b[this.idProp]||null},getRecordData:function(b){return this.model.isPlain()?
b:b.data},processRawDataItem:function(b){if(b instanceof X||this.model.isPlain())return b;var a=this.model.type,c=this.getRecordId(b),e;c&&(e=ca.getFromCache(a,c));e||(e=C(a,c,b,{model:this.model,standalone:!1}));return e},bindRecord:function(b,a){a[b]("change",this.onRecordChange,this);a[b]("destroy",this.onRecordDestroy,this);a[b]("dirtychange",this.onRecordDirtyChange,this);return a},onRecordDirtyChange:function(b){this.trigger("update",this,b)},onRecordChange:function(b,a,c,e){this.trigger("update",
this,b)},onRecordDestroy:function(b){this.remove(b)},shift:function(b,a,c){return this.removeAt(0,b,a,c)},unshift:function(b,a,c){return this.insert(0,b,a,c)},pop:function(b,a,c){return this.removeAt(this.length-1,b,a,c)},addMany:function(b,a,c){var e,f,g=this.length;e=0;for(f=b.length;e<f;e++)this.insert(g+e,b[e],!0,!0);c||this.update();0<f&&!a&&this.trigger("add",b)},add:function(b,a,c){return this.insert(this.length,b,a,c)},onAdd:t,removeAt:function(b,a,c,e){e||(b=this.items.indexOf(this.current[b]));
if(b<this.length&&0<=b)return this.length--,e=this.items[b],this.items.splice(b,1),b=this.getRecordId(e),void 0!=b&&(delete this.map[b],delete this.currentMap[b]),this.onRemove(e,b),c||this.update(),a||this.trigger("remove",e,b),e instanceof X?(this.bindRecord("un",e),e.detachStore(this),e.destroyed?void 0:e):e},onRemove:t,insertMany:function(b,a,c,e){var f,g;f=0;for(g=a.length;f<g;f++)this.insert(b+f,a[f],!0,!0);0<g&&!e&&this.update();0<g&&!c&&this.trigger("add",a)},insert:function(b,a,c,e){var f,
g=!1;a=this.processRawDataItem(a);f=this.getRecordId(a);this.map[f]&&(this.suspendAllEvents(),this.removeId(f),this.resumeAllEvents());b>=this.length?(this.items.push(a),g=!0):this.items.splice(b,0,a);this.length++;this.maxLength&&this.length>this.maxLength&&(g?this.pop(c,!0):this.shift(c,!0));void 0!=f&&(this.map[f]=a);a instanceof X&&(a.attachStore(this),this.bindRecord("on",a));this.onAdd(b,a);e||this.update();c||this.trigger("add",[a]);return a},replace:function(b,a,c,e){var f;f=this.items.indexOf(b);
this.removeAt(f,!0,!0,!0);this.insert(f,a,!0,!0);e||this.update();c||this.trigger("replace",b,a);return a},onReplace:t,remove:function(b,a,c){return this.removeAt(this.indexOf(b,!0),a,c,!0)},removeId:function(b,a,c){return this.removeAt(this.indexOfId(b,!0),a,c,!0)},contains:function(b,a){return-1!=this.indexOf(b,a)},containsId:function(b,a){return a?void 0!==this.map[b]:void 0!==this.currentMap[b]},clear:function(b){var a=this.getRange();this._reset();this.onClear();b||this.trigger("clear",a)},onClear:t,
reset:function(){this._reset();this.start=0},_reset:function(b){var a,c;if(!b)for(b=0,a=this.items.length;b<a;b++)c=this.items[b],c instanceof X&&(this.bindRecord("un",c),c.detachStore(this));this.totalLength=this.currentLength=this.length=0;this.items=[];this.current=[];this.map={};this.currentMap={};this.loaded=this.local},getAt:function(b,a){return a?this.items[b]||void 0:this.current[b]||void 0},getById:function(b,a){return a?this.map[b]||void 0:this.currentMap[b]||void 0},indexOf:function(b,
a){return a?this.items.indexOf(b):this.current.indexOf(b)},indexOfId:function(b,a){return this.indexOf(this.getById(b,a),a)},each:function(b,a,c){c=c?this.items.slice():this.current.slice();for(var e=0,f=c.length;e<f&&!1!==b.call(a,c[e],e,f);e++);},eachId:function(b,a,c){var e=this;e.each(function(c,d,h){return b.call(a,e.getRecordId(c),d,h)},null,c)},collect:function(b,a){var c=[],e=!this.model.isPlain();this.each(function(a){(a=e?a.get(b):a[b])&&c.push(a)},null,a);return c},first:function(b){return b?
this.items[0]:this.current[0]},last:function(b){return b?this.items[this.length-1]:this.current[this.current-1]},getRange:function(b,a,c){c=c?this.items:this.current;var e=[];if(1>c.length)return e;b=b||0;a=Math.min(void 0==a?this.length-1:a,this.length-1);if(b<=a)for(;b<=a;b++)e.push(c[b]);else for(;b>=a;b--)e.push(c[b]);return e},findBy:function(b,a,c,e){b=this.findIndexBy(b,a,c,e);return-1==b?void 0:this.getAt(b,e)},findIndexBy:function(b,a,c,e){e=e?this.items:this.current;c=c||0;for(var f=e.length;c<
f;c++)if(b.call(a,e[c],this.getRecordId(e[c])))return c;return-1},find:function(b,a,c,e){var f=!this.model.isPlain(),g;return this.findIndexBy(function(e){g=f?e.get(b):e[b];return c?g===a:g==a},this,0,e)},findExact:function(b,a,c){return this.find(b,a,!0,c)},findBySet:function(b,a){var c=null,e,f;this.each(function(a){e=!0;for(f in b)if(b[f]!=a[f]){e=!1;break}return e?(c=a,!1):!0},null,a);return c},update:function(){var b=this,a=b.filtered,c=b.sorted;b.currentLength=b.length;b.currentMap=b.map;b.current=
b.items;if(a){var e=b.filterBy,f=b.filterOpt,g,h;b.current=g=[];b.currentMap=h={};b.each(function(a){ta.compare(a.data,e,f)&&(g.push(a),h[b.getRecordId(a)]=a)},null,!0);b.currentLength=b.current.length}if(c){var k=b.sortBy,l=!b.model.isPlain();b.current=na(b.current,function(a){return l?a.get(k):a[k]},b.sortDir)}b.trigger("update",b)},filter:function(b,a){this.filtered=!0;this.filterBy=b;this.filterOpt=a;this.update()},clearFilter:function(){this.filtered&&(this.filterOpt=this.filterBy=null,this.update())},
sort:function(b,a){this.sorted=!0;this.sortBy=b;this.sortDir=a;this.update()},clearSorting:function(){this.sorted=!1;this.sortDir=this.sortBy=null;this.update()},onDestroy:function(){delete c[this.id];this.clear();this.supr()}},{lookupStore:function(b){return c[b]||null},eachStore:function(b,a){for(var d in c)if(!1===b.call(a||window,c[d]))break}})})();M({$class:"MetaphorJs.model.FirebaseStore",$extends:"MetaphorJs.model.Store",firebase:null,$init:function(c){this.firebase=k(c)?new Firebase(c):c;
this.firebase.on("child_added",n(this.onChildAdded,this));this.firebase.on("child_removed",n(this.onChildRemoved,this));this.firebase.on("child_changed",n(this.onChildChanged,this));this.firebase.on("child_moved",n(this.onChildMoved,this));this.supr()},initModel:t,ref:function(){return this.firebase.ref?this.firebase.ref():this.firebase},load:function(){if(!this.loaded)this.firebase.once("value",n(this.onSnapshotLoaded,this))},onSnapshotLoaded:function(c){var b=this;c.forEach(function(a){b.add(a,
!0,!0)});b.update();b.loaded=!0;b.trigger("load",b)},onChildAdded:function(c,b){if(this.loaded){var a=this.indexOfId(b,!0);this.insert(a+1,c)}},onChildRemoved:function(c){this.loaded&&this.removeId(c.name())},onChildChanged:function(c,b){if(this.loaded){var a=this.getById(c.name(),!0);this.replace(a,c)}},onChildMoved:function(c,b){},getRecordId:function(c){return c.name()},getRecordData:function(c){return c.val()},processRawDataItem:function(c){return c},bindRecord:t});"undefined"!=typeof global?
global.MetaphorJs=fa:window.MetaphorJs=fa})();
