'use strict';(function(){function Y(b){return"object"==typeof b&&3===Z(b)&&!b.nodeType&&b.constructor===Object}function da(b){return!0===b||!1===b}function q(b){return"function"==typeof b}function k(b){return"string"==typeof b||b===""+b}function N(b){return"object"==typeof b&&5===Z(b)}function X(b){if(null===b||"object"!=typeof b)return!1;b=Z(b);return 2<b||-1==b}function t(){}function ja(b,a,c,d){setTimeout(function(){b.apply(a,c||[])},d||0)}function ka(b,a){var c,d;if(!b||!k(b))return null;try{d=
new DOMParser,c=d.parseFromString(b,a||"text/xml")}catch(e){c=void 0}if(!c||c.getElementsByTagName("parsererror").length)throw"Invalid XML: "+b;return c}function ea(b){if(b&&void 0!=!b.length&&b!==""+b){for(var a=[],c=-1,d=b.length>>>0;++c!==d;a[c]=b[c]);return a}return b?[b]:[]}function A(b,a){return b.getAttribute?b.getAttribute(a):null}function R(b,a,c){b.attachEvent?b.attachEvent("on"+a,c):b.addEventListener(a,c,!1)}function K(b){if(!b)return!1;var a,c;return"object"!=(c=typeof b)&&"function"!=
c?!1:q(a=b.then)?a:!1}function M(b){var a=b.stack||Error().stack;if("undefined"!=typeof console&&console.log)ja(function(){console.log(b);a&&console.log(a)});else throw b;}function la(b){b=Z(b);return 3>b&&-1<b}function pa(b,a,c){c||(c="asc");b=b.slice();b.sort(function(c,b){var f=typeof c,g=c,h=b;if(f!=typeof b)return 0;"object"==f&&(q(a)?(g=a(c),h=a(b)):(g=c[a],h=b[a]));if("number"==typeof g)return g-h;g=(""+g).toLowerCase();h=(""+h).toLowerCase();return g===h?0:g>h?1:-1});return"desc"==c?b.reverse():
b}var O={},P=Array.prototype.slice,qa=Object.prototype.toString,Z=function(){var b={"[object String]":0,"[object Number]":1,"[object Boolean]":2,"[object Object]":3,"[object Function]":4,"[object Array]":5,"[object RegExp]":9,"[object Date]":10};return function(a){if(!a){if(null===a)return 6;if(void 0===a)return 7}var c=b[qa.call(a)];return void 0===c?-1:1==c&&isNaN(a)?8:c}}(),n=function(){return function a(){var c=!1,d=!1,e=P.call(arguments),f=e.shift(),g,h,l;da(e[e.length-1])&&(c=e.pop());da(e[e.length-
1])&&(d=c,c=e.pop());for(;e.length;)if(g=e.shift())for(h in g)if(g.hasOwnProperty(h)&&void 0!==(l=g[h]))if(d)if(f[h]&&Y(f[h])&&Y(l))a(f[h],l,c,d);else{if(!0===c||void 0==f[h])Y(l)?(f[h]={},a(f[h],l,c,!0)):f[h]=l}else if(!0===c||void 0==f[h])f[h]=l;return f}}(),ra=function(){var b,a=function(c){var a={},e=[];0==arguments.length&&(c=!0);return{addFinder:function(a,c,b){e[b?"unshift":"push"]({fn:a,context:c})},add:function(b,e,h){if(a[b]&&!1===a[b].rewritable)return a[b];a[b]={rewritable:"undefined"!=
typeof h?h:c,value:e};return e},get:function(c){if(a[c])return a[c].value;if(e.length){var b,h,l;b=0;for(h=e.length;b<h;b++)if(l=e[b].fn.call(e[b].context,c,this),void 0!==l)return this.add(c,l,!0)}},remove:function(c){var b=a[c];b&&!0===b.rewritable&&delete a[c];return b?b.value:void 0},exists:function(c){return!!a[c]},eachEntry:function(c,b){for(var e in a)c.call(b,a[e].value,e)},destroy:function(){this===b&&(b=null);this.remove=this.exists=this.destroy=this.get=this.add=c=a=null}}};a.global=function(){b||
(b=new a(!0));return b};return a}(),fa=function(){var b=function(c,b,e){e=e||new ra(!1);var f=b?b.length:null;c||(c="undefined"!=typeof global?global:window);var g=function(c){return c&&b&&c.substr(0,f)!=b?b+"."+c:c},h=function(a,h){a=g(a);if(e.exists(a))return e.get(a);if(!h){var f=a.split("."),D,F=f.length,z,L=c;for(D=0;D<F;D++)if(z=f[D],b&&0==D&&z==b)L=c;else{if(void 0===L[z])return;L=L[z]}L&&e.add(a,L);return L}};this.register=function(a,h){var f;f=g(a);var D=f.split("."),F,z=D.pop();F=D.join(".");
var L=D.length,w,p=c;if(e[F])f=[e[F],z,f];else{if(0<L)for(F=0;F<L;F++)w=D[F],b&&0==F&&w==b?p=c:(void 0===p[w]&&(p[w]={}),p=p[w]);f=[p,z,f]}D=f[0];z=f[1];X(D)&&void 0===D[z]&&(D[z]=h,e.add(f[2],h));return h};this.exists=function(a){return void 0!==h(a,!0)};this.get=h;this.add=function(a,c){a=g(a);e.add(a,c);return c};this.remove=function(a){a=g(a);e.remove(a)};this.normalize=g;this.makeAlias=function(a,c){a=g(a);c=g(c);var b=e.get(a);void 0!==b&&e.add(c,b)};this.destroy=function(){var c;this===a&&
(a=null);e.eachEntry(function(a){a&&a.$destroy&&a.$destroy()});e.destroy();e=null;for(c in this)this[c]=null}};b.prototype.register=null;b.prototype.exists=null;b.prototype.get=null;b.prototype.add=null;b.prototype.remove=null;b.prototype.normalize=null;b.prototype.makeAlias=null;b.prototype.destroy=null;var a;b.global=function(){a||(a=new b);return a};return b}(),sa=function(b,a){var c=function(){},d;c.prototype=b.prototype;c=new c;d=b.apply(c,a);return X(d)||!1===d?d:c},ta=function(b,a,c,d,e,f){e=
e||"before";return function(){var g,h;if("instead"==e)return a.apply(c||d,arguments);"before"==e?(g=a.apply(c||d,arguments),h=!1!==g?b.apply(d||c,arguments):null):(h=b.apply(d||c,arguments),g=a.apply(c||d,arguments));return f?g:h}},$=function(){var b=function(){this.$super&&this.$super!==t&&this.$super.apply(this,arguments)},a=function(a,c,b){var $super=a.prototype[c]||("$constructor"==c?a:t)||t;return function(){var a,c=this.$super;this.$super=$super;a=b.apply(this,arguments);this.$super=c;return a}},
c=function(c,b,d,e){var f,D,F,z=d.prototype;for(f in b)b.hasOwnProperty(f)&&(F=z[f],D=b[f],c[f]=!q(D)||F&&!q(F)?D:a(d,f,D));e||(c.$plugins=null,z.$beforeInit?(c.$beforeInit=z.$beforeInit.slice(),c.$afterInit=z.$afterInit.slice(),c.$beforeDestroy=z.$beforeDestroy.slice(),c.$afterDestroy=z.$afterDestroy.slice()):(c.$beforeInit=[],c.$afterInit=[],c.$beforeDestroy=[],c.$afterDestroy=[]))},d=function(a,c){for(var b in c)c.hasOwnProperty(b)&&("$beforeInit"==b?a.$beforeInit.push(c[b]):"$afterInit"==b?a.$afterInit.push(c[b]):
"$beforeDestroy"==b?a.$beforeDestroy.push(c[b]):"$afterDestroy"==b?a.$afterDestroy.push(c[b]):a[b]||(a[b]=c[b]))},e=function(a){a||(a=new fa);var h=function(){return function(){var c=[],b=[],d=arguments,e,f,h,l,m;if(!this)throw"Must instantiate via new";this.$plugins=[];(e=this.$constructor.apply(this,arguments))&&N(e)&&(d=e);h=this.$plugins;e=-1;for(f=this.$beforeInit.length;++e<f;c.push([this.$beforeInit[e],this]));e=-1;for(f=this.$afterInit.length;++e<f;b.push([this.$afterInit[e],this]));if(h&&
h.length)for(e=0,f=h.length;e<f;e++){l=h[e];if(k(l)&&(m=l,l=a.get("plugin."+l,!0),!l))throw m+" not found";l=new l(this,d);l.$beforeHostInit&&c.push([l.$beforeHostInit,l]);l.$afterHostInit&&b.push([l.$afterHostInit,l]);h[e]=l}e=-1;for(f=c.length;++e<f;c[e][0].apply(c[e][1],d));this.$init&&this.$init.apply(this,d);e=-1;for(f=b.length;++e<f;b[e][0].apply(b[e][1],d));}},l=function(){};n(l.prototype,{$class:null,$extends:null,$plugins:null,$mixins:null,$destroyed:!1,$constructor:t,$init:t,$beforeInit:[],
$afterInit:[],$beforeDestroy:[],$afterDestroy:[],$getClass:function(){return this.$class},$getParentClass:function(){return this.$extends},$intercept:function(a,c,b,d,e){this[a]=ta(this[a],c,b||this,this,d,e)},$implement:function(a){var b=this.constructor;b&&b.$parent&&c(this,a,b.$parent)},$destroy:function(){var a=this.$beforeDestroy,c=this.$afterDestroy,b=this.$plugins,d,e,f;if(!this.$destroyed){this.$destroyed=!0;d=-1;for(e=a.length;++d<e;a[d].apply(this,arguments));d=0;for(e=b.length;d<e;d++)b[d].$beforeHostDestroy&&
b[d].$beforeHostDestroy();f=this.destroy();d=-1;for(e=a.length;++d<e;c[d].apply(this,arguments));d=0;for(e=b.length;d<e;d++)b[d].$destroy();if(!1!==f)for(d in this)this.hasOwnProperty(d)&&(this[d]=null);this.$destroyed=!0}},destroy:function(){}});l.$self=l;l.$instantiate=function(){var a=arguments;switch(a.length){case 0:return new this;case 1:return new this(a[0]);case 2:return new this(a[0],a[1]);case 3:return new this(a[0],a[1],a[2]);case 4:return new this(a[0],a[1],a[2],a[3]);default:return sa(this,
a)}};l.$override=function(a){var b=this.$self,d=this.$parent;b&&d&&c(b.prototype,a,d)};l.$extend=function(a,c){return m(a,c,this)};l.$destroy=function(){for(var a in this)this[a]=null};var m=function(e,f,m){e=e||{};var v=e.$class,w=m||e.$extends,p=e.$mixins,s,n,E;w?k(w)?m=a.get(w):(m=w,w=m.$class||""):(m=l,w="");if(w&&!m)throw w+" not found";v&&(v=a.normalize(v));e.$class=v;e.$extends=w;e.$mixins=null;s=function(){};s.prototype=m.prototype;w=new s;s=null;e.$constructor=e.$constructor||b;c(w,e,m);
if(p)for(e=0,s=p.length;e<s;e++)E=p[e],k(E)&&(E=a.get("mixin."+E,!0)),d(w,E);p=h();w.constructor=p;p.prototype=w;for(n in l)"prototype"!=n&&l.hasOwnProperty(n)&&(p[n]=l[n]);for(n in m)"prototype"!=n&&m.hasOwnProperty(n)&&(p[n]=m[n]);if(f)for(n in f)"prototype"!=n&&f.hasOwnProperty(n)&&(p[n]=f[n]);p.$parent=m;p.$self=p;v&&a.register(v,p);return p},v=this;v.factory=function(c){var b=a.get(c),d=P.call(arguments,1);if(!b)throw c+" not found";return b.$instantiate.apply(b,d)};v.isSubclassOf=function(c,
b){var d=c,e=a.get;b=k(b)?a.normalize(b):b.prototype.$class;for(k(c)&&(d=e(a.normalize(c)));d&&d.prototype;){if(d.prototype.$class==b)return!0;d=d.$parent}return!1};v.isInstanceOf=function(c,b){var d=k(b)?a.get(b):b;return d?c instanceof d:!1};v.define=m;v.destroy=function(){v===f&&(f=null);l.$destroy();l=null;a.destroy();e=a=null};v.BaseClass=l};e.prototype={factory:null,isSubclassOf:null,isInstanceOf:null,define:null,destroy:null};var f;e.global=function(){f||(f=new e(fa.global()));return f};return e}(),
S=new fa(O,"MetaphorJs"),$=new $(S),ga=$.define,s=Function.prototype.bind?function(b,a){return b.bind(a)}:function(b,a){return function(){return b.apply(a,arguments)}},ma=function(){return String.prototype.trim?function(b){return k(b)?b.trim():b}:function(b){return k(b)?b.replace(/^\s\s*/,"").replace(/\s\s*$/,""):b}}(),ua=function(){return"undefined"!=typeof JSON?function(b){return JSON.parse(b)}:function(b){return(new Function("return "+b))()}}(),na=function(){var b=/^[\w[:#.][\w\]*^|=!]*$/,a=/=([^\]]+)/,
c=/ *, */,d=/(\([^)]*)\+/,e=/(\[[^\]]+)~/,f=/(~|>|\+)/,g=/ +/,h=/([^[:.#]+)?(?:#([^[:.#]+))?(?:\.([^[:.]+))?(?:\[([^!&^*|$[:=]+)([!$^*|&]?=)?([^:\]]+)?\])?(?::([^(]+)(?:\(([^)]+)\))?)?/,l=/(?:(-?\d*)n)?(?:(%|-)(\d*))?/,m=/\D/,v=/[^(]*\(([^)]*)\)/,D=/\(.*/,n=/\[([^!~^*|$ [:=]+)([$^*|]?=)?([^ :\]]+)?\]/,z=window.document,s=!!z.getElementsByClassName,w=!!z.querySelectorAll,p={"first-child":function(a){return a.parentNode.getElementsByTagName("*")[0]!==a},"last-child":function(a){for(;(a=a.nextSibling)&&
1!=a.nodeType;);return!!a},root:function(a){return"html"!==a.nodeName.toLowerCase()},"nth-child":function(a,c){var b=a.nodeIndex||0,d=c[3]=c[3]?("%"===c[2]?-1:1)*c[3]:0,e=c[1];if(b)return!((b+d)%e);var B=a.parentNode.firstChild;b++;do if(1==B.nodeType&&(B.nodeIndex=++b)&&a===B&&(b+d)%e)return 0;while(B=B.nextSibling);return 1},"nth-last-child":function(a,c){var b=a.nodeIndexLast||0,d=c[3]?("%"===c[2]?-1:1)*c[3]:0,e=c[1];if(b)return!((b+d)%e);var B=a.parentNode.lastChild;b++;do if(1==B.nodeType&&(B.nodeLastIndex=
b++)&&a===B&&(b+d)%e)return 0;while(B=B.previousSibling);return 1},empty:function(a){return!!a.firstChild},parent:function(a){return!a.firstChild},"only-child":function(a){return 1!=a.parentNode.getElementsByTagName("*").length},checked:function(a){return!a.checked},lang:function(a,c){return a.lang!==c&&z.documentElement.lang!==c},enabled:function(a){return a.disabled||"hidden"===a.type},disabled:function(a){return!a.disabled},selected:function(a){return!a.selected}},k={},q=function(a){return k[a]||
(k[a]=new RegExp("(^| +)"+a+"($| +)"))},E={"":function(a,c){return null!==A(a,c)},"=":function(a,c,b){var d;return(d=A(a,c))&&d===b},"&=":function(a,c,b){var d;return(d=A(a,c))&&q(b).test(d)},"^=":function(a,c,b){var d;return(d=A(a,c)+"")&&!d.indexOf(b)},"$=":function(a,c,b){var d;return(d=A(a,c)+"")&&d.indexOf(b)==d.length-b.length},"*=":function(a,c,b){var d;return(d=A(a,c)+"")&&-1!=d.indexOf(b)},"|=":function(a,c,b){var d;return(d=A(a,c)+"")&&(d===b||!!d.indexOf(b+"-"))},"!=":function(a,c,b){var d;
return!(d=A(a,c))||!q(b).test(d)}},B=function(B,G){G=G||z;var u=[],C=null,k,q,t,r,A,H,I;if(w)try{u=ea(G.querySelectorAll(B.replace(a,'="$1"')))}catch(J){C=!0}if(!w||C)if(b.test(B))switch(C=0,B.charAt(0)){case "#":C=B.slice(1);u=z.getElementById(C);u.id!==C&&(u=z.all[C]);u=u?[u]:[];break;case ".":k=B.slice(1);if(s)u=ea((u=G.getElementsByClassName(k)).length?u:[]);else{k=" "+k+" ";q=G.getElementsByTagName("*");for(t=0;r=q[t++];)-1!=(" "+r.className+" ").indexOf(k)&&(u[C++]=r);u=C?u:[]}break;case ":":q=
G.getElementsByTagName("*");t=0;A=B.replace(v,"$1");for(H=B.replace(D,"");r=q[t++];)p[H]&&!p[H](r,A)&&(u[C++]=r);u=C?u:[];break;case "[":q=G.getElementsByTagName("*");t=0;r=n.exec(B);k=r[1];I=r[2]||"";for(A=r[3];r=q[t++];)E[I]&&(E[I](r,k,A)||"class"===k&&E[I](r,"className",A))&&(u[C++]=r);u=C?u:[];break;default:u=ea((u=G.getElementsByTagName(B)).length?u:[])}else{for(var N=B.split(c),K=N.length-1,S=!!K,Q,R,y,O,T,U,V,W,X,x,M,P;C=N[K--];){R=(Q=C.replace(d,"$1%").replace(e,"$1&").replace(f," $1 ").split(g)).length;
t=0;O=" ";for(q=[G];y=Q[t++];)if(" "!==y&&">"!==y&&"~"!==y&&"+"!==y&&q){y=y.match(h);T=y[1]||"*";U=y[2];V=y[3]?" "+y[3]+" ":"";k=y[4];I=y[5]||"";H=y[7];A="nth-child"===H||"nth-last-child"===H?l.exec("even"===y[8]&&"2n"||"odd"===y[8]&&"2n%1"||!m.test(y[8])&&"0n%"+y[8]||y[8]):y[8];W=[];C=X=0;for(M=t==R;x=q[X++];)switch(O){case " ":P=x.getElementsByTagName(T);for(x=0;r=P[x++];)U&&r.id!==U||V&&-1==(" "+r.className+" ").indexOf(V)||!(!k||E[I]&&(E[I](r,k,y[6])||"class"===k&&E[I](r,"className",y[6])))||
r.yeasss||(p[H]?p[H](r,A):H)||(M&&(r.yeasss=1),W[C++]=r);break;case "~":for(T=T.toLowerCase();(x=x.nextSibling)&&!x.yeasss;)1!=x.nodeType||"*"!==T&&x.nodeName.toLowerCase()!==T||U&&x.id!==U||V&&-1==(" "+x.className+" ").indexOf(V)||!(!k||E[I]&&(E[I](r,k,y[6])||"class"===k&&E[I](r,"className",y[6])))||x.yeasss||(p[H]?p[H](x,A):H)||(M&&(x.yeasss=1),W[C++]=x);break;case "+":for(;(x=x.nextSibling)&&1!=x.nodeType;);!x||x.nodeName.toLowerCase()!==T.toLowerCase()&&"*"!==T||U&&x.id!==U||V&&-1==(" "+r.className+
" ").indexOf(V)||!(!k||E[I]&&(E[I](r,k,y[6])||"class"===k&&E[I](r,"className",y[6])))||x.yeasss||(p[H]?p[H](x,A):H)||(M&&(x.yeasss=1),W[C++]=x);break;case ">":for(P=x.getElementsByTagName(T),t=0;r=P[t++];)r.parentNode!==x||U&&r.id!==U||V&&-1==(" "+r.className+" ").indexOf(V)||!(!k||E[I]&&(E[I](r,k,y[6])||"class"===k&&E[I](r,"className",y[6])))||r.yeasss||(p[H]?p[H](r,A):H)||(M&&(r.yeasss=1),W[C++]=r)}q=W}else O=y;if(S){if(!q.concat){W=[];for(x=0;r=q[x];)W[x++]=r;q=W}u=q.concat(1==u.length?u[0]:u)}else u=
q}for(C=u.length;C--;)u[C].yeasss=u[C].nodeIndex=u[C].nodeIndexLast=null}return u};B.is=function(a,c){var b=B(c,a.parentNode),d,e;d=-1;for(e=b.length;++d<e;)if(b[d]===a)return!0;return!1};return B}(),aa=function(){var b=["0","0","0"];return function(){for(var a=b.length,c;a;){a--;c=b[a].charCodeAt(0);if(57==c)return b[a]="A",b.join("");if(90==c)b[a]="0";else return b[a]=String.fromCharCode(c+1),b.join("")}b.unshift("0");return b.join("")}}(),ha=function(){this.events={}};n(ha.prototype,{createEvent:function(b,
a){b=b.toLowerCase();var c=this.events;c[b]||(c[b]=new ia(b,a));return c[b]},getEvent:function(b){b=b.toLowerCase();return this.events[b]},on:function(b,a,c,d){b=b.toLowerCase();var e=this.events;e[b]||(e[b]=new ia(b));return e[b].on(a,c,d)},once:function(b,a,c,d){d=d||{};d.limit=1;return this.on(b,a,c,d)},un:function(b,a,c){b=b.toLowerCase();var d=this.events;d[b]&&d[b].un(a,c)},hasListener:function(b,a,c){b=b.toLowerCase();var d=this.events;return d[b]?d[b].hasListener(a,c):!1},removeAllListeners:function(b){var a=
this.events;a[b]&&a[b].removeAllListeners()},trigger:function(){var b=arguments[0],a=this.events,b=b.toLowerCase();if(!a[b])return null;b=a[b];return b.trigger.apply(b,P.call(arguments,1))},suspendEvent:function(b){b=b.toLowerCase();var a=this.events;a[b]&&a[b].suspend()},suspendAllEvents:function(){var b=this.events,a;for(a in b)b[a].suspend()},resumeEvent:function(b){b=b.toLowerCase();var a=this.events;a[b]&&a[b].resume()},resumeAllEvents:function(){var b=this.events,a;for(a in b)b[a].resume()},
destroyEvent:function(b){var a=this.events;a[b]&&(a[b].removeAllListeners(),a[b].destroy(),delete a[b])},destroy:function(b){var a=this.events;if(b)b=b.toLowerCase(),a[b]&&(a[b].destroy(),delete a[b]);else{for(var c in a)a[c].destroy();this.events={}}},getApi:function(){if(!this.api){for(var b="createEvent getEvent on un once hasListener removeAllListeners trigger suspendEvent suspendAllEvents resumeEvent resumeAllEvents destroyEvent".split(" "),a={},c,d=-1,e=b.length;++d<e;c=b[d],a[c]=s(this[c],
this));this.api=a}return this.api}},!0,!1);var ia=function(b,a){this.name=b;this.listeners=[];this.map={};this.hash=aa();this.uni="$$"+b+"_"+this.hash;this.suspended=!1;this.lid=0;this.returnResult=void 0===a?null:a};n(ia.prototype,{getName:function(){return this.name},destroy:function(){this.map=this.listeners=null},on:function(b,a,c){if(!b)return null;a=a||null;c=c||{};var d=this.uni,e=a||b;if(e[d]&&!c.allowDupes)return null;var f=++this.lid,g=c.first||!1;e[d]=f;b={fn:b,context:a,uniContext:e,id:f,
called:0,limit:c.limit||0,start:c.start||1,count:0,append:c.append,prepend:c.prepend};g?this.listeners.unshift(b):this.listeners.push(b);this.map[f]=b;return f},once:function(b,a,c){c=c||{};c.once=!0;return this.on(b,a,c)},un:function(b,a){var c=-1,d=this.uni,e=this.listeners,f;f=b==parseInt(b)?b:(a||b)[d];if(!f)return!1;for(var g=0,h=e.length;g<h;g++)if(e[g].id==f){c=g;delete e[g].uniContext[d];break}if(-1==c)return!1;e.splice(c,1);delete this.map[f];return!0},hasListener:function(b,a){var c=this.listeners,
d;if(b){a=a||b;d=q(b)?a[this.uni]:b;if(!d)return!1;for(var e=0,f=c.length;e<f;e++)if(c[e].id==d)return!0;return!1}return 0<c.length},removeAllListeners:function(){var b=this.listeners,a=this.uni,c,d;c=0;for(d=b.length;c<d;c++)delete b[c].uniContext[a];this.listeners=[];this.map={}},suspend:function(){this.suspended=!0},resume:function(){this.suspended=!1},_prepareArgs:function(b,a){var c;b.append||b.prepend?(c=P.call(a),b.prepend&&(c=b.prepend.concat(c)),b.append&&(c=c.concat(b.append))):c=a;return c},
trigger:function(){var b=this.listeners,a=this.returnResult;if(this.suspended||0==b.length)return null;for(var c="all"==a||"merge"==a?[]:null,d,e,b="first"==a?[b[0]]:P.call(b);d=b.shift();)if(d&&this.map[d.id]&&(d.count++,!(d.count<d.start)))if(e=d.fn.apply(d.context,this._prepareArgs(d,arguments)),d.called++,d.called==d.limit&&this.un(d.id),"all"==a)c.push(e);else if("merge"==a&&e)c=c.concat(e);else{if("first"==a)return e;if("last"==a)c=e;else if(!1==a&&!1===e)return!1}if(a)return c}},!0,!1);var ba=
function(){var b=[],a=!1,c="undefined"!=typeof process?process.nextTick:function(a){setTimeout(a,0)},d=function(){a=!0;var e=b.shift();c(function(){e[0].apply(e[1],e[2]);b.length?d():a=!1},0)},e=function(c,e,f){f=f||[];b.push([c,e,f]);a||d()},f=function(a,c){return function(b){try{c.resolve(a(b))}catch(d){c.reject(d)}}},g=function(a,c){if(a instanceof g)return a;if(!(this instanceof g))return new g(a,c);var b;this._fulfills=[];this._rejects=[];this._dones=[];this._fails=[];if(0<arguments.length)if(b=
K(a))a instanceof g?a.then(s(this.resolve,this),s(this.reject,this)):(new g(b,a)).then(s(this.resolve,this),s(this.reject,this));else if(q(a))try{a.call(c,s(this.resolve,this),s(this.reject,this))}catch(d){this.reject(d)}else this.resolve(a)};n(g.prototype,{_state:0,_fulfills:null,_rejects:null,_dones:null,_fails:null,_wait:0,_value:null,_reason:null,_triggered:!1,isPending:function(){return 0==this._state},isFulfilled:function(){return 1==this._state},isRejected:function(){return 2==this._state},
_cleanup:function(){this._fails=this._dones=this._rejects=this._fulfills=null},_processValue:function(a,c){var b;if(0==this._state)if(a===this)this._doReject(new TypeError("cannot resolve promise with itself"));else{try{if(b=K(a)){a instanceof g?a.then(s(this._processResolveValue,this),s(this._processRejectReason,this)):(new g(b,a)).then(s(this._processResolveValue,this),s(this._processRejectReason,this));return}}catch(d){0==this._state&&this._doReject(d);return}c.call(this,a)}},_callResolveHandlers:function(){this._done();
for(var a=this._fulfills,c;c=a.shift();)e(c[0],c[1],[this._value]);this._cleanup()},_doResolve:function(a){this._value=a;this._state=1;0==this._wait&&this._callResolveHandlers()},_processResolveValue:function(a){this._processValue(a,this._doResolve)},resolve:function(a){if(this._triggered)return this;this._triggered=!0;this._processResolveValue(a);return this},_callRejectHandlers:function(){this._fail();for(var a=this._rejects,c;c=a.shift();)e(c[0],c[1],[this._reason]);this._cleanup()},_doReject:function(a){this._state=
2;this._reason=a;0==this._wait&&this._callRejectHandlers()},_processRejectReason:function(a){this._processValue(a,this._doReject)},reject:function(a){if(this._triggered)return this;this._triggered=!0;this._processRejectReason(a);return this},then:function(a,c){var b=new g,d=this._state;0==d||0!=this._wait?(a&&q(a)?this._fulfills.push([f(a,b),null]):this._fulfills.push([b.resolve,b]),c&&q(c)?this._rejects.push([f(c,b),null]):this._rejects.push([b.reject,b])):1==d?a&&q(a)?e(f(a,b),null,[this._value]):
b.resolve(this._value):2==d&&(c&&q(c)?e(f(c,b),null,[this._reason]):b.reject(this._reason));return b},"catch":function(a){return this.then(null,a)},_done:function(){for(var a=this._dones,c;c=a.shift();)try{c[0].call(c[1]||null,this._value)}catch(b){M(b)}},done:function(a,c){var b=this._state;if(1==b&&0==this._wait)try{a.call(c||null,this._value)}catch(d){M(d)}else 0==b&&this._dones.push([a,c]);return this},_fail:function(){for(var a=this._fails,c;c=a.shift();)try{c[0].call(c[1]||null,this._reason)}catch(b){M(b)}},
fail:function(a,c){var b=this._state;if(2==b&&0==this._wait)try{a.call(c||null,this._reason)}catch(d){M(d)}else 0==b&&this._fails.push([a,c]);return this},always:function(a,c){this.done(a,c);this.fail(a,c);return this},promise:function(){return{then:s(this.then,this),done:s(this.done,this),fail:s(this.fail,this),always:s(this.always,this)}},after:function(a){var c=this;if(K(a)){c._wait++;var b=function(){c._wait--;0==c._wait&&0!=c._state&&(1==c._state?c._callResolveHandlers():c._callRejectHandlers())};
q(a.done)?a.done(b):a.then(b)}return c}},!0,!1);g.fcall=function(a,c,b){return g.resolve(a.apply(c,b||[]))};g.resolve=function(a){var c=new g;c.resolve(a);return c};g.reject=function(a){var c=new g;c.reject(a);return c};g.all=function(a){if(!a.length)return g.resolve(null);var c=new g,b=a.length,d=Array(b),e=b,f,k,n=function(a,b){d[b]=a;e--;0==e&&c.resolve(d)};for(f=0;f<b;f++)(function(b){k=a[f];k instanceof g?k.done(function(a){n(a,b)}).fail(c.reject,c):K(k)||q(k)?(new g(k)).done(function(a){n(a,
b)}).fail(c.reject,c):n(k,b)})(f);return c};g.when=function(){return g.all(arguments)};g.allResolved=function(a){if(!a.length)return g.resolve(null);var c=new g,b=a.length,d=[],e=b,f,k,n=function(a){d.push(a);w()},w=function(){e--;0==e&&c.resolve(d)};for(f=0;f<b;f++)k=a[f],k instanceof g?k.done(n).fail(w):K(k)||q(k)?(new g(k)).done(n).fail(w):n(k);return c};g.race=function(a){if(!a.length)return g.resolve(null);var c=new g,b=a.length,d,e;for(d=0;d<b&&(e=a[d],e instanceof g?e.done(c.resolve,c).fail(c.reject,
c):K(e)||q(e)?(new g(e)).done(c.resolve,c).fail(c.reject,c):c.resolve(e),c.isPending());d++);return c};g.waterfall=function(a){if(!a.length)return g.resolve(null);for(var c=a.shift(),c=q(c)?g.fcall(c):g.resolve(b),b;b=a.shift();)K(b)?c=c.then(function(a){return function(){return a}}(b)):q(b)?c=c.then(b):c.resolve(b);return c};g.counter=function(a){var c=new g;c.countdown=function(){a--;0==a&&c.resolve()};return c};return g}(),va=function(){var b=/#.*$/,a=/([?&])_=[^&]*/,c=/\?/,d=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,
e=/^(?:GET|HEAD)$/i,f=function(a,c,b){var d,e;if(la(a)&&b)c.push(encodeURIComponent(b)+"="+encodeURIComponent(""+a));else if(N(a)&&b)for(d=0,e=a.length;d<e;d++)f(a[d],c,b+"["+d+"]");else if(X(a))for(d in a)a.hasOwnProperty(d)&&f(a[d],c,b?b+"["+d+"]":d)},g=function(d,g){d.replace(b,"");if(!1===g.cache){var G=(new Date).getTime();return a.test(d)?d.replace(a,"$1_="+G):d+(c.test(d)?"&":"?")+"_="+G}!g.data||window.FormData&&g.data instanceof window.FormData||(k(g.data)?G=g.data:(G=[],f(g.data,G,null),
G=G.join("&").replace(/%20/g,"+")),g.data=G,e.test(g.method)&&(d+=(c.test(d)?"&":"?")+g.data,g.data=null));return d},h={xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"},l={url:null,data:null,method:"GET",headers:null,username:null,password:null,cache:null,dataType:null,timeout:0,contentType:"application/x-www-form-urlencoded",xhrFields:null,jsonp:!1,jsonpParam:null,jsonpCallback:null,
transport:null,replace:!1,selector:null,form:null,beforeSend:null,progress:null,uploadProgress:null,processResponse:null,callbackScope:null},m={},v=new ha,D=function(a){var c;c=eval;a&&(/^[^\S]*use strict/.test(a)?(c=document.createElement("script"),c.text=a,document.head.appendChild(c).parentNode.removeChild(c)):c(a))},F=function(a,c,b){var d,e;if(!X(a)&&!q(a)&&b)d=document.createElement("input"),d.setAttribute("type","hidden"),d.setAttribute("name",b),d.setAttribute("value",a),c.appendChild(d);
else if(N(a)&&b)for(d=0,e=a.length;d<e;d++)F(a[d],c,b+"["+d+"]");else if(X(a))for(d in a)a.hasOwnProperty(d)&&F(a[d],c,b?b+"["+d+"]":d)},z=function(a){for(var c,b,d="",e=0;e<a.elements.length;e++)if(c=a.elements[e],null!==A(c,"name"))if(b="INPUT"===c.nodeName.toUpperCase()?A(c,"type").toUpperCase():"TEXT","FILE"===b)for(b=0;b<c.files.length;d+="&"+encodeURIComponent(c.name)+"="+encodeURIComponent(c.files[b++].name));else if("RADIO"!==b&&"CHECKBOX"!==b||c.checked)d+="&"+encodeURIComponent(c.name)+
"="+encodeURIComponent(c.value);return d},L=function(a,c,b){var d=c?c.dataType:null;c=c?c.selector:null;if(!k(a))return a;b=b||"";if("xml"===d||!d&&0<=b.indexOf("xml"))return a=ka(ma(a)),c?na(c,a):a;if("html"===d)return a=ka(a,"text/html"),c?na(c,a):a;if("fragment"==d){b=document.createDocumentFragment();d=document.createElement("div");for(d.innerHTML=a;d.firstChild;)b.appendChild(d.firstChild);return b}if("json"===d||!d&&0<=b.indexOf("json"))return ua(ma(a));("script"===d||!d&&0<=b.indexOf("javascript"))&&
D(a);return a+""},w=function(a){var c=d.exec((window?window.location.href:"").toLowerCase())||[],b=d.exec(a.url.toLowerCase());this._opt=a;!0!==a.crossDomain&&(a.crossDomain=!(!b||b[1]===c[1]&&b[2]===c[2]&&(b[3]||("http:"===b[1]?"80":"443"))===(c[3]||("http:"===c[1]?"80":"443"))));c=new ba;"iframe"!=a.transport||a.form?a.form&&(this._form=a.form,"POST"!=a.method||window&&window.FormData||(a.transport="iframe")):(this.createForm(),a.form=this._form);a.form&&"iframe"!=a.transport&&(a.data="POST"==a.method?
new FormData(a.form):z(a.form));a.url=g(a.url,a);b=!a.crossDomain&&"script"!=a.transport||a.form?"iframe"==a.transport?new E(a,c,this):new J(a,c,this):new K(a,c,this);this._deferred=c;this._transport=b;c.done(function(a){v.trigger("success",a)});c.fail(function(a){v.trigger("error",a)});c.always(function(){v.trigger("end")});v.trigger("start");a.timeout&&(this._timeout=setTimeout(s(this.onTimeout,this),a.timeout));a.jsonp&&this.createJsonp();!1===v.trigger("beforeSend",a,b)&&(this._promise=ba.reject());
a.beforeSend&&!1===a.beforeSend.call(a.callbackScope,a,b)&&(this._promise=ba.reject());this._promise||(ja(b.send,b),c.abort=s(this.abort,this),c.always(this.destroy,this),this._promise=c)};n(w.prototype,{_jsonpName:null,_transport:null,_opt:null,_deferred:null,_promise:null,_timeout:null,_form:null,_removeForm:!1,promise:function(){return this._promise},abort:function(a){this._transport.abort();this._deferred.reject(a||"abort")},onTimeout:function(){this.abort("timeout")},createForm:function(){var a=
document.createElement("form");a.style.display="none";a.setAttribute("method",this._opt.method);F(this._opt.data,a,null);document.body.appendChild(a);this._form=a;this._removeForm=!0},createJsonp:function(){var a=this._opt,b=a.jsonpParam||"callback",d=a.jsonpCallback||"jsonp_"+aa();a.url+=(c.test(a.url)?"&":"?")+b+"="+d;this._jsonpName=d;"undefined"!=typeof window&&(window[d]=s(this.jsonpCallback,this));"undefined"!=typeof global&&(global[d]=s(this.jsonpCallback,this));return d},jsonpCallback:function(a){var c;
try{c=this.processResponseData(a)}catch(b){this._deferred?this._deferred.reject(b):M(b)}this._deferred&&this._deferred.resolve(c)},processResponseData:function(a,c){var b=this._opt;a=L(a,b,c);v.hasListener("processResponse")&&(a=v.trigger("processResponse",a,this._deferred));b.processResponse&&(a=b.processResponse.call(b.callbackScope,a,this._deferred));return a},processResponse:function(a,c){var b=this._deferred,d;if(this._opt.jsonp)if(a){try{D(a)}catch(e){b.reject(e)}b.isPending()&&b.reject("jsonp script didn't invoke callback")}else b.reject("jsonp script is empty");
else{try{d=this.processResponseData(a,c)}catch(f){b.reject(f)}b.resolve(d)}},destroy:function(){this._timeout&&clearTimeout(this._timeout);this._form&&this._form.parentNode&&this._removeForm&&this._form.parentNode.removeChild(this._form);this._transport.destroy();this._form=this._timeout=this._promise=this._deferred=this._opt=this._transport=null;this._jsonpName&&("undefined"!=typeof window&&delete window[this._jsonpName],"undefined"!=typeof global&&delete global[this._jsonpName])}},!0,!1);var p=
function(a,c){c=c||{};a&&!k(a)?c=a:c.url=a;if(!c.url&&(c.form&&(c.url=A(c.form,"action")),!c.url))throw"Must provide url";n(c,m,!1,!0);n(c,l,!1,!0);c.method=c.method?c.method.toUpperCase():c.form?A(c.form,"method").toUpperCase()||"GET":"GET";return(new w(c)).promise()};p.setup=function(a){n(m,a,!0,!0)};p.on=function(){v.on.apply(v,arguments)};p.un=function(){v.un.apply(v,arguments)};p.get=function(a,c){c=c||{};c.method="GET";return p(a,c)};p.post=function(a,c){c=c||{};c.method="POST";return p(a,c)};
p.load=function(a,c,b){b=b||{};k(c)||(b=c);b.dataType="fragment";return p(c,b).done(function(c){if(b.replace)for(;a.firstChild;)a.removeChild(a.firstChild);a.appendChild(c)})};p.loadScript=function(a){return p(a,{transport:"script"})};p.submit=function(a,c){c=c||{};c.form=a;return p(null,c)};var J=function(a,c,b){var d;if(!(window.XMLHttpRequest&&(d=new XMLHttpRequest)||(d=new ActiveXObject("Msxml2.XMLHTTP"))||(d=new ActiveXObject("Microsoft.XMLHTTP"))))throw"Unable to create XHR object";this._xhr=
d;this._deferred=c;this._opt=a;this._ajax=b;a.progress&&R(d,"progress",s(a.progress,a.callbackScope));a.uploadProgress&&d.upload&&R(d.upload,"progress",s(a.uploadProgress,a.callbackScope));d.onreadystatechange=s(this.onReadyStateChange,this)};n(J.prototype,{_xhr:null,_deferred:null,_ajax:null,setHeaders:function(){var a=this._opt,c=this._xhr,b;if(a.xhrFields)for(b in a.xhrFields)c[b]=a.xhrFields[b];a.data&&a.contentType&&c.setRequestHeader("Content-Type",a.contentType);c.setRequestHeader("X-Requested-With",
"XMLHttpRequest");c.setRequestHeader("Accept",a.dataType&&h[a.dataType]?h[a.dataType]+", */*; q=0.01":h._default);for(b in a.headers)c.setRequestHeader(b,a.headers[b])},onReadyStateChange:function(){var a=this._xhr,c=this._deferred;if(0===a.readyState)a.onreadystatechange=t,c.resolve(a);else if(4===a.readyState){a.onreadystatechange=t;var b;a:{try{b=!a.status&&location&&"file:"==location.protocol||200<=a.status&&300>a.status||304===a.status||1223===a.status;break a}catch(d){}b=!1}b?this._ajax.processResponse(k(a.responseText)?
a.responseText:void 0,a.getResponseHeader("content-type")||""):c.reject(a)}},abort:function(){this._xhr.onreadystatechange=t;this._xhr.abort()},send:function(){var a=this._opt;try{this._xhr.open(a.method,a.url,!0,a.username,a.password),this.setHeaders(),this._xhr.send(a.data)}catch(c){this._deferred.reject(c)}},destroy:function(){this._ajax=this._opt=this._deferred=this._xhr=null}},!0,!1);var K=function(a,c,b){this._opt=a;this._ajax=b;this._deferred=c};n(K.prototype,{_opt:null,_deferred:null,_ajax:null,
_el:null,send:function(){var a=document.createElement("script");a.setAttribute("async","async");a.setAttribute("charset","utf-8");a.setAttribute("src",this._opt.url);R(a,"load",s(this.onLoad,this));R(a,"error",s(this.onError,this));document.head.appendChild(a);this._el=a},onLoad:function(a){this._deferred&&this._deferred.resolve(a)},onError:function(a){this._deferred.reject(a)},abort:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el)},destroy:function(){this._el.parentNode&&
this._el.parentNode.removeChild(this._el);this._deferred=this._ajax=this._opt=this._el=null}},!0,!1);var E=function(a,c,b){this._opt=a;this._ajax=b;this._deferred=c};n(E.prototype,{_opt:null,_deferred:null,_ajax:null,_el:null,send:function(){var a=document.createElement("iframe"),c="frame-"+aa(),b=this._opt.form;a.setAttribute("id",c);a.setAttribute("name",c);a.style.display="none";document.body.appendChild(a);b.setAttribute("action",this._opt.url);b.setAttribute("target",c);R(a,"load",s(this.onLoad,
this));R(a,"error",s(this.onError,this));this._el=a;try{b.submit()}catch(d){this._deferred.reject(d)}},onLoad:function(){var a=this._el;this._opt&&!this._opt.jsonp&&(a=a.contentDocument||a.contentWindow.document,a=a.body.innerHTML,this._ajax.processResponse(a))},onError:function(a){this._deferred.reject(a)},abort:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el)},destroy:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el);this._deferred=this._ajax=this._opt=
this._el=null}},!0,!1);return p}(),ca=$.factory,J=function(){var b={},a={};return ga({$class:"MetaphorJs.Model",type:null,fields:null,record:null,store:null,plain:!1,lastAjaxResponse:null,$init:function(a){this.fields={};n(this,{record:{load:null,save:null,"delete":null,id:null,data:null,success:null,extra:{}},store:{load:null,save:null,"delete":null,id:null,data:null,total:null,start:null,limit:null,success:null,extra:{}}},!1,!0);n(this,a,!0,!0);this.plain=!this.type},isPlain:function(){return this.plain},
getRecordProp:function(a,b){return this.getProp("record",a,b)},setRecordProp:function(a,b){this.record[a]=b},getStoreProp:function(a,b){return this.getProp("store",a,b)},setStoreProp:function(a,b){this.store[a]=b},getProp:function(a,b,e){a=this[a];return a[b]&&a[b][e]||a[e]||this[e]||null},setProp:function(a,b){return this[a]=b},_makeRequest:function(a,b,e,f,g){var h=this,l=h[a],m=n({},k(l[b])||q(l[b])?{url:l[b]}:l[b]),v=h.getProp(a,b,"id"),s=h.getProp(a,b,"data"),t=h.getProp(a,b,"url"),z=h.getProp(a,
b,"json");if(!m)if(t)m={url:t};else throw a+"."+b+" not defined";if(k(m)||q(m))m={url:m};if(!m.url){if(!t)throw a+"."+b+" url not defined";m.url=t}m.data=n({},m.data,h.extra,l.extra,l[b]?l[b].extra:{},g,!0,!0);if(q(m.url)){e=m.url(m.data);var A=new ba;e.then(function(e){"record"==a?h._processRecordResponse(b,e,A):"store"==a&&h._processStoreResponse(b,e,A)});return A}m.method||(m.method="load"==b?"GET":"POST");e&&(m.data[v]=e);f&&(s?m.data[s]=f:m.data=f);z&&m.data&&"GET"!=m.method&&(m.data=JSON.stringify(m.data));
m.callbackScope=h;"record"==a?m.processResponse=function(a,c){h.lastAjaxResponse=a;h._processRecordResponse(b,a,c)}:"store"==a&&(m.processResponse=function(a,c){h.lastAjaxResponse=a;h._processStoreResponse(b,a,c)});return va(m)},_processRecordResponse:function(a,b,e){var f=this.getRecordProp(a,"id"),g=this.getRecordProp(a,"data"),f=(g=g?b[g]:b)&&g[f]||b[f];this._getSuccess("record",a,b)?e.resolve({id:f,data:g}):e.reject(b)},_processStoreResponse:function(a,b,e){var f=this.getStoreProp(a,"data"),g=
this.getStoreProp(a,"total"),f=f?b[f]:b,g=g?b[g]:null;this._getSuccess("store",a,b)?e.resolve({data:f,total:g}):e.reject(b)},_getSuccess:function(a,b,e){return(a=this.getProp(a,b,"success"))&&void 0!=e[a]?e[a]:!0},loadRecord:function(a){return this._makeRequest("record","load",a)},saveRecord:function(a,b,e){return this._makeRequest("record",a.getId()?"save":"create",a.getId(),n({},a.storeData(a.getData(b)),e))},deleteRecord:function(a){return this._makeRequest("record","delete",a.getId())},loadStore:function(a,
b){return this._makeRequest("store","load",null,null,b)},saveStore:function(a,b){return this._makeRequest("store","save",null,b)},deleteRecords:function(a,b){return this._makeRequest("store","delete",b)},getFields:function(){return this.fields},restoreField:function(a,b,e){var f=this.fields[b];if(f){switch(k(f)?f:f.type){case "int":e=parseInt(e);break;case "bool":case "boolean":k(e)?(e=e.toLowerCase(),e=!("off"===e||"no"===e||"0"===e||"false"==e||"null"==e)):e=e?!0:!1;break;case "double":case "float":e=
parseFloat(e);break;case "date":f.parseFn?e=f.parseFn(e,f.format):Date.parse?e=Date.parse(e,f.format):("timestamp"==f.format&&(e=1E3*parseInt(e)),e=new Date(e))}f.restore&&(e=f.restore.call(a,e,b))}return this.onRestoreField(a,b,e)},onRestoreField:function(a,b,e){return e},storeField:function(a,b,e){var f=this.fields[b];if(f){switch(k(f)?f:f.type){case "bool":case "boolean":e=e?"1":"0";break;case "date":e=f.formatFn?f.formatFn(e,f.format):Date.format?Date.format(e,f.format):"timestamp"==f.format?
e.getTime()/1E3:e.format?e.format(f.format):e.toString();break;default:e=e.toString()}f.store&&(e=f.store.call(a,e,b))}return this.onStoreField(a,b,e)},onStoreField:function(a,b,e){return e}},{create:function(a,d){return"MetaphorJs.Model"==a?ca(a,d):d?ca(a,d):b[a]?b[a]:b[a]=ca(a)},addToCache:function(c){var b=c.$getClass(),e=c.getId();"MetaphorJs.Record"!=b&&(a[b]||(a[b]={}),a[b][e]=c)},getFromCache:function(c,b){return a[c]&&a[c][b]?a[c][b]:null},removeFromCache:function(c,b){a[c]&&a[c][b]&&delete a[c][b]}})}(),
oa=S.add("mixin.Observable",{$$observable:null,$beforeInit:function(b){this.$$observable=new ha;if(b&&b.callback){var a=b.callback,c=a.context,d;a.context=null;for(d in a)if(a[d])this.$$observable.on(d,a[d],c||this);b.callback=null}},on:function(){var b=this.$$observable;return b.on.apply(b,arguments)},un:function(){var b=this.$$observable;return b.un.apply(b,arguments)},once:function(){var b=this.$$observable;return b.once.apply(b,arguments)},trigger:function(){var b=this.$$observable;return b.trigger.apply(b,
arguments)},$beforeDestroy:function(){this.$$observable.trigger("beforedestroy",this)},$afterDestroy:function(){this.$$observable.trigger("destroy",this);this.$$observable.destroy();this.$$observable=null}}),Q=ga({$class:"MetaphorJs.Record",$mixins:[oa],id:null,data:null,orig:null,modified:null,loaded:!1,dirty:!1,model:null,standalone:!0,stores:null,$init:function(b,a,c){var d=arguments.length;1==d?(c=b,a=b=null):2==d&&(c=a,a=null);this.data={};this.orig={};this.stores=[];this.modified={};c=c||{};
this.$super(c);k(this.model)?this.model=J.create(this.model):this.model instanceof J||(this.model=new J(this.model));this.id=b;a?this.importData(a):!1!==c.autoLoad&&b&&this.load();"MetaphorJs.Record"!=this.$getClass()&&J.addToCache(this)},isLoaded:function(){return this.loaded},isStandalone:function(){return this.standalone},isDirty:function(){return this.dirty},getModel:function(){return this.model},attachStore:function(b){b=b.getId();-1==this.stores.indexOf(b)&&this.stores.push(b)},detachStore:function(b){b=
b.getId();var a;this.$destroyed||-1==(a=this.stores.indexOf(b))||(this.stores.splice(a,1),0!=this.stores.length||this.standalone||this.$destroy())},setDirty:function(b){this.dirty!=b&&(this.dirty=!!b,this.trigger("dirtychange",this,b))},importData:function(b){var a={},c;if(b){for(c in b)a[c]=this.model.restoreField(this,c,b[c]);this.data=a}this.orig=n({},this.data);this.modified={};this.loaded=!0;this.setDirty(!1)},storeData:function(b){var a={},c;for(c in b)a[c]=this.model.storeField(this,c,b[c]);
return a},getId:function(){return this.id},getData:function(b){if(b){var a={},c,d;b=k(b)?[b]:b;c=0;for(d=b.length;c<d;c++)a[b[c]]=this.data[b[c]];return a}return n({},this.data)},getChanged:function(){return n({},this.modified)},isChanged:function(b){return this.modified[b]||!1},get:function(b){return this.data[b]},setId:function(b){!this.id&&b&&(this.id=b)},set:function(b,a){var c=this.data[b];a=this.model.restoreField(this,b,a);this.data[b]=a;c!=a&&(this.modified[b]=!0,this.setDirty(!0),this.trigger("change",
this,b,a,c),this.trigger("change-"+b,this,b,a,c))},revert:function(){this.dirty&&(this.data=n({},this.orig),this.modified={},this.setDirty(!1))},load:function(){var b=this;b.trigger("beforeload",b);return b.model.loadRecord(b.id).done(function(a){b.setId(a.id);b.importData(a.data);b.trigger("load",b)}).fail(function(){b.trigger("failedload",b)})},save:function(b,a){var c=this;c.trigger("beforesave",c);return c.model.saveRecord(c,b,a).done(function(a){c.setId(a.id);c.importData(a.data);c.trigger("save",
c)}).fail(function(a){c.trigger("failedsave",c)})},"delete":function(){var b=this;b.trigger("beforedelete",b);return b.model.deleteRecord(b).done(function(){b.trigger("delete",b);b.$destroy()}).fail(function(){b.trigger("faileddelete",b)})},reset:function(){this.id=null;this.data={};this.orig={};this.modified={};this.dirty=this.loaded=!1;this.trigger("reset",this)},destroy:function(){J.removeFromCache(this.$getClass(),this.id);this.$super()}}),wa=function(){var b=function(a,c,b){if(q(c))return c(a,
b);if(""===c||void 0===c)return!0;if(void 0!==a){if(da(a))return a===c;if(c instanceof RegExp)return c.test(""+a);if("strict"==b)return""+a===""+c;if(!0===b||null===b||void 0===b)return-1!=""+a.indexOf(c);if(!1===b)return-1==""+a.indexOf(c)}return!1},a=function(a,c,f){if(la(a))return void 0===c.$?!0:b(a,c.$,f);var g,h;for(g in c)if("$"==g)for(h in a){if(b(a[h],c.$,f))return!0}else if(b(a[g],c[g],f))return!0;return!1},c=function(c,b,f){Y(b)||(b={$:b});var g=[],h,k;h=-1;for(k=c.length;++h<k;)a(c[h],
b,f)&&g.push(c[h]);return g};c.compare=a;return c}(),S=Array.prototype.indexOf;S||(S=Array.prototype.indexOf=function(b,a){var c;if(null==this)throw new TypeError('"this" is null or not defined');var d=Object(this),e=d.length>>>0;if(0===e)return-1;c=+a||0;Infinity===Math.abs(c)&&(c=0);if(c>=e)return-1;for(c=Math.max(0<=c?c:e-Math.abs(c),0);c<e;){if(c in d&&d[c]===b)return c;c++}return-1});S=function(){var b={};return ga({$class:"MetaphorJs.Store",$mixins:[oa],id:null,autoLoad:!1,clearOnLoad:!0,model:null,
extraParams:null,loaded:!1,loading:!1,local:!1,items:null,current:null,map:null,currentMap:null,length:0,currentLength:0,maxLength:0,totalLength:0,start:0,pageSize:null,pages:null,filtered:!1,sorted:!1,filterBy:null,filterOpt:null,sortBy:null,sortDir:null,publicStore:!1,idProp:null,$init:function(a,c,d){this.items=[];this.current=[];this.map={};this.currentMap={};this.loaded=!1;this.extraParams=this.extraParams||{};a&&!k(a)&&(d=c,c=a,a=null);c=c||{};a&&(c.url=a);this.$super(c);n(this,c,!0,!1);this.id=
this.id||aa();this.publicStore&&(b[this.id]=this);this.initModel(c);this.$$observable.createEvent("beforeload",!1);!this.local&&this.autoLoad?this.load():d&&(N(d)?this._loadArray(d):this._loadAjaxData(d));this.local&&(this.loaded=!0)},initModel:function(a){k(this.model)?this.model=J.create(this.model):this.model instanceof J||(this.model=new J(this.model));a.url&&(this.model.store.load=a.url);this.idProp=this.model.getStoreProp("load","id")},getId:function(){return this.id},isLoaded:function(){return this.loaded},
isLocal:function(){return this.local},setLocal:function(a){this.local=!!a},isLoading:function(){return this.loading},isFiltered:function(){return this.filtered},isSorted:function(){return this.sorted},getLength:function(a){return a?this.length:this.currentLength},getTotalLength:function(){return this.totalLength||this.currentLength},getPagesCount:function(){return null!==this.pageSize?parseInt(this.totalLength/this.pageSize):1},setParam:function(a,c){this.extraParams[a]=c},getParam:function(a){return this.extraParams[a]},
setStart:function(a){this.start=a},setPageSize:function(a){this.pageSize=a},getAjaxData:function(){return this.ajaxData},hasDirty:function(a){if(this.model.isPlain())return!1;var c=!1;this.each(function(a){return a.isDirty()?(c=!0,!1):!0},null,a);return c},getDirty:function(a){var c=[];if(this.model.isPlain())return c;this.each(function(a){a.isDirty()&&c.push(a)},null,a);return c},getModel:function(){return this.model},_loadAjaxData:function(a,c){var b=this;c=c||{};if(c.silent||!1!==b.trigger("beforeload",
b))b.ajaxData=a,b.model._processStoreResponse("load",a,{resolve:function(a){b._onModelLoadSuccess(a,c)},reject:function(a){b._onModelLoadFail(a,c)}})},_loadArray:function(a,c){c=c||{};(c.silent||!1!==this.trigger("beforeload",this))&&N(a)&&(this._load(a,c),this.totalLength=this.length)},_load:function(a,c){var b=c.prepend;c=c||{};for(var e=0;e<a.length;e++)b?this.insert(e,a[e],!0,!0):this.add(a[e],!0,!0);this.loaded=!0;this.loading=!1;this.trigger("loadingend",this);this.onLoad();c.skipUpdate||this.update();
c.silent||this.trigger("load",this)},load:function(a,c){var b=this,e=b.model.store,f=e.start,e=e.limit,g=b.pageSize;c=c||{};if(b.local)return null;a=n({},b.extraParams,a||{});null===g||a[f]||a[e]||(f&&(a[f]=b.start),e&&(a[e]=g));if(!c.silent&&!1===b.trigger("beforeload",b))return null;b.loading=!0;b.trigger("loadingstart",b);return b.model.loadStore(b,a).done(function(a){b.ajaxData=b.model.lastAjaxResponse;b._onModelLoadSuccess(a,c)}).fail(function(a){b.ajaxData=b.model.lastAjaxResponse;b._onModelLoadFail(a,
c)})},_onModelLoadSuccess:function(a,b){b=b||{};if(!b.noopOnEmpty||a.data.length)!b.prepend&&!b.append&&this.clearOnLoad&&0<this.length&&this.clear(!0),this.totalLength=parseInt(a.total),this._load(a.data,b)},_onModelLoadFail:function(a,b){this.onFailedLoad();b.silent||this.trigger("failedload",this,a)},onLoad:t,onFailedLoad:t,save:function(a){var b=this,d={},e=0;if(b.local)return null;if(b.model.isPlain())throw Error("Cannot save plain store");b.each(function(a){a.isDirty()&&(d[a.getId()]=a.storeData(a.getData()),
e++)});if(!e)throw Error("Nothing to save");return a||!1!==b.trigger("beforesave",b,d)?b.model.saveStore(b,d).done(function(d){b._onModelSaveSuccess(d,a)}).fail(function(d){b._onModelSaveFail(d,a)}):null},_onModelSaveSuccess:function(a,b){var d,e,f,g=a.data;if(g&&g.length)for(d=0,e=g.length;d<e;d++)f=this.getRecordId(g[d]),(f=this.getById(f))&&f.importData(g[d]);this.onSave();b||this.trigger("save",this)},_onModelSaveFail:function(a,b){this.onFailedSave(a);b||this.trigger("failedsave",this)},onSave:t,
onFailedSave:t,deleteById:function(a,b,d){var e=this,f,g,h;if(e.local)return null;if(!a||N(a)&&!a.length)throw Error("Record id required");N(a)||(a=[a]);f=0;for(g=a.length;f<g;f++)h=e.getById(a[f]),e.remove(h,b,d),h instanceof Q&&h.$destroy();return b||!1!==e.trigger("beforedelete",e,a)?e.model.deleteRecords(e,a).done(function(){e.totalLength-=a.length;e.onDelete();b||e.trigger("delete",e,a)}).fail(function(){e.onFailedDelete();b||e.trigger("faileddelete",e,a)}):null},onDelete:t,onFailedDelete:t,
deleteAt:function(a,b,d){var e=this.getAt(a);if(!e)throw Error("Record not found at "+a);return this["delete"](e,b,d)},"delete":function(a,b,d){return this.deleteById(this.getRecordId(a),b,d)},deleteRecords:function(a,b,d){var e=[],f,g;f=0;for(g=a.length;f<g;f++)e.push(this.getRecordId(a[f]));return this.deleteById(e,b,d)},loadOr:function(a,b,d){this.local||this.isLoading()||(this.isLoaded()?a&&a.call(b||this):this.load(null,d))},addPrevPage:function(a){a=a||{};a.append=!1;a.prepend=!0;a.noopOnEmpty=
!0;return this.loadPrevPage(a)},addNextPage:function(a){a=a||{};a.append=!0;a.prepend=!1;a.noopOnEmpty=!0;if(!this.local&&(!this.totalLength||this.length<this.totalLength))return this.load({start:this.length,limit:this.pageSize},a)},loadNextPage:function(a){if(!this.local&&(!this.totalLength||this.length<this.totalLength))return this.start+=this.pageSize,this.load(null,a)},loadPrevPage:function(a){if(!this.local&&0<this.start)return this.start-=this.pageSize,0>this.start&&(this.start=0),this.load(null,
a)},loadPage:function(a,b){if(!this.local)return this.start=parseInt(a,10),0>this.start&&(this.start=0),this.load(null,b)},getRecordId:function(a){return a instanceof Q?a.getId():a[this.idProp]||null},getRecordData:function(a){return this.model.isPlain()?a:a.data},processRawDataItem:function(a){if(a instanceof Q||this.model.isPlain())return a;var b=this.model.type,d=this.getRecordId(a),e;d&&(e=J.getFromCache(b,d));e||(e=ca(b,d,a,{model:this.model,standalone:!1}));return e},bindRecord:function(a,b){b[a]("change",
this.onRecordChange,this);b[a]("destroy",this.onRecordDestroy,this);b[a]("dirtychange",this.onRecordDirtyChange,this);return b},onRecordDirtyChange:function(a){this.trigger("update",this,a)},onRecordChange:function(a,b,d,e){this.trigger("update",this,a)},onRecordDestroy:function(a){this.remove(a)},shift:function(a,b,d){return this.removeAt(0,a,b,d)},unshift:function(a,b,d){return this.insert(0,a,b,d)},pop:function(a,b,d){return this.removeAt(this.length-1,a,b,d)},addMany:function(a,b,d){var e,f,g=
this.length;e=0;for(f=a.length;e<f;e++)this.insert(g+e,a[e],!0,!0);d||this.update();0<f&&!b&&this.trigger("add",a)},add:function(a,b,d){return this.insert(this.length,a,b,d)},onAdd:t,removeAt:function(a,b,d,e){e||(a=this.items.indexOf(this.current[a]));if(a<this.length&&0<=a)return this.length--,e=this.items[a],this.items.splice(a,1),a=this.getRecordId(e),void 0!=a&&(delete this.map[a],delete this.currentMap[a]),this.onRemove(e,a),d||this.update(),b||this.trigger("remove",e,a),e instanceof Q?(this.bindRecord("un",
e),e.detachStore(this),e.$destroyed?void 0:e):e},onRemove:t,insertMany:function(a,b,d,e){var f,g;f=0;for(g=b.length;f<g;f++)this.insert(a+f,b[f],!0,!0);0<g&&!e&&this.update();0<g&&!d&&this.trigger("add",b)},insert:function(a,b,d,e){var f,g=!1;b=this.processRawDataItem(b);f=this.getRecordId(b);this.map[f]&&(this.suspendAllEvents(),this.removeId(f),this.resumeAllEvents());a>=this.length?(this.items.push(b),g=!0):this.items.splice(a,0,b);this.length++;this.maxLength&&this.length>this.maxLength&&(g?this.pop(d,
!0):this.shift(d,!0));void 0!=f&&(this.map[f]=b);b instanceof Q&&(b.attachStore(this),this.bindRecord("on",b));this.onAdd(a,b);e||this.update();d||this.trigger("add",[b]);return b},replace:function(a,b,d,e){var f;f=this.items.indexOf(a);this.removeAt(f,!0,!0,!0);this.insert(f,b,!0,!0);e||this.update();d||this.trigger("replace",a,b);return b},onReplace:t,remove:function(a,b,d){return this.removeAt(this.indexOf(a,!0),b,d,!0)},removeId:function(a,b,d){return this.removeAt(this.indexOfId(a,!0),b,d,!0)},
contains:function(a,b){return-1!=this.indexOf(a,b)},containsId:function(a,b){return b?void 0!==this.map[a]:void 0!==this.currentMap[a]},clear:function(a){var b=this.getRange();this._reset();this.onClear();a||this.trigger("clear",b)},onClear:t,reset:function(){this._reset();this.start=0},_reset:function(a){var b,d;if(!a)for(a=0,b=this.items.length;a<b;a++)d=this.items[a],d instanceof Q&&(this.bindRecord("un",d),d.detachStore(this));this.totalLength=this.currentLength=this.length=0;this.items=[];this.current=
[];this.map={};this.currentMap={};this.loaded=this.local},getAt:function(a,b){return b?this.items[a]||void 0:this.current[a]||void 0},getById:function(a,b){return b?this.map[a]||void 0:this.currentMap[a]||void 0},indexOf:function(a,b){return b?this.items.indexOf(a):this.current.indexOf(a)},indexOfId:function(a,b){return this.indexOf(this.getById(a,b),b)},each:function(a,b,d){d=d?this.items.slice():this.current.slice();for(var e=0,f=d.length;e<f&&!1!==a.call(b,d[e],e,f);e++);},eachId:function(a,b,
d){var e=this;e.each(function(d,g,h){return a.call(b,e.getRecordId(d),g,h)},null,d)},collect:function(a,b){var d=[],e=!this.model.isPlain();this.each(function(b){(b=e?b.get(a):b[a])&&d.push(b)},null,b);return d},first:function(a){return a?this.items[0]:this.current[0]},last:function(a){return a?this.items[this.length-1]:this.current[this.current-1]},getRange:function(a,b,d){d=d?this.items:this.current;var e=[];if(1>d.length)return e;a=a||0;b=Math.min(void 0==b?this.length-1:b,this.length-1);if(a<=
b)for(;a<=b;a++)e.push(d[a]);else for(;a>=b;a--)e.push(d[a]);return e},findBy:function(a,b,d,e){a=this.findIndexBy(a,b,d,e);return-1==a?void 0:this.getAt(a,e)},findIndexBy:function(a,b,d,e){e=e?this.items:this.current;d=d||0;for(var f=e.length;d<f;d++)if(a.call(b,e[d],this.getRecordId(e[d])))return d;return-1},find:function(a,b,d,e){var f=!this.model.isPlain(),g;return this.findIndexBy(function(e){g=f?e.get(a):e[a];return d?g===b:g==b},this,0,e)},findExact:function(a,b,d){return this.find(a,b,!0,
d)},findBySet:function(a,b){var d=null,e,f;this.each(function(b){e=!0;for(f in a)if(a[f]!=b[f]){e=!1;break}return e?(d=b,!1):!0},null,b);return d},update:function(){var a=this,b=a.filtered,d=a.sorted;a.currentLength=a.length;a.currentMap=a.map;a.current=a.items;if(b){var e=a.filterBy,f=a.filterOpt,g,h;a.current=g=[];a.currentMap=h={};a.each(function(b){wa.compare(b.data,e,f)&&(g.push(b),h[a.getRecordId(b)]=b)},null,!0);a.currentLength=a.current.length}if(d){var k=a.sortBy,m=!a.model.isPlain();a.current=
pa(a.current,function(a){return m?a.get(k):a[k]},a.sortDir)}a.trigger("update",a)},filter:function(a,b){this.filtered=!0;this.filterBy=a;this.filterOpt=b;this.update()},clearFilter:function(){this.filtered&&(this.filterOpt=this.filterBy=null,this.update())},sort:function(a,b){this.sorted=!0;this.sortBy=a;this.sortDir=b;this.update()},clearSorting:function(){this.sorted=!1;this.sortDir=this.sortBy=null;this.update()},destroy:function(){delete b[this.id];this.clear();this.$super()}},{lookupStore:function(a){return b[a]||
null},eachStore:function(a,c){for(var d in b)if(!1===a.call(c,b[d]))break}})}();O.Model=J;O.Record=Q;O.Store=S;"undefined"!=typeof global?global.MetaphorJs=O:window.MetaphorJs=O})();
