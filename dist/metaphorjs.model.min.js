(function(){var x=function(r){return"function"==typeof r},ja=Object.prototype.toString,p=function(){var r={"[object String]":0,"[object Number]":1,"[object Boolean]":2,"[object Object]":3,"[object Function]":4,"[object Array]":5,"[object RegExp]":9,"[object Date]":10};return function(c){if(!c){if(null===c)return 6;if(void 0===c)return 7}var b=r[ja.call(c)];if(void 0===b)return-1;1==b&&isNaN(c)&&(b=8);return b}}(),u=function(r){return 0===p(r)},O=function(r){var c=p(r);return null!==r&&"object"==typeof r&&
(2<c||-1==c)},Y=function(r,c){var b={};r||(r="undefined"!=typeof global?global:window);this.register=function(a,d){var e;e=a;var f=e.split("."),g,k=f.pop();g=f.join(".");var h=f.length,s,H=r;if(b[g])e=[b[g],k,e];else{if(0<h)for(g=0;g<h;g++){s=f[g];if(c&&0==g)if(s==c){H=r;continue}else e=c+"."+e;void 0===H[s]&&(H[s]={});H=H[s]}else c&&(e=c+"."+e);e=[H,k,e]}f=e[0];k=e[1];O(f)&&void 0===f[k]&&(f[k]=d,b[e[2]]=d);return d};this.exists=function(a){return void 0!==b[a]};this.get=function(a,d){if(void 0!==
b[a])return b[a];if(c&&void 0!==b[c+"."+a])return b[c+"."+a];if(!d){var e=a.split("."),f,g=e.length,k,h=r;for(f=0;f<g;f++)if(k=e[f],c&&0==f&&k==c)h=r;else{if(void 0===h[k])return;h=h[k]}h&&(b[a]=h);return h}};this.add=function(a,d){c&&0!==a.indexOf(c)&&(a=c+"."+a);void 0===b[a]&&(b[a]=d);return d};this.remove=function(a){delete b[a]}};Y.prototype={register:null,exists:null,get:null,add:null,remove:null};var I=Array.prototype.slice,ea=function(r,c,b){setTimeout(function(){r.apply(c,b||[])},0)},Z=function(r){var c=
r.stack||Error().stack;if("undefined"!=typeof console&&console.log)ea(function(){console.log(r);c&&console.log(c)});else throw r;},F=function(r){r||(r=new Y);var c=function(b,a){return d(function(){},b,a)},b=function(b,a,d){return function(){var c,e=this.supr;this.supr=b.prototype[a]||function(){};c=d.apply(this,arguments);this.supr=e;return c}},a=function(a,d,c){for(var e in d)d.hasOwnProperty(e)&&(a[e]=x(d[e])&&c.prototype&&x(c.prototype[e])?b(c,e,d[e]):d[e])},d=function(b,d,c){var e=function(){};
e.prototype=b.prototype;var e=new e,s=function(){c&&c.apply(this,arguments);this.initialize&&this.initialize.apply(this,arguments)};a(e,d,b);e.constructor=s;s.prototype=e;s.prototype.getClass=function(){return s.__class};s.prototype.getParentClass=function(){return s.__parentClass};s.__instantiate=function(b){return function(){var a=function(){},d;a.prototype=b.prototype;a=new a;d=b.prototype.constructor.apply(a,arguments);return O(d)?d:a}}(s);return s},e=function(b,a,e,h,s,H){null===b&&(b="");x(b)?
(s=e,u(a)?(s=h,h=e):(h=a,e=b,a=null),b=null):u(b)||(s=a,h=b,b=e=a=null);u(a)||x(a)||(s=h,h=e,e=a,a=null);x(e)||(s=h,h=e,e=null);h=h||{};var A=a&&u(a)?r.get(a):a;if(a&&!A)throw Error(a+" not found");a=A?d(A,h,e):c(h,e);a.__isMetaphorClass=!0;a.__parent=A;a.__parentClass=A?A.__class:null;a.__class=b;if(s)for(var l in s)s.hasOwnProperty(l)&&(a[l]=s[l]);b&&(H?r.add(b,a):r.register(b,a));s&&s.alias&&r.add(s.alias,a);return a};this.factory=function(b){var a=r.get(b),d=I.call(arguments,1);if(!a)throw Error(b+
" not found");return a.__instantiate.apply(this,d)};this.isSubclassOf=function(b,a){var d=b,c=r.get;u(a)||(a=a.getClass?a.getClass():a.prototype.constructor.__class);for(u(b)&&(d=c(b));d;){if(d.prototype.constructor.__class==a)return!0;d&&(d=d.getParentClass?c(d.getParentClass()):d.__parent)}return!1};this.isInstanceOf=function(b,a){var d=u(a)?r.get(a):a;return d?b instanceof d:!1};this.define=e;this.defineCache=function(a,b,d,c,s){return e(a,b,d,c,s,!0)}};F.prototype={factory:null,isSubclassOf:null,
isInstanceOf:null,define:null,defineCache:null};var $={lib:{},cmp:{},view:{}},ka=new Y($,"MetaphorJs"),F=new F(ka),J=F.define,l=Function.prototype.bind?function(r,c){return r.bind(c)}:function(r,c){return function(){return r.apply(c,arguments)}},m=function(){},D=function c(){var b=!1,a=!1,d=I.call(arguments),e=d.shift(),f,g,k;2===p(d[d.length-1])&&(b=d.pop());2===p(d[d.length-1])&&(a=b,b=d.pop());for(;d.length;)if(f=d.shift())for(g in f)if(f.hasOwnProperty(g)&&void 0!==(k=f[g]))if(a)if(e[g]&&3===
p(e[g])&&3===p(k))c(e[g],k,b,a);else{if(!0===b||void 0==e[g])3===p(k)?(e[g]={},c(e[g],k,b,!0)):e[g]=k}else if(!0===b||void 0==e[g])e[g]=k;return e},fa=function(){return String.prototype.trim?function(c){return u(c)?c.trim():c}:function(c){return u(c)?c.replace(/^\s\s*/,"").replace(/\s\s*$/,""):c}}(),la=function(){return"undefined"!=typeof JSON?function(c){return JSON.parse(c)}:function(c){return(new Function("return "+c))()}}(),ga=function(c,b){var a,d;if(!c||!u(c))return null;try{d=new DOMParser,
a=d.parseFromString(c,b||"text/xml")}catch(e){a=void 0}if(!a||a.getElementsByTagName("parsererror").length)throw"Invalid XML: "+c;return a},aa=function(c){if(c&&void 0!=!c.length&&!u(c)){for(var b=[],a=-1,d=c.length>>>0;++a!==d;b[a]=c[a]);return b}return c?[c]:[]},ha=function(){var c=/^[\w[:#.][\w\]*^|=!]*$/,b=/=([^\]]+)/,a=/ *, */,d=/(\([^)]*)\+/,e=/(\[[^\]]+)~/,f=/(~|>|\+)/,g=/ +/,k=/([^[:.#]+)?(?:#([^[:.#]+))?(?:\.([^[:.]+))?(?:\[([^!&^*|$[:=]+)([!$^*|&]?=)?([^:\]]+)?\])?(?::([^(]+)(?:\(([^)]+)\))?)?/,
h=/(?:(-?\d*)n)?(?:(%|-)(\d*))?/,s=/\D/,H=/[^(]*\(([^)]*)\)/,A=/\(.*/,l=/\[([^!~^*|$ [:=]+)([$^*|]?=)?([^ :\]]+)?\]/,M=document,u=!!M.getElementsByClassName,x=!!M.querySelectorAll,K={"first-child":function(a){return a.parentNode.getElementsByTagName("*")[0]!==a},"last-child":function(a){for(;(a=a.nextSibling)&&1!=a.nodeType;);return!!a},root:function(a){return"html"!==a.nodeName.toLowerCase()},"nth-child":function(a,b){var d=a.nodeIndex||0,c=b[3]=b[3]?("%"===b[2]?-1:1)*b[3]:0,e=b[1];if(d)return!((d+
c)%e);var f=a.parentNode.firstChild;d++;do if(1==f.nodeType&&(f.nodeIndex=++d)&&a===f&&(d+c)%e)return 0;while(f=f.nextSibling);return 1},"nth-last-child":function(a,b){var d=a.nodeIndexLast||0,c=b[3]?("%"===b[2]?-1:1)*b[3]:0,e=b[1];if(d)return!((d+c)%e);var f=a.parentNode.lastChild;d++;do if(1==f.nodeType&&(f.nodeLastIndex=d++)&&a===f&&(d+c)%e)return 0;while(f=f.previousSibling);return 1},empty:function(a){return!!a.firstChild},parent:function(a){return!a.firstChild},"only-child":function(a){return 1!=
a.parentNode.getElementsByTagName("*").length},checked:function(a){return!a.checked},lang:function(a,b){return a.lang!==b&&M.documentElement.lang!==b},enabled:function(a){return a.disabled||"hidden"===a.type},disabled:function(a){return!a.disabled},selected:function(a){return!a.selected}},w={},p=function(a){return w[a]||(w[a]=new RegExp("(^| +)"+a+"($| +)"))},B={"":function(a,b){return!!a.getAttribute(b)},"=":function(a,b,d){return(b=a.getAttribute(b))&&b===d},"&=":function(a,b,d){return(b=a.getAttribute(b))&&
p(d).test(b)},"^=":function(a,b,d){return(b=a.getAttribute(b)+"")&&!b.indexOf(d)},"$=":function(a,b,d){return(b=a.getAttribute(b)+"")&&b.indexOf(d)==b.length-d.length},"*=":function(a,b,d){return(b=a.getAttribute(b)+"")&&-1!=b.indexOf(d)},"|=":function(a,b,d){return(b=a.getAttribute(b)+"")&&(b===d||!!b.indexOf(d+"-"))},"!=":function(a,b,d){return!(b=a.getAttribute(b))||!p(d).test(b)}},m=function(N,P){P=P||M;var n=[],y=null,z,m,p,q,w,C,E;if(x)try{n=aa(P.querySelectorAll(N.replace(b,'="$1"')))}catch(D){y=
!0}if(!x||y)if(c.test(N))switch(y=0,N.charAt(0)){case "#":y=N.slice(1);n=M.getElementById(y);n.id!==y&&(n=M.all[y]);n=n?[n]:[];break;case ".":z=N.slice(1);if(u)n=aa((n=P.getElementsByClassName(z)).length?n:[]);else{z=" "+z+" ";m=P.getElementsByTagName("*");for(p=0;q=m[p++];)-1!=(" "+q.className+" ").indexOf(z)&&(n[y++]=q);n=y?n:[]}break;case ":":m=P.getElementsByTagName("*");p=0;w=N.replace(H,"$1");for(C=N.replace(A,"");q=m[p++];)K[C]&&!K[C](q,w)&&(n[y++]=q);n=y?n:[];break;case "[":m=P.getElementsByTagName("*");
p=0;q=l.exec(N);z=q[1];E=q[2]||"";for(w=q[3];q=m[p++];)B[E]&&(B[E](q,z,w)||"class"===z&&B[E](q,"className",w))&&(n[y++]=q);n=y?n:[];break;default:n=aa((n=P.getElementsByTagName(N)).length?n:[])}else{for(var F=N.split(a),G=F.length-1,V=!!G,O,U,v,L,Q,R,S,T,W,t,I,J;y=F[G--];){U=(O=y.replace(d,"$1%").replace(e,"$1&").replace(f," $1 ").split(g)).length;p=0;L=" ";for(m=[P];v=O[p++];)if(" "!==v&&">"!==v&&"~"!==v&&"+"!==v&&m){v=v.match(k);Q=v[1]||"*";R=v[2];S=v[3]?" "+v[3]+" ":"";z=v[4];E=v[5]||"";C=v[7];
w="nth-child"===C||"nth-last-child"===C?h.exec("even"===v[8]&&"2n"||"odd"===v[8]&&"2n%1"||!s.test(v[8])&&"0n%"+v[8]||v[8]):v[8];T=[];y=W=0;for(I=p==U;t=m[W++];)switch(L){case " ":J=t.getElementsByTagName(Q);for(t=0;q=J[t++];)R&&q.id!==R||S&&-1==(" "+q.className+" ").indexOf(S)||!(!z||B[E]&&(B[E](q,z,v[6])||"class"===z&&B[E](q,"className",v[6])))||q.yeasss||(K[C]?K[C](q,w):C)||(I&&(q.yeasss=1),T[y++]=q);break;case "~":for(Q=Q.toLowerCase();(t=t.nextSibling)&&!t.yeasss;)1!=t.nodeType||"*"!==Q&&t.nodeName.toLowerCase()!==
Q||R&&t.id!==R||S&&-1==(" "+t.className+" ").indexOf(S)||!(!z||B[E]&&(B[E](q,z,v[6])||"class"===z&&B[E](q,"className",v[6])))||t.yeasss||(K[C]?K[C](t,w):C)||(I&&(t.yeasss=1),T[y++]=t);break;case "+":for(;(t=t.nextSibling)&&1!=t.nodeType;);!t||t.nodeName.toLowerCase()!==Q.toLowerCase()&&"*"!==Q||R&&t.id!==R||S&&-1==(" "+q.className+" ").indexOf(S)||!(!z||B[E]&&(B[E](q,z,v[6])||"class"===z&&B[E](q,"className",v[6])))||t.yeasss||(K[C]?K[C](t,w):C)||(I&&(t.yeasss=1),T[y++]=t);break;case ">":for(J=t.getElementsByTagName(Q),
p=0;q=J[p++];)q.parentNode!==t||R&&q.id!==R||S&&-1==(" "+q.className+" ").indexOf(S)||!(!z||B[E]&&(B[E](q,z,v[6])||"class"===z&&B[E](q,"className",v[6])))||q.yeasss||(K[C]?K[C](q,w):C)||(I&&(q.yeasss=1),T[y++]=q)}m=T}else L=v;if(V){if(!m.concat){T=[];for(t=0;q=m[t];)T[t++]=q;m=T}n=m.concat(1==n.length?n[0]:n)}else n=m}for(y=n.length;y--;)n[y].yeasss=n[y].nodeIndex=n[y].nodeIndexLast=null}return n};m.is=function(a,b){var d=m(b,a.parentNode),c,e;c=-1;for(e=d.length;++c<e;)if(d[c]===a)return!0;return!1};
return m}(),U=function(c,b,a){c.attachEvent?c.attachEvent("on"+b,a):c.addEventListener(b,a,!1)},ia=function(){var c=["0","0","0"];return function(){for(var b=c.length,a;b;){b--;a=c[b].charCodeAt(0);if(57==a)return c[b]="A",c.join("");if(90==a)c[b]="0";else return c[b]=String.fromCharCode(a+1),c.join("")}c.unshift("0");return c.join("")}}(),ba=function(){this.events={}};ba.prototype={createEvent:function(c,b){c=c.toLowerCase();var a=this.events;a[c]||(a[c]=new ca(c,b));return a[c]},getEvent:function(c){c=
c.toLowerCase();return this.events[c]},on:function(c,b,a,d){c=c.toLowerCase();var e=this.events;e[c]||(e[c]=new ca(c));return e[c].on(b,a,d)},once:function(c,b,a,d){d=d||{};d.limit=1;return this.on(c,b,a,d)},un:function(c,b,a){c=c.toLowerCase();var d=this.events;d[c]&&d[c].un(b,a)},hasListener:function(c,b,a){c=c.toLowerCase();var d=this.events;return d[c]?d[c].hasListener(b,a):!1},removeAllListeners:function(c){var b=this.events;b[c]&&b[c].removeAllListeners()},trigger:function(){var c=arguments[0],
b=this.events,c=c.toLowerCase();if(!b[c])return null;c=b[c];return c.trigger.apply(c,I.call(arguments,1))},suspendEvent:function(c){c=c.toLowerCase();var b=this.events;b[c]&&b[c].suspend()},suspendAllEvents:function(){var c=this.events,b;for(b in c)c[b].suspend()},resumeEvent:function(c){c=c.toLowerCase();var b=this.events;b[c]&&b[c].resume()},resumeAllEvents:function(){var c=this.events,b;for(b in c)c[b].resume()},destroyEvent:function(c){var b=this.events;b[c]&&(b[c].removeAllListeners(),b[c].destroy(),
delete b[c])},destroy:function(c){var b=this.events;if(c)c=c.toLowerCase(),b[c]&&(b[c].destroy(),delete b[c]);else{for(var a in b)b[a].destroy();this.events={}}},getApi:function(){if(!this.api){for(var c="createEvent getEvent on un once hasListener removeAllListeners trigger suspendEvent suspendAllEvents resumeEvent resumeAllEvents destroyEvent".split(" "),b={},a,d=-1,e=c.length;++d<e;a=c[d],b[a]=l(this[a],this));this.api=b}return this.api}};var ca=function(c,b){this.name=c;this.listeners=[];this.map=
{};this.hash=ia();this.uni="$$"+c+"_"+this.hash;this.suspended=!1;this.lid=0;this.returnResult=void 0===b?null:b};ca.prototype={getName:function(){return this.name},destroy:function(){this.map=this.listeners=null},on:function(c,b,a){if(!c)return null;b=b||null;a=a||{};var d=this.uni,e=b||c;if(e[d]&&!a.allowDupes)return null;var f=++this.lid,g=a.first||!1;e[d]=f;c={fn:c,scope:b,uniScope:e,id:f,called:0,limit:a.limit||0,start:a.start||1,count:0,append:a.append,prepend:a.prepend};g?this.listeners.unshift(c):
this.listeners.push(c);this.map[f]=c;return f},once:function(c,b,a){a=a||{};a.once=!0;return this.on(c,b,a)},un:function(c,b){var a=-1,d=this.uni,e=this.listeners,f;f=c==parseInt(c)?c:(b||c)[d];if(!f)return!1;for(var g=0,k=e.length;g<k;g++)if(e[g].id==f){a=g;delete e[g].uniScope[d];break}if(-1==a)return!1;e.splice(a,1);delete this.map[f];return!0},hasListener:function(c,b){var a=this.listeners,d;if(c){b=b||c;d=x(c)?b[this.uni]:c;if(!d)return!1;for(var e=0,f=a.length;e<f;e++)if(a[e].id==d)return!0;
return!1}return 0<a.length},removeAllListeners:function(){var c=this.listeners,b=this.uni,a,d;a=0;for(d=c.length;a<d;a++)delete c[a].uniScope[b];this.listeners=[];this.map={}},suspend:function(){this.suspended=!0},resume:function(){this.suspended=!1},_prepareArgs:function(c,b){var a;c.append||c.prepend?(a=I.call(b),c.prepend&&(a=c.prepend.concat(a)),c.append&&(a=a.concat(c.append))):a=b;return a},trigger:function(){var c=this.listeners,b=this.returnResult;if(this.suspended||0==c.length)return null;
for(var a="all"==b?[]:null,d,e,c="first"==b?[c[0]]:I.call(c);d=c.shift();)if(d&&this.map[d.id]&&(d.count++,!(d.count<d.start))){e=d.fn.apply(d.scope,this._prepareArgs(d,arguments));d.called++;d.called==d.limit&&this.un(d.id);"all"==b&&a.push(e);if("first"==b)return e;"last"==b&&(a=e);if(!1==b&&!1===e)break}if(b)return a}};var V=function(c){var b;return c&&(O(c)||x(c))?x(b=c.then)?b:!1:!1},da=function(){var c=[],b=!1,a="undefined"!=typeof process?process.nextTick:function(a){setTimeout(a,0)},d=function(){b=
!0;var e=c.shift();a(function(){e[0].apply(e[1],e[2]);c.length?d():b=!1},0)},e=function(a,e,f){f=f||[];c.push([a,e,f]);b||d()},f=function(a,b){return function(d){try{b.resolve(a(d))}catch(c){b.reject(c)}}},g=function(a,b){if(a instanceof g)return a;if(!(this instanceof g))return new g(a,b);var d;this._fulfills=[];this._rejects=[];this._dones=[];this._fails=[];if(0<arguments.length)if(d=V(a))a instanceof g?a.then(l(this.resolve,this),l(this.reject,this)):(new g(d,a)).then(l(this.resolve,this),l(this.reject,
this));else if(x(a))try{a.call(b,l(this.resolve,this),l(this.reject,this))}catch(c){this.reject(c)}else this.resolve(a)};g.prototype={_state:0,_fulfills:null,_rejects:null,_dones:null,_fails:null,_wait:0,_value:null,_reason:null,_triggered:!1,isPending:function(){return 0==this._state},isFulfilled:function(){return 1==this._state},isRejected:function(){return 2==this._state},_cleanup:function(){delete this._fulfills;delete this._rejects;delete this._dones;delete this._fails},_processValue:function(a,
b){var d;if(0==this._state)if(a===this)this._doReject(new TypeError("cannot resolve promise with itself"));else{try{if(d=V(a)){a instanceof g?a.then(l(this._processResolveValue,this),l(this._processRejectReason,this)):(new g(d,a)).then(l(this._processResolveValue,this),l(this._processRejectReason,this));return}}catch(c){0==this._state&&this._doReject(c);return}b.call(this,a)}},_callResolveHandlers:function(){this._done();for(var a=this._fulfills,b;b=a.shift();)e(b[0],b[1],[this._value]);this._cleanup()},
_doResolve:function(a){this._value=a;this._state=1;0==this._wait&&this._callResolveHandlers()},_processResolveValue:function(a){this._processValue(a,this._doResolve)},resolve:function(a){if(this._triggered)return this;this._triggered=!0;this._processResolveValue(a);return this},_callRejectHandlers:function(){this._fail();for(var a=this._rejects,b;b=a.shift();)e(b[0],b[1],[this._reason]);this._cleanup()},_doReject:function(a){this._state=2;this._reason=a;0==this._wait&&this._callRejectHandlers()},
_processRejectReason:function(a){this._processValue(a,this._doReject)},reject:function(a){if(this._triggered)return this;this._triggered=!0;this._processRejectReason(a);return this},then:function(a,b){var d=new g,c=this._state;0==c||0!=this._wait?(a&&x(a)?this._fulfills.push([f(a,d),null]):this._fulfills.push([d.resolve,d]),b&&x(b)?this._rejects.push([f(b,d),null]):this._rejects.push([d.reject,d])):1==c?a&&x(a)?e(f(a,d),null,[this._value]):d.resolve(this._value):2==c&&(b&&x(b)?e(f(b,d),null,[this._reason]):
d.reject(this._reason));return d},"catch":function(a){return this.then(null,a)},_done:function(){for(var a=this._dones,b;b=a.shift();)try{b[0].call(b[1]||null,this._value)}catch(d){Z(d)}},done:function(a,b){var d=this._state;1==d&&0==this._wait?a.call(b||null,this._value):0==d&&this._dones.push([a,b]);return this},_fail:function(){for(var a=this._fails,b;b=a.shift();)try{b[0].call(b[1]||null,this._reason)}catch(d){Z(d)}},fail:function(a,b){var d=this._state;2==d&&0==this._wait?a.call(b||null,this._reason):
0==d&&this._fails.push([a,b]);return this},always:function(a,b){this.done(a,b);this.fail(a,b);return this},promise:function(){return{then:l(this.then,this),done:l(this.done,this),fail:l(this.fail,this),always:l(this.always,this)}},after:function(a){var b=this;if(V(a)){b._wait++;var d=function(){b._wait--;0==b._wait&&0!=b._state&&(1==b._state?b._callResolveHandlers():b._callRejectHandlers())};x(a.done)?a.done(d):a.then(d)}return b}};g.fcall=function(a,b,d){return g.resolve(a.apply(b,d||[]))};g.resolve=
function(a){var b=new g;b.resolve(a);return b};g.reject=function(a){var b=new g;b.reject(a);return b};g.all=function(a){if(!a.length)return g.resolve(null);var b=new g,d=a.length,c=Array(d),e=d,f,l,m=function(a,d){c[d]=a;e--;0==e&&b.resolve(c)};for(f=0;f<d;f++)(function(d){l=a[f];l instanceof g?l.done(function(a){m(a,d)}).fail(b.reject,b):V(l)||x(l)?(new g(l)).done(function(a){m(a,d)}).fail(b.reject,b):m(l,d)})(f);return b};g.when=function(){return g.all(arguments)};g.allResolved=function(a){if(!a.length)return g.resolve(null);
var b=new g,d=a.length,c=[],e=d,f,l,m=function(a){c.push(a);p()},p=function(){e--;0==e&&b.resolve(c)};for(f=0;f<d;f++)l=a[f],l instanceof g?l.done(m).fail(p):V(l)||x(l)?(new g(l)).done(m).fail(p):m(l);return b};g.race=function(a){if(!a.length)return g.resolve(null);var b=new g,d=a.length,c,e;for(c=0;c<d&&(e=a[c],e instanceof g?e.done(b.resolve,b).fail(b.reject,b):V(e)||x(e)?(new g(e)).done(b.resolve,b).fail(b.reject,b):b.resolve(e),b.isPending());c++);return b};g.waterfall=function(a){if(!a.length)return g.resolve(null);
for(var b=g.fcall(a.shift()),d;d=a.shift();)b=V(d)?b.then(function(a){return function(){return a}}(d)):b.then(d);return b};return g}(),L=function(){var c=/#.*$/,b=/([?&])_=[^&]*/,a=/\?/,d=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,e=/^(?:GET|HEAD)$/i,f=0,g=function(a,b,d){var c,e;if(u(a)&&d)b.push(encodeURIComponent(d)+"="+encodeURIComponent(a));else if(5===p(a)&&d)for(c=0,e=a.length;c<e;c++)g(a[c],b,d+"["+c+"]");else if(O(a))for(c in a)a.hasOwnProperty(c)&&g(a[c],b,d?d+"["+c+"]":
c)},k=function(d,f){d.replace(c,"");if(!1===f.cache){var n=(new Date).getTime();return b.test(d)?d.replace(b,"$1_="+n):d+(a.test(d)?"&":"?")+"_="+n}!f.data||window.FormData&&f.data instanceof window.FormData||(u(f.data)?n=f.data:(n=[],g(f.data,n,null),n=n.join("&").replace(/%20/g,"+")),f.data=n,e.test(f.method)&&(d+=(a.test(d)?"&":"?")+f.data,f.data=null));return d},h={xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",
text:"text/plain",_default:"*/*"},s={url:null,data:null,method:"GET",headers:null,username:null,password:null,cache:null,dataType:null,timeout:0,contentType:"application/x-www-form-urlencoded",xhrFields:null,jsonp:!1,jsonpParam:null,jsonpCallback:null,transport:null,replace:!1,selector:null,form:null,beforeSend:null,progress:null,uploadProgress:null,processResponse:null,callbackScope:null},H={},A=new ba,F=function(a){var b;b=eval;a&&(/^[^\S]*use strict/.test(a)?(b=document.createElement("script"),
b.text=a,document.head.appendChild(b).parentNode.removeChild(b)):b(a))},M=function(a,b,d){var c,e;if(!O(a)&&!x(a)&&d)c=document.createElement("input"),c.setAttribute("type","hidden"),c.setAttribute("name",d),c.setAttribute("value",a),b.appendChild(c);else if(5===p(a)&&d)for(c=0,e=a.length;c<e;c++)M(a[c],b,d+"["+c+"]");else if(O(a))for(c in a)a.hasOwnProperty(c)&&M(a[c],b,d?d+"["+c+"]":c)},G=function(a){for(var b,d,c="",e=0;e<a.elements.length;e++)if(b=a.elements[e],b.hasAttribute("name"))if(d="INPUT"===
b.nodeName.toUpperCase()?b.getAttribute("type").toUpperCase():"TEXT","FILE"===d)for(d=0;d<b.files.length;c+="&"+encodeURIComponent(b.name)+"="+encodeURIComponent(b.files[d++].name));else if("RADIO"!==d&&"CHECKBOX"!==d||b.checked)c+="&"+encodeURIComponent(b.name)+"="+encodeURIComponent(b.value);return c},I=function(a,b,d){var c=b?b.dataType:null;b=b?b.selector:null;if(!u(a))return a;d=d||"";if("xml"===c||!c&&0<=d.indexOf("xml"))return a=ga(fa(a)),b?ha(b,a):a;if("html"===c)return a=ga(a,"text/html"),
b?ha(b,a):a;if("fragment"==c){d=document.createDocumentFragment();c=document.createElement("div");for(c.innerHTML=a;c.firstChild;)d.appendChild(c.firstChild);return d}if("json"===c||!c&&0<=d.indexOf("json"))return la(fa(a));("script"===c||!c&&0<=d.indexOf("javascript"))&&F(a);return a+""},K=function(a){var b=d.exec((window?window.location.href:"").toLowerCase())||[],c=d.exec(a.url.toLowerCase());this._opt=a;!0!==a.crossDomain&&(a.crossDomain=!(!c||c[1]===b[1]&&c[2]===b[2]&&(c[3]||("http:"===c[1]?
"80":"443"))===(b[3]||("http:"===b[1]?"80":"443"))));b=new da;"iframe"!=a.transport||a.form?a.form&&(this._form=a.form,"POST"!=a.method||window&&window.FormData||(a.transport="iframe")):(this.createForm(),a.form=this._form);a.form&&"iframe"!=a.transport&&(a.data="POST"==a.method?new FormData(a.form):G(a.form));a.url=k(a.url,a);c=!a.crossDomain&&"script"!=a.transport||a.form?"iframe"==a.transport?new L(a,b,this):new J(a,b,this):new B(a,b,this);this._deferred=b;this._transport=c;b.done(function(a){A.trigger("success",
a)});b.fail(function(a){A.trigger("error",a)});b.always(function(){A.trigger("end")});A.trigger("start");a.timeout&&(this._timeout=setTimeout(l(this.onTimeout,this),a.timeout));a.jsonp&&this.createJsonp();!1===A.trigger("beforeSend",a,c)&&(this._promise=da.reject());a.beforeSend&&!1===a.beforeSend.call(a.callbackScope,a,c)&&(this._promise=da.reject());this._promise||(ea(c.send,c),b.abort=l(this.abort,this),b.always(this.destroy,this),this._promise=b)};K.prototype={_jsonpName:null,_transport:null,
_opt:null,_deferred:null,_promise:null,_timeout:null,_form:null,_removeForm:!1,promise:function(){return this._promise},abort:function(a){this._transport.abort();this._deferred.reject(a||"abort")},onTimeout:function(){this.abort("timeout")},createForm:function(){var a=document.createElement("form");a.style.display="none";a.setAttribute("method",this._opt.method);M(this._opt.data,a,null);document.body.appendChild(a);this._form=a;this._removeForm=!0},createJsonp:function(){var b=this._opt,d=b.jsonpParam||
"callback",c=b.jsonpCallback||"jsonp_"+ ++f;b.url+=(a.test(b.url)?"&":"?")+d+"="+c;this._jsonpName=c;"undefined"!=typeof window&&(window[c]=l(this.jsonpCallback,this));"undefined"!=typeof global&&(global[c]=l(this.jsonpCallback,this));return c},jsonpCallback:function(a){var b;try{b=this.processResponseData(a)}catch(d){this._deferred?this._deferred.reject(d):Z(d)}this._deferred&&this._deferred.resolve(b)},processResponseData:function(a,b){var d=this._opt;a=I(a,d,b);A.hasListener("processResponse")&&
(a=A.trigger("processResponse",a,this._deferred));d.processResponse&&(a=d.processResponse.call(d.callbackScope,a,this._deferred));return a},processResponse:function(a,b){var d=this._deferred,c;if(this._opt.jsonp)if(a){try{F(a)}catch(e){d.reject(e)}d.isPending()&&d.reject("jsonp script didn't invoke callback")}else d.reject("jsonp script is empty");else{try{c=this.processResponseData(a,b)}catch(f){d.reject(f)}d.resolve(c)}},destroy:function(){this._timeout&&clearTimeout(this._timeout);this._form&&
this._form.parentNode&&this._removeForm&&this._form.parentNode.removeChild(this._form);this._transport.destroy();delete this._transport;delete this._opt;delete this._deferred;delete this._promise;delete this._timeout;delete this._form;this._jsonpName&&("undefined"!=typeof window&&delete window[this._jsonpName],"undefined"!=typeof global&&delete global[this._jsonpName])}};var w=function(a,b){b=b||{};a&&!u(a)?b=a:b.url=a;if(!b.url&&(b.form&&(b.url=b.form.getAttribute("action")),!b.url))throw"Must provide url";
D(b,H,!1,!0);D(b,s,!1,!0);b.method=b.method?b.method.toUpperCase():b.form?b.form.getAttribute("method").toUpperCase()||"GET":"GET";return(new K(b)).promise()};w.setup=function(a){D(H,a,!0,!0)};w.on=function(){A.on.apply(A,arguments)};w.un=function(){A.un.apply(A,arguments)};w.get=function(a,b){b=b||{};b.method="GET";return w(a,b)};w.post=function(a,b){b=b||{};b.method="POST";return w(a,b)};w.load=function(a,b,d){d=d||{};u(b)||(d=b);d.dataType="fragment";return w(b,d).done(function(b){if(d.replace)for(;a.firstChild;)a.removeChild(a.firstChild);
a.appendChild(b)})};w.loadScript=function(a){return w(a,{transport:"script"})};w.submit=function(a,b){b=b||{};b.form=a;return w(null,b)};var J=function(a,b,d){var c;if(!(window.XMLHttpRequest&&(c=new XMLHttpRequest)||(c=new ActiveXObject("Msxml2.XMLHTTP"))||(c=new ActiveXObject("Microsoft.XMLHTTP"))))throw"Unable to create XHR object";this._xhr=c;this._deferred=b;this._opt=a;this._ajax=d;a.progress&&U(c,"progress",l(a.progress,a.callbackScope));a.uploadProgress&&c.upload&&U(c.upload,"progress",l(a.uploadProgress,
a.callbackScope));c.onreadystatechange=l(this.onReadyStateChange,this)};J.prototype={_xhr:null,_deferred:null,_ajax:null,setHeaders:function(){var a=this._opt,b=this._xhr,d;if(a.xhrFields)for(d in a.xhrFields)b[d]=a.xhrFields[d];a.data&&a.contentType&&b.setRequestHeader("Content-Type",a.contentType);b.setRequestHeader("X-Requested-With","XMLHttpRequest");b.setRequestHeader("Accept",a.dataType&&h[a.dataType]?h[a.dataType]+", */*; q=0.01":h._default);for(d in a.headers)b.setRequestHeader(d,a.headers[d])},
onReadyStateChange:function(){var a=this._xhr,b=this._deferred;if(0===a.readyState)a.onreadystatechange=m,b.resolve(a);else if(4===a.readyState){a.onreadystatechange=m;var d;a:{try{d=!a.status&&location&&"file:"==location.protocol||200<=a.status&&300>a.status||304===a.status||1223===a.status;break a}catch(c){}d=!1}d?this._ajax.processResponse(u(a.responseText)?a.responseText:void 0,a.getResponseHeader("content-type")||""):b.reject(a)}},abort:function(){this._xhr.onreadystatechange=m;this._xhr.abort()},
send:function(){var a=this._opt;try{this._xhr.open(a.method,a.url,!0,a.username,a.password),this.setHeaders(),this._xhr.send(a.data)}catch(b){this._deferred.reject(b)}},destroy:function(){delete this._xhr;delete this._deferred;delete this._opt;delete this._ajax}};var B=function(a,b,d){this._opt=a;this._ajax=d;this._deferred=b};B.prototype={_opt:null,_deferred:null,_ajax:null,_el:null,send:function(){var a=document.createElement("script");a.setAttribute("async","async");a.setAttribute("charset","utf-8");
a.setAttribute("src",this._opt.url);U(a,"load",l(this.onLoad,this));U(a,"error",l(this.onError,this));document.head.appendChild(a);this._el=a},onLoad:function(a){this._deferred&&this._deferred.resolve(a)},onError:function(a){this._deferred.reject(a)},abort:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el)},destroy:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el);delete this._el;delete this._opt;delete this._ajax;delete this._deferred}};var L=function(a,
b,d){this._opt=a;this._ajax=d;this._deferred=b};L.prototype={_opt:null,_deferred:null,_ajax:null,_el:null,send:function(){var a=document.createElement("iframe"),b="frame-"+ ++f,d=this._opt.form;a.setAttribute("id",b);a.setAttribute("name",b);a.style.display="none";document.body.appendChild(a);d.setAttribute("action",this._opt.url);d.setAttribute("target",b);U(a,"load",l(this.onLoad,this));U(a,"error",l(this.onError,this));this._el=a;try{d.submit()}catch(c){this._deferred.reject(c)}},onLoad:function(){var a=
this._el;this._opt&&!this._opt.jsonp&&(a=a.contentDocument||a.contentWindow.document,a=a.body.innerHTML,this._ajax.processResponse(a))},onError:function(a){this._deferred.reject(a)},abort:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el)},destroy:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el);delete this._el;delete this._opt;delete this._ajax;delete this._deferred}};return w}(),G=F.factory,X=function(){var c={},b={};return J("MetaphorJs.data.Model",
{type:null,fields:null,record:null,store:null,plain:!1,lastAjaxResponse:null,initialize:function(a){this.fields={};D(this,{record:{load:null,save:null,"delete":null,id:null,data:null,success:null,extra:{}},store:{load:null,save:null,"delete":null,id:null,data:null,total:null,start:null,limit:null,success:null,extra:{}}},!1,!0);D(this,a,!0,!0);this.plain=!this.type},isPlain:function(){return this.plain},getRecordProp:function(a,b){return this.getProp("record",a,b)},setRecordProp:function(a,b){this.record[a]=
b},getStoreProp:function(a,b){return this.getProp("store",a,b)},setStoreProp:function(a,b){this.store[a]=b},getProp:function(a,b,c){a=this[a];return a[b]&&a[b][c]||a[c]||this[c]||null},setProp:function(a,b){return this[a]=b},_createAjaxCfg:function(a,b,c,f){var g=this,k=g[a],h=D({},u(k[b])?{url:k[b]}:k[b]),l=g.getProp(a,b,"id"),m=g.getProp(a,b,"data"),p=g.getProp(a,b,"url"),x=g.getProp(a,b,"json");if(!h)if(p)h={url:p};else throw a+"."+b+" not defined";u(h)&&(h={url:h});if(!h.url){if(!p)throw a+"."+
b+" url not defined";h.url=p}h.data=D({},h.data,g.extra,k.extra,k[b]?k[b].extra:{},!1,!0);h.method||(h.method="load"==b?"GET":"POST");c&&(h.data[l]=c);f&&(m?h.data[m]=f:h.data=f);x&&h.data&&"GET"!=h.method&&(h.data=JSON.stringify(h.data));h.callbackScope=g;"record"==a?h.processResponse=function(a,c){g.lastAjaxResponse=a;g._processRecordResponse(b,a,c)}:"store"==a&&(h.processResponse=function(a,c){g.lastAjaxResponse=a;g._processStoreResponse(b,a,c)});return h},_processRecordResponse:function(a,b,c){var f=
this.getRecordProp(a,"id"),g=this.getRecordProp(a,"data"),f=(g=g?b[g]:b)&&g[f]||b[f];this._getSuccess("record",a,b)?c.resolve({id:f,data:g}):c.reject(b)},_processStoreResponse:function(a,b,c){var f=this.getStoreProp(a,"data"),g=this.getStoreProp(a,"total"),f=f?b[f]:b,g=g?b[g]:null;this._getSuccess("store",a,b)?c.resolve({data:f,total:g}):c.reject(b)},_getSuccess:function(a,b,c){return(a=this.getProp(a,b,"success"))&&void 0!=c[a]?c[a]:!0},loadRecord:function(a){return L(this._createAjaxCfg("record",
"load",a))},saveRecord:function(a,b,c){return L(this._createAjaxCfg("record",a.getId()?"save":"create",a.getId(),D({},a.storeData(a.getData(b)),c)))},deleteRecord:function(a){return L(this._createAjaxCfg("record","delete",a.getId()))},loadStore:function(a,b){return L(D(this._createAjaxCfg("store","load"),b,!0,!0))},saveStore:function(a,b){return L(this._createAjaxCfg("store","save",null,b))},deleteRecords:function(a,b){return L(this._createAjaxCfg("store","delete",b))},getFields:function(){return this.fields},
restoreField:function(a,b,c){var f=this.fields[b];if(f){switch(u(f)?f:f.type){case "int":c=parseInt(c);break;case "bool":case "boolean":u(c)?(c=c.toLowerCase(),c=!("off"===c||"no"===c||"0"===c||"false"==c||"null"==c)):c=c?!0:!1;break;case "double":case "float":c=parseFloat(c);break;case "date":f.parseFn?c=f.parseFn(c,f.format):Date.parse?c=Date.parse(c,f.format):("timestamp"==f.format&&(c=1E3*parseInt(c)),c=new Date(c))}f.restore&&(c=f.restore.call(a,c,b))}return this.onRestoreField(a,b,c)},onRestoreField:function(a,
b,c){return c},storeField:function(a,b,c){var f=this.fields[b];if(f){switch(u(f)?f:f.type){case "bool":case "boolean":c=c?"1":"0";break;case "date":c=f.formatFn?f.formatFn(c,f.format):Date.format?Date.format(c,f.format):"timestamp"==f.format?c.getTime()/1E3:c.format?c.format(f.format):c.toString();break;default:c=c.toString()}f.store&&(c=f.store.call(a,c,b))}return this.onStoreField(a,b,c)},onStoreField:function(a,b,c){return c}},{create:function(a,b){return"MetaphorJs.data.Model"==a?G(a,b):b?G(a,
b):c[a]?c[a]:c[a]=G(a)},addToCache:function(a){var c=a.getClass(),e=a.getId();"MetaphorJs.data.Record"!=c&&(b[c]||(b[c]={}),b[c][e]=a)},getFromCache:function(a,c){return b[a]&&b[a][c]?b[a][c]:null},removeFromCache:function(a,c){b[a]&&b[a][c]&&delete b[a][c]}})}(),ma=F.isInstanceOf;J("MetaphorJs.cmp.Base",{destroyed:!1,_observable:null,initialize:function(c){c=c||{};this._observable=new ba;D(this,this._observable.getApi(),!0,!1);if(c.callback){var b=c.callback,a=b.scope||this;delete b.scope;for(var d in b)if(b.hasOwnProperty(d))this.on(d,
b[d],a);delete c.callback}D(this,c,!0,!1)},destroy:function(){if(!this.destroyed){if(!1===this.trigger("beforedestroy",this))return!1;this.onDestroy();this.destroyed=!0;this.trigger("destroy",this);this._observable.destroy();delete this._observable}},onDestroy:m});var W=J("MetaphorJs.data.Record","MetaphorJs.cmp.Base",{id:null,data:null,orig:null,modified:null,loaded:!1,dirty:!1,destroyed:!1,model:null,standalone:!0,stores:null,initialize:function(c,b,a){var d=arguments.length;1==d?(a=c,b=c=null):
2==d&&(a=b,b=null);this.data={};this.orig={};this.stores=[];this.modified={};a=a||{};this.supr(a);u(this.model)?this.model=G(this.model):ma(this.model,"MetaphorJs.data.Model")||(this.model=G("MetaphorJs.data.Model",this.model));this.id=c;b?this.importData(b):!1!==a.autoLoad&&c&&this.load();"MetaphorJs.data.Record"!=this.getClass()&&X.addToCache(this)},isLoaded:function(){return this.loaded},isStandalone:function(){return this.standalone},isDirty:function(){return this.dirty},getModel:function(){return this.model},
attachStore:function(c){c=c.getId();-1==this.stores.indexOf(c)&&this.stores.push(c)},detachStore:function(c){c=c.getId();var b;this.destroyed||-1==(b=this.stores.indexOf(c))||(this.stores.splice(b,1),0!=this.stores.length||this.standalone||this.destroy())},setDirty:function(c){this.dirty!=c&&(this.dirty=!!c,this.trigger("dirtychange",this,c))},importData:function(c){var b={},a;if(c){for(a in c)b[a]=this.model.restoreField(this,a,c[a]);this.data=b}this.orig=D({},this.data);this.modified={};this.loaded=
!0;this.setDirty(!1)},storeData:function(c){var b={},a;for(a in c)b[a]=this.model.storeField(this,a,c[a]);return b},getId:function(){return this.id},getData:function(c){if(c){var b={},a,d;c=u(c)?[c]:c;a=0;for(d=c.length;a<d;a++)b[c[a]]=this.data[c[a]];return b}return D({},this.data)},getChanged:function(){return D({},this.modified)},isChanged:function(c){return this.modified[c]||!1},get:function(c){return this.data[c]},setId:function(c){!this.id&&c&&(this.id=c)},set:function(c,b){var a=this.data[c];
b=this.model.restoreField(this,c,b);this.data[c]=b;a!=b&&(this.modified[c]=!0,this.setDirty(!0),this.trigger("change",this,c,b,a),this.trigger("change-"+c,this,c,b,a))},revert:function(){this.dirty&&(this.data=D({},this.orig),this.modified={},this.setDirty(!1))},load:function(){var c=this;c.trigger("beforeload",c);return c.model.loadRecord(c.id).done(function(b){c.setId(b.id);c.importData(b.data);c.trigger("load",c)}).fail(function(){c.trigger("failedload",c)})},save:function(c,b){var a=this;a.trigger("beforesave",
a);return a.model.saveRecord(a,c,b).done(function(b){a.setId(b.id);a.importData(b.data);a.trigger("save",a)}).fail(function(b){a.trigger("failedsave",a)})},"delete":function(){var c=this;c.trigger("beforedelete",c);return c.model.deleteRecord(c).done(function(){c.trigger("delete",c);c.destroy()}).fail(function(){c.trigger("faileddelete",c)})},reset:function(){this.id=null;this.data={};this.orig={};this.modified={};this.dirty=this.loaded=!1;this.trigger("reset",this)},destroy:function(){this.destroyed||
(this.destroyed=!0,this.trigger("destroy",this),this.stores=this.model=this.modified=this.orig=this.data=null,X.removeFromCache(this.getClass(),this.id),this.supr())}}),na=function(){var c=function(a,b,c){if(x(b))return b(a,c);if(""===b||void 0===b)return!0;if(void 0!==a){if(2===p(a))return a===b;if(b instanceof RegExp)return b.test(""+a);if("strict"==c)return""+a===""+b;if(!0===c||null===c||void 0===c)return-1!=""+a.indexOf(b);if(!1===c)return-1==""+a.indexOf(b)}return!1},b=function(a,b,f){var g=
p(a);if(3>g&&-1<g)return void 0===b.$?!0:c(a,b.$,f);var k,h;for(k in b)if("$"==k)for(h in a){if(c(a[h],b.$,f))return!0}else if(c(a[k],b[k],f))return!0;return!1},a=function(a,c,f){3!==p(c)&&(c={$:c});var g=[],k,h;k=-1;for(h=a.length;++k<h;)b(a[k],c,f)&&g.push(a[k]);return g};a.compare=b;return a}(),oa=function(c,b,a){a||(a="asc");c=c.slice();c.sort(function(a,c){var f=typeof a,g=a,k=c;if(f!=typeof c)return 0;"object"==f&&(x(b)?(g=b(a),k=b(c)):(g=a[b],k=c[b]));if("number"==typeof g)return g-k;g=(""+
g).toLowerCase();k=(""+k).toLowerCase();return g===k?0:g>k?1:-1});return"desc"==a?c.reverse():c},F=Array.prototype.indexOf;F||(F=Array.prototype.indexOf=function(c,b){var a;if(null==this)throw new TypeError('"this" is null or not defined');var d=Object(this),e=d.length>>>0;if(0===e)return-1;a=+b||0;Infinity===Math.abs(a)&&(a=0);if(a>=e)return-1;for(a=Math.max(0<=a?a:e-Math.abs(a),0);a<e;){if(a in d&&d[a]===c)return a;a++}return-1});(function(){var c={};return J("MetaphorJs.data.Store","MetaphorJs.cmp.Base",
{id:null,autoLoad:!1,clearOnLoad:!0,model:null,extraParams:null,loaded:!1,loading:!1,local:!1,items:null,current:null,map:null,currentMap:null,length:0,currentLength:0,maxLength:0,totalLength:0,start:0,pageSize:null,pages:null,filtered:!1,sorted:!1,filterBy:null,filterOpt:null,sortBy:null,sortDir:null,publicStore:!1,idProp:null,initialize:function(b,a,d){this.items=[];this.current=[];this.map={};this.currentMap={};this.loaded=!1;this.extraParams=this.extraParams||{};b&&!u(b)&&(d=a,a=b,b=null);a=a||
{};b&&(a.url=b);this.supr(a);this.id=this.id||ia();this.publicStore&&(c[this.id]=this);this.initModel(a);this.createEvent("beforeload",!1);!this.local&&this.autoLoad?this.load():d&&(5===p(d)?this._loadArray(d):this._loadAjaxData(d));this.local&&(this.loaded=!0)},initModel:function(b){u(this.model)?this.model=G(this.model):this.model instanceof X||(this.model=G("MetaphorJs.data.Model",this.model));b.url&&(this.model.store.load=b.url);this.idProp=this.model.getStoreProp("load","id")},getId:function(){return this.id},
isLoaded:function(){return this.loaded},isLocal:function(){return this.local},setLocal:function(b){this.local=!!b},isLoading:function(){return this.loading},isFiltered:function(){return this.filtered},isSorted:function(){return this.sorted},getLength:function(b){return b?this.length:this.currentLength},getTotalLength:function(){return this.totalLength||this.currentLength},getPagesCount:function(){return null!==this.pageSize?parseInt(this.totalLength/this.pageSize):1},setParam:function(b,a){this.extraParams[b]=
a},getParam:function(b){return this.extraParams[b]},setStart:function(b){this.start=b},setPageSize:function(b){this.pageSize=b},getAjaxData:function(){return this.ajaxData},hasDirty:function(b){if(this.model.isPlain())return!1;var a=!1;this.each(function(b){return b.isDirty()?(a=!0,!1):!0},null,b);return a},getDirty:function(b){var a=[];if(this.model.isPlain())return a;this.each(function(b){b.isDirty()&&a.push(b)},null,b);return a},getModel:function(){return this.model},_loadAjaxData:function(b,a){var c=
this;a=a||{};if(a.silent||!1!==c.trigger("beforeload",c))c.ajaxData=b,c.model._processStoreResponse("load",b,{resolve:function(b){c._onModelLoadSuccess(b,a)},reject:function(b){c._onModelLoadFail(b,a)}})},_loadArray:function(b,a){a=a||{};!a.silent&&!1===this.trigger("beforeload",this)||5!==p(b)||(this._load(b,a),this.totalLength=this.length)},_load:function(b,a){var c=a.prepend;a=a||{};for(var e=0;e<b.length;e++)c?this.insert(e,b[e],!0,!0):this.add(b[e],!0,!0);this.loaded=!0;this.loading=!1;this.onLoad();
a.skipUpdate||this.update();a.silent||this.trigger("load",this)},load:function(b,a){var c=this,e=c.model.store,f=e.start,e=e.limit,g=c.pageSize;a=a||{};if(c.local)return null;b=D({},c.extraParams,b||{});null===g||b[f]||b[e]||(b[f]=c.start,b[e]=g);if(!a.silent&&!1===c.trigger("beforeload",c))return null;c.loading=!0;return c.model.loadStore(c,b).done(function(b){c.ajaxData=c.model.lastAjaxResponse;c._onModelLoadSuccess(b,a)}).fail(function(b){c.ajaxData=c.model.lastAjaxResponse;c._onModelLoadFail(b,
a)})},_onModelLoadSuccess:function(b,a){this.clearOnLoad&&0<this.length&&this.clear();this.totalLength=parseInt(b.total);this._load(b.data,a)},_onModelLoadFail:function(b,a){this.onFailedLoad();a.silent||this.trigger("failedload",this,b)},onLoad:m,onFailedLoad:m,save:function(b){var a=this,c={},e=0;if(a.local)return null;if(a.model.isPlain())throw Error("Cannot save plain store");a.each(function(a){a.isDirty()&&(c[a.getId()]=a.storeData(a.getData()),e++)});if(!e)throw Error("Nothing to save");return b||
!1!==a.trigger("beforesave",a,c)?a.model.saveStore(a,c).done(function(c){a._onModelSaveSuccess(c,b)}).fail(function(c){a._onModelSaveFail(c,b)}):null},_onModelSaveSuccess:function(b,a){var c,e,f,g=b.data;if(g&&g.length)for(c=0,e=g.length;c<e;c++)f=this.getRecordId(g[c]),(f=this.getById(f))&&f.importData(g[c]);this.onSave();a||this.trigger("save",this)},_onModelSaveFail:function(b,a){this.onFailedSave(b);a||this.trigger("failedsave",this)},onSave:m,onFailedSave:m,deleteById:function(b,a,c){var e=this,
f,g,k;if(e.local)return null;if(!b||5===p(b)&&!b.length)throw Error("Record id required");5!==p(b)&&(b=[b]);f=0;for(g=b.length;f<g;f++)k=e.getById(b[f]),e.remove(k,a,c),k instanceof W&&k.destroy();return a||!1!==e.trigger("beforedelete",e,b)?e.model.deleteRecords(e,b).done(function(){e.totalLength-=b.length;e.onDelete();a||e.trigger("delete",e,b)}).fail(function(){e.onFailedDelete();a||e.trigger("faileddelete",e,b)}):null},onDelete:m,onFailedDelete:m,deleteAt:function(b,a,c){var e=this.getAt(b);if(!e)throw Error("Record not found at "+
b);return this["delete"](e,a,c)},"delete":function(b,a,c){return this.deleteById(this.getRecordId(b),a,c)},deleteRecords:function(b,a,c){var e=[],f,g;f=0;for(g=b.length;f<g;f++)e.push(this.getRecordId(b[f]));return this.deleteById(e,a,c)},loadOr:function(b,a,c){this.local||this.isLoading()||(this.isLoaded()?b&&b.call(a||this):this.load(null,c))},addNextPage:function(b){!this.local&&this.length<this.totalLength&&this.load({start:this.length,limit:this.pageSize},b)},loadNextPage:function(b){this.local||
(this.start+=this.pageSize,this.load(null,b))},loadPrevPage:function(b){this.local||(this.start-=this.pageSize,this.load(null,b))},getRecordId:function(b){return b instanceof W?b.getId():b[this.idProp]||null},getRecordData:function(b){return this.model.isPlain()?b:b.data},processRawDataItem:function(b){if(b instanceof W||this.model.isPlain())return b;var a=this.model.type,c=this.getRecordId(b),e;c&&(e=X.getFromCache(a,c));e||(e=G(a,c,b,{model:this.model,standalone:!1}));return e},bindRecord:function(b,
a){a[b]("change",this.onRecordChange,this);a[b]("destroy",this.onRecordDestroy,this);a[b]("dirtychange",this.onRecordDirtyChange,this);return a},onRecordDirtyChange:function(b){this.trigger("update",this,b)},onRecordChange:function(b,a,c,e){this.trigger("update",this,b)},onRecordDestroy:function(b){this.remove(b)},shift:function(b,a,c){return this.removeAt(0,b,a,c)},unshift:function(b,a,c){return this.insert(0,b,a,c)},pop:function(b,a,c){return this.removeAt(this.length-1,b,a,c)},addMany:function(b,
a,c){var e,f,g=this.length;e=0;for(f=b.length;e<f;e++)this.insert(g+e,b[e],!0,!0);c||this.update();0<f&&!a&&this.trigger("add",b)},add:function(b,a,c){return this.insert(this.length,b,a,c)},onAdd:m,removeAt:function(b,a,c,e){e||(b=this.items.indexOf(this.current[b]));if(b<this.length&&0<=b)return this.length--,e=this.items[b],this.items.splice(b,1),b=this.getRecordId(e),void 0!=b&&(delete this.map[b],delete this.currentMap[b]),this.onRemove(e,b),c||this.update(),a||this.trigger("remove",e,b),e instanceof
W?(this.bindRecord("un",e),e.detachStore(this),e.destroyed?void 0:e):e},onRemove:m,insertMany:function(b,a,c,e){var f,g;f=0;for(g=a.length;f<g;f++)this.insert(b+f,a[f],!0,!0);0<g&&!e&&this.update();0<g&&!c&&this.trigger("add",a)},insert:function(b,a,c,e){var f,g=!1;a=this.processRawDataItem(a);f=this.getRecordId(a);this.map[f]&&(this.suspendAllEvents(),this.removeId(f),this.resumeAllEvents());b>=this.length?(this.items.push(a),g=!0):this.items.splice(b,0,a);this.length++;this.maxLength&&this.length>
this.maxLength&&(g?this.pop(c,!0):this.shift(c,!0));void 0!=f&&(this.map[f]=a);a instanceof W&&(a.attachStore(this),this.bindRecord("on",a));this.onAdd(b,a);e||this.update();c||this.trigger("add",[a]);return a},replace:function(b,a,c,e){var f;f=this.items.indexOf(b);this.removeAt(f,!0,!0,!0);this.insert(f,a,!0,!0);e||this.update();c||this.trigger("replace",b,a);return a},onReplace:m,remove:function(b,a,c){return this.removeAt(this.indexOf(b,!0),a,c,!0)},removeId:function(b,a,c){return this.removeAt(this.indexOfId(b,
!0),a,c,!0)},contains:function(b,a){return-1!=this.indexOf(b,a)},containsId:function(b,a){return a?void 0!==this.map[b]:void 0!==this.currentMap[b]},clear:function(){var b=this.getRange();this._reset();this.onClear();this.trigger("clear",b)},onClear:m,reset:function(){this._reset()},_reset:function(b){var a,c;if(!b)for(b=0,a=this.items.length;b<a;b++)c=this.items[b],c instanceof W&&(this.bindRecord("un",c),c.detachStore(this));this.totalLength=this.currentLength=this.length=this.start=0;this.items=
[];this.current=[];this.map={};this.currentMap={};this.loaded=this.local},getAt:function(b,a){return a?this.items[b]||void 0:this.current[b]||void 0},getById:function(b,a){return a?this.map[b]||void 0:this.currentMap[b]||void 0},indexOf:function(b,a){return a?this.items.indexOf(b):this.current.indexOf(b)},indexOfId:function(b,a){return this.indexOf(this.getById(b,a),a)},each:function(b,a,c){c=c?this.items.slice():this.current.slice();for(var e=0,f=c.length;e<f&&!1!==b.call(a,c[e],e,f);e++);},eachId:function(b,
a,c){var e=this;e.each(function(c,d,k){return b.call(a,e.getRecordId(c),d,k)},null,c)},collect:function(b,a){var c=[],e=!this.model.isPlain();this.each(function(a){(a=e?a.get(b):a[b])&&c.push(a)},null,a);return c},first:function(b){return b?this.items[0]:this.current[0]},last:function(b){return b?this.items[this.length-1]:this.current[this.current-1]},getRange:function(b,a,c){c=c?this.items:this.current;var e=[];if(1>c.length)return e;b=b||0;a=Math.min(void 0==a?this.length-1:a,this.length-1);if(b<=
a)for(;b<=a;b++)e.push(c[b]);else for(;b>=a;b--)e.push(c[b]);return e},findBy:function(b,a,c,e){b=this.findIndexBy(b,a,c,e);return-1==b?void 0:this.getAt(b,e)},findIndexBy:function(b,a,c,e){e=e?this.items:this.current;c=c||0;for(var f=e.length;c<f;c++)if(b.call(a,e[c],this.getRecordId(e[c])))return c;return-1},find:function(b,a,c,e){var f=!this.model.isPlain(),g;return this.findIndexBy(function(e){g=f?e.get(b):e[b];return c?g===a:g==a},this,0,e)},findExact:function(b,a,c){return this.find(b,a,!0,
c)},findBySet:function(b,a){var c=null,e,f;this.each(function(a){e=!0;for(f in b)if(b[f]!=a[f]){e=!1;break}return e?(c=a,!1):!0},null,a);return c},update:function(){var b=this,a=b.filtered,c=b.sorted;b.currentLength=b.length;b.currentMap=b.map;b.current=b.items;if(a){var e=b.filterBy,f=b.filterOpt,g,k;b.current=g=[];b.currentMap=k={};b.each(function(a){na.compare(a.data,e,f)&&(g.push(a),k[b.getRecordId(a)]=a)},null,!0);b.currentLength=b.current.length}if(c){var h=b.sortBy,l=!b.model.isPlain();b.current=
oa(b.current,function(a){return l?a.get(h):a[h]},b.sortDir)}b.trigger("update",b)},filter:function(b,a){this.filtered=!0;this.filterBy=b;this.filterOpt=a;this.update()},clearFilter:function(){this.filtered&&(this.filterOpt=this.filterBy=null,this.update())},sort:function(b,a){this.sorted=!0;this.sortBy=b;this.sortDir=a;this.update()},clearSorting:function(){this.sorted=!1;this.sortDir=this.sortBy=null;this.update()},onDestroy:function(){delete c[this.id];this.clear();this.supr()}},{createFromSelect:function(b){var a=
[];b=b.options;for(var c=0,e=b.length;c<e;c++){var f=b[c],g=(f.hasAttribute?f.hasAttribute("value"):f.getAttributeNode("value").specified)?f.value:f.text;a.push([g,f.text])}b=G("MetaphorJs.data.Store",{server:{load:{id:0}}});b._loadArray(a);return b},lookupStore:function(b){return c[b]||null},eachStore:function(b,a){for(var d in c)if(!1===b.call(a||window,c[d]))break}})})();J("MetaphorJs.data.FirebaseStore","MetaphorJs.data.Store",{firebase:null,initialize:function(c){this.firebase=u(c)?new Firebase(c):
c;this.firebase.on("child_added",l(this.onChildAdded,this));this.firebase.on("child_removed",l(this.onChildRemoved,this));this.firebase.on("child_changed",l(this.onChildChanged,this));this.firebase.on("child_moved",l(this.onChildMoved,this));this.supr()},initModel:m,ref:function(){return this.firebase.ref?this.firebase.ref():this.firebase},load:function(){if(!this.loaded)this.firebase.once("value",l(this.onSnapshotLoaded,this))},onSnapshotLoaded:function(c){var b=this;c.forEach(function(a){b.add(a,
!0,!0)});b.update();b.loaded=!0;b.trigger("load",b)},onChildAdded:function(c,b){if(this.loaded){var a=this.indexOfId(b,!0);this.insert(a+1,c)}},onChildRemoved:function(c){this.loaded&&this.removeId(c.name())},onChildChanged:function(c,b){if(this.loaded){var a=this.getById(c.name(),!0);this.replace(a,c)}},onChildMoved:function(c,b){},getRecordId:function(c){return c.name()},getRecordData:function(c){return c.val()},processRawDataItem:function(c){return c},bindRecord:m});"undefined"!=typeof global?
global.MetaphorJs=$:window.MetaphorJs=$})();
