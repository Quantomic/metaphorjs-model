(function(){var H=Array.prototype.slice,Y=function(h){return!(!h||h.constructor!==Object)},h=function(h){return"undefined"==typeof h},p=function c(){var d=!1,a=!1,b=H.call(arguments),e=b.shift(),g,f,z;"boolean"==typeof b[b.length-1]&&(d=b.pop());"boolean"==typeof b[b.length-1]&&(a=d,d=b.pop());for(;b.length;)if(g=b.shift())for(f in g)if(g.hasOwnProperty(f)&&!h(z=g[f]))if(a)if(e[f]&&Y(e[f])&&Y(z))c(e[f],z,d,a);else{if(!0===d||h(e[f])||null===e[f])Y(z)?(e[f]={},c(e[f],z,d,!0)):e[f]=z}else if(!0===d||
h(e[f])||null===e[f])e[f]=z;return e},A=function(c){return"function"===typeof c},r=function(c){return"string"==typeof c},M=function(c){return null!=c&&"object"===typeof c},Z=function(c,d){var a={};c||(c=h(global)?window:global);this.register=function(b,e){var g;g=b;var f=g.split("."),z,n=f.pop();z=f.join(".");var u=f.length,v,x=c;if(a[z])g=[a[z],n,g];else{if(0<u)for(z=0;z<u;z++){v=f[z];if(d&&0==z)if(v==d){x=c;continue}else g=d+"."+g;h(x[v])&&(x[v]={});x=x[v]}else d&&(g=d+"."+g);g=[x,n,g]}f=g[0];n=
g[1];M(f)&&h(f[n])&&(f[n]=e,a[g[2]]=e);return e};this.exists=function(b){return!h(a[b])};this.get=function(b,e){if(!h(a[b]))return a[b];if(d&&!h(a[d+"."+b]))return a[d+"."+b];if(!e){var g=b.split("."),f,z=g.length,n,u=c;for(f=0;f<z;f++)if(n=g[f],d&&0==f&&n==d)u=c;else{if(h(u[n]))return;u=u[n]}u&&(a[b]=u);return u}};this.add=function(b,c){d&&0!==b.indexOf(d)&&(b=d+"."+b);h(a[b])&&(a[b]=c);return c};this.remove=function(b){delete a[b]}};Z.prototype={register:null,exists:null,get:null,add:null,remove:null};
var K=function(c){c||(c=new Z);var d=function(a,b){return e(function(){},a,b)},a=function(a,b,c){return function(){var e=void 0,d=this.supr;this.supr=a.prototype[b]||function(){};try{e=c.apply(this,arguments)}catch(g){}this.supr=d;return e}},b=function(b,c,e){for(var d in c)c.hasOwnProperty(d)&&(b[d]=A(c[d])&&e.prototype&&A(e.prototype[d])?a(e,d,c[d]):c[d])},e=function(a,c,e){var d=function(){};d.prototype=a.prototype;var d=new d,g=function(){e&&e.apply(this,arguments);this.initialize&&this.initialize.apply(this,
arguments)};b(d,c,a);g.prototype=d;g.prototype.constructor=g;g.prototype.getClass=function(){return this.__proto__.constructor.__class};g.prototype.getParentClass=function(){return this.__proto__.constructor.__parentClass};g.__instantiate=function(a){return function(){var b=function(){},c;b.prototype=a.prototype;b=new b;c=a.prototype.constructor.apply(b,arguments);return M(c)?c:b}}(g);return g},g=function(a,b,g,u,v,x){null===a&&(a="");A(a)?(v=g,r(b)?(v=u,u=g):(u=b,g=a,b=null),a=null):r(a)||(v=b,u=
a,a=g=b=null);r(b)||A(b)||(v=u,u=g,g=b,b=null);A(g)||(v=u,u=g,g=null);u=u||{};var h=b&&r(b)?c.get(b):b;if(b&&!h)throw Error(b+" not found");b=h?e(h,u,g):d(u,g);b.__isMetaphorClass=!0;b.__parent=h;b.__parentClass=h?h.__class:null;b.__class=c;if(v)for(var G in v)v.hasOwnProperty(G)&&(b[G]=v[G]);a&&(x?c.add(a,b):c.register(a,b));v&&v.alias&&c.add(v.alias,b);return b};this.factory=function(a){var b=c.get(a),e=H.call(arguments,1);if(!b)throw Error(a+" not found");return b.__instantiate.apply(this,e)};
this.isSubclassOf=function(a,b){var e=a,d=c.get;r(b)||(b=b.getClass?b.getClass():b.prototype.constructor.__class);for(r(a)&&(e=d(a));e;){if(e.prototype.constructor.__class==b)return!0;e&&(e=e.getParentClass?d(e.getParentClass()):e.__parent)}return!1};this.isInstanceOf=function(a,b){var e=r(b)?c.get(b):b;return e?a instanceof e:!1};this.define=g;this.defineCache=function(a,b,c,e,d){return g(a,b,c,e,d,!0)}};K.prototype={factory:null,isSubclassOf:null,isInstanceOf:null,define:null,defineCache:null};
var $={lib:{},cmp:{},view:{}},ja=new Z($,"MetaphorJs"),K=new K(ja),O=K.define,w=Function.prototype.bind?function(c,d){return c.bind(d)}:function(c,d){return function(){return c.apply(d,arguments)}},ea=function(){return String.prototype.trim?function(c){return r(c)?c.trim():c}:function(c){return r(c)?c.replace(/^\s\s*/,"").replace(/\s\s*$/,""):c}}(),ka=function(c,d,a){setTimeout(function(){c.apply(d,a||[])},0)},k=function(){},la=function(){return h(JSON)?function(c){return JSON.parse(c)}:function(c){return(new Function("return "+
c))()}}(),fa=function(c,d){var a,b;if(!c||!r(c))return null;try{b=new DOMParser,a=b.parseFromString(c,d||"text/xml")}catch(e){a=void 0}if(!a||a.getElementsByTagName("parsererror").length)throw"Invalid XML: "+c;return a},aa=function(c){if(!c||h(c.length)||r(c))return c?[c]:[];for(var d=[],a=-1,b=c.length>>>0;++a!==b;d[a]=c[a]);return d},ga=function(){var c=/^[\w[:#.][\w\]*^|=!]*$/,d=/=([^\]]+)/,a=/ *, */,b=/(\([^)]*)\+/,e=/(\[[^\]]+)~/,g=/(~|>|\+)/,f=/ +/,z=/([^[:.#]+)?(?:#([^[:.#]+))?(?:\.([^[:.]+))?(?:\[([^!&^*|$[:=]+)([!$^*|&]?=)?([^:\]]+)?\])?(?::([^(]+)(?:\(([^)]+)\))?)?/,
n=/(?:(-?\d*)n)?(?:(%|-)(\d*))?/,u=/\D/,v=/[^(]*\(([^)]*)\)/,h=/\(.*/,r=/\[([^!~^*|$ [:=]+)([$^*|]?=)?([^ :\]]+)?\]/,G=document,w=!!G.getElementsByClassName,A=!!G.querySelectorAll,I={"first-child":function(a){return a.parentNode.getElementsByTagName("*")[0]!==a},"last-child":function(a){for(;(a=a.nextSibling)&&1!=a.nodeType;);return!!a},root:function(a){return"html"!==a.nodeName.toLowerCase()},"nth-child":function(a,b){var c=a.nodeIndex||0,e=b[3]=b[3]?("%"===b[2]?-1:1)*b[3]:0,d=b[1];if(c)return!((c+
e)%d);var g=a.parentNode.firstChild;c++;do if(1==g.nodeType&&(g.nodeIndex=++c)&&a===g&&(c+e)%d)return 0;while(g=g.nextSibling);return 1},"nth-last-child":function(a,b){var c=a.nodeIndexLast||0,e=b[3]?("%"===b[2]?-1:1)*b[3]:0,d=b[1];if(c)return!((c+e)%d);var g=a.parentNode.lastChild;c++;do if(1==g.nodeType&&(g.nodeLastIndex=c++)&&a===g&&(c+e)%d)return 0;while(g=g.previousSibling);return 1},empty:function(a){return!!a.firstChild},parent:function(a){return!a.firstChild},"only-child":function(a){return 1!=
a.parentNode.getElementsByTagName("*").length},checked:function(a){return!a.checked},lang:function(a,b){return a.lang!==b&&G.documentElement.lang!==b},enabled:function(a){return a.disabled||"hidden"===a.type},disabled:function(a){return!a.disabled},selected:function(a){return!a.selected}},t={},p=function(a){return t[a]||(t[a]=new RegExp("(^| +)"+a+"($| +)"))},C={"":function(a,b){return!!a.getAttribute(b)},"=":function(a,b,c){return(b=a.getAttribute(b))&&b===c},"&=":function(a,b,c){return(b=a.getAttribute(b))&&
p(c).test(b)},"^=":function(a,b,c){return(b=a.getAttribute(b)+"")&&!b.indexOf(c)},"$=":function(a,b,c){return(b=a.getAttribute(b)+"")&&b.indexOf(c)==b.length-c.length},"*=":function(a,b,c){return(b=a.getAttribute(b)+"")&&-1!=b.indexOf(c)},"|=":function(a,b,c){return(b=a.getAttribute(b)+"")&&(b===c||!!b.indexOf(c+"-"))},"!=":function(a,b,c){return!(b=a.getAttribute(b))||!p(c).test(b)}},k=function(N,P){P=P||G;var l=[],y=null,B,k,p,m,t,D,E;if(A)try{l=aa(P.querySelectorAll(N.replace(d,'="$1"')))}catch(J){y=
!0}if(!A||y)if(c.test(N))switch(y=0,N.charAt(0)){case "#":y=N.slice(1);l=G.getElementById(y);l.id!==y&&(l=G.all[y]);l=l?[l]:[];break;case ".":B=N.slice(1);if(w)l=aa((l=P.getElementsByClassName(B)).length?l:[]);else{B=" "+B+" ";k=P.getElementsByTagName("*");for(p=0;m=k[p++];)-1!=(" "+m.className+" ").indexOf(B)&&(l[y++]=m);l=y?l:[]}break;case ":":k=P.getElementsByTagName("*");p=0;t=N.replace(v,"$1");for(D=N.replace(h,"");m=k[p++];)I[D]&&!I[D](m,t)&&(l[y++]=m);l=y?l:[];break;case "[":k=P.getElementsByTagName("*");
p=0;m=r.exec(N);B=m[1];E=m[2]||"";for(t=m[3];m=k[p++];)C[E]&&(C[E](m,B,t)||"class"===B&&C[E](m,"className",t))&&(l[y++]=m);l=y?l:[];break;default:l=aa((l=P.getElementsByTagName(N)).length?l:[])}else{for(var F=N.split(a),M=F.length-1,U=!!M,K,V,s,L,Q,R,S,T,W,q,H,O;y=F[M--];){V=(K=y.replace(b,"$1%").replace(e,"$1&").replace(g," $1 ").split(f)).length;p=0;L=" ";for(k=[P];s=K[p++];)if(" "!==s&&">"!==s&&"~"!==s&&"+"!==s&&k){s=s.match(z);Q=s[1]||"*";R=s[2];S=s[3]?" "+s[3]+" ":"";B=s[4];E=s[5]||"";D=s[7];
t="nth-child"===D||"nth-last-child"===D?n.exec("even"===s[8]&&"2n"||"odd"===s[8]&&"2n%1"||!u.test(s[8])&&"0n%"+s[8]||s[8]):s[8];T=[];y=W=0;for(H=p==V;q=k[W++];)switch(L){case " ":O=q.getElementsByTagName(Q);for(q=0;m=O[q++];)R&&m.id!==R||S&&-1==(" "+m.className+" ").indexOf(S)||!(!B||C[E]&&(C[E](m,B,s[6])||"class"===B&&C[E](m,"className",s[6])))||m.yeasss||(I[D]?I[D](m,t):D)||(H&&(m.yeasss=1),T[y++]=m);break;case "~":for(Q=Q.toLowerCase();(q=q.nextSibling)&&!q.yeasss;)1!=q.nodeType||"*"!==Q&&q.nodeName.toLowerCase()!==
Q||R&&q.id!==R||S&&-1==(" "+q.className+" ").indexOf(S)||!(!B||C[E]&&(C[E](m,B,s[6])||"class"===B&&C[E](m,"className",s[6])))||q.yeasss||(I[D]?I[D](q,t):D)||(H&&(q.yeasss=1),T[y++]=q);break;case "+":for(;(q=q.nextSibling)&&1!=q.nodeType;);!q||q.nodeName.toLowerCase()!==Q.toLowerCase()&&"*"!==Q||R&&q.id!==R||S&&-1==(" "+m.className+" ").indexOf(S)||!(!B||C[E]&&(C[E](m,B,s[6])||"class"===B&&C[E](m,"className",s[6])))||q.yeasss||(I[D]?I[D](q,t):D)||(H&&(q.yeasss=1),T[y++]=q);break;case ">":for(O=q.getElementsByTagName(Q),
p=0;m=O[p++];)m.parentNode!==q||R&&m.id!==R||S&&-1==(" "+m.className+" ").indexOf(S)||!(!B||C[E]&&(C[E](m,B,s[6])||"class"===B&&C[E](m,"className",s[6])))||m.yeasss||(I[D]?I[D](m,t):D)||(H&&(m.yeasss=1),T[y++]=m)}k=T}else L=s;if(U){if(!k.concat){T=[];for(q=0;m=k[q];)T[q++]=m;k=T}l=k.concat(1==l.length?l[0]:l)}else l=k}for(y=l.length;y--;)l[y].yeasss=l[y].nodeIndex=l[y].nodeIndexLast=null}return l};k.is=function(a,b){var c=k(b,a.parentNode),e,d;e=-1;for(d=c.length;++e<d;)if(c[e]===a)return!0;return!1};
return k}(),ma=Object.prototype.toString,ha=function(c){return"number"==typeof c&&!isNaN(c)},U=function(c){return!!(c&&M(c)&&ha(c.length)&&"[object Array]"==ma.call(c))},V=function(c,d,a){c.attachEvent?c.attachEvent("on"+d,a):c.addEventListener(d,a,!1)},na=function(){var c=["0","0","0"];return function(){for(var d=c.length,a;d;){d--;a=c[d].charCodeAt(0);if(57==a)return c[d]="A",c.join("");if(90==a)c[d]="0";else return c[d]=String.fromCharCode(a+1),c.join("")}c.unshift("0");return c.join("")}}(),ba=
function(){this.events={}};ba.prototype={createEvent:function(c,d){c=c.toLowerCase();var a=this.events;a[c]||(a[c]=new ca(c,d));return a[c]},getEvent:function(c){c=c.toLowerCase();return this.events[c]},on:function(c,d,a,b){c=c.toLowerCase();var e=this.events;e[c]||(e[c]=new ca(c));return e[c].on(d,a,b)},once:function(c,d,a,b){b=b||{};b.limit=1;return this.on(c,d,a,b)},un:function(c,d,a){c=c.toLowerCase();var b=this.events;b[c]&&b[c].un(d,a)},hasListener:function(c,d,a){c=c.toLowerCase();var b=this.events;
return b[c]?b[c].hasListener(d,a):!1},removeAllListeners:function(c){var d=this.events;d[c]&&d[c].removeAllListeners()},trigger:function(){var c=arguments[0],d=this.events,c=c.toLowerCase();if(!d[c])return null;c=d[c];return c.trigger.apply(c,H.call(arguments,1))},suspendEvent:function(c){c=c.toLowerCase();var d=this.events;d[c]&&d[c].suspend()},suspendAllEvents:function(){var c=this.events,d;for(d in c)c[d].suspend()},resumeEvent:function(c){c=c.toLowerCase();var d=this.events;d[c]&&d[c].resume()},
resumeAllEvents:function(){var c=this.events,d;for(d in c)c[d].resume()},destroyEvent:function(c){var d=this.events;d[c]&&(d[c].removeAllListeners(),d[c].destroy(),delete d[c])},destroy:function(c){var d=this.events;if(c)c=c.toLowerCase(),d[c]&&(d[c].destroy(),delete d[c]);else{for(var a in d)d[a].destroy();this.events={}}},getApi:function(){if(!this.api){for(var c="createEvent getEvent on un once hasListener removeAllListeners trigger suspendEvent suspendAllEvents resumeEvent resumeAllEvents destroyEvent".split(" "),
d={},a,b=-1,e=c.length;++b<e;a=c[b],d[a]=w(this[a],this));this.api=d}return this.api}};var ca=function(c,d){this.name=c;this.listeners=[];this.map={};this.hash=na();this.uni="$$"+c+"_"+this.hash;this.suspended=!1;this.lid=0;this.returnResult=h(d)?null:d};ca.prototype={getName:function(){return this.name},destroy:function(){this.map=this.listeners=null},on:function(c,d,a){if(!c)return null;d=d||null;a=a||{};var b=this.uni,e=d||c;if(e[b]&&!a.allowDupes)return null;var g=++this.lid,f=a.first||!1;e[b]=
g;c={fn:c,scope:d,uniScope:e,id:g,called:0,limit:a.limit||0,start:a.start||1,count:0,append:a.append,prepend:a.prepend};f?this.listeners.unshift(c):this.listeners.push(c);this.map[g]=c;return g},once:function(c,d,a){a=a||{};a.once=!0;return this.on(c,d,a)},un:function(c,d){var a=-1,b=this.uni,e=this.listeners,g;g=c==parseInt(c)?c:(d||c)[b];if(!g)return!1;for(var f=0,z=e.length;f<z;f++)if(e[f].id==g){a=f;delete e[f].uniScope[b];break}if(-1==a)return!1;e.splice(a,1);delete this.map[g];return!0},hasListener:function(c,
d){var a=this.listeners,b;if(c){d=d||c;b=A(c)?d[this.uni]:c;if(!b)return!1;for(var e=0,g=a.length;e<g;e++)if(a[e].id==b)return!0;return!1}return 0<a.length},removeAllListeners:function(){var c=this.listeners,d=this.uni,a,b;a=0;for(b=c.length;a<b;a++)delete c[a].uniScope[d];this.listeners=[];this.map={}},suspend:function(){this.suspended=!0},resume:function(){this.suspended=!1},_prepareArgs:function(c,d){var a;c.append||c.prepend?(a=H.call(d),c.prepend&&(a=c.prepend.concat(a)),c.append&&(a=a.concat(c.append))):
a=d;return a},trigger:function(){var c=this.listeners,d=this.returnResult;if(this.suspended||0==c.length)return null;for(var a="all"==d?[]:null,b,e,c="first"==d?[c[0]]:H.call(c);b=c.shift();)if(b&&this.map[b.id]&&(b.count++,!(b.count<b.start))){e=b.fn.apply(b.scope,this._prepareArgs(b,arguments));b.called++;b.called==b.limit&&this.un(b.id);"all"==d&&a.push(e);if("first"==d)return e;"last"==d&&(a=e);if(!1==d&&!1===e)break}if(d)return a}};var L=function(c){var d;return c&&(M(c)||A(c))?A(d=c.then)?d:
!1:!1},da=function(){var c=[],d=!1,a="undefined"!=typeof process?process.nextTick:function(a){setTimeout(a,0)},b=function(){d=!0;var e=c.shift();a(function(){e[0].apply(e[1],e[2]);c.length?b():d=!1},0)},e=function(a,e,g){g=g||[];c.push([a,e,g]);d||b()},g=function(a,b){return function(c){try{b.resolve(a(c))}catch(e){b.reject(e)}}},f=function(a,b){if(a instanceof f)return a;if(!(this instanceof f))return new f(a,b);this._fulfills=[];this._rejects=[];this._dones=[];this._fails=[];if(!h(a))if(L(a)||!A(a))this.resolve(a);
else try{a.call(b,w(this.resolve,this),w(this.reject,this))}catch(c){this.reject(c)}};f.prototype={_state:0,_fulfills:null,_rejects:null,_dones:null,_fails:null,_wait:0,_value:null,_reason:null,_triggered:!1,isPending:function(){return 0==this._state},isFulfilled:function(){return 1==this._state},isRejected:function(){return 2==this._state},_cleanup:function(){delete this._fulfills;delete this._rejects;delete this._dones;delete this._fails},_processValue:function(a,b){var c;if(0==this._state)if(a===
this)this._doReject(new TypeError("cannot resolve promise with itself"));else{try{if(c=L(a)){a instanceof f?a.then(w(this._processResolveValue,this),w(this._processRejectReason,this)):(new f(c,a)).then(w(this._processResolveValue,this),w(this._processRejectReason,this));return}}catch(e){0==this._state&&this._doReject(e);return}b.call(this,a)}},_callResolveHandlers:function(){this._done();for(var a=this._fulfills,b;b=a.shift();)e(b[0],b[1],[this._value]);this._cleanup()},_doResolve:function(a){this._value=
a;this._state=1;0==this._wait&&this._callResolveHandlers()},_processResolveValue:function(a){this._processValue(a,this._doResolve)},resolve:function(a){if(this._triggered)return this;this._triggered=!0;this._processResolveValue(a);return this},_callRejectHandlers:function(){this._fail();for(var a=this._rejects,b;b=a.shift();)e(b[0],b[1],[this._reason]);this._cleanup()},_doReject:function(a){this._state=2;this._reason=a;0==this._wait&&this._callRejectHandlers()},_processRejectReason:function(a){this._processValue(a,
this._doReject)},reject:function(a){if(this._triggered)return this;this._triggered=!0;this._processRejectReason(a);return this},then:function(a,b){var c=new f,d=this._state;0==d||0!=this._wait?(a&&A(a)?this._fulfills.push([g(a,c),null]):this._fulfills.push([c.resolve,c]),b&&A(b)?this._rejects.push([g(b,c),null]):this._rejects.push([c.reject,c])):1==d?a&&A(a)?e(g(a,c),null,[this._value]):c.resolve(this._value):2==d&&(b&&A(b)?e(g(b,c),null,[this._reason]):c.reject(this._reason));return c},"catch":function(a){return this.then(null,
a)},_done:function(){for(var a=this._dones,b;b=a.shift();)b[0].call(b[1]||null,this._value)},done:function(a,b){var c=this._state;1==c&&0==this._wait?a.call(b||null,this._value):0==c&&this._dones.push([a,b]);return this},_fail:function(){for(var a=this._fails,b;b=a.shift();)b[0].call(b[1]||null,this._reason)},fail:function(a,b){var c=this._state;2==c&&0==this._wait?a.call(b||null,this._reason):0==c&&this._fails.push([a,b]);return this},always:function(a,b){this.done(a,b);this.fail(a,b);return this},
promise:function(){return{then:w(this.then,this),done:w(this.done,this),fail:w(this.fail,this),always:w(this.always,this)}},after:function(a){var b=this;if(L(a)){b._wait++;var c=function(){b._wait--;0==b._wait&&0!=b._state&&(1==b._state?b._callResolveHandlers():b._callRejectHandlers())};A(a.done)?a.done(c):a.then(c)}return b}};f.resolve=function(a){return new f(a)};f.reject=function(a){var b=new f;b.reject(a);return b};f.all=function(a){if(!a.length)return f.resolve(null);var b=new f,c=a.length,e=
Array(c),d=c,g,h,k=function(a,c){e[c]=a;d--;0==d&&b.resolve(e)};for(g=0;g<c;g++)(function(c){h=a[g];h instanceof f?h.done(function(a){k(a,c)}).fail(b.reject,b):L(h)||A(h)?(new f(h)).done(function(a){k(a,c)}).fail(b.reject,b):k(h,c)})(g);return b};f.when=function(){return f.all(arguments)};f.allResolved=function(a){if(!a.length)return f.resolve(null);var b=new f,c=a.length,e=[],d=c,g,h,k=function(a){e.push(a);p()},p=function(){d--;0==d&&b.resolve(e)};for(g=0;g<c;g++)h=a[g],h instanceof f?h.done(k).fail(p):
L(h)||A(h)?(new f(h)).done(k).fail(p):k(h);return b};f.race=function(a){if(!a.length)return f.resolve(null);var b=new f,c=a.length,e,d;for(e=0;e<c&&(d=a[e],d instanceof f?d.done(b.resolve,b).fail(b.reject,b):L(d)||A(d)?(new f(d)).done(b.resolve,b).fail(b.reject,b):b.resolve(d),b.isPending());e++);return b};return f}(),W=function(){var c=/#.*$/,d=/([?&])_=[^&]*/,a=/\?/,b=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,e=/^(?:GET|HEAD)$/i,g=0,f=function(a,b,c){var e,d;if(r(a)&&c)b.push(encodeURIComponent(c)+
"="+encodeURIComponent(a));else if(U(a)&&c)for(e=0,d=a.length;e<d;e++)f(a[e],b,c+"["+e+"]");else if(M(a))for(e in a)a.hasOwnProperty(e)&&f(a[e],b,c?c+"["+e+"]":e)},z=function(b,g){b.replace(c,"");if(!1===g.cache){var l=(new Date).getTime();return d.test(b)?b.replace(d,"$1_="+l):b+(a.test(b)?"&":"?")+"_="+l}!g.data||window.FormData&&g.data instanceof window.FormData||(r(g.data)?l=g.data:(l=[],f(g.data,l,null),l=l.join("&").replace(/%20/g,"+")),g.data=l,e.test(g.method)&&(b+=(a.test(b)?"&":"?")+g.data,
g.data=null));return b},n={xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"},u={url:null,data:null,method:"GET",headers:null,username:null,password:null,cache:null,dataType:null,timeout:0,contentType:"application/x-www-form-urlencoded",xhrFields:null,jsonp:!1,jsonpParam:null,jsonpCallback:null,transport:null,replace:!1,selector:null,form:null,beforeSend:null,progress:null,uploadProgress:null,
processResponse:null,callbackScope:null},v={},x=new ba,F=function(a){var b;b=eval;a&&(/^[^\S]*use strict/.test(a)?(b=document.createElement("script"),b.text=a,document.head.appendChild(b).parentNode.removeChild(b)):b(a))},G=function(a,b,c){var e,d;if(!M(a)&&!A(a)&&c)e=document.createElement("input"),e.setAttribute("type","hidden"),e.setAttribute("name",c),e.setAttribute("value",a),b.appendChild(e);else if(U(a)&&c)for(e=0,d=a.length;e<d;e++)G(a[e],b,c+"["+e+"]");else if(M(a))for(e in a)a.hasOwnProperty(e)&&
G(a[e],b,c?c+"["+e+"]":e)},H=function(a){for(var b,c,e="",d=0;d<a.elements.length;d++)if(b=a.elements[d],b.hasAttribute("name"))if(c="INPUT"===b.nodeName.toUpperCase()?b.getAttribute("type").toUpperCase():"TEXT","FILE"===c)for(c=0;c<b.files.length;e+="&"+encodeURIComponent(b.name)+"="+encodeURIComponent(b.files[c++].name));else if("RADIO"!==c&&"CHECKBOX"!==c||b.checked)e+="&"+encodeURIComponent(b.name)+"="+encodeURIComponent(b.value);return e},L=function(a,b,c){var e=b?b.dataType:null;b=b?b.selector:
null;if(!r(a))return a;c=c||"";if("xml"===e||!e&&0<=c.indexOf("xml"))return a=fa(ea(a)),b?ga(b,a):a;if("html"===e)return a=fa(a,"text/html"),b?ga(b,a):a;if("fragment"==e){c=document.createDocumentFragment();e=document.createElement("div");for(e.innerHTML=a;e.firstChild;)c.appendChild(e.firstChild);return c}if("json"===e||!e&&0<=c.indexOf("json"))return la(ea(a));("script"===e||!e&&0<=c.indexOf("javascript"))&&F(a);return a+""},I=function(a){var c=h(window)?"":window.location.href,c=b.exec(c.toLowerCase())||
[],e=b.exec(a.url.toLowerCase());this._opt=a;a.crossDomain=!(!e||e[1]===c[1]&&e[2]===c[2]&&(e[3]||("http:"===e[1]?"80":"443"))===(c[3]||("http:"===c[1]?"80":"443")));c=new da;"iframe"!=a.transport||a.form?a.form&&(this._form=a.form,"POST"!=a.method||!h(window)&&window.FormData||"iframe"==a.transport||(a.transport="iframe")):(this.createForm(),a.form=this._form);a.form&&"iframe"!=a.transport&&(a.data="POST"==a.method?new FormData(a.form):H(a.form));a.url=z(a.url,a);e=!a.crossDomain&&"script"!=a.transport||
a.form?"iframe"==a.transport?new K(a,c,this):new J(a,c,this):new C(a,c,this);this._deferred=c;this._transport=e;c.done(function(a){x.trigger("success",a)});c.fail(function(a){x.trigger("error",a)});c.always(function(){x.trigger("end")});x.trigger("start");a.timeout&&(this._timeout=setTimeout(w(this.onTimeout,this),a.timeout));a.jsonp&&this.createJsonp();!1===x.trigger("beforeSend",a,e)&&(this._promise=da.reject());a.beforeSend&&!1===a.beforeSend.call(a.callbackScope,a,e)&&(this._promise=da.reject());
this._promise||(ka(e.send,e),c.abort=w(this.abort,this),c.always(this.destroy,this),this._promise=c)};I.prototype={_jsonpName:null,_transport:null,_opt:null,_deferred:null,_promise:null,_timeout:null,_form:null,_removeForm:!1,promise:function(){return this._promise},abort:function(a){this._transport.abort();this._deferred.reject(a||"abort")},onTimeout:function(){this.abort("timeout")},createForm:function(){var a=document.createElement("form");a.style.display="none";a.setAttribute("method",this._opt.method);
G(this._opt.data,a,null);document.body.appendChild(a);this._form=a;this._removeForm=!0},createJsonp:function(){var b=this._opt,c=b.jsonpParam||"callback",e=b.jsonpCallback||"jsonp_"+ ++g;b.url+=(a.test(b.url)?"&":"?")+c+"="+e;this._jsonpName=e;h(window)||(window[e]=w(this.jsonpCallback,this));h(global)||(global[e]=w(this.jsonpCallback,this));return e},jsonpCallback:function(a){try{this._deferred.resolve(this.processResponseData(a))}catch(b){this._deferred.reject(b)}},processResponseData:function(a,
b){var c=this._opt;a=L(a,c,b);x.hasListener("processResponse")&&(a=x.trigger("processResponse",a,this._deferred));c.processResponse&&(a=c.processResponse.call(c.callbackScope,a,this._deferred));return a},processResponse:function(a,b){var c=this._deferred;if(this._opt.jsonp)if(a){try{F(a)}catch(e){c.reject(e)}c.isPending()&&c.reject("jsonp script didn't invoke callback")}else c.reject("jsonp script is empty");else try{c.resolve(this.processResponseData(a,b))}catch(d){c.reject(d)}},destroy:function(){this._timeout&&
clearTimeout(this._timeout);this._form&&this._form.parentNode&&this._removeForm&&this._form.parentNode.removeChild(this._form);this._transport.destroy();delete this._transport;delete this._opt;delete this._deferred;delete this._promise;delete this._timeout;delete this._form;this._jsonpName&&(h(window)||delete window[this._jsonpName],h(global)||delete global[this._jsonpName])}};var t=function(a,b){b=b||{};a&&!r(a)?b=a:b.url=a;if(!b.url&&(b.form&&(b.url=b.form.getAttribute("action")),!b.url))throw"Must provide url";
p(b,v,!1,!0);p(b,u,!1,!0);b.method=b.method?b.method.toUpperCase():b.form?b.form.getAttribute("method").toUpperCase()||"GET":"GET";return(new I(b)).promise()};t.setup=function(a){p(v,a,!0,!0)};t.on=function(){x.on.apply(x,arguments)};t.un=function(){x.un.apply(x,arguments)};t.get=function(a,b){b=b||{};b.method="GET";return t(a,b)};t.post=function(a,b){b=b||{};b.method="POST";return t(a,b)};t.load=function(a,b,c){c=c||{};r(b)||(c=b);c.dataType="fragment";return t(b,c).done(function(b){if(c.replace)for(;a.firstChild;)a.removeChild(a.firstChild);
a.appendChild(b)})};t.loadScript=function(a){return t(a,{transport:"script"})};t.submit=function(a,b){b=b||{};b.form=a;return t(null,b)};var J=function(a,b,c){var e;if(!(window.XMLHttpRequest&&(e=new XMLHttpRequest)||(e=new ActiveXObject("Msxml2.XMLHTTP"))||(e=new ActiveXObject("Microsoft.XMLHTTP"))))throw"Unable to create XHR object";this._xhr=e;this._deferred=b;this._opt=a;this._ajax=c;a.progress&&V(e,"progress",w(a.progress,a.callbackScope));a.uploadProgress&&e.upload&&V(e.upload,"progress",w(a.uploadProgress,
a.callbackScope));try{var d;if(a.xhrFields)for(d in a.xhrFields)e[d]=a.xhrFields[d];a.data&&a.contentType&&e.setRequestHeader("Content-Type",a.contentType);e.setRequestHeader("X-Requested-With","XMLHttpRequest");e.setRequestHeader("Accept",a.dataType&&n[a.dataType]?n[a.dataType]+", */*; q=0.01":n._default);for(d in a.headers)e.setRequestHeader(d,a.headers[d])}catch(g){}e.onreadystatechange=w(this.onReadyStateChange,this)};J.prototype={_xhr:null,_deferred:null,_ajax:null,onReadyStateChange:function(){var a=
this._xhr,b=this._deferred;if(0===a.readyState)a.onreadystatechange=k,b.resolve(a);else if(4===a.readyState){a.onreadystatechange=k;var c;a:{try{c=!a.status&&!h(location)&&"file:"==location.protocol||200<=a.status&&300>a.status||304===a.status||1223===a.status;break a}catch(e){}c=!1}c?this._ajax.processResponse(r(a.responseText)?a.responseText:void 0,a.getResponseHeader("content-type")||""):b.reject(a)}},abort:function(){this._xhr.onreadystatechange=k;this._xhr.abort()},send:function(){var a=this._opt;
try{this._xhr.open(a.method,a.url,!0,a.username,a.password),this._xhr.send(a.data)}catch(b){this._deferred.reject(b)}},destroy:function(){delete this._xhr;delete this._deferred;delete this._opt;delete this._ajax}};var C=function(a,b,c){this._opt=a;this._ajax=c;this._deferred=b};C.prototype={_opt:null,_deferred:null,_ajax:null,_el:null,send:function(){var a=document.createElement("script");a.setAttribute("async","async");a.setAttribute("charset","utf-8");a.setAttribute("src",this._opt.url);V(a,"load",
w(this.onLoad,this));V(a,"error",w(this.onError,this));document.head.appendChild(a);this._el=a},onLoad:function(a){this._deferred&&this._deferred.resolve(a)},onError:function(a){this._deferred.reject(a)},abort:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el)},destroy:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el);delete this._el;delete this._opt;delete this._ajax;delete this._deferred}};var K=function(a,b,c){this._opt=a;this._ajax=c;this._deferred=
b};K.prototype={_opt:null,_deferred:null,_ajax:null,_el:null,send:function(){var a=document.createElement("iframe"),b="frame-"+ ++g,c=this._opt.form;a.setAttribute("id",b);a.setAttribute("name",b);a.style.display="none";document.body.appendChild(a);c.setAttribute("action",this._opt.url);c.setAttribute("target",b);V(a,"load",w(this.onLoad,this));V(a,"error",w(this.onError,this));this._el=a;try{c.submit()}catch(e){this._deferred.reject(e)}},onLoad:function(){var a=this._el;this._opt&&!this._opt.jsonp&&
(a=a.contentDocument||a.contentWindow.document,a=a.body.innerHTML,this._ajax.processResponse(a))},onError:function(a){this._deferred.reject(a)},abort:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el)},destroy:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el);delete this._el;delete this._opt;delete this._ajax;delete this._deferred}};return t}(),J=K.factory,X=function(){var c={},d={};return O("MetaphorJs.data.Model",{type:null,fields:null,record:null,
store:null,plain:!1,initialize:function(a){this.fields={};p(this,{record:{load:null,save:null,"delete":null,id:null,data:null,success:null,extra:{}},store:{load:null,save:null,"delete":null,id:null,data:null,total:null,start:null,limit:null,success:null,extra:{}}},!1,!0);p(this,a,!0,!0);this.plain=!this.type},isPlain:function(){return this.plain},getRecordProp:function(a,b){return this.getProp("record",a,b)},setRecordProp:function(a,b){this.record[a]=b},getStoreProp:function(a,b){return this.getProp("store",
a,b)},setStoreProp:function(a,b){this.store[a]=b},getProp:function(a,b,c){a=this[a];return a[b]&&a[b][c]||a[c]||this[c]||null},setProp:function(a,b){return this[a]=b},_createAjaxCfg:function(a,b,c,d){var f=this,h=f[a],n=p({},r(h[b])?{url:h[b]}:h[b]),k=f.getProp(a,b,"id"),v=f.getProp(a,b,"data"),x=f.getProp(a,b,"url"),w=f.getProp(a,b,"json");if(!n)if(x)n={url:x};else throw a+"."+b+" not defined";r(n)&&(n={url:n});if(!n.url){if(!x)throw a+"."+b+" url not defined";n.url=x}n.data=p({},n.data,f.extra,
h.extra,h[b]?h[b].extra:{},!1,!0);n.method||(n.method="load"==b?"GET":"POST");c&&(n.data[k]=c);d&&(v?n.data[v]=d:n.data=d);w&&n.data&&"GET"!=n.method&&(n.data=JSON.stringify(n.data));n.callbackScope=f;"record"==a?n.processResponse=function(a,c){f._processRecordResponse(b,a,c)}:"store"==a&&(n.processResponse=function(a,c){f._processStoreResponse(b,a,c)});return n},_processRecordResponse:function(a,b,c){var d=this.getRecordProp(a,"id"),f=this.getRecordProp(a,"data"),d=(f=f?b[f]:b)&&f[d]||b[d];this._getSuccess("record",
a,b)?c.resolve({id:d,data:f}):c.reject(b)},_processStoreResponse:function(a,b,c){var d=this.getStoreProp(a,"data"),f=this.getStoreProp(a,"total"),d=d?b[d]:b,f=f?b[f]:null;this._getSuccess("store",a,b)?c.resolve({data:d,total:f}):c.reject(b)},_getSuccess:function(a,b,c){return(a=this.getProp(a,b,"success"))&&void 0!=c[a]?c[a]:!0},loadRecord:function(a){return W(this._createAjaxCfg("record","load",a))},saveRecord:function(a,b,c){return W(this._createAjaxCfg("record",a.getId()?"save":"create",a.getId(),
p({},a.storeData(a.getData(b)),c)))},deleteRecord:function(a){return W(this._createAjaxCfg("record","delete",a.getId()))},loadStore:function(a,b){return W(p(this._createAjaxCfg("store","load"),b,!0,!0))},saveStore:function(a,b){return W(this._createAjaxCfg("store","save",null,b))},deleteRecords:function(a,b){return W(this._createAjaxCfg("store","delete",b))},getFields:function(){return this.fields},restoreField:function(a,b,c){var d=this.fields[b];if(d){switch(r(d)?d:d.type){case "int":c=parseInt(c);
break;case "bool":case "boolean":r(c)?(c=c.toLowerCase(),c=!("off"===c||"no"===c||"0"===c||"false"==c||"null"==c)):c=c?!0:!1;break;case "double":case "float":c=parseFloat(c);break;case "date":d.parseFn?c=d.parseFn(c,d.format):Date.parse?c=Date.parse(c,d.format):("timestamp"==d.format&&(c=1E3*parseInt(c)),c=new Date(c))}d.restore&&(c=d.restore.call(a,c,b))}return this.onRestoreField(a,b,c)},onRestoreField:function(a,b,c){return c},storeField:function(a,b,c){var d=this.fields[b];if(d){switch(r(d)?d:
d.type){case "bool":case "boolean":c=c?"1":"0";break;case "date":c=d.formatFn?d.formatFn(c,d.format):Date.format?Date.format(c,d.format):"timestamp"==d.format?c.getTime()/1E3:c.format?c.format(d.format):c.toString();break;default:c=c.toString()}d.store&&(c=d.store.call(a,c,b))}return this.onStoreField(a,b,c)},onStoreField:function(a,b,c){return c}},{create:function(a,b){return"MetaphorJs.data.Model"==a?J(a,b):b?J(a,b):c[a]?c[a]:c[a]=J(a)},addToCache:function(a){var b=a.getClass(),c=a.getId();"MetaphorJs.data.Record"!=
b&&(d[b]||(d[b]={}),d[b][c]=a)},getFromCache:function(a,b){return d[a]&&d[a][b]?d[a][b]:null},removeFromCache:function(a,b){d[a]&&d[a][b]&&delete d[a][b]}})}(),ia=K.isInstanceOf;O("MetaphorJs.cmp.Base",{destroyed:!1,_observable:null,initialize:function(c){c=c||{};this._observable=new ba;p(this,this._observable.getApi(),!0,!1);if(c.callback){var d=c.callback,a=d.scope||this;delete d.scope;for(var b in d)if(d.hasOwnProperty(b))this.on(b,d[b],a);delete c.callback}p(this,c,!0,!1)},destroy:function(){if(!this.destroyed){if(!1===
this.trigger("beforedestroy",this))return!1;this.onDestroy();this.destroyed=!0;this.trigger("destroy",this);this._observable.destroy();delete this._observable}},onDestroy:k});var F=O("MetaphorJs.data.Record","MetaphorJs.cmp.Base",{id:null,data:null,orig:null,modified:null,loaded:!1,dirty:!1,destroyed:!1,model:null,standalone:!0,stores:null,initialize:function(c,d,a){var b=arguments.length;1==b?(a=c,d=c=null):2==b&&(a=d,d=null);this.data={};this.orig={};this.stores=[];this.modified={};a=a||{};this.supr(a);
r(this.model)?this.model=J(this.model):ia(this.model,"MetaphorJs.data.Model")||(this.model=J("MetaphorJs.data.Model",this.model));this.id=c;d?this.importData(d):!1!==a.autoLoad&&c&&this.load();"MetaphorJs.data.Record"!=this.getClass()&&X.addToCache(this)},isLoaded:function(){return this.loaded},isStandalone:function(){return this.standalone},isDirty:function(){return this.dirty},getModel:function(){return this.model},attachStore:function(c){c=c.getId();-1==this.stores.indexOf(c)&&this.stores.push(c)},
detachStore:function(c){c=c.getId();var d;this.destroyed||-1==(d=this.stores.indexOf(c))||(this.stores.splice(d,1),0!=this.stores.length||this.standalone||this.destroy())},setDirty:function(c){this.dirty!=c&&(this.dirty=!!c,this.trigger("dirtychange",this,c))},importData:function(c){var d={},a;if(c){for(a in c)d[a]=this.model.restoreField(this,a,c[a]);this.data=d}this.orig=p({},this.data);this.modified={};this.loaded=!0;this.setDirty(!1)},storeData:function(c){var d={},a;for(a in c)d[a]=this.model.storeField(this,
a,c[a]);return d},getId:function(){return this.id},getData:function(c){if(c){var d={},a,b;c=r(c)?[c]:c;a=0;for(b=c.length;a<b;a++)d[c[a]]=this.data[c[a]];return d}return p({},this.data)},getChanged:function(){return p({},this.modified)},isChanged:function(c){return this.modified[c]||!1},get:function(c){return this.data[c]},setId:function(c){!this.id&&c&&(this.id=c)},set:function(c,d){var a=this.data[c];d=this.model.restoreField(this,c,d);this.data[c]=d;a!=d&&(this.modified[c]=!0,this.setDirty(!0),
this.trigger("change",this,c,d,a),this.trigger("change-"+c,this,c,d,a))},revert:function(){this.dirty&&(this.data=p({},this.orig),this.modified={},this.setDirty(!1))},load:function(){var c=this;c.trigger("beforeload",c);return c.model.loadRecord(c.id).done(function(d){c.setId(d.id);c.importData(d.data);c.trigger("load",c)}).fail(function(){c.trigger("failedload",c)})},save:function(c,d){var a=this;a.trigger("beforesave",a);return a.model.saveRecord(a,c,d).done(function(b){a.setId(b.id);a.importData(b.data);
a.trigger("save",a)}).fail(function(b){a.trigger("failedsave",a)})},"delete":function(){var c=this;c.trigger("beforedelete",c);return c.model.deleteRecord(c).done(function(){c.trigger("delete",c);c.destroy()}).fail(function(){c.trigger("faileddelete",c)})},reset:function(){this.id=null;this.data={};this.orig={};this.modified={};this.dirty=this.loaded=!1;this.trigger("reset",this)},destroy:function(){this.destroyed||(this.destroyed=!0,this.trigger("destroy",this),this.stores=this.model=this.modified=
this.orig=this.data=null,X.removeFromCache(this.getClass(),this.id),this.supr())}});(function(){var c=0,d={};return O("MetaphorJs.data.Store","MetaphorJs.cmp.Base",{id:null,autoLoad:!1,clearOnLoad:!0,model:null,extraParams:null,loaded:!1,loading:!1,local:!1,items:null,map:null,keys:null,length:0,totalLength:0,start:0,pageSize:null,pages:null,filtered:!1,filterBackup:null,filterFn:null,filterScope:null,filterParams:null,initialize:function(a,b,e){this.items=[];this.map={};this.keys=[];this.loaded=
!1;this.extraParams=this.extraParams||{};a&&!r(a)&&(e=b,b=a,a=null);b=b||{};this.supr(b);this.id=this.id||++c;d[this.id]=this;r(this.model)?this.model=J(this.model):ia(this.model,X)||(this.model=J("MetaphorJs.data.Model",this.model));if(a||b.url)this.model.store.load=a||b.url;!this.local&&this.autoLoad?this.load():e&&(U(e)?this.loadArray(e):this.loadAjaxData(e));this.local&&(this.loaded=!0)},getId:function(){return this.id},isLoaded:function(){return this.loaded},isLocal:function(){return this.local},
setLocal:function(a){this.local=!!a},isLoading:function(){return this.loading},isFiltered:function(){return this.filtered},getLength:function(){return this.length},getTotalLength:function(){return this.filtered?this.length:this.totalLength||this.length},getPagesCount:function(){return null!==this.pageSize?parseInt(this.totalLength/this.pageSize):1},setParam:function(a,b){this.extraParams[a]=b},getParam:function(a){return this.extraParams[a]},setStart:function(a){this.start=a},setPageSize:function(a){this.pageSize=
a},getAjaxData:function(){return this.ajaxData},hasDirty:function(){if(this.model.isPlain())return!1;var a=!1;this.each(function(b){return b.isDirty()?(a=!0,!1):!0});return a},getDirty:function(){var a=[];if(this.model.isPlain())return a;this.each(function(b){b.isDirty()&&a.push(b)});return a},getModel:function(){return this.model},importData:function(a){this.suspendAllEvents();for(var b=0;b<a.length;b++)this.add(a[b]);this.resumeAllEvents();this.loaded=!0;this.loading=!1;this.onLoad();this.trigger("load",
this)},load:function(a){var b=this,c=b.model.store,d=c.start,c=c.limit;if(b.local)return null;a=p({},b.extraParams,a||{});null===b.pageSize||a[d]||a[c]||(a[d]=b.start,a[c]=b.pageSize);return!1===b.trigger("beforeload",b)?null:b.model.loadStore(b,a).done(function(a){b.totalLength=parseInt(a.total);b.importData(a.data);b.totalLength=parseInt(a.total)}).fail(function(a){b.onFailedLoad();b.trigger("failedload",b,a)})},onLoad:k,onFailedLoad:k,save:function(){var a=this,b={},c=0;if(a.local)return null;
if(a.model.isPlain())throw Error("Cannot save plain store");a.each(function(a){a.isDirty()&&(b[a.getId()]=a.storeData(a.getData()),c++)});if(!c)throw Error("Nothing to save");return!1===a.trigger("beforesave",a,b)?null:a.model.saveStore(a,b).done(function(b){var c,e,d=b.data;if(d&&d.length)for(b=0,c=d.length;b<c;b++)e=a.getRecordId(d[b]),(e=a.getById(e))&&e.importData(d[b]);a.onSave();a.trigger("save",a)}).fail(function(){a.onFailedSave();a.trigger("failedsave",a)})},onSave:k,onFailedSave:k,deleteById:function(a){var b=
this,c,d,f;if(b.local)return null;if(!a||U(a)&&!a.length)throw Error("Record id required");U(a)||(a=[a]);c=0;for(d=a.length;c<d;c++)f=b.getById(a[c]),f instanceof F?f.destroy():b.removeId(a[c]);return!1===b.trigger("beforedelete",b,a)?null:b.model.deleteRecords(b,a).done(function(){b.onDelete();b.trigger("delete",b,a)}).fail(function(){b.onFailedDelete();b.trigger("faileddelete",b,a)})},onDelete:k,onFailedDelete:k,deleteAt:function(a){var b=this.getAt(a);if(!b)throw Error("Record not found at "+a);
return this.deleteRecord(b)},"delete":function(a){return this.deleteById(this.getRecordId(a))},deleteRecords:function(a){var b=[],c,d;c=0;for(d=a.length;c<d;c++)b.push(this.getRecordId(a[c]));return this.deleteById(b)},loadAjaxData:function(a){var b=this;!1!==b.trigger("beforeload",b)&&b.model._processStoreResponse("load",a,{resolve:function(a,c){b.importData(a);b.totalLength=parseInt(c)},reject:function(){}})},loadArray:function(a,b){!1!==this.trigger("beforeload",this)&&(!b&&this.clearOnLoad&&0<
this.length&&this.clear(),U(a)&&(this.importData(a),this.totalLength=this.length))},loadOr:function(a,b){this.local||this.isLoading()||(this.isLoaded()?a&&a.call(b||this):this.load())},addNextPage:function(){!this.local&&this.length<this.totalLength&&this.load({start:this.length,limit:this.pageSize},!0)},loadNextPage:function(){this.local||(this.start+=this.pageSize,this.load())},loadPrevPage:function(){this.local||(this.start-=this.pageSize,this.load())},getRecordId:function(a){return a instanceof
F?a.getId():a[this.model.getStoreProp("load","id")]||null},processRawDataItem:function(a){if(a instanceof F||this.model.isPlain())return a;var b=this.model.type,c=this.getRecordId(a),d;c&&(d=X.getFromCache(b,c));d||(d=J(b,c,a,{model:this.model,standalone:!1}));return d},bindRecord:function(a,b){b[a]("change",this.onRecordChange,this);b[a]("destroy",this.onRecordDestroy,this);b[a]("dirtychange",this.onRecordDirtyChange,this);return b},onRecordDirtyChange:function(a){this.trigger("update",this,a)},
onRecordChange:function(a,b,c,d){this.trigger("update",this,a)},onRecordDestroy:function(a){this.remove(a)},add:function(a,b,c){if(this.filtered)throw"Cannot add to filtered store";if(!r(a)&&!ha(a)){b=a;if(U(b)){if(!b.length)return;a=this.length;for(var d=0,f=b.length;d<f;d++)b[d]=this.processRawDataItem(b[d]),this.add(this.getRecordId(b[d]),b[d],!0);this.onAdd(a,b);c||this.trigger("add",a,b);return}b=this.processRawDataItem(b);a=this.getRecordId(b)}if(!h(a)&&null!==a){if(!h(this.map[a])){this.replace(a,
b);return}this.map[a]=b}this.length++;this.items.push(b);this.keys.push(a);b instanceof F&&(b.attachStore(this),this.bindRecord("on",b));this.onAdd(this.length-1,[b]);c||this.trigger("add",this.length-1,[b])},onAdd:k,removeAt:function(a){if(a<this.length&&0<=a){this.length--;this.totalLength--;var b=this.items[a];this.items.splice(a,1);var c=this.keys[a];h(c)||delete this.map[c];this.keys.splice(a,1);this.onRemove(b,c);this.trigger("remove",b,c);return b instanceof F?(this.bindRecord("un",b),b.detachStore(this),
null):b}return!1},onRemove:k,insert:function(a,b,c,d){if(this.filtered)throw Error("Cannot insert into filtered store");2==arguments.length&&(c=arguments[1],b=this.getRecordId(c));c=this.processRawDataItem(c);this.containsId(b)&&(this.suspendAllEvents(),this.removeId(b),this.resumeAllEvents());if(a>=this.length)return this.add(b,c,d);this.length++;this.items.splice(a,0,c);h(b)||null===b||(this.map[b]=c);this.keys.splice(a,0,b);c instanceof F&&(c.attachStore(this),this.bindRecord("on",c));this.onAdd(a,
[c]);d||this.trigger("add",a,[c]);return c},replace:function(a,b){var c,d;1==arguments.length&&(b=arguments[0],a=this.getRecordId(b));b=this.processRawDataItem(b);c=this.map[a];if(h(a)||null===a||h(c))return this.add(a,b);c instanceof F&&(this.bindRecord("un",c),c.detachStore(this));d=this.indexOfId(a);this.items[d]=b;this.map[a]=b;b instanceof F&&(this.bindRecord("on",b),b.attachStore(this));this.onReplace(a,c,b);this.trigger("replace",a,c,b);return b},onReplace:k,remove:function(a){return this.removeAt(this.indexOf(a))},
removeId:function(a){return this.removeAt(this.indexOfId(a))},contains:function(a){return-1!=this.indexOf(a)},containsId:function(a){return!h(this.map[a])},clear:function(){var a=this.getRange();this.clearFilter(!0);this._reset();this.onClear();this.trigger("clear",a)},onClear:k,reset:function(){this._reset()},_reset:function(a){var b,c;if(!a)for(a=0,b=this.items.length;a<b;a++)c=this.items[a],c instanceof F&&(this.bindRecord("un",c),c.detachStore(this));this.totalLength=this.length=this.start=0;
this.items=[];this.keys=[];this.map={};this.loaded=this.local},filter:function(a,b,c){this.filtered&&this.clearFilter(!0);this.filtered=!0;this.filterFn=a;this.filterScope=b;this.filterParams=c;this.trigger("beforefilter",this);this.suspendAllEvents();this.filterBackup={length:this.length,items:this.items,keys:this.keys,map:this.map};this._reset(!0);a=this.filterBackup.keys;b=this.filterBackup.items;c=0;for(var d=b.length;c<d;c++)this._filterRecord(b[c],a[c])&&(this.items.push(b[c]),this.keys.push(a[c]),
this.length++,this.map[a[c]]=b[c]);this.resumeAllEvents();this.onFilter();this.trigger("filter",this)},onFilter:k,_filterRecord:function(a,b){return this.filtered&&this.filterFn.call(this.filterScope,a,b,this.filterParams)},clearFilter:function(a){this.filtered&&(a||this.trigger("beforeclearfilter",this),this.suspendAllEvents(),this.filtered=!1,this._reset(!0),this.length=this.filterBackup.length,this.items=this.filterBackup.items,this.keys=this.filterBackup.keys,this.map=this.filterBackup.map,this.filterBackup=
null,this.resumeAllEvents(),this.onClearFilter(),a||this.trigger("clearfilter",this))},onClearFilter:k,getAt:function(a){return this.items[a]||null},getById:function(a){return this.map[a]||null},indexOf:function(a){return this.items.indexOf(a)},indexOfId:function(a){return this.keys.indexOf(a)},each:function(a,b){var c=[].concat(this.items);b=b||window;for(var d=0,f=c.length;d<f&&!1!==a.call(b,c[d],d,f);d++);},eachId:function(a,b){b=b||window;for(var c=0,d=this.keys.length;c<d;c++)a.call(b,this.keys[c],
this.items[c],c,d)},collect:function(a){var b=[],c=!this.model.isPlain();this.each(function(d){(d=c?d.get(a):d[a])&&b.push(d)});return b},first:function(){return this.items[0]},last:function(){return this.items[this.length-1]},getRange:function(a,b){var c=this.items;if(1>c.length)return[];a=a||0;b=Math.min(h(b)||null===b?this.length-1:b,this.length-1);var d,f=[];if(a<=b)for(d=a;d<=b;d++)f[f.length]=c[d];else for(d=a;d>=b;d--)f[f.length]=c[d];return f},findBy:function(a,b,c){a=this.findIndexBy(a,b,
c);return-1==a?null:this.getAt(a)},findIndexBy:function(a,b,c){b=b||this;var d=this.keys,f=this.items;c=c||0;for(var h=f.length;c<h;c++)if(a.call(b,f[c],d[c]))return c;return-1},find:function(a,b,c){var d=!this.model.isPlain(),f;return this.findIndexBy(function(h){f=d?h.get(a):h[a];return c?f===b:f==b},this)},findExact:function(a,b){return this.find(a,b,!0)},findBySet:function(a){var b=null,c,d;this.each(function(f){c=!0;for(d in a)if(a[d]!=f[d]){c=!1;break}return c?(b=f,!1):!0});return b},onDestroy:function(){delete d[this.id];
this.clear();this.supr()}},{createFromSelect:function(a){var b=[];a=a.options;for(var c=0,d=a.length;c<d;c++){var f=a[c],h=(f.hasAttribute?f.hasAttribute("value"):f.getAttributeNode("value").specified)?f.value:f.text;b.push([h,f.text])}a=J("MetaphorJs.data.Store",{server:{load:{id:0}}});a.loadArray(b);return a},lookupStore:function(a){return d[a]||null},eachStore:function(a,b){for(var c in d)if(!1===a.call(b||window,d[c]))break}})})();"undefined"!=typeof global?global.MetaphorJs=$:window.MetaphorJs=
$})();
