define("metaphorjs-model",["metaphorjs-ajax","metaphorjs-promise","metaphorjs-namespace","metaphorjs-class","metaphorjs"],function(r,x,E,F,v){var t=v.cs.define,n=v.cs.factory,y=v.cs.isInstanceOf,u=Function.prototype.bind?function(l,b){return l.bind(b)}:function(l,b){return function(){return l.apply(b,arguments)}},z=Object.prototype.toString,l=function(){var l={"[object String]":0,"[object Number]":1,"[object Boolean]":2,"[object Object]":3,"[object Function]":4,"[object Array]":5,"[object RegExp]":9,
"[object Date]":10};return function(b){if(!b){if(null===b)return 6;if(void 0===b)return 7}var a=l[z.call(b)];if(void 0===a)return-1;1==a&&isNaN(b)&&(a=8);return a}}(),q=function(m){return 0===l(m)},m=function(){},A=Array.prototype.slice,p=function b(){var a=!1,c=!1,d=A.call(arguments),e=d.shift(),g,f,h;2===l(d[d.length-1])&&(a=d.pop());2===l(d[d.length-1])&&(c=a,a=d.pop());for(;d.length;)if(g=d.shift())for(f in g)if(g.hasOwnProperty(f)&&void 0!==(h=g[f]))if(c)if(e[f]&&3===l(e[f])&&3===l(h))b(e[f],
h,a,c);else{if(!0===a||void 0==e[f])3===l(h)?(e[f]={},b(e[f],h,a,!0)):e[f]=h}else if(!0===a||void 0==e[f])e[f]=h;return e},w=function(){var b={},a={};return t("MetaphorJs.data.Model",{type:null,fields:null,record:null,store:null,plain:!1,lastAjaxResponse:null,initialize:function(a){this.fields={};p(this,{record:{load:null,save:null,"delete":null,id:null,data:null,success:null,extra:{}},store:{load:null,save:null,"delete":null,id:null,data:null,total:null,start:null,limit:null,success:null,extra:{}}},
!1,!0);p(this,a,!0,!0);this.plain=!this.type},isPlain:function(){return this.plain},getRecordProp:function(a,d){return this.getProp("record",a,d)},setRecordProp:function(a,d){this.record[a]=d},getStoreProp:function(a,d){return this.getProp("store",a,d)},setStoreProp:function(a,d){this.store[a]=d},getProp:function(a,d,e){a=this[a];return a[d]&&a[d][e]||a[e]||this[e]||null},setProp:function(a,d){return this[a]=d},_createAjaxCfg:function(a,d,e,b){var f=this,h=f[a],k=p({},q(h[d])?{url:h[d]}:h[d]),l=f.getProp(a,
d,"id"),m=f.getProp(a,d,"data"),n=f.getProp(a,d,"url"),r=f.getProp(a,d,"json");if(!k)if(n)k={url:n};else throw a+"."+d+" not defined";q(k)&&(k={url:k});if(!k.url){if(!n)throw a+"."+d+" url not defined";k.url=n}k.data=p({},k.data,f.extra,h.extra,h[d]?h[d].extra:{},!1,!0);k.method||(k.method="load"==d?"GET":"POST");e&&(k.data[l]=e);b&&(m?k.data[m]=b:k.data=b);r&&k.data&&"GET"!=k.method&&(k.data=JSON.stringify(k.data));k.callbackScope=f;"record"==a?k.processResponse=function(a,c){f.lastAjaxResponse=
a;f._processRecordResponse(d,a,c)}:"store"==a&&(k.processResponse=function(a,c){f.lastAjaxResponse=a;f._processStoreResponse(d,a,c)});return k},_processRecordResponse:function(a,d,e){var b=this.getRecordProp(a,"id"),f=this.getRecordProp(a,"data"),b=(f=f?d[f]:d)&&f[b]||d[b];this._getSuccess("record",a,d)?e.resolve({id:b,data:f}):e.reject(d)},_processStoreResponse:function(a,d,e){var b=this.getStoreProp(a,"data"),f=this.getStoreProp(a,"total"),b=b?d[b]:d,f=f?d[f]:null;this._getSuccess("store",a,d)?
e.resolve({data:b,total:f}):e.reject(d)},_getSuccess:function(a,d,e){return(a=this.getProp(a,d,"success"))&&void 0!=e[a]?e[a]:!0},loadRecord:function(a){return r(this._createAjaxCfg("record","load",a))},saveRecord:function(a,d,e){return r(this._createAjaxCfg("record",a.getId()?"save":"create",a.getId(),p({},a.storeData(a.getData(d)),e)))},deleteRecord:function(a){return r(this._createAjaxCfg("record","delete",a.getId()))},loadStore:function(a,d){return r(p(this._createAjaxCfg("store","load"),d,!0,
!0))},saveStore:function(a,d){return r(this._createAjaxCfg("store","save",null,d))},deleteRecords:function(a,d){return r(this._createAjaxCfg("store","delete",d))},getFields:function(){return this.fields},restoreField:function(a,d,e){var b=this.fields[d];if(b){switch(q(b)?b:b.type){case "int":e=parseInt(e);break;case "bool":case "boolean":q(e)?(e=e.toLowerCase(),e=!("off"===e||"no"===e||"0"===e||"false"==e||"null"==e)):e=e?!0:!1;break;case "double":case "float":e=parseFloat(e);break;case "date":b.parseFn?
e=b.parseFn(e,b.format):Date.parse?e=Date.parse(e,b.format):("timestamp"==b.format&&(e=1E3*parseInt(e)),e=new Date(e))}b.restore&&(e=b.restore.call(a,e,d))}return this.onRestoreField(a,d,e)},onRestoreField:function(a,d,e){return e},storeField:function(a,d,e){var b=this.fields[d];if(b){switch(q(b)?b:b.type){case "bool":case "boolean":e=e?"1":"0";break;case "date":e=b.formatFn?b.formatFn(e,b.format):Date.format?Date.format(e,b.format):"timestamp"==b.format?e.getTime()/1E3:e.format?e.format(b.format):
e.toString();break;default:e=e.toString()}b.store&&(e=b.store.call(a,e,d))}return this.onStoreField(a,d,e)},onStoreField:function(a,d,e){return e}},{create:function(a,d){return"MetaphorJs.data.Model"==a?n(a,d):d?n(a,d):b[a]?b[a]:b[a]=n(a)},addToCache:function(c){var d=c.getClass(),e=c.getId();"MetaphorJs.data.Record"!=d&&(a[d]||(a[d]={}),a[d][e]=c)},getFromCache:function(c,d){return a[c]&&a[c][d]?a[c][d]:null},removeFromCache:function(c,d){a[c]&&a[c][d]&&delete a[c][d]}})}();t("MetaphorJs.cmp.Base",
{destroyed:!1,_observable:null,initialize:function(b){b=b||{};this._observable=new Observable;p(this,this._observable.getApi(),!0,!1);if(b.callback){var a=b.callback,c=a.scope||this;delete a.scope;for(var d in a)if(a.hasOwnProperty(d))this.on(d,a[d],c);delete b.callback}p(this,b,!0,!1)},destroy:function(){if(!this.destroyed){if(!1===this.trigger("beforedestroy",this))return!1;this.onDestroy();this.destroyed=!0;this.trigger("destroy",this);this._observable.destroy();delete this._observable}},onDestroy:m});
var s=t("MetaphorJs.data.Record","MetaphorJs.cmp.Base",{id:null,data:null,orig:null,modified:null,loaded:!1,dirty:!1,destroyed:!1,model:null,standalone:!0,stores:null,initialize:function(b,a,c){var d=arguments.length;1==d?(c=b,a=b=null):2==d&&(c=a,a=null);this.data={};this.orig={};this.stores=[];this.modified={};c=c||{};this.supr(c);q(this.model)?this.model=n(this.model):y(this.model,"MetaphorJs.data.Model")||(this.model=n("MetaphorJs.data.Model",this.model));this.id=b;a?this.importData(a):!1!==c.autoLoad&&
b&&this.load();"MetaphorJs.data.Record"!=this.getClass()&&w.addToCache(this)},isLoaded:function(){return this.loaded},isStandalone:function(){return this.standalone},isDirty:function(){return this.dirty},getModel:function(){return this.model},attachStore:function(b){b=b.getId();-1==this.stores.indexOf(b)&&this.stores.push(b)},detachStore:function(b){b=b.getId();var a;this.destroyed||-1==(a=this.stores.indexOf(b))||(this.stores.splice(a,1),0!=this.stores.length||this.standalone||this.destroy())},setDirty:function(b){this.dirty!=
b&&(this.dirty=!!b,this.trigger("dirtychange",this,b))},importData:function(b){var a={},c;if(b){for(c in b)a[c]=this.model.restoreField(this,c,b[c]);this.data=a}this.orig=p({},this.data);this.modified={};this.loaded=!0;this.setDirty(!1)},storeData:function(b){var a={},c;for(c in b)a[c]=this.model.storeField(this,c,b[c]);return a},getId:function(){return this.id},getData:function(b){if(b){var a={},c,d;b=q(b)?[b]:b;c=0;for(d=b.length;c<d;c++)a[b[c]]=this.data[b[c]];return a}return p({},this.data)},
getChanged:function(){return p({},this.modified)},isChanged:function(b){return this.modified[b]||!1},get:function(b){return this.data[b]},setId:function(b){!this.id&&b&&(this.id=b)},set:function(b,a){var c=this.data[b];a=this.model.restoreField(this,b,a);this.data[b]=a;c!=a&&(this.modified[b]=!0,this.setDirty(!0),this.trigger("change",this,b,a,c),this.trigger("change-"+b,this,b,a,c))},revert:function(){this.dirty&&(this.data=p({},this.orig),this.modified={},this.setDirty(!1))},load:function(){var b=
this;b.trigger("beforeload",b);return b.model.loadRecord(b.id).done(function(a){b.setId(a.id);b.importData(a.data);b.trigger("load",b)}).fail(function(){b.trigger("failedload",b)})},save:function(b,a){var c=this;c.trigger("beforesave",c);return c.model.saveRecord(c,b,a).done(function(a){c.setId(a.id);c.importData(a.data);c.trigger("save",c)}).fail(function(a){c.trigger("failedsave",c)})},"delete":function(){var b=this;b.trigger("beforedelete",b);return b.model.deleteRecord(b).done(function(){b.trigger("delete",
b);b.destroy()}).fail(function(){b.trigger("faileddelete",b)})},reset:function(){this.id=null;this.data={};this.orig={};this.modified={};this.dirty=this.loaded=!1;this.trigger("reset",this)},destroy:function(){this.destroyed||(this.destroyed=!0,this.trigger("destroy",this),this.stores=this.model=this.modified=this.orig=this.data=null,w.removeFromCache(this.getClass(),this.id),this.supr())}}),B=function(){var b=["0","0","0"];return function(){for(var a=b.length,c;a;){a--;c=b[a].charCodeAt(0);if(57==
c)return b[a]="A",b.join("");if(90==c)b[a]="0";else return b[a]=String.fromCharCode(c+1),b.join("")}b.unshift("0");return b.join("")}}(),C=function(){var b=function(a,c,b){if("function"==typeof c)return c(a,b);if(""===c||void 0===c)return!0;if(void 0!==a){if(2===l(a))return a===c;if(c instanceof RegExp)return c.test(""+a);if("strict"==b)return""+a===""+c;if(!0===b||null===b||void 0===b)return-1!=""+a.indexOf(c);if(!1===b)return-1==""+a.indexOf(c)}return!1},a=function(a,c,g){var f=l(a);if(3>f&&-1<
f)return void 0===c.$?!0:b(a,c.$,g);var h,k;for(h in c)if("$"==h)for(k in a){if(b(a[k],c.$,g))return!0}else if(b(a[h],c[h],g))return!0;return!1},c=function(c,e,b){3!==l(e)&&(e={$:e});var f=[],h,k;h=-1;for(k=c.length;++h<k;)a(c[h],e,b)&&f.push(c[h]);return f};c.compare=a;return c}(),D=function(b,a,c){c||(c="asc");b=b.slice();b.sort(function(c,e){var b=typeof c,f=c,h=e;if(b!=typeof e)return 0;"object"==b&&("function"==typeof a?(f=a(c),h=a(e)):(f=c[a],h=e[a]));if("number"==typeof f)return f-h;f=(""+
f).toLowerCase();h=(""+h).toLowerCase();return f===h?0:f>h?1:-1});return"desc"==c?b.reverse():b};x=Array.prototype.indexOf;x||(x=Array.prototype.indexOf=function(b,a){var c;if(null==this)throw new TypeError('"this" is null or not defined');var d=Object(this),e=d.length>>>0;if(0===e)return-1;c=+a||0;Infinity===Math.abs(c)&&(c=0);if(c>=e)return-1;for(c=Math.max(0<=c?c:e-Math.abs(c),0);c<e;){if(c in d&&d[c]===b)return c;c++}return-1});(function(){var b={};return t("MetaphorJs.data.Store","MetaphorJs.cmp.Base",
{id:null,autoLoad:!1,clearOnLoad:!0,model:null,extraParams:null,loaded:!1,loading:!1,local:!1,items:null,current:null,map:null,currentMap:null,length:0,currentLength:0,maxLength:0,totalLength:0,start:0,pageSize:null,pages:null,filtered:!1,sorted:!1,filterBy:null,filterOpt:null,sortBy:null,sortDir:null,publicStore:!1,idProp:null,initialize:function(a,c,d){this.items=[];this.current=[];this.map={};this.currentMap={};this.loaded=!1;this.extraParams=this.extraParams||{};a&&!q(a)&&(d=c,c=a,a=null);c=c||
{};a&&(c.url=a);this.supr(c);this.id=this.id||B();this.publicStore&&(b[this.id]=this);this.initModel(c);this.createEvent("beforeload",!1);!this.local&&this.autoLoad?this.load():d&&(5===l(d)?this._loadArray(d):this._loadAjaxData(d));this.local&&(this.loaded=!0)},initModel:function(a){q(this.model)?this.model=n(this.model):this.model instanceof w||(this.model=n("MetaphorJs.data.Model",this.model));a.url&&(this.model.store.load=a.url);this.idProp=this.model.getStoreProp("load","id")},getId:function(){return this.id},
isLoaded:function(){return this.loaded},isLocal:function(){return this.local},setLocal:function(a){this.local=!!a},isLoading:function(){return this.loading},isFiltered:function(){return this.filtered},isSorted:function(){return this.sorted},getLength:function(a){return a?this.length:this.currentLength},getTotalLength:function(){return this.totalLength||this.currentLength},getPagesCount:function(){return null!==this.pageSize?parseInt(this.totalLength/this.pageSize):1},setParam:function(a,c){this.extraParams[a]=
c},getParam:function(a){return this.extraParams[a]},setStart:function(a){this.start=a},setPageSize:function(a){this.pageSize=a},getAjaxData:function(){return this.ajaxData},hasDirty:function(a){if(this.model.isPlain())return!1;var c=!1;this.each(function(a){return a.isDirty()?(c=!0,!1):!0},null,a);return c},getDirty:function(a){var c=[];if(this.model.isPlain())return c;this.each(function(a){a.isDirty()&&c.push(a)},null,a);return c},getModel:function(){return this.model},_loadAjaxData:function(a,c){var d=
this;c=c||{};if(c.silent||!1!==d.trigger("beforeload",d))d.ajaxData=a,d.model._processStoreResponse("load",a,{resolve:function(a){d._onModelLoadSuccess(a,c)},reject:function(a){d._onModelLoadFail(a,c)}})},_loadArray:function(a,c){c=c||{};!c.silent&&!1===this.trigger("beforeload",this)||5!==l(a)||(this._load(a,c),this.totalLength=this.length)},_load:function(a,c){var d=c.prepend;c=c||{};for(var e=0;e<a.length;e++)d?this.insert(e,a[e],!0,!0):this.add(a[e],!0,!0);this.loaded=!0;this.loading=!1;this.onLoad();
c.skipUpdate||this.update();c.silent||this.trigger("load",this)},load:function(a,c){var d=this,e=d.model.store,b=e.start,e=e.limit,f=d.pageSize;c=c||{};if(d.local)return null;a=p({},d.extraParams,a||{});null===f||a[b]||a[e]||(a[b]=d.start,a[e]=f);if(!c.silent&&!1===d.trigger("beforeload",d))return null;d.loading=!0;return d.model.loadStore(d,a).done(function(a){d.ajaxData=d.model.lastAjaxResponse;d._onModelLoadSuccess(a,c)}).fail(function(a){d.ajaxData=d.model.lastAjaxResponse;d._onModelLoadFail(a,
c)})},_onModelLoadSuccess:function(a,c){this.clearOnLoad&&0<this.length&&this.clear();this.totalLength=parseInt(a.total);this._load(a.data,c)},_onModelLoadFail:function(a,c){this.onFailedLoad();c.silent||this.trigger("failedload",this,a)},onLoad:m,onFailedLoad:m,save:function(a){var c=this,d={},b=0;if(c.local)return null;if(c.model.isPlain())throw Error("Cannot save plain store");c.each(function(a){a.isDirty()&&(d[a.getId()]=a.storeData(a.getData()),b++)});if(!b)throw Error("Nothing to save");return a||
!1!==c.trigger("beforesave",c,d)?c.model.saveStore(c,d).done(function(d){c._onModelSaveSuccess(d,a)}).fail(function(d){c._onModelSaveFail(d,a)}):null},_onModelSaveSuccess:function(a,c){var d,b,g,f=a.data;if(f&&f.length)for(d=0,b=f.length;d<b;d++)g=this.getRecordId(f[d]),(g=this.getById(g))&&g.importData(f[d]);this.onSave();c||this.trigger("save",this)},_onModelSaveFail:function(a,c){this.onFailedSave(a);c||this.trigger("failedsave",this)},onSave:m,onFailedSave:m,deleteById:function(a,c,d){var b=this,
g,f,h;if(b.local)return null;if(!a||5===l(a)&&!a.length)throw Error("Record id required");5!==l(a)&&(a=[a]);g=0;for(f=a.length;g<f;g++)h=b.getById(a[g]),b.remove(h,c,d),h instanceof s&&h.destroy();return c||!1!==b.trigger("beforedelete",b,a)?b.model.deleteRecords(b,a).done(function(){b.totalLength-=a.length;b.onDelete();c||b.trigger("delete",b,a)}).fail(function(){b.onFailedDelete();c||b.trigger("faileddelete",b,a)}):null},onDelete:m,onFailedDelete:m,deleteAt:function(a,c,d){var b=this.getAt(a);if(!b)throw Error("Record not found at "+
a);return this["delete"](b,c,d)},"delete":function(a,c,d){return this.deleteById(this.getRecordId(a),c,d)},deleteRecords:function(a,c,d){var b=[],g,f;g=0;for(f=a.length;g<f;g++)b.push(this.getRecordId(a[g]));return this.deleteById(b,c,d)},loadOr:function(a,c,d){this.local||this.isLoading()||(this.isLoaded()?a&&a.call(c||this):this.load(null,d))},addNextPage:function(a){!this.local&&this.length<this.totalLength&&this.load({start:this.length,limit:this.pageSize},a)},loadNextPage:function(a){this.local||
(this.start+=this.pageSize,this.load(null,a))},loadPrevPage:function(a){this.local||(this.start-=this.pageSize,this.load(null,a))},getRecordId:function(a){return a instanceof s?a.getId():a[this.idProp]||null},getRecordData:function(a){return this.model.isPlain()?a:a.data},processRawDataItem:function(a){if(a instanceof s||this.model.isPlain())return a;var c=this.model.type,d=this.getRecordId(a),b;d&&(b=w.getFromCache(c,d));b||(b=n(c,d,a,{model:this.model,standalone:!1}));return b},bindRecord:function(a,
c){c[a]("change",this.onRecordChange,this);c[a]("destroy",this.onRecordDestroy,this);c[a]("dirtychange",this.onRecordDirtyChange,this);return c},onRecordDirtyChange:function(a){this.trigger("update",this,a)},onRecordChange:function(a,c,b,e){this.trigger("update",this,a)},onRecordDestroy:function(a){this.remove(a)},shift:function(a,c,b){return this.removeAt(0,a,c,b)},unshift:function(a,c,b){return this.insert(0,a,c,b)},pop:function(a,c,b){return this.removeAt(this.length-1,a,c,b)},addMany:function(a,
c,b){var e,g,f=this.length;e=0;for(g=a.length;e<g;e++)this.insert(f+e,a[e],!0,!0);b||this.update();0<g&&!c&&this.trigger("add",a)},add:function(a,c,b){return this.insert(this.length,a,c,b)},onAdd:m,removeAt:function(a,c,b,e){e||(a=this.items.indexOf(this.current[a]));if(a<this.length&&0<=a)return this.length--,e=this.items[a],this.items.splice(a,1),a=this.getRecordId(e),void 0!=a&&(delete this.map[a],delete this.currentMap[a]),this.onRemove(e,a),b||this.update(),c||this.trigger("remove",e,a),e instanceof
s?(this.bindRecord("un",e),e.detachStore(this),e.destroyed?void 0:e):e},onRemove:m,insertMany:function(a,c,b,e){var g,f;g=0;for(f=c.length;g<f;g++)this.insert(a+g,c[g],!0,!0);0<f&&!e&&this.update();0<f&&!b&&this.trigger("add",c)},insert:function(a,c,b,e){var g,f=!1;c=this.processRawDataItem(c);g=this.getRecordId(c);this.map[g]&&(this.suspendAllEvents(),this.removeId(g),this.resumeAllEvents());a>=this.length?(this.items.push(c),f=!0):this.items.splice(a,0,c);this.length++;this.maxLength&&this.length>
this.maxLength&&(f?this.pop(b,!0):this.shift(b,!0));void 0!=g&&(this.map[g]=c);c instanceof s&&(c.attachStore(this),this.bindRecord("on",c));this.onAdd(a,c);e||this.update();b||this.trigger("add",[c]);return c},replace:function(a,c,b,e){var g;g=this.items.indexOf(a);this.removeAt(g,!0,!0,!0);this.insert(g,c,!0,!0);e||this.update();b||this.trigger("replace",a,c);return c},onReplace:m,remove:function(a,c,b){return this.removeAt(this.indexOf(a,!0),c,b,!0)},removeId:function(a,c,b){return this.removeAt(this.indexOfId(a,
!0),c,b,!0)},contains:function(a,c){return-1!=this.indexOf(a,c)},containsId:function(a,c){return c?void 0!==this.map[a]:void 0!==this.currentMap[a]},clear:function(){var a=this.getRange();this._reset();this.onClear();this.trigger("clear",a)},onClear:m,reset:function(){this._reset()},_reset:function(a){var c,b;if(!a)for(a=0,c=this.items.length;a<c;a++)b=this.items[a],b instanceof s&&(this.bindRecord("un",b),b.detachStore(this));this.totalLength=this.currentLength=this.length=this.start=0;this.items=
[];this.current=[];this.map={};this.currentMap={};this.loaded=this.local},getAt:function(a,c){return c?this.items[a]||void 0:this.current[a]||void 0},getById:function(a,c){return c?this.map[a]||void 0:this.currentMap[a]||void 0},indexOf:function(a,c){return c?this.items.indexOf(a):this.current.indexOf(a)},indexOfId:function(a,c){return this.indexOf(this.getById(a,c),c)},each:function(a,c,b){b=b?this.items.slice():this.current.slice();for(var e=0,g=b.length;e<g&&!1!==a.call(c,b[e],e,g);e++);},eachId:function(a,
c,b){var e=this;e.each(function(b,d,h){return a.call(c,e.getRecordId(b),d,h)},null,b)},collect:function(a,c){var b=[],e=!this.model.isPlain();this.each(function(c){(c=e?c.get(a):c[a])&&b.push(c)},null,c);return b},first:function(a){return a?this.items[0]:this.current[0]},last:function(a){return a?this.items[this.length-1]:this.current[this.current-1]},getRange:function(a,c,b){b=b?this.items:this.current;var e=[];if(1>b.length)return e;a=a||0;c=Math.min(void 0==c?this.length-1:c,this.length-1);if(a<=
c)for(;a<=c;a++)e.push(b[a]);else for(;a>=c;a--)e.push(b[a]);return e},findBy:function(a,c,b,e){a=this.findIndexBy(a,c,b,e);return-1==a?void 0:this.getAt(a,e)},findIndexBy:function(a,c,b,e){e=e?this.items:this.current;b=b||0;for(var g=e.length;b<g;b++)if(a.call(c,e[b],this.getRecordId(e[b])))return b;return-1},find:function(a,c,b,e){var g=!this.model.isPlain(),f;return this.findIndexBy(function(e){f=g?e.get(a):e[a];return b?f===c:f==c},this,0,e)},findExact:function(a,b,d){return this.find(a,b,!0,
d)},findBySet:function(a,b){var d=null,e,g;this.each(function(b){e=!0;for(g in a)if(a[g]!=b[g]){e=!1;break}return e?(d=b,!1):!0},null,b);return d},update:function(){var a=this,b=a.filtered,d=a.sorted;a.currentLength=a.length;a.currentMap=a.map;a.current=a.items;if(b){var e=a.filterBy,g=a.filterOpt,f,h;a.current=f=[];a.currentMap=h={};a.each(function(b){C.compare(b.data,e,g)&&(f.push(b),h[a.getRecordId(b)]=b)},null,!0);a.currentLength=a.current.length}if(d){var k=a.sortBy,l=!a.model.isPlain();a.current=
D(a.current,function(a){return l?a.get(k):a[k]},a.sortDir)}a.trigger("update",a)},filter:function(a,b){this.filtered=!0;this.filterBy=a;this.filterOpt=b;this.update()},clearFilter:function(){this.filtered&&(this.filterOpt=this.filterBy=null,this.update())},sort:function(a,b){this.sorted=!0;this.sortBy=a;this.sortDir=b;this.update()},clearSorting:function(){this.sorted=!1;this.sortDir=this.sortBy=null;this.update()},onDestroy:function(){delete b[this.id];this.clear();this.supr()}},{createFromSelect:function(a){var b=
[];a=a.options;for(var d=0,e=a.length;d<e;d++){var g=a[d],f=(g.hasAttribute?g.hasAttribute("value"):g.getAttributeNode("value").specified)?g.value:g.text;b.push([f,g.text])}a=n("MetaphorJs.data.Store",{server:{load:{id:0}}});a._loadArray(b);return a},lookupStore:function(a){return b[a]||null},eachStore:function(a,c){for(var d in b)if(!1===a.call(c||window,b[d]))break}})})();t("MetaphorJs.data.FirebaseStore","MetaphorJs.data.Store",{firebase:null,initialize:function(b){this.firebase=q(b)?new Firebase(b):
b;this.firebase.on("child_added",u(this.onChildAdded,this));this.firebase.on("child_removed",u(this.onChildRemoved,this));this.firebase.on("child_changed",u(this.onChildChanged,this));this.firebase.on("child_moved",u(this.onChildMoved,this));this.supr()},initModel:m,ref:function(){return this.firebase.ref?this.firebase.ref():this.firebase},load:function(){if(!this.loaded)this.firebase.once("value",u(this.onSnapshotLoaded,this))},onSnapshotLoaded:function(b){var a=this;b.forEach(function(b){a.add(b,
!0,!0)});a.update();a.loaded=!0;a.trigger("load",a)},onChildAdded:function(b,a){if(this.loaded){var c=this.indexOfId(a,!0);this.insert(c+1,b)}},onChildRemoved:function(b){this.loaded&&this.removeId(b.name())},onChildChanged:function(b,a){if(this.loaded){var c=this.getById(b.name(),!0);this.replace(c,b)}},onChildMoved:function(b,a){},getRecordId:function(b){return b.name()},getRecordData:function(b){return b.val()},processRawDataItem:function(b){return b},bindRecord:m});return v.data});
