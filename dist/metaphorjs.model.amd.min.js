'use strict';define("metaphorjs-model",["metaphorjs-ajax","metaphorjs-promise","metaphorjs-namespace","metaphorjs-class","metaphorjs"],function(C,D,s,J,t){function v(c){return"object"==typeof c&&3===y(c)&&!c.nodeType&&c.constructor===Object}function z(c){return!0===c||!1===c}function r(c){return"string"==typeof c||c===""+c}function u(c){return"function"==typeof c}function m(){}function w(c){return"object"==typeof c&&5===y(c)}function E(c,a,b){b||(b="asc");c=c.slice();c.sort(function(b,d){var c=typeof b,
f=b,h=d;if(c!=typeof d)return 0;"object"==c&&(u(a)?(f=a(b),h=a(d)):(f=b[a],h=d[a]));if("number"==typeof f)return f-h;f=(""+f).toLowerCase();h=(""+h).toLowerCase();return f===h?0:f>h?1:-1});return"desc"==b?c.reverse():c}var A=t.cs.define,x=t.cs.factory,F=Array.prototype.slice,G=Object.prototype.toString,y=function(){var c={"[object String]":0,"[object Number]":1,"[object Boolean]":2,"[object Object]":3,"[object Function]":4,"[object Array]":5,"[object RegExp]":9,"[object Date]":10};return function(a){if(!a){if(null===
a)return 6;if(void 0===a)return 7}var b=c[G.call(a)];return void 0===b?-1:1==b&&isNaN(a)?8:b}}(),p=function(){return function a(){var b=!1,e=!1,d=F.call(arguments),g=d.shift(),f,h,l;z(d[d.length-1])&&(b=d.pop());z(d[d.length-1])&&(e=b,b=d.pop());for(;d.length;)if(f=d.shift())for(h in f)if(f.hasOwnProperty(h)&&void 0!==(l=f[h]))if(e)if(g[h]&&v(g[h])&&v(l))a(g[h],l,b,e);else{if(!0===b||void 0==g[h])v(l)?(g[h]={},a(g[h],l,b,!0)):g[h]=l}else if(!0===b||void 0==g[h])g[h]=l;return g}}(),n=function(){var c=
{},a={};return A({$class:"MetaphorJs.Model",type:null,fields:null,record:null,store:null,plain:!1,lastAjaxResponse:null,$init:function(b){this.fields={};p(this,{record:{load:null,save:null,"delete":null,id:null,data:null,success:null,extra:{}},store:{load:null,save:null,"delete":null,id:null,data:null,total:null,start:null,limit:null,success:null,extra:{}}},!1,!0);p(this,b,!0,!0);this.plain=!this.type},isPlain:function(){return this.plain},getRecordProp:function(b,a){return this.getProp("record",
b,a)},setRecordProp:function(b,a){this.record[b]=a},getStoreProp:function(b,a){return this.getProp("store",b,a)},setStoreProp:function(b,a){this.store[b]=a},getProp:function(b,a,d){b=this[b];return b[a]&&b[a][d]||b[d]||this[d]||null},setProp:function(b,a){return this[b]=a},_makeRequest:function(a,e,d,c,f){var h=this,l=h[a],k=p({},r(l[e])||u(l[e])?{url:l[e]}:l[e]),m=h.getProp(a,e,"id"),n=h.getProp(a,e,"data"),q=h.getProp(a,e,"url"),t=h.getProp(a,e,"json");if(!k)if(q)k={url:q};else throw a+"."+e+" not defined";
if(r(k)||u(k))k={url:k};if(!k.url){if(!q)throw a+"."+e+" url not defined";k.url=q}k.data=p({},k.data,h.extra,l.extra,l[e]?l[e].extra:{},f,!0,!0);if(u(k.url)){d=k.url(k.data);var s=new D;d.then(function(d){"record"==a?h._processRecordResponse(e,d,s):"store"==a&&h._processStoreResponse(e,d,s)});return s}k.method||(k.method="load"==e?"GET":"POST");d&&(k.data[m]=d);c&&(n?k.data[n]=c:k.data=c);t&&k.data&&"GET"!=k.method&&(k.data=JSON.stringify(k.data));k.callbackScope=h;"record"==a?k.processResponse=function(a,
b){h.lastAjaxResponse=a;h._processRecordResponse(e,a,b)}:"store"==a&&(k.processResponse=function(a,b){h.lastAjaxResponse=a;h._processStoreResponse(e,a,b)});return C(k)},_processRecordResponse:function(a,e,d){var c=this.getRecordProp(a,"id"),f=this.getRecordProp(a,"data"),c=(f=f?e[f]:e)&&f[c]||e[c];this._getSuccess("record",a,e)?d.resolve({id:c,data:f}):d.reject(e)},_processStoreResponse:function(a,e,d){var c=this.getStoreProp(a,"data"),f=this.getStoreProp(a,"total"),c=c?e[c]:e,f=f?e[f]:null;this._getSuccess("store",
a,e)?d.resolve({data:c,total:f}):d.reject(e)},_getSuccess:function(a,e,d){return(a=this.getProp(a,e,"success"))&&void 0!=d[a]?d[a]:!0},loadRecord:function(a){return this._makeRequest("record","load",a)},saveRecord:function(a,e,d){return this._makeRequest("record",a.getId()?"save":"create",a.getId(),p({},a.storeData(a.getData(e)),d))},deleteRecord:function(a){return this._makeRequest("record","delete",a.getId())},loadStore:function(a,e){return this._makeRequest("store","load",null,null,e)},saveStore:function(a,
e){return this._makeRequest("store","save",null,e)},deleteRecords:function(a,e){return this._makeRequest("store","delete",e)},getFields:function(){return this.fields},restoreField:function(a,e,d){var c=this.fields[e];if(c){switch(r(c)?c:c.type){case "int":d=parseInt(d);break;case "bool":case "boolean":r(d)?(d=d.toLowerCase(),d=!("off"===d||"no"===d||"0"===d||"false"==d||"null"==d)):d=d?!0:!1;break;case "double":case "float":d=parseFloat(d);break;case "date":c.parseFn?d=c.parseFn(d,c.format):Date.parse?
d=Date.parse(d,c.format):("timestamp"==c.format&&(d=1E3*parseInt(d)),d=new Date(d))}c.restore&&(d=c.restore.call(a,d,e))}return this.onRestoreField(a,e,d)},onRestoreField:function(a,e,d){return d},storeField:function(a,e,d){var c=this.fields[e];if(c){switch(r(c)?c:c.type){case "bool":case "boolean":d=d?"1":"0";break;case "date":d=c.formatFn?c.formatFn(d,c.format):Date.format?Date.format(d,c.format):"timestamp"==c.format?d.getTime()/1E3:d.format?d.format(c.format):d.toString();break;default:d=d.toString()}c.store&&
(d=c.store.call(a,d,e))}return this.onStoreField(a,e,d)},onStoreField:function(a,e,d){return d}},{create:function(a,e){return"MetaphorJs.Model"==a?x(a,e):e?x(a,e):c[a]?c[a]:c[a]=x(a)},addToCache:function(b){var e=b.$getClass(),d=b.getId();"MetaphorJs.Record"!=e&&(a[e]||(a[e]={}),a[e][d]=b)},getFromCache:function(b,e){return a[b]&&a[b][e]?a[b][e]:null},removeFromCache:function(b,e){a[b]&&a[b][e]&&delete a[b][e]}})}();t={};var B=(new s(t,"MetaphorJs")).add("mixin.Observable",{$$observable:null,$beforeInit:function(c){this.$$observable=
new Observable;if(c&&c.callback){var a=c.callback,b=a.context,e;a.context=null;for(e in a)if(a[e])this.$$observable.on(e,a[e],b||this);c.callback=null}},on:function(){var c=this.$$observable;return c.on.apply(c,arguments)},un:function(){var c=this.$$observable;return c.un.apply(c,arguments)},once:function(){var c=this.$$observable;return c.once.apply(c,arguments)},trigger:function(){var c=this.$$observable;return c.trigger.apply(c,arguments)},$beforeDestroy:function(){this.$$observable.trigger("beforedestroy",
this)},$afterDestroy:function(){this.$$observable.trigger("destroy",this);this.$$observable.destroy();this.$$observable=null}}),q=A({$class:"MetaphorJs.Record",$mixins:[B],id:null,data:null,orig:null,modified:null,loaded:!1,dirty:!1,model:null,standalone:!0,stores:null,$init:function(c,a,b){var e=arguments.length;1==e?(b=c,a=c=null):2==e&&(b=a,a=null);this.data={};this.orig={};this.stores=[];this.modified={};b=b||{};this.$super(b);r(this.model)?this.model=n.create(this.model):this.model instanceof
n||(this.model=new n(this.model));this.id=c;a?this.importData(a):!1!==b.autoLoad&&c&&this.load();"MetaphorJs.Record"!=this.$getClass()&&n.addToCache(this)},isLoaded:function(){return this.loaded},isStandalone:function(){return this.standalone},isDirty:function(){return this.dirty},getModel:function(){return this.model},attachStore:function(c){c=c.getId();-1==this.stores.indexOf(c)&&this.stores.push(c)},detachStore:function(c){c=c.getId();var a;this.$destroyed||-1==(a=this.stores.indexOf(c))||(this.stores.splice(a,
1),0!=this.stores.length||this.standalone||this.$destroy())},setDirty:function(c){this.dirty!=c&&(this.dirty=!!c,this.trigger("dirtychange",this,c))},importData:function(c){var a={},b;if(c){for(b in c)a[b]=this.model.restoreField(this,b,c[b]);this.data=a}this.orig=p({},this.data);this.modified={};this.loaded=!0;this.setDirty(!1)},storeData:function(c){var a={},b;for(b in c)a[b]=this.model.storeField(this,b,c[b]);return a},getId:function(){return this.id},getData:function(c){if(c){var a={},b,e;c=r(c)?
[c]:c;b=0;for(e=c.length;b<e;b++)a[c[b]]=this.data[c[b]];return a}return p({},this.data)},getChanged:function(){return p({},this.modified)},isChanged:function(c){return this.modified[c]||!1},get:function(c){return this.data[c]},setId:function(c){!this.id&&c&&(this.id=c)},set:function(c,a){var b=this.data[c];a=this.model.restoreField(this,c,a);this.data[c]=a;b!=a&&(this.modified[c]=!0,this.setDirty(!0),this.trigger("change",this,c,a,b),this.trigger("change-"+c,this,c,a,b))},revert:function(){this.dirty&&
(this.data=p({},this.orig),this.modified={},this.setDirty(!1))},load:function(){var c=this;c.trigger("beforeload",c);return c.model.loadRecord(c.id).done(function(a){c.setId(a.id);c.importData(a.data);c.trigger("load",c)}).fail(function(){c.trigger("failedload",c)})},save:function(c,a){var b=this;b.trigger("beforesave",b);return b.model.saveRecord(b,c,a).done(function(a){b.setId(a.id);b.importData(a.data);b.trigger("save",b)}).fail(function(a){b.trigger("failedsave",b)})},"delete":function(){var c=
this;c.trigger("beforedelete",c);return c.model.deleteRecord(c).done(function(){c.trigger("delete",c);c.$destroy()}).fail(function(){c.trigger("faileddelete",c)})},reset:function(){this.id=null;this.data={};this.orig={};this.modified={};this.dirty=this.loaded=!1;this.trigger("reset",this)},destroy:function(){n.removeFromCache(this.$getClass(),this.id);this.$super()}}),H=function(){var c=["0","0","0"];return function(){for(var a=c.length,b;a;){a--;b=c[a].charCodeAt(0);if(57==b)return c[a]="A",c.join("");
if(90==b)c[a]="0";else return c[a]=String.fromCharCode(b+1),c.join("")}c.unshift("0");return c.join("")}}(),I=function(){var c=function(a,b,c){if(u(b))return b(a,c);if(""===b||void 0===b)return!0;if(void 0!==a){if(z(a))return a===b;if(b instanceof RegExp)return b.test(""+a);if("strict"==c)return""+a===""+b;if(!0===c||null===c||void 0===c)return-1!=""+a.indexOf(b);if(!1===c)return-1==""+a.indexOf(b)}return!1},a=function(a,b,g){var f=y(a);if(3>f&&-1<f)return void 0===b.$?!0:c(a,b.$,g);var h,l;for(h in b)if("$"==
h)for(l in a){if(c(a[l],b.$,g))return!0}else if(c(a[h],b[h],g))return!0;return!1},b=function(b,d,c){v(d)||(d={$:d});var f=[],h,l;h=-1;for(l=b.length;++h<l;)a(b[h],d,c)&&f.push(b[h]);return f};b.compare=a;return b}();s=Array.prototype.indexOf;s||(s=Array.prototype.indexOf=function(c,a){var b;if(null==this)throw new TypeError('"this" is null or not defined');var e=Object(this),d=e.length>>>0;if(0===d)return-1;b=+a||0;Infinity===Math.abs(b)&&(b=0);if(b>=d)return-1;for(b=Math.max(0<=b?b:d-Math.abs(b),
0);b<d;){if(b in e&&e[b]===c)return b;b++}return-1});(function(){var c={};return A({$class:"MetaphorJs.Store",$mixins:[B],id:null,autoLoad:!1,clearOnLoad:!0,model:null,extraParams:null,loaded:!1,loading:!1,local:!1,items:null,current:null,map:null,currentMap:null,length:0,currentLength:0,maxLength:0,totalLength:0,start:0,pageSize:null,pages:null,filtered:!1,sorted:!1,filterBy:null,filterOpt:null,sortBy:null,sortDir:null,publicStore:!1,idProp:null,$init:function(a,b,e){this.items=[];this.current=[];
this.map={};this.currentMap={};this.loaded=!1;this.extraParams=this.extraParams||{};a&&!r(a)&&(e=b,b=a,a=null);b=b||{};a&&(b.url=a);this.$super(b);p(this,b,!0,!1);this.id=this.id||H();this.publicStore&&(c[this.id]=this);this.initModel(b);this.$$observable.createEvent("beforeload",!1);!this.local&&this.autoLoad?this.load():e&&(w(e)?this._loadArray(e):this._loadAjaxData(e));this.local&&(this.loaded=!0)},initModel:function(a){r(this.model)?this.model=n.create(this.model):this.model instanceof n||(this.model=
new n(this.model));a.url&&(this.model.store.load=a.url);this.idProp=this.model.getStoreProp("load","id")},getId:function(){return this.id},isLoaded:function(){return this.loaded},isLocal:function(){return this.local},setLocal:function(a){this.local=!!a},isLoading:function(){return this.loading},isFiltered:function(){return this.filtered},isSorted:function(){return this.sorted},getLength:function(a){return a?this.length:this.currentLength},getTotalLength:function(){return this.totalLength||this.currentLength},
getPagesCount:function(){return null!==this.pageSize?parseInt(this.totalLength/this.pageSize):1},setParam:function(a,b){this.extraParams[a]=b},getParam:function(a){return this.extraParams[a]},setStart:function(a){this.start=a},setPageSize:function(a){this.pageSize=a},getAjaxData:function(){return this.ajaxData},hasDirty:function(a){if(this.model.isPlain())return!1;var b=!1;this.each(function(a){return a.isDirty()?(b=!0,!1):!0},null,a);return b},getDirty:function(a){var b=[];if(this.model.isPlain())return b;
this.each(function(a){a.isDirty()&&b.push(a)},null,a);return b},getModel:function(){return this.model},_loadAjaxData:function(a,b){var e=this;b=b||{};if(b.silent||!1!==e.trigger("beforeload",e))e.ajaxData=a,e.model._processStoreResponse("load",a,{resolve:function(a){e._onModelLoadSuccess(a,b)},reject:function(a){e._onModelLoadFail(a,b)}})},_loadArray:function(a,b){b=b||{};(b.silent||!1!==this.trigger("beforeload",this))&&w(a)&&(this._load(a,b),this.totalLength=this.length)},_load:function(a,b){var e=
b.prepend;b=b||{};for(var d=0;d<a.length;d++)e?this.insert(d,a[d],!0,!0):this.add(a[d],!0,!0);this.loaded=!0;this.loading=!1;this.trigger("loadingend",this);this.onLoad();b.skipUpdate||this.update();b.silent||this.trigger("load",this)},load:function(a,b){var e=this,d=e.model.store,c=d.start,d=d.limit,f=e.pageSize;b=b||{};if(e.local)return null;a=p({},e.extraParams,a||{});null===f||a[c]||a[d]||(c&&(a[c]=e.start),d&&(a[d]=f));if(!b.silent&&!1===e.trigger("beforeload",e))return null;e.loading=!0;e.trigger("loadingstart",
e);return e.model.loadStore(e,a).done(function(a){e.ajaxData=e.model.lastAjaxResponse;e._onModelLoadSuccess(a,b)}).fail(function(a){e.ajaxData=e.model.lastAjaxResponse;e._onModelLoadFail(a,b)})},_onModelLoadSuccess:function(a,b){b=b||{};if(!b.noopOnEmpty||a.data.length)!b.prepend&&!b.append&&this.clearOnLoad&&0<this.length&&this.clear(!0),this.totalLength=parseInt(a.total),this._load(a.data,b)},_onModelLoadFail:function(a,b){this.onFailedLoad();b.silent||this.trigger("failedload",this,a)},onLoad:m,
onFailedLoad:m,save:function(a){var b=this,e={},d=0;if(b.local)return null;if(b.model.isPlain())throw Error("Cannot save plain store");b.each(function(a){a.isDirty()&&(e[a.getId()]=a.storeData(a.getData()),d++)});if(!d)throw Error("Nothing to save");return a||!1!==b.trigger("beforesave",b,e)?b.model.saveStore(b,e).done(function(e){b._onModelSaveSuccess(e,a)}).fail(function(e){b._onModelSaveFail(e,a)}):null},_onModelSaveSuccess:function(a,b){var e,d,c,f=a.data;if(f&&f.length)for(e=0,d=f.length;e<d;e++)c=
this.getRecordId(f[e]),(c=this.getById(c))&&c.importData(f[e]);this.onSave();b||this.trigger("save",this)},_onModelSaveFail:function(a,b){this.onFailedSave(a);b||this.trigger("failedsave",this)},onSave:m,onFailedSave:m,deleteById:function(a,b,e){var c=this,g,f,h;if(c.local)return null;if(!a||w(a)&&!a.length)throw Error("Record id required");w(a)||(a=[a]);g=0;for(f=a.length;g<f;g++)h=c.getById(a[g]),c.remove(h,b,e),h instanceof q&&h.$destroy();return b||!1!==c.trigger("beforedelete",c,a)?c.model.deleteRecords(c,
a).done(function(){c.totalLength-=a.length;c.onDelete();b||c.trigger("delete",c,a)}).fail(function(){c.onFailedDelete();b||c.trigger("faileddelete",c,a)}):null},onDelete:m,onFailedDelete:m,deleteAt:function(a,b,c){var d=this.getAt(a);if(!d)throw Error("Record not found at "+a);return this["delete"](d,b,c)},"delete":function(a,b,c){return this.deleteById(this.getRecordId(a),b,c)},deleteRecords:function(a,b,c){var d=[],g,f;g=0;for(f=a.length;g<f;g++)d.push(this.getRecordId(a[g]));return this.deleteById(d,
b,c)},loadOr:function(a,b,c){this.local||this.isLoading()||(this.isLoaded()?a&&a.call(b||this):this.load(null,c))},addPrevPage:function(a){a=a||{};a.append=!1;a.prepend=!0;a.noopOnEmpty=!0;return this.loadPrevPage(a)},addNextPage:function(a){a=a||{};a.append=!0;a.prepend=!1;a.noopOnEmpty=!0;if(!this.local&&(!this.totalLength||this.length<this.totalLength))return this.load({start:this.length,limit:this.pageSize},a)},loadNextPage:function(a){if(!this.local&&(!this.totalLength||this.length<this.totalLength))return this.start+=
this.pageSize,this.load(null,a)},loadPrevPage:function(a){if(!this.local&&0<this.start)return this.start-=this.pageSize,0>this.start&&(this.start=0),this.load(null,a)},loadPage:function(a,b){if(!this.local)return this.start=parseInt(a,10),0>this.start&&(this.start=0),this.load(null,b)},getRecordId:function(a){return a instanceof q?a.getId():a[this.idProp]||null},getRecordData:function(a){return this.model.isPlain()?a:a.data},processRawDataItem:function(a){if(a instanceof q||this.model.isPlain())return a;
var b=this.model.type,c=this.getRecordId(a),d;c&&(d=n.getFromCache(b,c));d||(d=x(b,c,a,{model:this.model,standalone:!1}));return d},bindRecord:function(a,b){b[a]("change",this.onRecordChange,this);b[a]("destroy",this.onRecordDestroy,this);b[a]("dirtychange",this.onRecordDirtyChange,this);return b},onRecordDirtyChange:function(a){this.trigger("update",this,a)},onRecordChange:function(a,b,c,d){this.trigger("update",this,a)},onRecordDestroy:function(a){this.remove(a)},shift:function(a,b,c){return this.removeAt(0,
a,b,c)},unshift:function(a,b,c){return this.insert(0,a,b,c)},pop:function(a,b,c){return this.removeAt(this.length-1,a,b,c)},addMany:function(a,b,c){var d,g,f=this.length;d=0;for(g=a.length;d<g;d++)this.insert(f+d,a[d],!0,!0);c||this.update();0<g&&!b&&this.trigger("add",a)},add:function(a,b,c){return this.insert(this.length,a,b,c)},onAdd:m,removeAt:function(a,b,c,d){d||(a=this.items.indexOf(this.current[a]));if(a<this.length&&0<=a)return this.length--,d=this.items[a],this.items.splice(a,1),a=this.getRecordId(d),
void 0!=a&&(delete this.map[a],delete this.currentMap[a]),this.onRemove(d,a),c||this.update(),b||this.trigger("remove",d,a),d instanceof q?(this.bindRecord("un",d),d.detachStore(this),d.$destroyed?void 0:d):d},onRemove:m,insertMany:function(a,b,c,d){var g,f;g=0;for(f=b.length;g<f;g++)this.insert(a+g,b[g],!0,!0);0<f&&!d&&this.update();0<f&&!c&&this.trigger("add",b)},insert:function(a,b,c,d){var g,f=!1;b=this.processRawDataItem(b);g=this.getRecordId(b);this.map[g]&&(this.suspendAllEvents(),this.removeId(g),
this.resumeAllEvents());a>=this.length?(this.items.push(b),f=!0):this.items.splice(a,0,b);this.length++;this.maxLength&&this.length>this.maxLength&&(f?this.pop(c,!0):this.shift(c,!0));void 0!=g&&(this.map[g]=b);b instanceof q&&(b.attachStore(this),this.bindRecord("on",b));this.onAdd(a,b);d||this.update();c||this.trigger("add",[b]);return b},replace:function(a,b,c,d){var g;g=this.items.indexOf(a);this.removeAt(g,!0,!0,!0);this.insert(g,b,!0,!0);d||this.update();c||this.trigger("replace",a,b);return b},
onReplace:m,remove:function(a,b,c){return this.removeAt(this.indexOf(a,!0),b,c,!0)},removeId:function(a,b,c){return this.removeAt(this.indexOfId(a,!0),b,c,!0)},contains:function(a,b){return-1!=this.indexOf(a,b)},containsId:function(a,b){return b?void 0!==this.map[a]:void 0!==this.currentMap[a]},clear:function(a){var b=this.getRange();this._reset();this.onClear();a||this.trigger("clear",b)},onClear:m,reset:function(){this._reset();this.start=0},_reset:function(a){var b,c;if(!a)for(a=0,b=this.items.length;a<
b;a++)c=this.items[a],c instanceof q&&(this.bindRecord("un",c),c.detachStore(this));this.totalLength=this.currentLength=this.length=0;this.items=[];this.current=[];this.map={};this.currentMap={};this.loaded=this.local},getAt:function(a,b){return b?this.items[a]||void 0:this.current[a]||void 0},getById:function(a,b){return b?this.map[a]||void 0:this.currentMap[a]||void 0},indexOf:function(a,b){return b?this.items.indexOf(a):this.current.indexOf(a)},indexOfId:function(a,b){return this.indexOf(this.getById(a,
b),b)},each:function(a,b,c){c=c?this.items.slice():this.current.slice();for(var d=0,g=c.length;d<g&&!1!==a.call(b,c[d],d,g);d++);},eachId:function(a,b,c){var d=this;d.each(function(c,e,h){return a.call(b,d.getRecordId(c),e,h)},null,c)},collect:function(a,b){var c=[],d=!this.model.isPlain();this.each(function(b){(b=d?b.get(a):b[a])&&c.push(b)},null,b);return c},first:function(a){return a?this.items[0]:this.current[0]},last:function(a){return a?this.items[this.length-1]:this.current[this.current-1]},
getRange:function(a,b,c){c=c?this.items:this.current;var d=[];if(1>c.length)return d;a=a||0;b=Math.min(void 0==b?this.length-1:b,this.length-1);if(a<=b)for(;a<=b;a++)d.push(c[a]);else for(;a>=b;a--)d.push(c[a]);return d},findBy:function(a,b,c,d){a=this.findIndexBy(a,b,c,d);return-1==a?void 0:this.getAt(a,d)},findIndexBy:function(a,b,c,d){d=d?this.items:this.current;c=c||0;for(var g=d.length;c<g;c++)if(a.call(b,d[c],this.getRecordId(d[c])))return c;return-1},find:function(a,b,c,d){var g=!this.model.isPlain(),
f;return this.findIndexBy(function(d){f=g?d.get(a):d[a];return c?f===b:f==b},this,0,d)},findExact:function(a,b,c){return this.find(a,b,!0,c)},findBySet:function(a,b){var c=null,d,g;this.each(function(b){d=!0;for(g in a)if(a[g]!=b[g]){d=!1;break}return d?(c=b,!1):!0},null,b);return c},update:function(){var a=this,b=a.filtered,c=a.sorted;a.currentLength=a.length;a.currentMap=a.map;a.current=a.items;if(b){var d=a.filterBy,g=a.filterOpt,f,h;a.current=f=[];a.currentMap=h={};a.each(function(b){I.compare(b.data,
d,g)&&(f.push(b),h[a.getRecordId(b)]=b)},null,!0);a.currentLength=a.current.length}if(c){var l=a.sortBy,k=!a.model.isPlain();a.current=E(a.current,function(a){return k?a.get(l):a[l]},a.sortDir)}a.trigger("update",a)},filter:function(a,b){this.filtered=!0;this.filterBy=a;this.filterOpt=b;this.update()},clearFilter:function(){this.filtered&&(this.filterOpt=this.filterBy=null,this.update())},sort:function(a,b){this.sorted=!0;this.sortBy=a;this.sortDir=b;this.update()},clearSorting:function(){this.sorted=
!1;this.sortDir=this.sortBy=null;this.update()},destroy:function(){delete c[this.id];this.clear();this.$super()}},{lookupStore:function(a){return c[a]||null},eachStore:function(a,b){for(var e in c)if(!1===a.call(b||window,c[e]))break}})})();return t});
