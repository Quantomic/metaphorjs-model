define("metaphorjs-model",["metaphorjs-ajax","metaphorjs-promise","metaphorjs-namespace","metaphorjs-class","metaphorjs"],function(q,A,I,J,v){var t=v.cs.define,n=v.cs.factory,C=v.cs.isInstanceOf,u=Function.prototype.bind?function(b,a){return b.bind(a)}:function(b,a){return function(){return b.apply(a,arguments)}},D=Object.prototype.toString,w=function(){var b={"[object String]":0,"[object Number]":1,"[object Boolean]":2,"[object Object]":3,"[object Function]":4,"[object Array]":5,"[object RegExp]":9,
"[object Date]":10};return function(a){if(!a){if(null===a)return 6;if(void 0===a)return 7}var c=b[D.call(a)];return void 0===c?-1:1==c&&isNaN(a)?8:c}}(),r=function(b){return"string"==typeof b||0===w(b)},m=function(){},E=Array.prototype.slice,x=function(b){return"object"==typeof b&&3===w(b)&&!b.nodeType},B=function(b){return!0===b||!1===b},p=function(){return function a(){var c=!1,e=!1,d=E.call(arguments),f=d.shift(),g,h,l;B(d[d.length-1])&&(c=d.pop());B(d[d.length-1])&&(e=c,c=d.pop());for(;d.length;)if(g=
d.shift())for(h in g)if(g.hasOwnProperty(h)&&void 0!==(l=g[h]))if(e)if(f[h]&&x(f[h])&&x(l))a(f[h],l,c,e);else{if(!0===c||void 0==f[h])x(l)?(f[h]={},a(f[h],l,c,!0)):f[h]=l}else if(!0===c||void 0==f[h])f[h]=l;return f}}(),y=function(){var b={},a={};return t("MetaphorJs.data.Model",{type:null,fields:null,record:null,store:null,plain:!1,lastAjaxResponse:null,initialize:function(a){this.fields={};p(this,{record:{load:null,save:null,"delete":null,id:null,data:null,success:null,extra:{}},store:{load:null,
save:null,"delete":null,id:null,data:null,total:null,start:null,limit:null,success:null,extra:{}}},!1,!0);p(this,a,!0,!0);this.plain=!this.type},isPlain:function(){return this.plain},getRecordProp:function(a,e){return this.getProp("record",a,e)},setRecordProp:function(a,e){this.record[a]=e},getStoreProp:function(a,e){return this.getProp("store",a,e)},setStoreProp:function(a,e){this.store[a]=e},getProp:function(a,e,d){a=this[a];return a[e]&&a[e][d]||a[d]||this[d]||null},setProp:function(a,e){return this[a]=
e},_createAjaxCfg:function(a,e,d,b,g){var h=this,l=h[a],k=p({},r(l[e])?{url:l[e]}:l[e]),m=h.getProp(a,e,"id"),n=h.getProp(a,e,"data"),q=h.getProp(a,e,"url"),s=h.getProp(a,e,"json");if(!k)if(q)k={url:q};else throw a+"."+e+" not defined";r(k)&&(k={url:k});if(!k.url){if(!q)throw a+"."+e+" url not defined";k.url=q}k.data=p({},k.data,h.extra,l.extra,l[e]?l[e].extra:{},g,!0,!0);k.method||(k.method="load"==e?"GET":"POST");d&&(k.data[m]=d);b&&(n?k.data[n]=b:k.data=b);s&&k.data&&"GET"!=k.method&&(k.data=JSON.stringify(k.data));
k.callbackScope=h;"record"==a?k.processResponse=function(a,c){h.lastAjaxResponse=a;h._processRecordResponse(e,a,c)}:"store"==a&&(k.processResponse=function(a,c){h.lastAjaxResponse=a;h._processStoreResponse(e,a,c)});return k},_processRecordResponse:function(a,e,d){var b=this.getRecordProp(a,"id"),g=this.getRecordProp(a,"data"),b=(g=g?e[g]:e)&&g[b]||e[b];this._getSuccess("record",a,e)?d.resolve({id:b,data:g}):d.reject(e)},_processStoreResponse:function(a,e,d){var b=this.getStoreProp(a,"data"),g=this.getStoreProp(a,
"total"),b=b?e[b]:e,g=g?e[g]:null;this._getSuccess("store",a,e)?d.resolve({data:b,total:g}):d.reject(e)},_getSuccess:function(a,e,d){return(a=this.getProp(a,e,"success"))&&void 0!=d[a]?d[a]:!0},loadRecord:function(a){return q(this._createAjaxCfg("record","load",a))},saveRecord:function(a,e,d){return q(this._createAjaxCfg("record",a.getId()?"save":"create",a.getId(),p({},a.storeData(a.getData(e)),d)))},deleteRecord:function(a){return q(this._createAjaxCfg("record","delete",a.getId()))},loadStore:function(a,
e){return q(this._createAjaxCfg("store","load",null,null,e))},saveStore:function(a,e){return q(this._createAjaxCfg("store","save",null,e))},deleteRecords:function(a,e){return q(this._createAjaxCfg("store","delete",e))},getFields:function(){return this.fields},restoreField:function(a,e,d){var b=this.fields[e];if(b){switch(r(b)?b:b.type){case "int":d=parseInt(d);break;case "bool":case "boolean":r(d)?(d=d.toLowerCase(),d=!("off"===d||"no"===d||"0"===d||"false"==d||"null"==d)):d=d?!0:!1;break;case "double":case "float":d=
parseFloat(d);break;case "date":b.parseFn?d=b.parseFn(d,b.format):Date.parse?d=Date.parse(d,b.format):("timestamp"==b.format&&(d=1E3*parseInt(d)),d=new Date(d))}b.restore&&(d=b.restore.call(a,d,e))}return this.onRestoreField(a,e,d)},onRestoreField:function(a,e,d){return d},storeField:function(a,e,d){var b=this.fields[e];if(b){switch(r(b)?b:b.type){case "bool":case "boolean":d=d?"1":"0";break;case "date":d=b.formatFn?b.formatFn(d,b.format):Date.format?Date.format(d,b.format):"timestamp"==b.format?
d.getTime()/1E3:d.format?d.format(b.format):d.toString();break;default:d=d.toString()}b.store&&(d=b.store.call(a,d,e))}return this.onStoreField(a,e,d)},onStoreField:function(a,e,d){return d}},{create:function(a,e){return"MetaphorJs.data.Model"==a?n(a,e):e?n(a,e):b[a]?b[a]:b[a]=n(a)},addToCache:function(c){var e=c.getClass(),d=c.getId();"MetaphorJs.data.Record"!=e&&(a[e]||(a[e]={}),a[e][d]=c)},getFromCache:function(c,e){return a[c]&&a[c][e]?a[c][e]:null},removeFromCache:function(c,e){a[c]&&a[c][e]&&
delete a[c][e]}})}();t("MetaphorJs.cmp.Base",{destroyed:!1,_observable:null,initialize:function(b){b=b||{};this._observable=new Observable;p(this,this._observable.getApi(),!0,!1);if(b.callback){var a=b.callback,c=a.scope||this;delete a.scope;for(var e in a)if(a.hasOwnProperty(e))this.on(e,a[e],c);delete b.callback}p(this,b,!0,!1)},destroy:function(){if(!this.destroyed){if(!1===this.trigger("beforedestroy",this))return!1;this.onDestroy();this.destroyed=!0;this.trigger("destroy",this);this._observable.destroy();
delete this._observable}},onDestroy:m});var s=t("MetaphorJs.data.Record","MetaphorJs.cmp.Base",{id:null,data:null,orig:null,modified:null,loaded:!1,dirty:!1,destroyed:!1,model:null,standalone:!0,stores:null,initialize:function(b,a,c){var e=arguments.length;1==e?(c=b,a=b=null):2==e&&(c=a,a=null);this.data={};this.orig={};this.stores=[];this.modified={};c=c||{};this.supr(c);r(this.model)?this.model=n(this.model):C(this.model,"MetaphorJs.data.Model")||(this.model=n("MetaphorJs.data.Model",this.model));
this.id=b;a?this.importData(a):!1!==c.autoLoad&&b&&this.load();"MetaphorJs.data.Record"!=this.getClass()&&y.addToCache(this)},isLoaded:function(){return this.loaded},isStandalone:function(){return this.standalone},isDirty:function(){return this.dirty},getModel:function(){return this.model},attachStore:function(b){b=b.getId();-1==this.stores.indexOf(b)&&this.stores.push(b)},detachStore:function(b){b=b.getId();var a;this.destroyed||-1==(a=this.stores.indexOf(b))||(this.stores.splice(a,1),0!=this.stores.length||
this.standalone||this.destroy())},setDirty:function(b){this.dirty!=b&&(this.dirty=!!b,this.trigger("dirtychange",this,b))},importData:function(b){var a={},c;if(b){for(c in b)a[c]=this.model.restoreField(this,c,b[c]);this.data=a}this.orig=p({},this.data);this.modified={};this.loaded=!0;this.setDirty(!1)},storeData:function(b){var a={},c;for(c in b)a[c]=this.model.storeField(this,c,b[c]);return a},getId:function(){return this.id},getData:function(b){if(b){var a={},c,e;b=r(b)?[b]:b;c=0;for(e=b.length;c<
e;c++)a[b[c]]=this.data[b[c]];return a}return p({},this.data)},getChanged:function(){return p({},this.modified)},isChanged:function(b){return this.modified[b]||!1},get:function(b){return this.data[b]},setId:function(b){!this.id&&b&&(this.id=b)},set:function(b,a){var c=this.data[b];a=this.model.restoreField(this,b,a);this.data[b]=a;c!=a&&(this.modified[b]=!0,this.setDirty(!0),this.trigger("change",this,b,a,c),this.trigger("change-"+b,this,b,a,c))},revert:function(){this.dirty&&(this.data=p({},this.orig),
this.modified={},this.setDirty(!1))},load:function(){var b=this;b.trigger("beforeload",b);return b.model.loadRecord(b.id).done(function(a){b.setId(a.id);b.importData(a.data);b.trigger("load",b)}).fail(function(){b.trigger("failedload",b)})},save:function(b,a){var c=this;c.trigger("beforesave",c);return c.model.saveRecord(c,b,a).done(function(a){c.setId(a.id);c.importData(a.data);c.trigger("save",c)}).fail(function(a){c.trigger("failedsave",c)})},"delete":function(){var b=this;b.trigger("beforedelete",
b);return b.model.deleteRecord(b).done(function(){b.trigger("delete",b);b.destroy()}).fail(function(){b.trigger("faileddelete",b)})},reset:function(){this.id=null;this.data={};this.orig={};this.modified={};this.dirty=this.loaded=!1;this.trigger("reset",this)},destroy:function(){this.destroyed||(this.destroyed=!0,this.trigger("destroy",this),this.stores=this.model=this.modified=this.orig=this.data=null,y.removeFromCache(this.getClass(),this.id),this.supr())}}),z=function(b){return"object"==typeof b&&
5===w(b)},F=function(){var b=["0","0","0"];return function(){for(var a=b.length,c;a;){a--;c=b[a].charCodeAt(0);if(57==c)return b[a]="A",b.join("");if(90==c)b[a]="0";else return b[a]=String.fromCharCode(c+1),b.join("")}b.unshift("0");return b.join("")}}(),G=function(){var b=function(a,c,b){if("function"==typeof c)return c(a,b);if(""===c||void 0===c)return!0;if(void 0!==a){if(B(a))return a===c;if(c instanceof RegExp)return c.test(""+a);if("strict"==b)return""+a===""+c;if(!0===b||null===b||void 0===
b)return-1!=""+a.indexOf(c);if(!1===b)return-1==""+a.indexOf(c)}return!1},a=function(a,c,f){var g=w(a);if(3>g&&-1<g)return void 0===c.$?!0:b(a,c.$,f);var h,l;for(h in c)if("$"==h)for(l in a){if(b(a[l],c.$,f))return!0}else if(b(a[h],c[h],f))return!0;return!1},c=function(c,d,b){x(d)||(d={$:d});var g=[],h,l;h=-1;for(l=c.length;++h<l;)a(c[h],d,b)&&g.push(c[h]);return g};c.compare=a;return c}(),H=function(b,a,c){c||(c="asc");b=b.slice();b.sort(function(c,d){var b=typeof c,g=c,h=d;if(b!=typeof d)return 0;
"object"==b&&("function"==typeof a?(g=a(c),h=a(d)):(g=c[a],h=d[a]));if("number"==typeof g)return g-h;g=(""+g).toLowerCase();h=(""+h).toLowerCase();return g===h?0:g>h?1:-1});return"desc"==c?b.reverse():b};A=Array.prototype.indexOf;A||(A=Array.prototype.indexOf=function(b,a){var c;if(null==this)throw new TypeError('"this" is null or not defined');var e=Object(this),d=e.length>>>0;if(0===d)return-1;c=+a||0;Infinity===Math.abs(c)&&(c=0);if(c>=d)return-1;for(c=Math.max(0<=c?c:d-Math.abs(c),0);c<d;){if(c in
e&&e[c]===b)return c;c++}return-1});(function(){var b={};return t("MetaphorJs.data.Store","MetaphorJs.cmp.Base",{id:null,autoLoad:!1,clearOnLoad:!0,model:null,extraParams:null,loaded:!1,loading:!1,local:!1,items:null,current:null,map:null,currentMap:null,length:0,currentLength:0,maxLength:0,totalLength:0,start:0,pageSize:null,pages:null,filtered:!1,sorted:!1,filterBy:null,filterOpt:null,sortBy:null,sortDir:null,publicStore:!1,idProp:null,initialize:function(a,c,e){this.items=[];this.current=[];this.map=
{};this.currentMap={};this.loaded=!1;this.extraParams=this.extraParams||{};a&&!r(a)&&(e=c,c=a,a=null);c=c||{};a&&(c.url=a);this.supr(c);this.id=this.id||F();this.publicStore&&(b[this.id]=this);this.initModel(c);this.createEvent("beforeload",!1);!this.local&&this.autoLoad?this.load():e&&(z(e)?this._loadArray(e):this._loadAjaxData(e));this.local&&(this.loaded=!0)},initModel:function(a){r(this.model)?this.model=n(this.model):this.model instanceof y||(this.model=n("MetaphorJs.data.Model",this.model));
a.url&&(this.model.store.load=a.url);this.idProp=this.model.getStoreProp("load","id")},getId:function(){return this.id},isLoaded:function(){return this.loaded},isLocal:function(){return this.local},setLocal:function(a){this.local=!!a},isLoading:function(){return this.loading},isFiltered:function(){return this.filtered},isSorted:function(){return this.sorted},getLength:function(a){return a?this.length:this.currentLength},getTotalLength:function(){return this.totalLength||this.currentLength},getPagesCount:function(){return null!==
this.pageSize?parseInt(this.totalLength/this.pageSize):1},setParam:function(a,c){this.extraParams[a]=c},getParam:function(a){return this.extraParams[a]},setStart:function(a){this.start=a},setPageSize:function(a){this.pageSize=a},getAjaxData:function(){return this.ajaxData},hasDirty:function(a){if(this.model.isPlain())return!1;var c=!1;this.each(function(a){return a.isDirty()?(c=!0,!1):!0},null,a);return c},getDirty:function(a){var c=[];if(this.model.isPlain())return c;this.each(function(a){a.isDirty()&&
c.push(a)},null,a);return c},getModel:function(){return this.model},_loadAjaxData:function(a,c){var e=this;c=c||{};if(c.silent||!1!==e.trigger("beforeload",e))e.ajaxData=a,e.model._processStoreResponse("load",a,{resolve:function(a){e._onModelLoadSuccess(a,c)},reject:function(a){e._onModelLoadFail(a,c)}})},_loadArray:function(a,c){c=c||{};(c.silent||!1!==this.trigger("beforeload",this))&&z(a)&&(this._load(a,c),this.totalLength=this.length)},_load:function(a,c){var e=c.prepend;c=c||{};for(var b=0;b<
a.length;b++)e?this.insert(b,a[b],!0,!0):this.add(a[b],!0,!0);this.loaded=!0;this.loading=!1;this.onLoad();c.skipUpdate||this.update();c.silent||this.trigger("load",this)},load:function(a,c){var e=this,b=e.model.store,f=b.start,b=b.limit,g=e.pageSize;c=c||{};if(e.local)return null;a=p({},e.extraParams,a||{});null===g||a[f]||a[b]||(f&&(a[f]=e.start),b&&(a[b]=g));if(!c.silent&&!1===e.trigger("beforeload",e))return null;e.loading=!0;return e.model.loadStore(e,a).done(function(a){e.ajaxData=e.model.lastAjaxResponse;
e._onModelLoadSuccess(a,c)}).fail(function(a){e.ajaxData=e.model.lastAjaxResponse;e._onModelLoadFail(a,c)})},_onModelLoadSuccess:function(a,c){this.clearOnLoad&&0<this.length&&this.clear();this.totalLength=parseInt(a.total);this._load(a.data,c)},_onModelLoadFail:function(a,c){this.onFailedLoad();c.silent||this.trigger("failedload",this,a)},onLoad:m,onFailedLoad:m,save:function(a){var c=this,e={},b=0;if(c.local)return null;if(c.model.isPlain())throw Error("Cannot save plain store");c.each(function(a){a.isDirty()&&
(e[a.getId()]=a.storeData(a.getData()),b++)});if(!b)throw Error("Nothing to save");return a||!1!==c.trigger("beforesave",c,e)?c.model.saveStore(c,e).done(function(e){c._onModelSaveSuccess(e,a)}).fail(function(e){c._onModelSaveFail(e,a)}):null},_onModelSaveSuccess:function(a,c){var e,b,f,g=a.data;if(g&&g.length)for(e=0,b=g.length;e<b;e++)f=this.getRecordId(g[e]),(f=this.getById(f))&&f.importData(g[e]);this.onSave();c||this.trigger("save",this)},_onModelSaveFail:function(a,c){this.onFailedSave(a);c||
this.trigger("failedsave",this)},onSave:m,onFailedSave:m,deleteById:function(a,c,e){var b=this,f,g,h;if(b.local)return null;if(!a||z(a)&&!a.length)throw Error("Record id required");z(a)||(a=[a]);f=0;for(g=a.length;f<g;f++)h=b.getById(a[f]),b.remove(h,c,e),h instanceof s&&h.destroy();return c||!1!==b.trigger("beforedelete",b,a)?b.model.deleteRecords(b,a).done(function(){b.totalLength-=a.length;b.onDelete();c||b.trigger("delete",b,a)}).fail(function(){b.onFailedDelete();c||b.trigger("faileddelete",
b,a)}):null},onDelete:m,onFailedDelete:m,deleteAt:function(a,c,b){var d=this.getAt(a);if(!d)throw Error("Record not found at "+a);return this["delete"](d,c,b)},"delete":function(a,c,b){return this.deleteById(this.getRecordId(a),c,b)},deleteRecords:function(a,c,b){var d=[],f,g;f=0;for(g=a.length;f<g;f++)d.push(this.getRecordId(a[f]));return this.deleteById(d,c,b)},loadOr:function(a,c,b){this.local||this.isLoading()||(this.isLoaded()?a&&a.call(c||this):this.load(null,b))},addNextPage:function(a){!this.local&&
this.length<this.totalLength&&this.load({start:this.length,limit:this.pageSize},a)},loadNextPage:function(a){this.local||(this.start+=this.pageSize,this.load(null,a))},loadPrevPage:function(a){this.local||(this.start-=this.pageSize,0>this.start&&(this.start=0),this.load(null,a))},loadPage:function(a,c){this.local||(this.start=parseInt(a,10),0>this.start&&(this.start=0),this.load(null,c))},getRecordId:function(a){return a instanceof s?a.getId():a[this.idProp]||null},getRecordData:function(a){return this.model.isPlain()?
a:a.data},processRawDataItem:function(a){if(a instanceof s||this.model.isPlain())return a;var c=this.model.type,b=this.getRecordId(a),d;b&&(d=y.getFromCache(c,b));d||(d=n(c,b,a,{model:this.model,standalone:!1}));return d},bindRecord:function(a,c){c[a]("change",this.onRecordChange,this);c[a]("destroy",this.onRecordDestroy,this);c[a]("dirtychange",this.onRecordDirtyChange,this);return c},onRecordDirtyChange:function(a){this.trigger("update",this,a)},onRecordChange:function(a,c,b,d){this.trigger("update",
this,a)},onRecordDestroy:function(a){this.remove(a)},shift:function(a,c,b){return this.removeAt(0,a,c,b)},unshift:function(a,c,b){return this.insert(0,a,c,b)},pop:function(a,c,b){return this.removeAt(this.length-1,a,c,b)},addMany:function(a,c,b){var d,f,g=this.length;d=0;for(f=a.length;d<f;d++)this.insert(g+d,a[d],!0,!0);b||this.update();0<f&&!c&&this.trigger("add",a)},add:function(a,c,b){return this.insert(this.length,a,c,b)},onAdd:m,removeAt:function(a,c,b,d){d||(a=this.items.indexOf(this.current[a]));
if(a<this.length&&0<=a)return this.length--,d=this.items[a],this.items.splice(a,1),a=this.getRecordId(d),void 0!=a&&(delete this.map[a],delete this.currentMap[a]),this.onRemove(d,a),b||this.update(),c||this.trigger("remove",d,a),d instanceof s?(this.bindRecord("un",d),d.detachStore(this),d.destroyed?void 0:d):d},onRemove:m,insertMany:function(a,c,b,d){var f,g;f=0;for(g=c.length;f<g;f++)this.insert(a+f,c[f],!0,!0);0<g&&!d&&this.update();0<g&&!b&&this.trigger("add",c)},insert:function(a,c,b,d){var f,
g=!1;c=this.processRawDataItem(c);f=this.getRecordId(c);this.map[f]&&(this.suspendAllEvents(),this.removeId(f),this.resumeAllEvents());a>=this.length?(this.items.push(c),g=!0):this.items.splice(a,0,c);this.length++;this.maxLength&&this.length>this.maxLength&&(g?this.pop(b,!0):this.shift(b,!0));void 0!=f&&(this.map[f]=c);c instanceof s&&(c.attachStore(this),this.bindRecord("on",c));this.onAdd(a,c);d||this.update();b||this.trigger("add",[c]);return c},replace:function(a,c,b,d){var f;f=this.items.indexOf(a);
this.removeAt(f,!0,!0,!0);this.insert(f,c,!0,!0);d||this.update();b||this.trigger("replace",a,c);return c},onReplace:m,remove:function(a,c,b){return this.removeAt(this.indexOf(a,!0),c,b,!0)},removeId:function(a,c,b){return this.removeAt(this.indexOfId(a,!0),c,b,!0)},contains:function(a,c){return-1!=this.indexOf(a,c)},containsId:function(a,c){return c?void 0!==this.map[a]:void 0!==this.currentMap[a]},clear:function(){var a=this.getRange();this._reset();this.onClear();this.trigger("clear",a)},onClear:m,
reset:function(){this._reset();this.start=0},_reset:function(a){var c,b;if(!a)for(a=0,c=this.items.length;a<c;a++)b=this.items[a],b instanceof s&&(this.bindRecord("un",b),b.detachStore(this));this.totalLength=this.currentLength=this.length=0;this.items=[];this.current=[];this.map={};this.currentMap={};this.loaded=this.local},getAt:function(a,c){return c?this.items[a]||void 0:this.current[a]||void 0},getById:function(a,c){return c?this.map[a]||void 0:this.currentMap[a]||void 0},indexOf:function(a,
c){return c?this.items.indexOf(a):this.current.indexOf(a)},indexOfId:function(a,c){return this.indexOf(this.getById(a,c),c)},each:function(a,c,b){b=b?this.items.slice():this.current.slice();for(var d=0,f=b.length;d<f&&!1!==a.call(c,b[d],d,f);d++);},eachId:function(a,c,b){var d=this;d.each(function(b,e,h){return a.call(c,d.getRecordId(b),e,h)},null,b)},collect:function(a,c){var b=[],d=!this.model.isPlain();this.each(function(c){(c=d?c.get(a):c[a])&&b.push(c)},null,c);return b},first:function(a){return a?
this.items[0]:this.current[0]},last:function(a){return a?this.items[this.length-1]:this.current[this.current-1]},getRange:function(a,c,b){b=b?this.items:this.current;var d=[];if(1>b.length)return d;a=a||0;c=Math.min(void 0==c?this.length-1:c,this.length-1);if(a<=c)for(;a<=c;a++)d.push(b[a]);else for(;a>=c;a--)d.push(b[a]);return d},findBy:function(a,c,b,d){a=this.findIndexBy(a,c,b,d);return-1==a?void 0:this.getAt(a,d)},findIndexBy:function(a,c,b,d){d=d?this.items:this.current;b=b||0;for(var f=d.length;b<
f;b++)if(a.call(c,d[b],this.getRecordId(d[b])))return b;return-1},find:function(a,b,e,d){var f=!this.model.isPlain(),g;return this.findIndexBy(function(d){g=f?d.get(a):d[a];return e?g===b:g==b},this,0,d)},findExact:function(a,b,e){return this.find(a,b,!0,e)},findBySet:function(a,b){var e=null,d,f;this.each(function(b){d=!0;for(f in a)if(a[f]!=b[f]){d=!1;break}return d?(e=b,!1):!0},null,b);return e},update:function(){var a=this,b=a.filtered,e=a.sorted;a.currentLength=a.length;a.currentMap=a.map;a.current=
a.items;if(b){var d=a.filterBy,f=a.filterOpt,g,h;a.current=g=[];a.currentMap=h={};a.each(function(b){G.compare(b.data,d,f)&&(g.push(b),h[a.getRecordId(b)]=b)},null,!0);a.currentLength=a.current.length}if(e){var l=a.sortBy,k=!a.model.isPlain();a.current=H(a.current,function(a){return k?a.get(l):a[l]},a.sortDir)}a.trigger("update",a)},filter:function(a,b){this.filtered=!0;this.filterBy=a;this.filterOpt=b;this.update()},clearFilter:function(){this.filtered&&(this.filterOpt=this.filterBy=null,this.update())},
sort:function(a,b){this.sorted=!0;this.sortBy=a;this.sortDir=b;this.update()},clearSorting:function(){this.sorted=!1;this.sortDir=this.sortBy=null;this.update()},onDestroy:function(){delete b[this.id];this.clear();this.supr()}},{createFromSelect:function(a){var b=[];a=a.options;for(var e=0,d=a.length;e<d;e++){var f=a[e],g=(f.hasAttribute?f.hasAttribute("value"):f.getAttributeNode("value").specified)?f.value:f.text;b.push([g,f.text])}a=n("MetaphorJs.data.Store",{server:{load:{id:0}}});a._loadArray(b);
return a},lookupStore:function(a){return b[a]||null},eachStore:function(a,c){for(var e in b)if(!1===a.call(c||window,b[e]))break}})})();t("MetaphorJs.data.FirebaseStore","MetaphorJs.data.Store",{firebase:null,initialize:function(b){this.firebase=r(b)?new Firebase(b):b;this.firebase.on("child_added",u(this.onChildAdded,this));this.firebase.on("child_removed",u(this.onChildRemoved,this));this.firebase.on("child_changed",u(this.onChildChanged,this));this.firebase.on("child_moved",u(this.onChildMoved,
this));this.supr()},initModel:m,ref:function(){return this.firebase.ref?this.firebase.ref():this.firebase},load:function(){if(!this.loaded)this.firebase.once("value",u(this.onSnapshotLoaded,this))},onSnapshotLoaded:function(b){var a=this;b.forEach(function(b){a.add(b,!0,!0)});a.update();a.loaded=!0;a.trigger("load",a)},onChildAdded:function(b,a){if(this.loaded){var c=this.indexOfId(a,!0);this.insert(c+1,b)}},onChildRemoved:function(b){this.loaded&&this.removeId(b.name())},onChildChanged:function(b,
a){if(this.loaded){var c=this.getById(b.name(),!0);this.replace(c,b)}},onChildMoved:function(b,a){},getRecordId:function(b){return b.name()},getRecordData:function(b){return b.val()},processRawDataItem:function(b){return b},bindRecord:m});return v.data});
